{"sha": "7e1bd23f8bd52eab67e56118eac33380f176449e", "filename": "superset-frontend/plugins/plugin-chart-echarts/src/utils/tooltip.test.tsx", "status": "added", "additions": 87, "deletions": 0, "changes": 87, "blob_url": "https://github.com/apache/superset/blob/4ddb70d86c42553b8c7d7ee4c017ae29242cd864/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2Futils%2Ftooltip.test.tsx", "raw_url": "https://github.com/apache/superset/raw/4ddb70d86c42553b8c7d7ee4c017ae29242cd864/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2Futils%2Ftooltip.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2Futils%2Ftooltip.test.tsx?ref=4ddb70d86c42553b8c7d7ee4c017ae29242cd864", "patch": "@@ -0,0 +1,87 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+/** @jest-environment jsdom */\n+import '@testing-library/jest-dom';\n+import React from 'react';\n+import { getDefaultTooltip } from './tooltip';\n+import type { Refs } from '../types';\n+\n+test('getDefaultTooltip computes height and sets scroll styles', () => {\n+  const div = document.createElement('div');\n+  jest.spyOn(div, 'getBoundingClientRect').mockReturnValue({\n+    x: 0,\n+    y: 0,\n+    width: 100,\n+    height: 100,\n+    top: 0,\n+    right: 100,\n+    bottom: 100,\n+    left: 0,\n+    toJSON: () => ({}),\n+  } as DOMRect);\n+\n+  const divRef = React.createRef<HTMLDivElement>();\n+  Object.defineProperty(divRef, 'current', { value: div });\n+\n+  const refs: Refs = { divRef };\n+\n+  // Set viewport dimensions\n+  Object.defineProperty(document.documentElement, 'clientWidth', {\n+    value: 1200,\n+    configurable: true,\n+  });\n+  Object.defineProperty(document.documentElement, 'clientHeight', {\n+    value: 1000,\n+    configurable: true,\n+  });\n+\n+  const tooltip = getDefaultTooltip(refs);\n+\n+  // Test behavioral properties\n+  expect(tooltip.enterable).toBe(true);\n+  expect(tooltip.confine).toBe(true);\n+  expect(tooltip.hideDelay).toBe(50);\n+\n+  // Test that position function exists and is callable\n+  expect(typeof tooltip.position).toBe('function');\n+\n+  // Test position function behavior - returns coordinates\n+  const tooltipDom = document.createElement('div');\n+  const result = tooltip.position(\n+    [200, 300],\n+    {} as any,\n+    tooltipDom,\n+    {} as any,\n+    { contentSize: [300, 600], viewSize: [1200, 1000] },\n+  );\n+\n+  // Verify position returns coordinate tuple\n+  expect(Array.isArray(result)).toBe(true);\n+  expect(result).toHaveLength(2);\n+  expect(typeof result[0]).toBe('number');\n+  expect(typeof result[1]).toBe('number');\n+\n+  const computedMaxHeight = parseInt(tooltipDom.style.maxHeight, 10);\n+  const viewportHeight = 1000;\n+  const expectedMaxHeight = Math.min(800, viewportHeight * 0.8);\n+\n+  expect(computedMaxHeight).toBe(expectedMaxHeight);\n+  expect(tooltipDom).toHaveStyle({ overflow: 'auto' });\n+});", "pull_request_number": 37022}
{"sha": "5c6566900932a0a88679f7d4f7a37cb98f6cf60e", "filename": "superset-frontend/plugins/plugin-chart-echarts/src/utils/tooltip.ts", "status": "modified", "additions": 26, "deletions": 4, "changes": 30, "blob_url": "https://github.com/apache/superset/blob/4ddb70d86c42553b8c7d7ee4c017ae29242cd864/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2Futils%2Ftooltip.ts", "raw_url": "https://github.com/apache/superset/raw/4ddb70d86c42553b8c7d7ee4c017ae29242cd864/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2Futils%2Ftooltip.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2Futils%2Ftooltip.ts?ref=4ddb70d86c42553b8c7d7ee4c017ae29242cd864", "patch": "@@ -33,6 +33,12 @@ export function getDefaultTooltip(refs: Refs) {\n     borderColor: 'transparent',\n     // CSS hack applied on this class to resolve https://github.com/apache/superset/issues/30058\n     className: 'echarts-tooltip',\n+    // allow scrolling inside tooltip without re-triggering the chart\n+    enterable: true,\n+    // keep within viewport and above header; enable internal scroll\n+    confine: true,\n+    // optional: reduce flicker when moving in/out of tooltip\n+    hideDelay: 50,\n     position: (\n       canvasMousePos: [number, number],\n       params: CallbackDataParams,\n@@ -47,20 +53,36 @@ export function getDefaultTooltip(refs: Refs) {\n       const divRect = refs.divRef?.current?.getBoundingClientRect();\n \n       // The mouse coordinates relative to the whole window\n-      // The first parameter to the position function is the mouse position relative to the canvas\n       const mouseX = canvasMousePos[0] + (divRect?.x || 0);\n       const mouseY = canvasMousePos[1] + (divRect?.y || 0);\n \n+      // Available viewport dimensions\n+      const viewportWidth = document.documentElement.clientWidth;\n+      const viewportHeight = document.documentElement.clientHeight;\n+\n       // The width and height of the tooltip dom element\n       const tooltipWidth = sizes.contentSize[0];\n       const tooltipHeight = sizes.contentSize[1];\n \n+      // Cap tooltip height to the smaller of 800px or 80vh\n+      const maxAllowedHeight = Math.min(800, Math.floor(viewportHeight * 0.8));\n+\n+      if (tooltipDom) {\n+        tooltipDom.style.maxHeight = `${maxAllowedHeight}px`;\n+        tooltipDom.style.overflow = 'auto';\n+        // ensure interactions within tooltip don't get swallowed\n+        tooltipDom.style.pointerEvents = 'auto';\n+      }\n+\n+      // Use effective height for positioning after applying the cap\n+      const effectiveTooltipHeight = Math.min(tooltipHeight, maxAllowedHeight);\n+\n       // Start by placing the tooltip top and right relative to the mouse position\n       let xPos = mouseX + TOOLTIP_POINTER_MARGIN;\n-      let yPos = mouseY - TOOLTIP_POINTER_MARGIN - tooltipHeight;\n+      let yPos = mouseY - TOOLTIP_POINTER_MARGIN - effectiveTooltipHeight;\n \n       // The tooltip is overflowing past the right edge of the window\n-      if (xPos + tooltipWidth >= document.documentElement.clientWidth) {\n+      if (xPos + tooltipWidth >= viewportWidth) {\n         // Attempt to place the tooltip to the left of the mouse position\n         xPos = mouseX - TOOLTIP_POINTER_MARGIN - tooltipWidth;\n \n@@ -76,7 +98,7 @@ export function getDefaultTooltip(refs: Refs) {\n         yPos = mouseY + TOOLTIP_POINTER_MARGIN;\n \n         // The tooltip is overflowing past the bottom edge of the window\n-        if (yPos + tooltipHeight >= document.documentElement.clientHeight)\n+        if (yPos + effectiveTooltipHeight >= viewportHeight)\n           // Place the tooltip a fixed distance from the top edge of the window\n           yPos = TOOLTIP_OVERFLOW_MARGIN;\n       }", "pull_request_number": 37022}
{"sha": "cfb05d1602d39d407bd1c4015353a066a9ac8acf", "filename": "superset-frontend/plugins/plugin-chart-echarts/src/Timeseries/transformProps.ts", "status": "modified", "additions": 43, "deletions": 0, "changes": 43, "blob_url": "https://github.com/apache/superset/blob/3320341f51182cf87c3db9d87d417800a68a738d/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FTimeseries%2FtransformProps.ts", "raw_url": "https://github.com/apache/superset/raw/3320341f51182cf87c3db9d87d417800a68a738d/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FTimeseries%2FtransformProps.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FTimeseries%2FtransformProps.ts?ref=3320341f51182cf87c3db9d87d417800a68a738d", "patch": "@@ -56,6 +56,7 @@ import type { SeriesOption } from 'echarts';\n import {\n   EchartsTimeseriesChartProps,\n   EchartsTimeseriesFormData,\n+  EchartsTimeseriesSeriesType,\n   OrientationType,\n   TimeseriesChartTransformedProps,\n } from './types';\n@@ -310,6 +311,14 @@ export default function transformProps(\n \n   let patternIncrement = 0;\n \n+  // For horizontal bar charts, calculate min/max from data to avoid cutting off labels\n+  const shouldCalculateDataBounds =\n+    isHorizontal &&\n+    seriesType === EchartsTimeseriesSeriesType.Bar &&\n+    truncateYAxis;\n+  let dataMax: number | undefined;\n+  let dataMin: number | undefined;\n+\n   rawSeries.forEach(entry => {\n     const derivedSeries = isDerivedSeries(entry, chartProps.rawFormData);\n     const lineStyle: LineStyleOption = {};\n@@ -323,6 +332,21 @@ export default function transformProps(\n     const entryName = String(entry.name || '');\n     const seriesName = inverted[entryName] || entryName;\n \n+    // Calculate min/max from data for horizontal bar charts\n+    if (shouldCalculateDataBounds && entry.data && Array.isArray(entry.data)) {\n+      (entry.data as [number, any][]).forEach((datum: [number, any]) => {\n+        const value = datum[0];\n+        if (typeof value === 'number' && !Number.isNaN(value)) {\n+          if (dataMax === undefined || value > dataMax) {\n+            dataMax = value;\n+          }\n+          if (dataMin === undefined || value < dataMin) {\n+            dataMin = value;\n+          }\n+        }\n+      });\n+    }\n+\n     let colorScaleKey = getOriginalSeries(seriesName, array);\n \n     // If this series name exactly matches a time compare value, it's a time-shifted series\n@@ -498,6 +522,18 @@ export default function transformProps(\n     yAxisMin = calculateLowerLogTick(minPositiveValue);\n   }\n \n+  // For horizontal bar charts, set max/min from calculated data bounds\n+  if (shouldCalculateDataBounds) {\n+    // Set max to actual data max to avoid gaps and ensure labels are visible\n+    if (dataMax !== undefined && yAxisMax === undefined) {\n+      yAxisMax = dataMax;\n+    }\n+    // Set min to actual data min for diverging bars\n+    if (dataMin !== undefined && yAxisMin === undefined && dataMin < 0) {\n+      yAxisMin = dataMin;\n+    }\n+  }\n+\n   const tooltipFormatter =\n     xAxisDataType === GenericDataType.Temporal\n       ? getTooltipTimeFormatter(tooltipTimeFormat)\n@@ -603,6 +639,13 @@ export default function transformProps(\n   if (isHorizontal) {\n     [xAxis, yAxis] = [yAxis, xAxis];\n     [padding.bottom, padding.left] = [padding.left, padding.bottom];\n+    // Increase right padding for horizontal bar charts to ensure value labels are visible\n+    if (seriesType === EchartsTimeseriesSeriesType.Bar && showValue) {\n+      padding.right = Math.max(\n+        padding.right || 0,\n+        TIMESERIES_CONSTANTS.horizontalBarLabelRightPadding,\n+      );\n+    }\n   }\n \n   const echartOptions: EChartsCoreOption = {", "pull_request_number": 36989}
{"sha": "a6992323e45c9f9d25643850b6191b80212ba81d", "filename": "superset-frontend/plugins/plugin-chart-echarts/src/constants.ts", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/3320341f51182cf87c3db9d87d417800a68a738d/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2Fconstants.ts", "raw_url": "https://github.com/apache/superset/raw/3320341f51182cf87c3db9d87d417800a68a738d/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2Fconstants.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2Fconstants.ts?ref=3320341f51182cf87c3db9d87d417800a68a738d", "patch": "@@ -46,6 +46,8 @@ export const TIMESERIES_CONSTANTS = {\n   dataZoomEnd: 100,\n   yAxisLabelTopOffset: 20,\n   extraControlsOffset: 22,\n+  // Min right padding (px) for horizontal bar charts to ensure value labels are fully visible\n+  horizontalBarLabelRightPadding: 70,\n };\n \n export const LABEL_POSITION: [LabelPositionEnum, string][] = [", "pull_request_number": 36989}
{"sha": "b25476dd852047e09f6ccbd876877fc304969d99", "filename": "superset-frontend/plugins/plugin-chart-echarts/test/Timeseries/helpers.ts", "status": "added", "additions": 122, "deletions": 0, "changes": 122, "blob_url": "https://github.com/apache/superset/blob/3320341f51182cf87c3db9d87d417800a68a738d/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Ftest%2FTimeseries%2Fhelpers.ts", "raw_url": "https://github.com/apache/superset/raw/3320341f51182cf87c3db9d87d417800a68a738d/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Ftest%2FTimeseries%2Fhelpers.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Ftest%2FTimeseries%2Fhelpers.ts?ref=3320341f51182cf87c3db9d87d417800a68a738d", "patch": "@@ -0,0 +1,122 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+/**\n+ * Base timestamp used for test data generation.\n+ * This provides a consistent starting point for all test timestamps.\n+ */\n+export const BASE_TIMESTAMP = 599616000000;\n+\n+/**\n+ * Default interval between timestamps (300000000 ms \u2248 3.47 days).\n+ * This matches the common pattern used in tests.\n+ */\n+export const DEFAULT_TIMESTAMP_INTERVAL = 300000000;\n+\n+/**\n+ * Creates a timestamp with an offset from the base timestamp.\n+ *\n+ * @param offset - Offset in milliseconds from BASE_TIMESTAMP\n+ * @returns Timestamp value\n+ */\n+export function createTimestamp(offset: number = 0): number {\n+  return BASE_TIMESTAMP + offset;\n+}\n+\n+/**\n+ * Creates an array of timestamps starting from the base timestamp.\n+ *\n+ * @param count - Number of timestamps to generate\n+ * @param intervalMs - Interval between timestamps in milliseconds (default: DEFAULT_TIMESTAMP_INTERVAL)\n+ * @returns Array of timestamp values\n+ */\n+export function createTimestamps(\n+  count: number,\n+  intervalMs: number = DEFAULT_TIMESTAMP_INTERVAL,\n+): number[] {\n+  return Array.from({ length: count }, (_, index) =>\n+    createTimestamp(index * intervalMs),\n+  );\n+}\n+\n+/**\n+ * Creates a single test data row with a timestamp.\n+ *\n+ * @param values - Object containing series values (excluding __timestamp)\n+ * @param timestamp - Timestamp value to include\n+ * @returns Test data row with __timestamp property\n+ */\n+export function createTestDataRow(\n+  values: Record<string, number>,\n+  timestamp: number,\n+): Record<string, number> & { __timestamp: number } {\n+  return {\n+    ...values,\n+    __timestamp: timestamp,\n+  };\n+}\n+\n+/**\n+ * Options for creating test data.\n+ */\n+export interface CreateTestDataOptions {\n+  /** Base timestamp to start from (default: BASE_TIMESTAMP) */\n+  baseTimestamp?: number;\n+  /** Interval between timestamps in milliseconds (default: DEFAULT_TIMESTAMP_INTERVAL) */\n+  intervalMs?: number;\n+}\n+\n+/**\n+ * Creates an array of test data rows with auto-generated timestamps.\n+ *\n+ * @param rows - Array of objects containing series values (without __timestamp)\n+ * @param options - Options for timestamp generation\n+ * @returns Array of test data rows with __timestamp properties\n+ *\n+ * @example\n+ * ```typescript\n+ * const data = createTestData(\n+ *   [\n+ *     { 'Series A': 15000 },\n+ *     { 'Series A': 20000 },\n+ *     { 'Series A': 18000 },\n+ *   ],\n+ *   { intervalMs: 300000000 }\n+ * );\n+ * // Returns:\n+ * // [\n+ * //   { 'Series A': 15000, __timestamp: 599616000000 },\n+ * //   { 'Series A': 20000, __timestamp: 599916000000 },\n+ * //   { 'Series A': 18000, __timestamp: 600216000000 },\n+ * // ]\n+ * ```\n+ */\n+export function createTestData(\n+  rows: Array<Record<string, number>>,\n+  options: CreateTestDataOptions = {},\n+): Array<Record<string, number> & { __timestamp: number }> {\n+  const {\n+    baseTimestamp = BASE_TIMESTAMP,\n+    intervalMs = DEFAULT_TIMESTAMP_INTERVAL,\n+  } = options;\n+\n+  return rows.map((row, index) =>\n+    createTestDataRow(row, baseTimestamp + index * intervalMs),\n+  );\n+}", "pull_request_number": 36989}
{"sha": "1bdaf9b5fa94497f899556f6614c2297420504e2", "filename": "superset-frontend/plugins/plugin-chart-echarts/test/Timeseries/transformProps.test.ts", "status": "modified", "additions": 302, "deletions": 139, "changes": 441, "blob_url": "https://github.com/apache/superset/blob/3320341f51182cf87c3db9d87d417800a68a738d/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Ftest%2FTimeseries%2FtransformProps.test.ts", "raw_url": "https://github.com/apache/superset/raw/3320341f51182cf87c3db9d87d417800a68a738d/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Ftest%2FTimeseries%2FtransformProps.test.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Ftest%2FTimeseries%2FtransformProps.test.ts?ref=3320341f51182cf87c3db9d87d417800a68a738d", "patch": "@@ -30,6 +30,11 @@ import {\n import { supersetTheme } from '@apache-superset/core/ui';\n import { EchartsTimeseriesChartProps } from '../../src/types';\n import transformProps from '../../src/Timeseries/transformProps';\n+import {\n+  EchartsTimeseriesSeriesType,\n+  OrientationType,\n+} from '../../src/Timeseries/types';\n+import { BASE_TIMESTAMP, createTestData } from './helpers';\n \n type YAxisFormatter = (value: number, index: number) => string;\n \n@@ -55,10 +60,13 @@ const formData: SqlaFormData = {\n };\n const queriesData = [\n   {\n-    data: [\n-      { 'San Francisco': 1, 'New York': 2, __timestamp: 599616000000 },\n-      { 'San Francisco': 3, 'New York': 4, __timestamp: 599916000000 },\n-    ],\n+    data: createTestData(\n+      [\n+        { 'San Francisco': 1, 'New York': 2 },\n+        { 'San Francisco': 3, 'New York': 4 },\n+      ],\n+      { intervalMs: 300000000 },\n+    ),\n   },\n ];\n const chartPropsConfig = {\n@@ -83,15 +91,15 @@ describe('EchartsTimeseries transformProps', () => {\n           series: expect.arrayContaining([\n             expect.objectContaining({\n               data: [\n-                [599616000000, 1],\n-                [599916000000, 3],\n+                [BASE_TIMESTAMP, 1],\n+                [BASE_TIMESTAMP + 300000000, 3],\n               ],\n               name: 'San Francisco',\n             }),\n             expect.objectContaining({\n               data: [\n-                [599616000000, 2],\n-                [599916000000, 4],\n+                [BASE_TIMESTAMP, 2],\n+                [BASE_TIMESTAMP + 300000000, 4],\n               ],\n               name: 'New York',\n             }),\n@@ -120,15 +128,15 @@ describe('EchartsTimeseries transformProps', () => {\n           series: expect.arrayContaining([\n             expect.objectContaining({\n               data: [\n-                [1, 599616000000],\n-                [3, 599916000000],\n+                [1, BASE_TIMESTAMP],\n+                [3, BASE_TIMESTAMP + 300000000],\n               ],\n               name: 'San Francisco',\n             }),\n             expect.objectContaining({\n               data: [\n-                [2, 599616000000],\n-                [4, 599916000000],\n+                [2, BASE_TIMESTAMP],\n+                [4, BASE_TIMESTAMP + 300000000],\n               ],\n               name: 'New York',\n             }),\n@@ -165,22 +173,22 @@ describe('EchartsTimeseries transformProps', () => {\n           series: expect.arrayContaining([\n             expect.objectContaining({\n               data: [\n-                [599616000000, 1],\n-                [599916000000, 3],\n+                [BASE_TIMESTAMP, 1],\n+                [BASE_TIMESTAMP + 300000000, 3],\n               ],\n               name: 'San Francisco',\n             }),\n             expect.objectContaining({\n               data: [\n-                [599616000000, 2],\n-                [599916000000, 4],\n+                [BASE_TIMESTAMP, 2],\n+                [BASE_TIMESTAMP + 300000000, 4],\n               ],\n               name: 'New York',\n             }),\n             expect.objectContaining({\n               data: [\n-                [599616000000, 599616000001],\n-                [599916000000, 599916000001],\n+                [BASE_TIMESTAMP, BASE_TIMESTAMP + 1],\n+                [BASE_TIMESTAMP + 300000000, BASE_TIMESTAMP + 300000000 + 1],\n               ],\n               name: 'My Formula',\n             }),\n@@ -303,64 +311,60 @@ describe('EchartsTimeseries transformProps', () => {\n   it('Should add a baseline series for stream graph', () => {\n     const streamQueriesData = [\n       {\n-        data: [\n-          {\n-            'San Francisco': 120,\n-            'New York': 220,\n-            Boston: 150,\n-            Miami: 270,\n-            Denver: 800,\n-            __timestamp: 599616000000,\n-          },\n-          {\n-            'San Francisco': 150,\n-            'New York': 190,\n-            Boston: 240,\n-            Miami: 350,\n-            Denver: 700,\n-            __timestamp: 599616000001,\n-          },\n-          {\n-            'San Francisco': 130,\n-            'New York': 300,\n-            Boston: 250,\n-            Miami: 410,\n-            Denver: 650,\n-            __timestamp: 599616000002,\n-          },\n-          {\n-            'San Francisco': 90,\n-            'New York': 340,\n-            Boston: 300,\n-            Miami: 480,\n-            Denver: 590,\n-            __timestamp: 599616000003,\n-          },\n-          {\n-            'San Francisco': 260,\n-            'New York': 200,\n-            Boston: 420,\n-            Miami: 490,\n-            Denver: 760,\n-            __timestamp: 599616000004,\n-          },\n-          {\n-            'San Francisco': 250,\n-            'New York': 250,\n-            Boston: 380,\n-            Miami: 360,\n-            Denver: 400,\n-            __timestamp: 599616000005,\n-          },\n-          {\n-            'San Francisco': 160,\n-            'New York': 210,\n-            Boston: 330,\n-            Miami: 440,\n-            Denver: 580,\n-            __timestamp: 599616000006,\n-          },\n-        ],\n+        data: createTestData(\n+          [\n+            {\n+              'San Francisco': 120,\n+              'New York': 220,\n+              Boston: 150,\n+              Miami: 270,\n+              Denver: 800,\n+            },\n+            {\n+              'San Francisco': 150,\n+              'New York': 190,\n+              Boston: 240,\n+              Miami: 350,\n+              Denver: 700,\n+            },\n+            {\n+              'San Francisco': 130,\n+              'New York': 300,\n+              Boston: 250,\n+              Miami: 410,\n+              Denver: 650,\n+            },\n+            {\n+              'San Francisco': 90,\n+              'New York': 340,\n+              Boston: 300,\n+              Miami: 480,\n+              Denver: 590,\n+            },\n+            {\n+              'San Francisco': 260,\n+              'New York': 200,\n+              Boston: 420,\n+              Miami: 490,\n+              Denver: 760,\n+            },\n+            {\n+              'San Francisco': 250,\n+              'New York': 250,\n+              Boston: 380,\n+              Miami: 360,\n+              Denver: 400,\n+            },\n+            {\n+              'San Francisco': 160,\n+              'New York': 210,\n+              Boston: 330,\n+              Miami: 440,\n+              Denver: 580,\n+            },\n+          ],\n+          { intervalMs: 1 },\n+        ),\n       },\n     ];\n     const streamFormData = { ...formData, stack: 'Stream' };\n@@ -395,13 +399,13 @@ describe('EchartsTimeseries transformProps', () => {\n       },\n       type: 'line',\n       data: [\n-        [599616000000, -415.7692307692308],\n-        [599616000001, -403.6219915054271],\n-        [599616000002, -476.32314093071443],\n-        [599616000003, -514.2120298196033],\n-        [599616000004, -485.7378514158475],\n-        [599616000005, -419.6402904402378],\n-        [599616000006, -442.9833136960517],\n+        [BASE_TIMESTAMP, -415.7692307692308],\n+        [BASE_TIMESTAMP + 1, -403.6219915054271],\n+        [BASE_TIMESTAMP + 2, -476.32314093071443],\n+        [BASE_TIMESTAMP + 3, -514.2120298196033],\n+        [BASE_TIMESTAMP + 4, -485.7378514158475],\n+        [BASE_TIMESTAMP + 5, -419.6402904402378],\n+        [BASE_TIMESTAMP + 6, -442.9833136960517],\n       ],\n     });\n   });\n@@ -434,32 +438,31 @@ describe('Does transformProps transform series correctly', () => {\n   };\n   const queriesData = [\n     {\n-      data: [\n-        {\n-          'San Francisco': 1,\n-          'New York': 2,\n-          Boston: 1,\n-          __timestamp: 599616000000,\n-        },\n-        {\n-          'San Francisco': 3,\n-          'New York': 4,\n-          Boston: 1,\n-          __timestamp: 599916000000,\n-        },\n-        {\n-          'San Francisco': 5,\n-          'New York': 8,\n-          Boston: 6,\n-          __timestamp: 600216000000,\n-        },\n-        {\n-          'San Francisco': 2,\n-          'New York': 7,\n-          Boston: 2,\n-          __timestamp: 600516000000,\n-        },\n-      ],\n+      data: createTestData(\n+        [\n+          {\n+            'San Francisco': 1,\n+            'New York': 2,\n+            Boston: 1,\n+          },\n+          {\n+            'San Francisco': 3,\n+            'New York': 4,\n+            Boston: 1,\n+          },\n+          {\n+            'San Francisco': 5,\n+            'New York': 8,\n+            Boston: 6,\n+          },\n+          {\n+            'San Francisco': 2,\n+            'New York': 7,\n+            Boston: 2,\n+          },\n+        ],\n+        { intervalMs: 300000000 },\n+      ),\n     },\n   ];\n   const chartPropsConfig = {\n@@ -643,36 +646,35 @@ describe('Does transformProps transform series correctly', () => {\n describe('legend sorting', () => {\n   const legendSortData = [\n     {\n-      data: [\n-        {\n-          Milton: 40,\n-          'San Francisco': 1,\n-          'New York': 2,\n-          Boston: 1,\n-          __timestamp: 599616000000,\n-        },\n-        {\n-          Milton: 20,\n-          'San Francisco': 3,\n-          'New York': 4,\n-          Boston: 1,\n-          __timestamp: 599916000000,\n-        },\n-        {\n-          Milton: 60,\n-          'San Francisco': 5,\n-          'New York': 8,\n-          Boston: 6,\n-          __timestamp: 600216000000,\n-        },\n-        {\n-          Milton: 10,\n-          'San Francisco': 2,\n-          'New York': 7,\n-          Boston: 2,\n-          __timestamp: 600516000000,\n-        },\n-      ],\n+      data: createTestData(\n+        [\n+          {\n+            Milton: 40,\n+            'San Francisco': 1,\n+            'New York': 2,\n+            Boston: 1,\n+          },\n+          {\n+            Milton: 20,\n+            'San Francisco': 3,\n+            'New York': 4,\n+            Boston: 1,\n+          },\n+          {\n+            Milton: 60,\n+            'San Francisco': 5,\n+            'New York': 8,\n+            Boston: 6,\n+          },\n+          {\n+            Milton: 10,\n+            'San Francisco': 2,\n+            'New York': 7,\n+            Boston: 2,\n+          },\n+        ],\n+        { intervalMs: 300000000 },\n+      ),\n     },\n   ];\n \n@@ -855,3 +857,164 @@ test('EchartsTimeseries should preserve static currency format with \u00a3 for GBP',\n   const formatter = getYAxisFormatter(transformed);\n   expect(formatter(1000, 0)).toContain('\u00a3');\n });\n+\n+const baseFormDataHorizontalBar: SqlaFormData = {\n+  colorScheme: 'bnbColors',\n+  datasource: '3__table',\n+  granularity_sqla: '__timestamp',\n+  metric: 'sum__num',\n+  groupby: [],\n+  viz_type: 'echarts_timeseries',\n+  seriesType: EchartsTimeseriesSeriesType.Bar,\n+  orientation: OrientationType.Horizontal,\n+  truncateYAxis: true,\n+  yAxisBounds: [null, null],\n+};\n+\n+test('should set yAxis max to actual data max for horizontal bar charts', () => {\n+  const queriesData = [\n+    {\n+      data: createTestData(\n+        [{ 'Series A': 15000 }, { 'Series A': 20000 }, { 'Series A': 18000 }],\n+        { intervalMs: 300000000 },\n+      ),\n+    },\n+  ];\n+\n+  const chartProps = new ChartProps({\n+    formData: baseFormDataHorizontalBar,\n+    width: 800,\n+    height: 600,\n+    queriesData,\n+    theme: supersetTheme,\n+  });\n+\n+  const transformedProps = transformProps(\n+    chartProps as EchartsTimeseriesChartProps,\n+  );\n+\n+  // In horizontal orientation, axes are swapped, so yAxis becomes xAxis\n+  const xAxisRaw = transformedProps.echartOptions.xAxis as any;\n+  expect(xAxisRaw.max).toBe(20000); // Should be the actual max value, not rounded\n+});\n+\n+test('should set yAxis min and max for diverging horizontal bar charts', () => {\n+  const queriesData = [\n+    {\n+      data: createTestData(\n+        [{ 'Series A': -21000 }, { 'Series A': 20000 }, { 'Series A': 18000 }],\n+        { intervalMs: 300000000 },\n+      ),\n+    },\n+  ];\n+\n+  const chartProps = new ChartProps({\n+    formData: baseFormDataHorizontalBar,\n+    width: 800,\n+    height: 600,\n+    queriesData,\n+    theme: supersetTheme,\n+  });\n+\n+  const transformedProps = transformProps(\n+    chartProps as EchartsTimeseriesChartProps,\n+  );\n+\n+  // In horizontal orientation, axes are swapped, so yAxis becomes xAxis\n+  const xAxisRaw = transformedProps.echartOptions.xAxis as any;\n+  expect(xAxisRaw.max).toBe(20000); // Should be the actual max value\n+  expect(xAxisRaw.min).toBe(-21000); // Should be the actual min value for diverging bars\n+});\n+\n+test('should not override explicit yAxisBounds for horizontal bar charts', () => {\n+  const queriesData = [\n+    {\n+      data: createTestData(\n+        [{ 'Series A': 15000 }, { 'Series A': 20000 }, { 'Series A': 18000 }],\n+        { intervalMs: 300000000 },\n+      ),\n+    },\n+  ];\n+\n+  const chartProps = new ChartProps({\n+    formData: {\n+      ...baseFormDataHorizontalBar,\n+      yAxisBounds: [0, 25000], // Explicit bounds\n+    },\n+    width: 800,\n+    height: 600,\n+    queriesData,\n+    theme: supersetTheme,\n+  });\n+\n+  const transformedProps = transformProps(\n+    chartProps as EchartsTimeseriesChartProps,\n+  );\n+\n+  // In horizontal orientation, axes are swapped, so yAxis becomes xAxis\n+  const xAxisRaw = transformedProps.echartOptions.xAxis as any;\n+  expect(xAxisRaw.max).toBe(25000); // Should respect explicit bound\n+  expect(xAxisRaw.min).toBe(0); // Should respect explicit bound\n+});\n+\n+test('should not apply axis bounds calculation when truncateYAxis is false for horizontal bar charts', () => {\n+  const queriesData = [\n+    {\n+      data: createTestData(\n+        [{ 'Series A': 15000 }, { 'Series A': 20000 }, { 'Series A': 18000 }],\n+        { intervalMs: 300000000 },\n+      ),\n+    },\n+  ];\n+\n+  const chartProps = new ChartProps({\n+    formData: {\n+      ...baseFormDataHorizontalBar,\n+      truncateYAxis: false,\n+    },\n+    width: 800,\n+    height: 600,\n+    queriesData,\n+    theme: supersetTheme,\n+  });\n+\n+  const transformedProps = transformProps(\n+    chartProps as EchartsTimeseriesChartProps,\n+  );\n+\n+  // In horizontal orientation, axes are swapped, so yAxis becomes xAxis\n+  const xAxis = transformedProps.echartOptions.xAxis as any;\n+  // Should not have explicit max set when truncateYAxis is false\n+  expect(xAxis.max).toBeUndefined();\n+});\n+\n+test('should not apply axis bounds calculation when seriesType is not Bar for horizontal charts', () => {\n+  const queriesData = [\n+    {\n+      data: createTestData(\n+        [{ 'Series A': 15000 }, { 'Series A': 20000 }, { 'Series A': 18000 }],\n+        { intervalMs: 300000000 },\n+      ),\n+    },\n+  ];\n+\n+  const chartProps = new ChartProps({\n+    formData: {\n+      ...baseFormDataHorizontalBar,\n+      seriesType: EchartsTimeseriesSeriesType.Line,\n+    },\n+    width: 800,\n+    height: 600,\n+    queriesData,\n+    theme: supersetTheme,\n+  });\n+\n+  const transformedProps = transformProps(\n+    chartProps as EchartsTimeseriesChartProps,\n+  );\n+\n+  // In horizontal orientation, axes are swapped, so yAxis becomes xAxis\n+  const xAxisRaw = transformedProps.echartOptions.xAxis as any;\n+  // Should not have explicit max set when seriesType is not Bar\n+  expect(xAxisRaw.max).toBeUndefined();\n+});", "pull_request_number": 36989}
{"sha": "014796fa07ae31ada373761ce21f57537c3df89d", "filename": "superset-frontend/packages/superset-ui-core/src/components/TableCollection/index.tsx", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/apache/superset/blob/7269e688f35ccace6394ee84aaef108f36a52ecd/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FTableCollection%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/7269e688f35ccace6394ee84aaef108f36a52ecd/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FTableCollection%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FTableCollection%2Findex.tsx?ref=7269e688f35ccace6394ee84aaef108f36a52ecd", "patch": "@@ -295,8 +295,7 @@ function TableCollection<T extends object>({\n       size={size}\n       data-test=\"listview-table\"\n       pagination={paginationConfig}\n-      scroll={{ x: 'max-content' }}\n-      tableLayout=\"auto\"\n+      tableLayout=\"fixed\"\n       rowKey=\"rowId\"\n       rowSelection={rowSelection}\n       locale={{ emptyText: null }}", "pull_request_number": 37299}
{"sha": "46b2329833deea159b4252563348cdd009564e71", "filename": "superset-frontend/src/pages/ChartList/index.tsx", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/apache/superset/blob/7269e688f35ccace6394ee84aaef108f36a52ecd/superset-frontend%2Fsrc%2Fpages%2FChartList%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/7269e688f35ccace6394ee84aaef108f36a52ecd/superset-frontend%2Fsrc%2Fpages%2FChartList%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fpages%2FChartList%2Findex.tsx?ref=7269e688f35ccace6394ee84aaef108f36a52ecd", "patch": "@@ -340,7 +340,7 @@ function ChartList(props: ChartListProps) {\n         Header: '',\n         id: 'id',\n         disableSortBy: true,\n-        size: 'xs',\n+        size: 'sm',\n         hidden: !userId,\n       },\n       {\n@@ -395,6 +395,7 @@ function ChartList(props: ChartListProps) {\n         ),\n         Header: t('Type'),\n         accessor: 'viz_type',\n+        size: 'xxl',\n         id: 'viz_type',\n       },\n       {\n@@ -423,7 +424,7 @@ function ChartList(props: ChartListProps) {\n         Header: t('Dataset'),\n         accessor: 'datasource_id',\n         disableSortBy: true,\n-        size: 'xl',\n+        size: 'xxl',\n         id: 'datasource_id',\n       },\n       {\n@@ -459,6 +460,7 @@ function ChartList(props: ChartListProps) {\n         accessor: 'tags',\n         disableSortBy: true,\n         hidden: !isFeatureEnabled(FeatureFlag.TaggingSystem),\n+        size: 'xxl',\n         id: 'tags',\n       },\n       {", "pull_request_number": 37299}
{"sha": "9e6af3a2a697e8d40cd25dc80b408fac814271ee", "filename": "superset-frontend/src/pages/DashboardList/index.tsx", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/apache/superset/blob/7269e688f35ccace6394ee84aaef108f36a52ecd/superset-frontend%2Fsrc%2Fpages%2FDashboardList%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/7269e688f35ccace6394ee84aaef108f36a52ecd/superset-frontend%2Fsrc%2Fpages%2FDashboardList%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fpages%2FDashboardList%2Findex.tsx?ref=7269e688f35ccace6394ee84aaef108f36a52ecd", "patch": "@@ -323,7 +323,7 @@ function DashboardList(props: DashboardListProps) {\n         Header: '',\n         id: 'id',\n         disableSortBy: true,\n-        size: 'xs',\n+        size: 'sm',\n         hidden: !user?.userId,\n       },\n       {\n@@ -363,7 +363,7 @@ function DashboardList(props: DashboardListProps) {\n         ),\n         Header: t('Status'),\n         accessor: 'published',\n-        size: 'sm',\n+        size: 'xl',\n         id: 'published',\n         className: 'no-ellipsis',\n       },\n@@ -393,6 +393,7 @@ function DashboardList(props: DashboardListProps) {\n         accessor: 'tags',\n         disableSortBy: true,\n         hidden: !isFeatureEnabled(FeatureFlag.TaggingSystem),\n+        size: 'xxl',\n         id: 'tags',\n       },\n       {\n@@ -404,6 +405,7 @@ function DashboardList(props: DashboardListProps) {\n         Header: t('Owners'),\n         accessor: 'owners',\n         disableSortBy: true,\n+        size: 'xl',\n         id: 'owners',\n       },\n       {\n@@ -417,6 +419,7 @@ function DashboardList(props: DashboardListProps) {\n         }: any) => <ModifiedInfo date={changedOn} user={changedBy} />,\n         Header: t('Last modified'),\n         accessor: 'changed_on_delta_humanized',\n+        size: 'xl',\n         id: 'changed_on_delta_humanized',\n       },\n       {\n@@ -504,6 +507,7 @@ function DashboardList(props: DashboardListProps) {\n         id: 'actions',\n         hidden: !canEdit && !canDelete && !canExport,\n         disableSortBy: true,\n+        size: 'xl',\n       },\n       {\n         accessor: QueryObjectColumns.ChangedBy,", "pull_request_number": 37299}
{"sha": "f2dfb29beefb68f9572df67747d233c7c60a9ca1", "filename": "superset-frontend/src/pages/DatasetList/index.tsx", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/apache/superset/blob/7269e688f35ccace6394ee84aaef108f36a52ecd/superset-frontend%2Fsrc%2Fpages%2FDatasetList%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/7269e688f35ccace6394ee84aaef108f36a52ecd/superset-frontend%2Fsrc%2Fpages%2FDatasetList%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fpages%2FDatasetList%2Findex.tsx?ref=7269e688f35ccace6394ee84aaef108f36a52ecd", "patch": "@@ -362,7 +362,7 @@ const DatasetList: FunctionComponent<DatasetListProps> = ({\n         Header: t('Type'),\n         accessor: 'kind',\n         disableSortBy: true,\n-        size: 'sm',\n+        size: 'xl',\n         id: 'kind',\n       },\n       {\n@@ -374,7 +374,7 @@ const DatasetList: FunctionComponent<DatasetListProps> = ({\n       {\n         Header: t('Schema'),\n         accessor: 'schema',\n-        size: 'lg',\n+        size: 'xl',\n         id: 'schema',\n       },\n       {\n@@ -507,6 +507,7 @@ const DatasetList: FunctionComponent<DatasetListProps> = ({\n         id: 'actions',\n         hidden: !canEdit && !canDelete && !canDuplicate,\n         disableSortBy: true,\n+        size: 'xl',\n       },\n       {\n         accessor: QueryObjectColumns.ChangedBy,", "pull_request_number": 37299}
{"sha": "e4ea0e12fbca30c45915a688a8721e5cc0ccf8cc", "filename": "superset/templates/superset/spa.html", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/apache/superset/blob/7269e688f35ccace6394ee84aaef108f36a52ecd/superset%2Ftemplates%2Fsuperset%2Fspa.html", "raw_url": "https://github.com/apache/superset/raw/7269e688f35ccace6394ee84aaef108f36a52ecd/superset%2Ftemplates%2Fsuperset%2Fspa.html", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Ftemplates%2Fsuperset%2Fspa.html?ref=7269e688f35ccace6394ee84aaef108f36a52ecd", "patch": "@@ -31,6 +31,10 @@\n     {% block head_meta %}{% endblock %}\n \n     <style>\n+      html {\n+        scrollbar-gutter: stable;\n+      }\n+\n       body {\n         background: #fff;\n         color: #000;", "pull_request_number": 37299}
{"sha": "e6b373a18eae511920b61fbd439febfc6ecb7e3b", "filename": "superset-frontend/plugins/plugin-chart-pivot-table/src/plugin/controlPanel.tsx", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/apache/superset/blob/6486e7aeb5b8bd57eeb9243352b88bd6313d0d8a/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2Fplugin%2FcontrolPanel.tsx", "raw_url": "https://github.com/apache/superset/raw/6486e7aeb5b8bd57eeb9243352b88bd6313d0d8a/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2Fplugin%2FcontrolPanel.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2Fplugin%2FcontrolPanel.tsx?ref=6486e7aeb5b8bd57eeb9243352b88bd6313d0d8a", "patch": "@@ -31,6 +31,7 @@ import {\n   QueryFormMetric,\n   SMART_DATE_ID,\n   validateNonEmpty,\n+  QueryFormColumn,\n } from '@superset-ui/core';\n import { MetricsLayoutEnum } from '../types';\n \n@@ -403,10 +404,21 @@ const config: ControlPanelConfig = {\n               renderTrigger: true,\n               label: t('Conditional formatting'),\n               description: t('Apply conditional color formatting to metrics'),\n+              shouldMapStateToProps() {\n+                return true;\n+              },\n               mapStateToProps(explore, _, chart) {\n-                const values =\n+                const metrics =\n                   (explore?.controls?.metrics?.value as QueryFormMetric[]) ??\n                   [];\n+                const columns =\n+                  (explore?.controls?.groupbyColumns\n+                    ?.value as QueryFormColumn[]) ?? [];\n+                const rows =\n+                  (explore?.controls?.groupbyRows\n+                    ?.value as QueryFormColumn[]) ?? [];\n+                const values = [...new Set([...metrics, ...columns, ...rows])];\n+\n                 const verboseMap = explore?.datasource?.hasOwnProperty(\n                   'verbose_map',\n                 )", "pull_request_number": 35863}
{"sha": "215a0df9efc658fb13764c9d26e9ed86090fc0ad", "filename": "superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx", "status": "modified", "additions": 46, "deletions": 20, "changes": 66, "blob_url": "https://github.com/apache/superset/blob/6486e7aeb5b8bd57eeb9243352b88bd6313d0d8a/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2Freact-pivottable%2FTableRenderers.jsx", "raw_url": "https://github.com/apache/superset/raw/6486e7aeb5b8bd57eeb9243352b88bd6313d0d8a/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2Freact-pivottable%2FTableRenderers.jsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2Freact-pivottable%2FTableRenderers.jsx?ref=6486e7aeb5b8bd57eeb9243352b88bd6313d0d8a", "patch": "@@ -434,6 +434,30 @@ export class TableRenderer extends Component {\n     return spans;\n   }\n \n+  getCellColor(keys, aggValue, cellColorFormatters) {\n+    let backgroundColor;\n+    if (cellColorFormatters) {\n+      Object.values(cellColorFormatters).forEach(cellColorFormatter => {\n+        if (Array.isArray(cellColorFormatter)) {\n+          keys.forEach(key => {\n+            if (backgroundColor) {\n+              return;\n+            }\n+            cellColorFormatter\n+              .filter(formatter => formatter.column === key)\n+              .forEach(formatter => {\n+                const formatterResult = formatter.getColorFromValue(aggValue);\n+                if (formatterResult) {\n+                  backgroundColor = formatterResult;\n+                }\n+              });\n+          });\n+        }\n+      });\n+    }\n+    return { backgroundColor };\n+  }\n+\n   getAggregatedData(pivotData, visibleColName, rowPartialOnTop) {\n     // Transforms flat row keys into a hierarchical group structure where each level\n     // represents a grouping dimension. For each row key path, it calculates the\n@@ -558,6 +582,7 @@ export class TableRenderer extends Component {\n       highlightHeaderCellsOnHover,\n       omittedHighlightHeaderGroups = [],\n       highlightedHeaderCells,\n+      cellColorFormatters,\n       dateFormatters,\n     } = this.props.tableOptions;\n \n@@ -656,10 +681,18 @@ export class TableRenderer extends Component {\n           typeof dateFormatters[attrName] === 'function'\n             ? dateFormatters[attrName](colKey[attrIdx])\n             : colKey[attrIdx];\n+        const { backgroundColor } = this.getCellColor(\n+          [attrName],\n+          headerCellFormattedValue,\n+          cellColorFormatters,\n+        );\n+        const style = { backgroundColor };\n+\n         attrValueCells.push(\n           <th\n             className={colLabelClass}\n             key={`colKey-${flatColKey}`}\n+            style={style}\n             colSpan={colSpan}\n             rowSpan={rowSpan}\n             role=\"columnheader button\"\n@@ -882,10 +915,18 @@ export class TableRenderer extends Component {\n           dateFormatters && dateFormatters[rowAttrs[i]]\n             ? dateFormatters[rowAttrs[i]](r)\n             : r;\n+        const { backgroundColor } = this.getCellColor(\n+          [rowAttrs[i]],\n+          headerCellFormattedValue,\n+          cellColorFormatters,\n+        );\n+        const style = { backgroundColor };\n+\n         return (\n           <th\n             key={`rowKeyLabel-${i}`}\n             className={valueCellClassName}\n+            style={style}\n             rowSpan={rowSpan}\n             colSpan={colSpan}\n             role=\"columnheader button\"\n@@ -942,26 +983,11 @@ export class TableRenderer extends Component {\n       const aggValue = agg.value();\n \n       const keys = [...rowKey, ...colKey];\n-      let backgroundColor;\n-      if (cellColorFormatters) {\n-        Object.values(cellColorFormatters).forEach(cellColorFormatter => {\n-          if (Array.isArray(cellColorFormatter)) {\n-            keys.forEach(key => {\n-              if (backgroundColor) {\n-                return;\n-              }\n-              cellColorFormatter\n-                .filter(formatter => formatter.column === key)\n-                .forEach(formatter => {\n-                  const formatterResult = formatter.getColorFromValue(aggValue);\n-                  if (formatterResult) {\n-                    backgroundColor = formatterResult;\n-                  }\n-                });\n-            });\n-          }\n-        });\n-      }\n+      const { backgroundColor } = this.getCellColor(\n+        keys,\n+        aggValue,\n+        cellColorFormatters,\n+      );\n \n       const style = agg.isSubtotal\n         ? { fontWeight: 'bold' }", "pull_request_number": 35863}
{"sha": "c08ac26930efdd31c0fbddb4f1b8a32c148d6972", "filename": "superset-frontend/package-lock.json", "status": "modified", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fpackage-lock.json", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fpackage-lock.json", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackage-lock.json?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -203,6 +203,7 @@\n         \"@types/rison\": \"0.1.0\",\n         \"@types/sinon\": \"^17.0.3\",\n         \"@types/tinycolor2\": \"^1.4.3\",\n+        \"@types/unzipper\": \"^0.10.11\",\n         \"@typescript-eslint/eslint-plugin\": \"^7.18.0\",\n         \"@typescript-eslint/parser\": \"^7.18.0\",\n         \"babel-jest\": \"^30.0.2\",\n@@ -276,6 +277,7 @@\n         \"tscw-config\": \"^1.1.2\",\n         \"tsx\": \"^4.21.0\",\n         \"typescript\": \"5.4.5\",\n+        \"unzipper\": \"^0.12.3\",\n         \"vm-browserify\": \"^1.1.2\",\n         \"wait-on\": \"^9.0.3\",\n         \"webpack\": \"^5.104.1\",\n@@ -20513,6 +20515,16 @@\n       \"integrity\": \"sha512-CmBKiL6NNo/OqgmMn95Fk9Whlp2mtvIv+KNpQKN2F4SjvrEesubTRWGYSg+BnWZOnlCaSTU1sMpsBOzgbYhnsA==\",\n       \"license\": \"MIT\"\n     },\n+    \"node_modules/@types/unzipper\": {\n+      \"version\": \"0.10.11\",\n+      \"resolved\": \"https://registry.npmjs.org/@types/unzipper/-/unzipper-0.10.11.tgz\",\n+      \"integrity\": \"sha512-D25im2zjyMCcgL9ag6N46+wbtJBnXIr7SI4zHf9eJD2Dw2tEB5e+p5MYkrxKIVRscs5QV0EhtU9rgXSPx90oJg==\",\n+      \"dev\": true,\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"@types/node\": \"*\"\n+      }\n+    },\n     \"node_modules/@types/urijs\": {\n       \"version\": \"1.19.26\",\n       \"resolved\": \"https://registry.npmjs.org/@types/urijs/-/urijs-1.19.26.tgz\",\n@@ -58008,6 +58020,20 @@\n         \"node\": \">=8\"\n       }\n     },\n+    \"node_modules/unzipper\": {\n+      \"version\": \"0.12.3\",\n+      \"resolved\": \"https://registry.npmjs.org/unzipper/-/unzipper-0.12.3.tgz\",\n+      \"integrity\": \"sha512-PZ8hTS+AqcGxsaQntl3IRBw65QrBI6lxzqDEL7IAo/XCEqRTKGfOX56Vea5TH9SZczRVxuzk1re04z/YjuYCJA==\",\n+      \"dev\": true,\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"bluebird\": \"~3.7.2\",\n+        \"duplexer2\": \"~0.1.4\",\n+        \"fs-extra\": \"^11.2.0\",\n+        \"graceful-fs\": \"^4.2.2\",\n+        \"node-int64\": \"^0.4.0\"\n+      }\n+    },\n     \"node_modules/upath\": {\n       \"version\": \"2.0.1\",\n       \"resolved\": \"https://registry.npmjs.org/upath/-/upath-2.0.1.tgz\",", "pull_request_number": 36684}
{"sha": "3ce18a25c97bbf857ef61aa020f952b96d8a32e5", "filename": "superset-frontend/package.json", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fpackage.json", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fpackage.json", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackage.json?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -284,6 +284,7 @@\n     \"@types/rison\": \"0.1.0\",\n     \"@types/sinon\": \"^17.0.3\",\n     \"@types/tinycolor2\": \"^1.4.3\",\n+    \"@types/unzipper\": \"^0.10.11\",\n     \"@typescript-eslint/eslint-plugin\": \"^7.18.0\",\n     \"@typescript-eslint/parser\": \"^7.18.0\",\n     \"babel-jest\": \"^30.0.2\",\n@@ -357,6 +358,7 @@\n     \"tscw-config\": \"^1.1.2\",\n     \"tsx\": \"^4.21.0\",\n     \"typescript\": \"5.4.5\",\n+    \"unzipper\": \"^0.12.3\",\n     \"vm-browserify\": \"^1.1.2\",\n     \"wait-on\": \"^9.0.3\",\n     \"webpack\": \"^5.104.1\",", "pull_request_number": 36684}
{"sha": "2c001297fe591a6dab0f9bae8e8d01d01299c70c", "filename": "superset-frontend/playwright.config.ts", "status": "modified", "additions": 18, "deletions": 6, "changes": 24, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright.config.ts", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright.config.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplaywright.config.ts?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -74,6 +74,9 @@ export default defineConfig({\n \n     viewport: { width: 1280, height: 1024 },\n \n+    // Accept downloads without prompts (needed for export tests)\n+    acceptDownloads: true,\n+\n     // Screenshots and videos on failure\n     screenshot: 'only-on-failure',\n     video: 'retain-on-failure',\n@@ -117,10 +120,19 @@ export default defineConfig({\n   // Web server setup - disabled in CI (Flask started separately in workflow)\n   webServer: process.env.CI\n     ? undefined\n-    : {\n-        command: 'curl -f http://localhost:8088/health',\n-        url: 'http://localhost:8088/health',\n-        reuseExistingServer: true,\n-        timeout: 5000,\n-      },\n+    : (() => {\n+        // Support custom base URL (e.g., http://localhost:9012/app/prefix/)\n+        const baseUrl =\n+          process.env.PLAYWRIGHT_BASE_URL || 'http://localhost:8088';\n+        // Extract origin (scheme + host + port) for health check\n+        // Health endpoint is always at /health regardless of app prefix\n+        const healthUrl = new URL('/health', new URL(baseUrl).origin).href;\n+        return {\n+          // Quote URL to prevent shell injection via PLAYWRIGHT_BASE_URL\n+          command: `curl -f '${healthUrl}'`,\n+          url: healthUrl,\n+          reuseExistingServer: true,\n+          timeout: 5000,\n+        };\n+      })(),\n });", "pull_request_number": 36684}
{"sha": "3e4d2dbf87bfa9b1cbcbd5f5d30f92feac4052e2", "filename": "superset-frontend/playwright/components/ListView/BulkSelect.ts", "status": "added", "additions": 116, "deletions": 0, "changes": 116, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fcomponents%2FListView%2FBulkSelect.ts", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fcomponents%2FListView%2FBulkSelect.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplaywright%2Fcomponents%2FListView%2FBulkSelect.ts?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -0,0 +1,116 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import { Locator, Page } from '@playwright/test';\n+import { Button, Checkbox, Table } from '../core';\n+\n+const BULK_SELECT_SELECTORS = {\n+  CONTROLS: '[data-test=\"bulk-select-controls\"]',\n+  ACTION: '[data-test=\"bulk-select-action\"]',\n+} as const;\n+\n+/**\n+ * BulkSelect component for Superset ListView bulk operations.\n+ * Provides a reusable interface for bulk selection and actions across list pages.\n+ *\n+ * @example\n+ * const bulkSelect = new BulkSelect(page, table);\n+ * await bulkSelect.enable();\n+ * await bulkSelect.selectRow('my-dataset');\n+ * await bulkSelect.selectRow('another-dataset');\n+ * await bulkSelect.clickAction('Delete');\n+ */\n+export class BulkSelect {\n+  private readonly page: Page;\n+  private readonly table: Table;\n+\n+  constructor(page: Page, table: Table) {\n+    this.page = page;\n+    this.table = table;\n+  }\n+\n+  /**\n+   * Gets the \"Bulk select\" toggle button\n+   */\n+  getToggleButton(): Button {\n+    return new Button(\n+      this.page,\n+      this.page.getByRole('button', { name: 'Bulk select' }),\n+    );\n+  }\n+\n+  /**\n+   * Enables bulk selection mode by clicking the toggle button\n+   */\n+  async enable(): Promise<void> {\n+    await this.getToggleButton().click();\n+  }\n+\n+  /**\n+   * Gets the checkbox for a row by name\n+   * @param rowName - The name/text identifying the row\n+   */\n+  getRowCheckbox(rowName: string): Checkbox {\n+    const row = this.table.getRow(rowName);\n+    return new Checkbox(this.page, row.getByRole('checkbox'));\n+  }\n+\n+  /**\n+   * Selects a row's checkbox in bulk select mode\n+   * @param rowName - The name/text identifying the row to select\n+   */\n+  async selectRow(rowName: string): Promise<void> {\n+    await this.getRowCheckbox(rowName).check();\n+  }\n+\n+  /**\n+   * Deselects a row's checkbox in bulk select mode\n+   * @param rowName - The name/text identifying the row to deselect\n+   */\n+  async deselectRow(rowName: string): Promise<void> {\n+    await this.getRowCheckbox(rowName).uncheck();\n+  }\n+\n+  /**\n+   * Gets the bulk select controls container locator (for assertions)\n+   */\n+  getControls(): Locator {\n+    return this.page.locator(BULK_SELECT_SELECTORS.CONTROLS);\n+  }\n+\n+  /**\n+   * Gets a bulk action button by name\n+   * @param actionName - The name of the bulk action (e.g., \"Export\", \"Delete\")\n+   */\n+  getActionButton(actionName: string): Button {\n+    const controls = this.getControls();\n+    return new Button(\n+      this.page,\n+      controls.locator(BULK_SELECT_SELECTORS.ACTION, { hasText: actionName }),\n+    );\n+  }\n+\n+  /**\n+   * Clicks a bulk action button by name (e.g., \"Export\", \"Delete\")\n+   * @param actionName - The name of the bulk action to click\n+   */\n+  async clickAction(actionName: string): Promise<void> {\n+    await this.getActionButton(actionName).click();\n+  }\n+}", "pull_request_number": 36684}
{"sha": "09bd815d4db24a312cce016d44af03eaa521ffdb", "filename": "superset-frontend/playwright/components/ListView/index.ts", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fcomponents%2FListView%2Findex.ts", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fcomponents%2FListView%2Findex.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplaywright%2Fcomponents%2FListView%2Findex.ts?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -0,0 +1,21 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+// ListView-specific Playwright Components for Superset\n+export { BulkSelect } from './BulkSelect';", "pull_request_number": 36684}
{"sha": "0ffc3f926841981227a6e9c1e90e558072ef8fab", "filename": "superset-frontend/playwright/components/core/AceEditor.ts", "status": "added", "additions": 207, "deletions": 0, "changes": 207, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fcomponents%2Fcore%2FAceEditor.ts", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fcomponents%2Fcore%2FAceEditor.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplaywright%2Fcomponents%2Fcore%2FAceEditor.ts?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -0,0 +1,207 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import { Locator, Page } from '@playwright/test';\n+\n+const ACE_EDITOR_SELECTORS = {\n+  TEXT_INPUT: '.ace_text-input',\n+  TEXT_LAYER: '.ace_text-layer',\n+  CONTENT: '.ace_content',\n+  SCROLLER: '.ace_scroller',\n+} as const;\n+\n+/**\n+ * AceEditor component for interacting with Ace Editor instances in Playwright.\n+ * Uses the ace editor API directly for reliable text manipulation.\n+ */\n+export class AceEditor {\n+  readonly page: Page;\n+  private readonly locator: Locator;\n+\n+  constructor(page: Page, selector: string);\n+\n+  constructor(page: Page, locator: Locator);\n+\n+  constructor(page: Page, selectorOrLocator: string | Locator) {\n+    this.page = page;\n+    if (typeof selectorOrLocator === 'string') {\n+      this.locator = page.locator(selectorOrLocator);\n+    } else {\n+      this.locator = selectorOrLocator;\n+    }\n+  }\n+\n+  /**\n+   * Gets the editor element locator\n+   */\n+  get element(): Locator {\n+    return this.locator;\n+  }\n+\n+  /**\n+   * Waits for the ace editor to be fully loaded and ready for interaction.\n+   */\n+  async waitForReady(): Promise<void> {\n+    // Wait for editor to be attached (outer .ace_editor div may be CSS-hidden)\n+    await this.locator.waitFor({ state: 'attached' });\n+    await this.locator\n+      .locator(ACE_EDITOR_SELECTORS.CONTENT)\n+      .waitFor({ state: 'attached' });\n+    // Wait for window.ace library to be fully loaded (may load async)\n+    await this.page.waitForFunction(\n+      () =>\n+        typeof (window as unknown as { ace?: { edit?: unknown } }).ace?.edit ===\n+        'function',\n+      { timeout: 10000 },\n+    );\n+  }\n+\n+  /**\n+   * Sets text in the ace editor using the ace API.\n+   * Uses element handle to target the specific editor instance (not global ID lookup).\n+   * @param text - The text to set\n+   */\n+  async setText(text: string): Promise<void> {\n+    await this.waitForReady();\n+    const elementHandle = await this.locator.elementHandle();\n+    if (!elementHandle) {\n+      throw new Error('Could not get element handle for ace editor');\n+    }\n+    await this.page.evaluate(\n+      ({ element, value }) => {\n+        const windowWithAce = window as unknown as {\n+          ace?: {\n+            edit(el: Element): {\n+              setValue(v: string, c: number): void;\n+              session: { getUndoManager(): { reset(): void } };\n+            };\n+          };\n+        };\n+        if (!windowWithAce.ace) {\n+          throw new Error(\n+            'Ace editor library not loaded. Ensure the page has finished loading.',\n+          );\n+        }\n+        // ace.edit() accepts either an element ID string or the DOM element itself\n+        const editor = windowWithAce.ace.edit(element);\n+        editor.setValue(value, 1);\n+        editor.session.getUndoManager().reset();\n+      },\n+      { element: elementHandle, value: text },\n+    );\n+  }\n+\n+  /**\n+   * Gets the text content from the ace editor.\n+   * Uses element handle to target the specific editor instance.\n+   * @returns The text content\n+   */\n+  async getText(): Promise<string> {\n+    await this.waitForReady();\n+    const elementHandle = await this.locator.elementHandle();\n+    if (!elementHandle) {\n+      throw new Error('Could not get element handle for ace editor');\n+    }\n+    return this.page.evaluate(element => {\n+      const windowWithAce = window as unknown as {\n+        ace?: { edit(el: Element): { getValue(): string } };\n+      };\n+      if (!windowWithAce.ace) {\n+        throw new Error(\n+          'Ace editor library not loaded. Ensure the page has finished loading.',\n+        );\n+      }\n+      return windowWithAce.ace.edit(element).getValue();\n+    }, elementHandle);\n+  }\n+\n+  /**\n+   * Clears the text in the ace editor.\n+   */\n+  async clear(): Promise<void> {\n+    await this.setText('');\n+  }\n+\n+  /**\n+   * Appends text to the existing content in the ace editor.\n+   * Uses element handle to target the specific editor instance.\n+   * @param text - The text to append\n+   */\n+  async appendText(text: string): Promise<void> {\n+    await this.waitForReady();\n+    const elementHandle = await this.locator.elementHandle();\n+    if (!elementHandle) {\n+      throw new Error('Could not get element handle for ace editor');\n+    }\n+    await this.page.evaluate(\n+      ({ element, value }) => {\n+        const windowWithAce = window as unknown as {\n+          ace?: {\n+            edit(el: Element): {\n+              getValue(): string;\n+              setValue(v: string, c: number): void;\n+            };\n+          };\n+        };\n+        if (!windowWithAce.ace) {\n+          throw new Error(\n+            'Ace editor library not loaded. Ensure the page has finished loading.',\n+          );\n+        }\n+        const editor = windowWithAce.ace.edit(element);\n+        const currentText = editor.getValue();\n+        // Only add newline if there's existing text that doesn't already end with one\n+        const needsNewline = currentText && !currentText.endsWith('\\n');\n+        const newText = currentText + (needsNewline ? '\\n' : '') + value;\n+        editor.setValue(newText, 1);\n+      },\n+      { element: elementHandle, value: text },\n+    );\n+  }\n+\n+  /**\n+   * Focuses the ace editor.\n+   * Uses element handle to target the specific editor instance.\n+   */\n+  async focus(): Promise<void> {\n+    await this.waitForReady();\n+    const elementHandle = await this.locator.elementHandle();\n+    if (!elementHandle) {\n+      throw new Error('Could not get element handle for ace editor');\n+    }\n+    await this.page.evaluate(element => {\n+      const windowWithAce = window as unknown as {\n+        ace?: { edit(el: Element): { focus(): void } };\n+      };\n+      if (!windowWithAce.ace) {\n+        throw new Error(\n+          'Ace editor library not loaded. Ensure the page has finished loading.',\n+        );\n+      }\n+      windowWithAce.ace.edit(element).focus();\n+    }, elementHandle);\n+  }\n+\n+  /**\n+   * Checks if the editor is visible.\n+   */\n+  async isVisible(): Promise<boolean> {\n+    return this.locator.isVisible();\n+  }\n+}", "pull_request_number": 36684}
{"sha": "d8527759baf1dba5e86e41e241815ead54cd9a28", "filename": "superset-frontend/playwright/components/core/Checkbox.ts", "status": "added", "additions": 95, "deletions": 0, "changes": 95, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fcomponents%2Fcore%2FCheckbox.ts", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fcomponents%2Fcore%2FCheckbox.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplaywright%2Fcomponents%2Fcore%2FCheckbox.ts?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -0,0 +1,95 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import { Locator, Page } from '@playwright/test';\n+\n+/**\n+ * Core Checkbox component used in Playwright tests to interact with checkbox\n+ * elements in the Superset UI.\n+ *\n+ * This class wraps a Playwright {@link Locator} pointing to a checkbox input\n+ * and provides convenience methods for common interactions such as checking,\n+ * unchecking, toggling, and asserting checkbox state and visibility.\n+ *\n+ * @example\n+ * const checkbox = new Checkbox(page, page.locator('input[type=\"checkbox\"]'));\n+ * await checkbox.check();\n+ * await expect(await checkbox.isChecked()).toBe(true);\n+ *\n+ * @param page - The Playwright {@link Page} instance associated with the test.\n+ * @param locator - The Playwright {@link Locator} targeting the checkbox element.\n+ */\n+export class Checkbox {\n+  readonly page: Page;\n+  private readonly locator: Locator;\n+\n+  constructor(page: Page, locator: Locator) {\n+    this.page = page;\n+    this.locator = locator;\n+  }\n+\n+  /**\n+   * Gets the checkbox element locator\n+   */\n+  get element(): Locator {\n+    return this.locator;\n+  }\n+\n+  /**\n+   * Checks the checkbox (ensures it's checked)\n+   */\n+  async check(): Promise<void> {\n+    await this.locator.check();\n+  }\n+\n+  /**\n+   * Unchecks the checkbox (ensures it's unchecked)\n+   */\n+  async uncheck(): Promise<void> {\n+    await this.locator.uncheck();\n+  }\n+\n+  /**\n+   * Toggles the checkbox state\n+   */\n+  async toggle(): Promise<void> {\n+    await this.locator.click();\n+  }\n+\n+  /**\n+   * Checks if the checkbox is checked\n+   */\n+  async isChecked(): Promise<boolean> {\n+    return this.locator.isChecked();\n+  }\n+\n+  /**\n+   * Checks if the checkbox is visible\n+   */\n+  async isVisible(): Promise<boolean> {\n+    return this.locator.isVisible();\n+  }\n+\n+  /**\n+   * Checks if the checkbox is enabled\n+   */\n+  async isEnabled(): Promise<boolean> {\n+    return this.locator.isEnabled();\n+  }\n+}", "pull_request_number": 36684}
{"sha": "1fb9191bcf5a835882ced1fdf40875d22783512c", "filename": "superset-frontend/playwright/components/core/Select.ts", "status": "added", "additions": 187, "deletions": 0, "changes": 187, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fcomponents%2Fcore%2FSelect.ts", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fcomponents%2Fcore%2FSelect.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplaywright%2Fcomponents%2Fcore%2FSelect.ts?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -0,0 +1,187 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import { Locator, Page } from '@playwright/test';\n+\n+/**\n+ * Ant Design Select component selectors\n+ */\n+const SELECT_SELECTORS = {\n+  DROPDOWN: '.ant-select-dropdown',\n+  OPTION: '.ant-select-item-option',\n+  SEARCH_INPUT: '.ant-select-selection-search-input',\n+  CLEAR: '.ant-select-clear',\n+} as const;\n+\n+/**\n+ * Select component for Ant Design Select/Combobox interactions.\n+ */\n+export class Select {\n+  readonly page: Page;\n+  private readonly locator: Locator;\n+\n+  constructor(page: Page, selector: string);\n+  constructor(page: Page, locator: Locator);\n+  constructor(page: Page, selectorOrLocator: string | Locator) {\n+    this.page = page;\n+    if (typeof selectorOrLocator === 'string') {\n+      this.locator = page.locator(selectorOrLocator);\n+    } else {\n+      this.locator = selectorOrLocator;\n+    }\n+  }\n+\n+  /**\n+   * Creates a Select from a combobox role with the given accessible name\n+   * @param page - The Playwright page\n+   * @param name - The accessible name (aria-label or placeholder text)\n+   */\n+  static fromRole(page: Page, name: string): Select {\n+    const locator = page.getByRole('combobox', { name });\n+    return new Select(page, locator);\n+  }\n+\n+  /**\n+   * Gets the select element locator\n+   */\n+  get element(): Locator {\n+    return this.locator;\n+  }\n+\n+  /**\n+   * Opens the dropdown, types to filter, and selects an option.\n+   * Handles cases where the option may not be initially visible in the dropdown.\n+   * Waits for dropdown to close after selection to avoid stale dropdowns.\n+   * @param optionText - The text of the option to select\n+   */\n+  async selectOption(optionText: string): Promise<void> {\n+    await this.open();\n+    await this.type(optionText);\n+    await this.clickOption(optionText);\n+    // Wait for dropdown to close to avoid multiple visible dropdowns\n+    await this.waitForDropdownClose();\n+  }\n+\n+  /**\n+   * Waits for dropdown to close after selection\n+   * This prevents strict mode violations when multiple selects are used sequentially\n+   */\n+  private async waitForDropdownClose(): Promise<void> {\n+    // Wait for dropdown to actually close (become hidden)\n+    await this.page\n+      .locator(`${SELECT_SELECTORS.DROPDOWN}:not(.ant-select-dropdown-hidden)`)\n+      .last()\n+      .waitFor({ state: 'hidden', timeout: 5000 })\n+      .catch(error => {\n+        // Only ignore TimeoutError (dropdown may already be closed); re-throw others\n+        if (!(error instanceof Error) || error.name !== 'TimeoutError') {\n+          throw error;\n+        }\n+      });\n+  }\n+\n+  /**\n+   * Opens the dropdown\n+   */\n+  async open(): Promise<void> {\n+    await this.locator.click();\n+  }\n+\n+  /**\n+   * Clicks an option in an already-open dropdown by its text content.\n+   * Uses selector-based approach matching Cypress patterns.\n+   * Handles multiple dropdowns by targeting only visible, non-hidden ones.\n+   * @param optionText - The text of the option to click (partial match for filtered results)\n+   */\n+  async clickOption(optionText: string): Promise<void> {\n+    // Target visible dropdown (excludes hidden ones via :not(.ant-select-dropdown-hidden))\n+    // Use .last() in case multiple dropdowns exist - the most recent one is what we want\n+    const dropdown = this.page\n+      .locator(`${SELECT_SELECTORS.DROPDOWN}:not(.ant-select-dropdown-hidden)`)\n+      .last();\n+    await dropdown.waitFor({ state: 'visible' });\n+\n+    // Find option by text content - use partial match since filtered results may have prefixes\n+    // (e.g., searching for 'main' shows 'examples.main', 'system.main')\n+    // First try exact match, fall back to partial match\n+    const exactOption = dropdown\n+      .locator(SELECT_SELECTORS.OPTION)\n+      .getByText(optionText, { exact: true });\n+\n+    if ((await exactOption.count()) > 0) {\n+      await exactOption.click();\n+    } else {\n+      // Fall back to first option containing the text\n+      const partialOption = dropdown\n+        .locator(SELECT_SELECTORS.OPTION)\n+        .filter({ hasText: optionText })\n+        .first();\n+      await partialOption.click();\n+    }\n+  }\n+\n+  /**\n+   * Closes the dropdown by pressing Escape\n+   */\n+  async close(): Promise<void> {\n+    await this.page.keyboard.press('Escape');\n+  }\n+\n+  /**\n+   * Types into the select to filter options (assumes dropdown is open)\n+   * @param text - The text to type\n+   */\n+  async type(text: string): Promise<void> {\n+    // Find the actual search input inside the select component\n+    const searchInput = this.locator.locator(SELECT_SELECTORS.SEARCH_INPUT);\n+    try {\n+      // Wait for search input in case dropdown is still rendering\n+      await searchInput.first().waitFor({ state: 'attached', timeout: 1000 });\n+      await searchInput.first().fill(text);\n+    } catch (error) {\n+      // Only handle TimeoutError (search input not found); re-throw other errors\n+      if (!(error instanceof Error) || error.name !== 'TimeoutError') {\n+        throw error;\n+      }\n+      // Fallback: locator might be the input itself (e.g., from getByRole('combobox'))\n+      await this.locator.fill(text);\n+    }\n+  }\n+\n+  /**\n+   * Clears the current selection\n+   */\n+  async clear(): Promise<void> {\n+    await this.locator.clear();\n+  }\n+\n+  /**\n+   * Checks if the select is visible\n+   */\n+  async isVisible(): Promise<boolean> {\n+    return this.locator.isVisible();\n+  }\n+\n+  /**\n+   * Checks if the select is enabled\n+   */\n+  async isEnabled(): Promise<boolean> {\n+    return this.locator.isEnabled();\n+  }\n+}", "pull_request_number": 36684}
{"sha": "cc4b7f5005342b7ba745aed13814bfea54caf8e9", "filename": "superset-frontend/playwright/components/core/Tabs.ts", "status": "added", "additions": 75, "deletions": 0, "changes": 75, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fcomponents%2Fcore%2FTabs.ts", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fcomponents%2Fcore%2FTabs.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplaywright%2Fcomponents%2Fcore%2FTabs.ts?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -0,0 +1,75 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import { Locator, Page } from '@playwright/test';\n+\n+/**\n+ * Tabs component for Ant Design tab navigation.\n+ */\n+export class Tabs {\n+  readonly page: Page;\n+  private readonly locator: Locator;\n+\n+  constructor(page: Page, locator?: Locator) {\n+    this.page = page;\n+    // Default to the tablist role if no specific locator provided\n+    this.locator = locator ?? page.getByRole('tablist');\n+  }\n+\n+  /**\n+   * Gets the tablist element locator\n+   */\n+  get element(): Locator {\n+    return this.locator;\n+  }\n+\n+  /**\n+   * Gets a tab by name, scoped to this tablist's container\n+   * @param tabName - The name/label of the tab\n+   */\n+  getTab(tabName: string): Locator {\n+    return this.locator.getByRole('tab', { name: tabName });\n+  }\n+\n+  /**\n+   * Clicks a tab by name\n+   * @param tabName - The name/label of the tab to click\n+   */\n+  async clickTab(tabName: string): Promise<void> {\n+    await this.getTab(tabName).click();\n+  }\n+\n+  /**\n+   * Gets the tab panel content for a given tab\n+   * @param tabName - The name/label of the tab\n+   */\n+  getTabPanel(tabName: string): Locator {\n+    return this.page.getByRole('tabpanel', { name: tabName });\n+  }\n+\n+  /**\n+   * Checks if a tab is selected\n+   * @param tabName - The name/label of the tab\n+   */\n+  async isSelected(tabName: string): Promise<boolean> {\n+    const tab = this.getTab(tabName);\n+    const ariaSelected = await tab.getAttribute('aria-selected');\n+    return ariaSelected === 'true';\n+  }\n+}", "pull_request_number": 36684}
{"sha": "5fae997f3ee13df5c5150a9fabc681f5abee9a21", "filename": "superset-frontend/playwright/components/core/Textarea.ts", "status": "added", "additions": 109, "deletions": 0, "changes": 109, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fcomponents%2Fcore%2FTextarea.ts", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fcomponents%2Fcore%2FTextarea.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplaywright%2Fcomponents%2Fcore%2FTextarea.ts?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -0,0 +1,109 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import { Locator, Page } from '@playwright/test';\n+\n+/**\n+ * Playwright helper for interacting with HTML {@link HTMLTextAreaElement | `<textarea>`} elements.\n+ *\n+ * This component wraps a Playwright {@link Locator} and provides convenience methods for\n+ * filling, clearing, and reading the value of a textarea without having to work with\n+ * locators directly.\n+ *\n+ * Typical usage:\n+ * ```ts\n+ * const textarea = new Textarea(page, 'textarea[name=\"description\"]');\n+ * await textarea.fill('Some multi-line text');\n+ * const value = await textarea.getValue();\n+ * ```\n+ *\n+ * You can also construct an instance from the `name` attribute:\n+ * ```ts\n+ * const textarea = Textarea.fromName(page, 'description');\n+ * await textarea.clear();\n+ * ```\n+ */\n+export class Textarea {\n+  readonly page: Page;\n+  private readonly locator: Locator;\n+\n+  constructor(page: Page, selector: string);\n+  constructor(page: Page, locator: Locator);\n+  constructor(page: Page, selectorOrLocator: string | Locator) {\n+    this.page = page;\n+    if (typeof selectorOrLocator === 'string') {\n+      this.locator = page.locator(selectorOrLocator);\n+    } else {\n+      this.locator = selectorOrLocator;\n+    }\n+  }\n+\n+  /**\n+   * Creates a Textarea from a name attribute\n+   * @param page - The Playwright page\n+   * @param name - The name attribute value\n+   */\n+  static fromName(page: Page, name: string): Textarea {\n+    const locator = page.locator(`textarea[name=\"${name}\"]`);\n+    return new Textarea(page, locator);\n+  }\n+\n+  /**\n+   * Gets the textarea element locator\n+   */\n+  get element(): Locator {\n+    return this.locator;\n+  }\n+\n+  /**\n+   * Fills the textarea with text (clears existing content)\n+   * @param text - The text to fill\n+   */\n+  async fill(text: string): Promise<void> {\n+    await this.locator.fill(text);\n+  }\n+\n+  /**\n+   * Clears the textarea content\n+   */\n+  async clear(): Promise<void> {\n+    await this.locator.clear();\n+  }\n+\n+  /**\n+   * Gets the current value of the textarea\n+   */\n+  async getValue(): Promise<string> {\n+    return this.locator.inputValue();\n+  }\n+\n+  /**\n+   * Checks if the textarea is visible\n+   */\n+  async isVisible(): Promise<boolean> {\n+    return this.locator.isVisible();\n+  }\n+\n+  /**\n+   * Checks if the textarea is enabled\n+   */\n+  async isEnabled(): Promise<boolean> {\n+    return this.locator.isEnabled();\n+  }\n+}", "pull_request_number": 36684}
{"sha": "5d9978cbf521c8755384e48831f98f8b34936285", "filename": "superset-frontend/playwright/components/core/index.ts", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fcomponents%2Fcore%2Findex.ts", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fcomponents%2Fcore%2Findex.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplaywright%2Fcomponents%2Fcore%2Findex.ts?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -18,8 +18,13 @@\n  */\n \n // Core Playwright Components for Superset\n+export { AceEditor } from './AceEditor';\n export { Button } from './Button';\n+export { Checkbox } from './Checkbox';\n export { Form } from './Form';\n export { Input } from './Input';\n export { Modal } from './Modal';\n+export { Select } from './Select';\n export { Table } from './Table';\n+export { Tabs } from './Tabs';\n+export { Textarea } from './Textarea';", "pull_request_number": 36684}
{"sha": "2d1c975e17095aab3efb84f2c276ddb34b351efc", "filename": "superset-frontend/playwright/components/modals/ConfirmDialog.ts", "status": "added", "additions": 75, "deletions": 0, "changes": 75, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fcomponents%2Fmodals%2FConfirmDialog.ts", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fcomponents%2Fmodals%2FConfirmDialog.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplaywright%2Fcomponents%2Fmodals%2FConfirmDialog.ts?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -0,0 +1,75 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import { Page, Locator } from '@playwright/test';\n+import { Modal } from '../core/Modal';\n+\n+/**\n+ * Confirm Dialog component for Ant Design Modal.confirm dialogs.\n+ * These are the \"OK\" / \"Cancel\" confirmation dialogs used throughout Superset.\n+ * Uses getByRole with name to target specific confirm dialogs when multiple are open.\n+ */\n+export class ConfirmDialog extends Modal {\n+  private readonly specificLocator: Locator;\n+\n+  constructor(page: Page, dialogName = 'Confirm save') {\n+    super(page);\n+    // Use getByRole with specific name to avoid strict mode violations\n+    // when multiple dialogs are open (e.g., Edit Dataset modal + Confirm save dialog)\n+    this.specificLocator = page.getByRole('dialog', { name: dialogName });\n+  }\n+\n+  /**\n+   * Override element getter to use specific locator\n+   */\n+  override get element(): Locator {\n+    return this.specificLocator;\n+  }\n+\n+  /**\n+   * Clicks the OK button to confirm.\n+   * @param options.timeout - If provided, silently returns if dialog doesn't appear\n+   *                          within timeout. If not provided, waits indefinitely (strict mode).\n+   */\n+  async clickOk(options?: { timeout?: number }): Promise<void> {\n+    try {\n+      await this.element.waitFor({\n+        state: 'visible',\n+        timeout: options?.timeout,\n+      });\n+      await this.clickFooterButton('OK');\n+      await this.waitForHidden();\n+    } catch (error) {\n+      // Only swallow TimeoutError when timeout was explicitly provided\n+      if (options?.timeout !== undefined) {\n+        if (error instanceof Error && error.name === 'TimeoutError') {\n+          return;\n+        }\n+      }\n+      throw error;\n+    }\n+  }\n+\n+  /**\n+   * Clicks the Cancel button to dismiss\n+   */\n+  async clickCancel(): Promise<void> {\n+    await this.clickFooterButton('Cancel');\n+  }\n+}", "pull_request_number": 36684}
{"sha": "3ee53d6d5ee1c170f5c0cc124411a0a644ba2b53", "filename": "superset-frontend/playwright/components/modals/DuplicateDatasetModal.ts", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fcomponents%2Fmodals%2FDuplicateDatasetModal.ts", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fcomponents%2Fmodals%2FDuplicateDatasetModal.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplaywright%2Fcomponents%2Fmodals%2FDuplicateDatasetModal.ts?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -55,7 +55,10 @@ export class DuplicateDatasetModal extends Modal {\n     datasetName: string,\n     options?: { timeout?: number; force?: boolean },\n   ): Promise<void> {\n-    await this.nameInput.fill(datasetName, options);\n+    const input = this.nameInput.element;\n+    // Clear existing text then fill (fill() clears first, but explicit clear is more reliable)\n+    await input.clear();\n+    await input.fill(datasetName, options);\n   }\n \n   /**", "pull_request_number": 36684}
{"sha": "bce66be962538db23f9fbf2792947467783e76ff", "filename": "superset-frontend/playwright/components/modals/EditDatasetModal.ts", "status": "added", "additions": 189, "deletions": 0, "changes": 189, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fcomponents%2Fmodals%2FEditDatasetModal.ts", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fcomponents%2Fmodals%2FEditDatasetModal.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplaywright%2Fcomponents%2Fmodals%2FEditDatasetModal.ts?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -0,0 +1,189 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import { Locator, Page } from '@playwright/test';\n+import { Input, Modal, Tabs, AceEditor } from '../core';\n+\n+/**\n+ * Edit Dataset Modal component (DatasourceModal).\n+ * Used for editing dataset properties like description, metrics, columns, etc.\n+ * Uses specific dialog name to avoid strict mode violations when multiple dialogs are open.\n+ */\n+export class EditDatasetModal extends Modal {\n+  private static readonly SELECTORS = {\n+    NAME_INPUT: '[data-test=\"inline-name\"]',\n+    LOCK_ICON: '[data-test=\"lock\"]',\n+    UNLOCK_ICON: '[data-test=\"unlock\"]',\n+  };\n+\n+  private readonly tabs: Tabs;\n+  private readonly specificLocator: Locator;\n+\n+  constructor(page: Page) {\n+    super(page);\n+    // Use getByRole with specific name to target Edit Dataset dialog\n+    // The dialog has aria-labelledby that resolves to \"edit Edit Dataset\"\n+    this.specificLocator = page.getByRole('dialog', { name: /edit.*dataset/i });\n+    // Scope tabs to modal's tablist to avoid matching tablists elsewhere on page\n+    this.tabs = new Tabs(page, this.specificLocator.getByRole('tablist'));\n+  }\n+\n+  /**\n+   * Override element getter to use specific locator\n+   */\n+  override get element(): Locator {\n+    return this.specificLocator;\n+  }\n+\n+  /**\n+   * Click the Save button to save changes\n+   */\n+  async clickSave(): Promise<void> {\n+    await this.clickFooterButton('Save');\n+  }\n+\n+  /**\n+   * Click the Cancel button to discard changes\n+   */\n+  async clickCancel(): Promise<void> {\n+    await this.clickFooterButton('Cancel');\n+  }\n+\n+  /**\n+   * Click the lock icon to enable edit mode\n+   * The modal starts in read-only mode and requires clicking the lock to edit\n+   */\n+  async enableEditMode(): Promise<void> {\n+    const lockButton = this.body.locator(EditDatasetModal.SELECTORS.LOCK_ICON);\n+    await lockButton.click();\n+  }\n+\n+  /**\n+   * Gets the dataset name input component\n+   */\n+  private get nameInput(): Input {\n+    return new Input(\n+      this.page,\n+      this.body.locator(EditDatasetModal.SELECTORS.NAME_INPUT),\n+    );\n+  }\n+\n+  /**\n+   * Fill in the dataset name field\n+   * Note: Call enableEditMode() first if the modal is in read-only mode\n+   * @param name - The new dataset name\n+   */\n+  async fillName(name: string): Promise<void> {\n+    await this.nameInput.fill(name);\n+  }\n+\n+  /**\n+   * Navigate to a specific tab in the modal\n+   * @param tabName - The name of the tab (e.g., 'Source', 'Metrics', 'Columns')\n+   */\n+  async clickTab(tabName: string): Promise<void> {\n+    await this.tabs.clickTab(tabName);\n+  }\n+\n+  /**\n+   * Navigate to the Settings tab\n+   */\n+  async clickSettingsTab(): Promise<void> {\n+    await this.tabs.clickTab('Settings');\n+  }\n+\n+  /**\n+   * Navigate to the Columns tab.\n+   * Uses regex to avoid matching \"Calculated columns\" tab, scoped to modal.\n+   */\n+  async clickColumnsTab(): Promise<void> {\n+    // Use regex starting with \"Columns\" to avoid matching \"Calculated columns\"\n+    // Scope to modal element to avoid matching tabs elsewhere on page\n+    await this.element.getByRole('tab', { name: /^Columns/ }).click();\n+  }\n+\n+  /**\n+   * Gets the description Ace Editor component (Settings tab).\n+   * The Description button and ace-editor are in the same form item.\n+   */\n+  private get descriptionEditor(): AceEditor {\n+    // Use tabpanel role with name \"Settings\" for more reliable lookup\n+    const settingsPanel = this.element.getByRole('tabpanel', {\n+      name: 'Settings',\n+    });\n+    // Find the form item that contains the Description button\n+    const descriptionFormItem = settingsPanel\n+      .locator('.ant-form-item')\n+      .filter({\n+        has: this.page.getByRole('button', {\n+          name: 'Description',\n+          exact: true,\n+        }),\n+      })\n+      .first();\n+    // The ace-editor has class .ace_editor within the form item\n+    const editorElement = descriptionFormItem.locator('.ace_editor');\n+    return new AceEditor(this.page, editorElement);\n+  }\n+\n+  /**\n+   * Fill the dataset description field (Settings tab).\n+   * @param description - The description text to set\n+   */\n+  async fillDescription(description: string): Promise<void> {\n+    await this.descriptionEditor.setText(description);\n+  }\n+\n+  /**\n+   * Expand a column row by column name.\n+   * Uses exact cell match to avoid false positives with short names like \"ds\".\n+   * @param columnName - The name of the column to expand\n+   * @returns The row locator for scoped selector access\n+   */\n+  async expandColumn(columnName: string): Promise<Locator> {\n+    // Find cell with exact column name text, then derive row from that cell\n+    const cell = this.body.getByRole('cell', { name: columnName, exact: true });\n+    const row = cell.locator('xpath=ancestor::tr[1]');\n+    await row.getByRole('button', { name: /expand row/i }).click();\n+    return row;\n+  }\n+\n+  /**\n+   * Fill column datetime format for a given column.\n+   * Expands the column row and fills the date format input.\n+   * Note: Expanded content appears in a sibling row, so we scope to modal body.\n+   * @param columnName - The name of the column to edit\n+   * @param format - The python date format string (e.g., '%Y-%m-%d')\n+   */\n+  async fillColumnDateFormat(\n+    columnName: string,\n+    format: string,\n+  ): Promise<void> {\n+    await this.expandColumn(columnName);\n+    // Expanded content appears in a sibling row, not nested inside the original row.\n+    // Use modal body scope with placeholder selector to find the datetime format input.\n+    const dateFormatInput = new Input(\n+      this.page,\n+      this.body.getByPlaceholder('%Y-%m-%d'),\n+    );\n+    await dateFormatInput.element.waitFor({ state: 'visible' });\n+    await dateFormatInput.clear();\n+    await dateFormatInput.fill(format);\n+  }\n+}", "pull_request_number": 36684}
{"sha": "1399cc53547f9b0acd3d6096eae1159b1c192bc9", "filename": "superset-frontend/playwright/components/modals/ImportDatasetModal.ts", "status": "added", "additions": 73, "deletions": 0, "changes": 73, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fcomponents%2Fmodals%2FImportDatasetModal.ts", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fcomponents%2Fmodals%2FImportDatasetModal.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplaywright%2Fcomponents%2Fmodals%2FImportDatasetModal.ts?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -0,0 +1,73 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import { Modal, Input } from '../core';\n+\n+/**\n+ * Import dataset modal for uploading dataset export files.\n+ * Handles file upload, overwrite confirmation, and import submission.\n+ */\n+export class ImportDatasetModal extends Modal {\n+  private static readonly SELECTORS = {\n+    FILE_INPUT: '[data-test=\"model-file-input\"]',\n+    OVERWRITE_INPUT: '[data-test=\"overwrite-modal-input\"]',\n+  };\n+\n+  /**\n+   * Upload a file to the import modal\n+   * @param filePath - Absolute path to the file to upload\n+   */\n+  async uploadFile(filePath: string): Promise<void> {\n+    await this.page\n+      .locator(ImportDatasetModal.SELECTORS.FILE_INPUT)\n+      .setInputFiles(filePath);\n+  }\n+\n+  /**\n+   * Fill the overwrite confirmation input (only needed if dataset exists)\n+   */\n+  async fillOverwriteConfirmation(): Promise<void> {\n+    const input = new Input(\n+      this.page,\n+      this.body.locator(ImportDatasetModal.SELECTORS.OVERWRITE_INPUT),\n+    );\n+    await input.fill('OVERWRITE');\n+  }\n+\n+  /**\n+   * Get the overwrite confirmation input locator\n+   */\n+  getOverwriteInput() {\n+    return this.body.locator(ImportDatasetModal.SELECTORS.OVERWRITE_INPUT);\n+  }\n+\n+  /**\n+   * Check if overwrite confirmation is visible\n+   */\n+  async isOverwriteVisible(): Promise<boolean> {\n+    return this.getOverwriteInput().isVisible();\n+  }\n+\n+  /**\n+   * Click the Import button in the footer\n+   */\n+  async clickImport(): Promise<void> {\n+    await this.clickFooterButton('Import');\n+  }\n+}", "pull_request_number": 36684}
{"sha": "a8f8f1576f3d692085d037e2fbbbc828b135f744", "filename": "superset-frontend/playwright/components/modals/index.ts", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fcomponents%2Fmodals%2Findex.ts", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fcomponents%2Fmodals%2Findex.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplaywright%2Fcomponents%2Fmodals%2Findex.ts?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -20,3 +20,4 @@\n // Specific modal implementations\n export { DeleteConfirmationModal } from './DeleteConfirmationModal';\n export { DuplicateDatasetModal } from './DuplicateDatasetModal';\n+export { ImportDatasetModal } from './ImportDatasetModal';", "pull_request_number": 36684}
{"sha": "5acf5396269bd0b682f30b0a572c11b9a8af7376", "filename": "superset-frontend/playwright/fixtures/dataset_export.zip", "status": "added", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Ffixtures%2Fdataset_export.zip", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Ffixtures%2Fdataset_export.zip", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplaywright%2Ffixtures%2Fdataset_export.zip?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "pull_request_number": 36684}
{"sha": "b1fe1c3cc51271957612918ce27a16a46b62d9ef", "filename": "superset-frontend/playwright/helpers/api/assertions.ts", "status": "added", "additions": 61, "deletions": 0, "changes": 61, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fhelpers%2Fapi%2Fassertions.ts", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fhelpers%2Fapi%2Fassertions.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplaywright%2Fhelpers%2Fapi%2Fassertions.ts?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -0,0 +1,61 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import type { Response, APIResponse } from '@playwright/test';\n+import { expect } from '@playwright/test';\n+\n+/**\n+ * Common interface for response types with status() method.\n+ * Supports both Response (network interception) and APIResponse (page.request API).\n+ */\n+type ResponseLike = Response | APIResponse;\n+\n+/**\n+ * Verify response has exact status code\n+ * @param response - Playwright Response or APIResponse object\n+ * @param expected - Expected status code\n+ * @returns The response for chaining\n+ */\n+export function expectStatus<T extends ResponseLike>(\n+  response: T,\n+  expected: number,\n+): T {\n+  expect(\n+    response.status(),\n+    `Expected status ${expected}, got ${response.status()}`,\n+  ).toBe(expected);\n+  return response;\n+}\n+\n+/**\n+ * Verify response status code is one of the expected values\n+ * @param response - Playwright Response or APIResponse object\n+ * @param expected - Array of acceptable status codes\n+ * @returns The response for chaining\n+ */\n+export function expectStatusOneOf<T extends ResponseLike>(\n+  response: T,\n+  expected: number[],\n+): T {\n+  expect(\n+    expected,\n+    `Expected status to be one of ${expected.join(', ')}, got ${response.status()}`,\n+  ).toContain(response.status());\n+  return response;\n+}", "pull_request_number": 36684}
{"sha": "7edea891973c21bd108777782535e98081d38ae0", "filename": "superset-frontend/playwright/helpers/api/database.ts", "status": "modified", "additions": 73, "deletions": 1, "changes": 74, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fhelpers%2Fapi%2Fdatabase.ts", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fhelpers%2Fapi%2Fdatabase.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplaywright%2Fhelpers%2Fapi%2Fdatabase.ts?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -18,19 +18,41 @@\n  */\n \n import { Page, APIResponse } from '@playwright/test';\n-import { apiPost, apiDelete, ApiRequestOptions } from './requests';\n+import rison from 'rison';\n+import { apiGet, apiPost, apiDelete, ApiRequestOptions } from './requests';\n \n const ENDPOINTS = {\n   DATABASE: 'api/v1/database/',\n } as const;\n \n+/**\n+ * TypeScript interface for database API response\n+ */\n+export interface DatabaseResult {\n+  id: number;\n+  database_name: string;\n+  /** Optional - list API masks this for security, only detail API returns it */\n+  sqlalchemy_uri?: string;\n+  backend?: string;\n+  engine_information?: {\n+    disable_ssh_tunneling?: boolean;\n+    supports_dynamic_catalog?: boolean;\n+    supports_file_upload?: boolean;\n+    supports_oauth2?: boolean;\n+  };\n+  extra?: string;\n+  expose_in_sqllab?: boolean;\n+  impersonate_user?: boolean;\n+}\n+\n /**\n  * TypeScript interface for database creation API payload\n  * Provides compile-time safety for required fields\n  */\n export interface DatabaseCreatePayload {\n   database_name: string;\n   engine: string;\n+  sqlalchemy_uri?: string;\n   configuration_method?: string;\n   engine_information?: {\n     disable_ssh_tunneling?: boolean;\n@@ -77,3 +99,53 @@ export async function apiDeleteDatabase(\n ): Promise<APIResponse> {\n   return apiDelete(page, `${ENDPOINTS.DATABASE}${databaseId}`, options);\n }\n+\n+/**\n+ * GET request to fetch a database's details\n+ * @param page - Playwright page instance (provides authentication context)\n+ * @param databaseId - ID of the database to fetch\n+ * @returns API response with database details\n+ */\n+export async function apiGetDatabase(\n+  page: Page,\n+  databaseId: number,\n+  options?: ApiRequestOptions,\n+): Promise<APIResponse> {\n+  return apiGet(page, `${ENDPOINTS.DATABASE}${databaseId}`, options);\n+}\n+\n+/**\n+ * Get a database by its name\n+ * @param page - Playwright page instance (provides authentication context)\n+ * @param databaseName - The database_name to search for\n+ * @returns Database object if found, null if not found\n+ */\n+export async function getDatabaseByName(\n+  page: Page,\n+  databaseName: string,\n+): Promise<DatabaseResult | null> {\n+  const filter = {\n+    filters: [\n+      {\n+        col: 'database_name',\n+        opr: 'eq',\n+        value: databaseName,\n+      },\n+    ],\n+  };\n+  const queryParam = rison.encode(filter);\n+  const response = await apiGet(page, `${ENDPOINTS.DATABASE}?q=${queryParam}`, {\n+    failOnStatusCode: false,\n+  });\n+\n+  if (!response.ok()) {\n+    return null;\n+  }\n+\n+  const body = await response.json();\n+  if (body.result && body.result.length > 0) {\n+    return body.result[0] as DatabaseResult;\n+  }\n+\n+  return null;\n+}", "pull_request_number": 36684}
{"sha": "2d3175de770cd49c0b2882bb696a18c8411fcc15", "filename": "superset-frontend/playwright/helpers/api/dataset.ts", "status": "modified", "additions": 56, "deletions": 13, "changes": 69, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fhelpers%2Fapi%2Fdataset.ts", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fhelpers%2Fapi%2Fdataset.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplaywright%2Fhelpers%2Fapi%2Fdataset.ts?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -20,9 +20,13 @@\n import { Page, APIResponse } from '@playwright/test';\n import rison from 'rison';\n import { apiGet, apiPost, apiDelete, ApiRequestOptions } from './requests';\n+import { getDatabaseByName } from './database';\n \n export const ENDPOINTS = {\n   DATASET: 'api/v1/dataset/',\n+  DATASET_EXPORT: 'api/v1/dataset/export/',\n+  DATASET_DUPLICATE: 'api/v1/dataset/duplicate',\n+  DATASET_IMPORT: 'api/v1/dataset/import/',\n } as const;\n \n /**\n@@ -37,12 +41,12 @@ export interface DatasetCreatePayload {\n }\n \n /**\n- * TypeScript interface for virtual dataset creation API payload\n- * Virtual datasets are SQL-based and support the Duplicate action in UI\n+ * TypeScript interface for virtual dataset creation API payload.\n+ * Virtual datasets are defined by SQL queries rather than physical tables.\n  */\n export interface VirtualDatasetCreatePayload {\n   database: number;\n-  schema: string;\n+  schema: string | null;\n   table_name: string;\n   sql: string;\n   owners?: number[];\n@@ -55,8 +59,8 @@ export interface VirtualDatasetCreatePayload {\n export interface DatasetResult {\n   id: number;\n   table_name: string;\n-  sql?: string;\n-  schema?: string;\n+  sql?: string | null;\n+  schema?: string | null;\n   database: {\n     id: number;\n     database_name: string;\n@@ -79,11 +83,11 @@ export async function apiPostDataset(\n }\n \n /**\n- * POST request to create a virtual (SQL-based) dataset\n- * Virtual datasets support the Duplicate action in the UI\n+ * POST request to create a virtual dataset with SQL.\n+ * Use expectStatusOneOf() on the response and handle both result.id and id shapes.\n  * @param page - Playwright page instance (provides authentication context)\n- * @param requestBody - Virtual dataset config (database, schema, table_name, sql)\n- * @returns API response from dataset creation\n+ * @param requestBody - Virtual dataset configuration (database, schema, table_name, sql)\n+ * @returns API response from virtual dataset creation\n  */\n export async function apiPostVirtualDataset(\n   page: Page,\n@@ -96,16 +100,27 @@ export async function apiPostVirtualDataset(\n  * Creates a simple virtual dataset for testing purposes\n  * @param page - Playwright page instance\n  * @param name - Name for the virtual dataset\n- * @param databaseId - ID of the database to use (defaults to 1 for examples db)\n+ * @param databaseId - ID of the database to use (looks up 'examples' DB if not provided)\n  * @returns The created dataset ID, or null on failure\n  */\n export async function createTestVirtualDataset(\n   page: Page,\n   name: string,\n-  databaseId = 1,\n+  databaseId?: number,\n ): Promise<number | null> {\n+  // Look up examples database if no ID provided\n+  let dbId = databaseId;\n+  if (dbId === undefined) {\n+    const examplesDb = await getDatabaseByName(page, 'examples');\n+    if (!examplesDb?.id) {\n+      console.warn('Failed to find examples database');\n+      return null;\n+    }\n+    dbId = examplesDb.id;\n+  }\n+\n   const response = await apiPostVirtualDataset(page, {\n-    database: databaseId,\n+    database: dbId,\n     schema: '',\n     table_name: name,\n     sql: \"SELECT 1 as id, 'test' as name\",\n@@ -118,7 +133,8 @@ export async function createTestVirtualDataset(\n   }\n \n   const body = await response.json();\n-  return body.id ?? null;\n+  // Handle both response shapes: { id } or { result: { id } }\n+  return body.result?.id ?? body.id ?? null;\n }\n \n /**\n@@ -186,3 +202,30 @@ export async function apiDeleteDataset(\n ): Promise<APIResponse> {\n   return apiDelete(page, `${ENDPOINTS.DATASET}${datasetId}`, options);\n }\n+\n+/**\n+ * Duplicate a dataset via the API\n+ * @param page - Playwright page instance (provides authentication context)\n+ * @param datasetId - ID of the dataset to duplicate\n+ * @param newName - Name for the duplicated dataset\n+ * @returns Object containing the new dataset's ID (use apiGetDataset for full details)\n+ */\n+export async function duplicateDataset(\n+  page: Page,\n+  datasetId: number,\n+  newName: string,\n+): Promise<{ id: number }> {\n+  const response = await apiPost(page, `${ENDPOINTS.DATASET}duplicate`, {\n+    base_model_id: datasetId,\n+    table_name: newName,\n+  });\n+  const body = await response.json();\n+  // Normalize: API may return id at top level or inside result\n+  const resolvedId = body.result?.id ?? body.id;\n+  if (!resolvedId) {\n+    throw new Error(\n+      `Duplicate dataset API returned no id. Response: ${JSON.stringify(body)}`,\n+    );\n+  }\n+  return { id: resolvedId };\n+}", "pull_request_number": 36684}
{"sha": "d813a2a91f6ad4045894de01a1a234c62cfca535", "filename": "superset-frontend/playwright/helpers/api/intercepts.ts", "status": "added", "additions": 145, "deletions": 0, "changes": 145, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fhelpers%2Fapi%2Fintercepts.ts", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fhelpers%2Fapi%2Fintercepts.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplaywright%2Fhelpers%2Fapi%2Fintercepts.ts?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -0,0 +1,145 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import type { Page, Response } from '@playwright/test';\n+\n+/**\n+ * HTTP methods enum for consistency\n+ */\n+export const HTTP_METHODS = {\n+  GET: 'GET',\n+  POST: 'POST',\n+  PUT: 'PUT',\n+  DELETE: 'DELETE',\n+  PATCH: 'PATCH',\n+} as const;\n+\n+type HttpMethod = (typeof HTTP_METHODS)[keyof typeof HTTP_METHODS];\n+\n+/**\n+ * Options for waitFor* functions\n+ */\n+interface WaitForResponseOptions {\n+  /** Optional timeout in milliseconds */\n+  timeout?: number;\n+  /** Match against URL pathname suffix instead of full URL includes (default: false) */\n+  pathMatch?: boolean;\n+}\n+\n+/**\n+ * Normalize a path by removing trailing slashes\n+ */\n+function normalizePath(path: string): string {\n+  return path.replace(/\\/+$/, '');\n+}\n+\n+/**\n+ * Check if a URL matches a pattern\n+ * - String + pathMatch: pathname.endsWith(pattern) with trailing slash normalization\n+ * - String: url.includes(pattern)\n+ * - RegExp: pattern.test(url)\n+ */\n+function matchUrl(\n+  url: string,\n+  pattern: string | RegExp,\n+  pathMatch?: boolean,\n+): boolean {\n+  if (typeof pattern === 'string') {\n+    if (pathMatch) {\n+      const pathname = normalizePath(new URL(url).pathname);\n+      const normalizedPattern = normalizePath(pattern);\n+      return pathname.endsWith(normalizedPattern);\n+    }\n+    return url.includes(pattern);\n+  }\n+  return pattern.test(url);\n+}\n+\n+/**\n+ * Generic helper to wait for a response matching URL pattern and HTTP method\n+ */\n+function waitForResponse(\n+  page: Page,\n+  urlPattern: string | RegExp,\n+  method: HttpMethod,\n+  options?: WaitForResponseOptions,\n+): Promise<Response> {\n+  const { pathMatch, ...waitOptions } = options ?? {};\n+  return page.waitForResponse(\n+    response =>\n+      matchUrl(response.url(), urlPattern, pathMatch) &&\n+      response.request().method() === method,\n+    waitOptions,\n+  );\n+}\n+\n+/**\n+ * Wait for a GET response matching the URL pattern\n+ */\n+export function waitForGet(\n+  page: Page,\n+  urlPattern: string | RegExp,\n+  options?: WaitForResponseOptions,\n+): Promise<Response> {\n+  return waitForResponse(page, urlPattern, HTTP_METHODS.GET, options);\n+}\n+\n+/**\n+ * Wait for a POST response matching the URL pattern\n+ */\n+export function waitForPost(\n+  page: Page,\n+  urlPattern: string | RegExp,\n+  options?: WaitForResponseOptions,\n+): Promise<Response> {\n+  return waitForResponse(page, urlPattern, HTTP_METHODS.POST, options);\n+}\n+\n+/**\n+ * Wait for a PUT response matching the URL pattern\n+ */\n+export function waitForPut(\n+  page: Page,\n+  urlPattern: string | RegExp,\n+  options?: WaitForResponseOptions,\n+): Promise<Response> {\n+  return waitForResponse(page, urlPattern, HTTP_METHODS.PUT, options);\n+}\n+\n+/**\n+ * Wait for a DELETE response matching the URL pattern\n+ */\n+export function waitForDelete(\n+  page: Page,\n+  urlPattern: string | RegExp,\n+  options?: WaitForResponseOptions,\n+): Promise<Response> {\n+  return waitForResponse(page, urlPattern, HTTP_METHODS.DELETE, options);\n+}\n+\n+/**\n+ * Wait for a PATCH response matching the URL pattern\n+ */\n+export function waitForPatch(\n+  page: Page,\n+  urlPattern: string | RegExp,\n+  options?: WaitForResponseOptions,\n+): Promise<Response> {\n+  return waitForResponse(page, urlPattern, HTTP_METHODS.PATCH, options);\n+}", "pull_request_number": 36684}
{"sha": "456d193d11f40a69bd4d3831cf5f5737c0f73e4a", "filename": "superset-frontend/playwright/helpers/fixtures/index.ts", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fhelpers%2Ffixtures%2Findex.ts", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fhelpers%2Ffixtures%2Findex.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplaywright%2Fhelpers%2Ffixtures%2Findex.ts?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -0,0 +1,21 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+// Base fixture with test asset cleanup\n+export { test as testWithAssets, expect, type TestAssets } from './testAssets';", "pull_request_number": 36684}
{"sha": "16f104f37045d3f1890bd793c218e994fae2db3f", "filename": "superset-frontend/playwright/helpers/fixtures/testAssets.ts", "status": "added", "additions": 68, "deletions": 0, "changes": 68, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fhelpers%2Ffixtures%2FtestAssets.ts", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fhelpers%2Ffixtures%2FtestAssets.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplaywright%2Fhelpers%2Ffixtures%2FtestAssets.ts?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -0,0 +1,68 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import { test as base } from '@playwright/test';\n+import { apiDeleteDataset } from '../api/dataset';\n+import { apiDeleteDatabase } from '../api/database';\n+\n+/**\n+ * Test asset tracker for automatic cleanup after each test.\n+ * Inspired by Cypress's cleanDashboards/cleanCharts pattern.\n+ */\n+export interface TestAssets {\n+  trackDataset(id: number): void;\n+  trackDatabase(id: number): void;\n+}\n+\n+export const test = base.extend<{ testAssets: TestAssets }>({\n+  testAssets: async ({ page }, use) => {\n+    // Use Set to de-dupe IDs (same resource may be tracked multiple times)\n+    const datasetIds = new Set<number>();\n+    const databaseIds = new Set<number>();\n+\n+    await use({\n+      trackDataset: id => datasetIds.add(id),\n+      trackDatabase: id => databaseIds.add(id),\n+    });\n+\n+    // Cleanup: Delete datasets FIRST (they reference databases)\n+    // Then delete databases. Use failOnStatusCode: false for tolerance.\n+    await Promise.all(\n+      [...datasetIds].map(id =>\n+        apiDeleteDataset(page, id, { failOnStatusCode: false }).catch(error => {\n+          console.warn(`[testAssets] Failed to cleanup dataset ${id}:`, error);\n+        }),\n+      ),\n+    );\n+    await Promise.all(\n+      [...databaseIds].map(id =>\n+        apiDeleteDatabase(page, id, { failOnStatusCode: false }).catch(\n+          error => {\n+            console.warn(\n+              `[testAssets] Failed to cleanup database ${id}:`,\n+              error,\n+            );\n+          },\n+        ),\n+      ),\n+    );\n+  },\n+});\n+\n+export { expect } from '@playwright/test';", "pull_request_number": 36684}
{"sha": "8dc381429382c1d387d396fd1c39b8fd49c29b6e", "filename": "superset-frontend/playwright/pages/ChartCreationPage.ts", "status": "added", "additions": 138, "deletions": 0, "changes": 138, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fpages%2FChartCreationPage.ts", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fpages%2FChartCreationPage.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplaywright%2Fpages%2FChartCreationPage.ts?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -0,0 +1,138 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import { expect, Locator, Page } from '@playwright/test';\n+import { Button, Select } from '../components/core';\n+\n+/**\n+ * Chart Creation Page object for the \"Create a new chart\" wizard.\n+ * This page appears after creating a dataset via the wizard.\n+ */\n+export class ChartCreationPage {\n+  readonly page: Page;\n+\n+  private static readonly SELECTORS = {\n+    VIZ_GALLERY: '.viz-gallery',\n+    VIZ_TYPE_ITEM: '[data-test=\"viz-type-gallery__item\"]',\n+  } as const;\n+\n+  constructor(page: Page) {\n+    this.page = page;\n+  }\n+\n+  /**\n+   * Gets the dataset selector container (includes the displayed selection value)\n+   */\n+  getDatasetSelectContainer(): Locator {\n+    return this.page.getByLabel('Dataset', { exact: false }).first();\n+  }\n+\n+  /**\n+   * Gets the dataset selector for interactions\n+   */\n+  getDatasetSelect(): Select {\n+    return new Select(\n+      this.page,\n+      this.page.getByRole('combobox', { name: /dataset/i }),\n+    );\n+  }\n+\n+  /**\n+   * Gets the visualization gallery container\n+   */\n+  getVizGallery(): Locator {\n+    return this.page.locator(ChartCreationPage.SELECTORS.VIZ_GALLERY);\n+  }\n+\n+  /**\n+   * Gets the \"Create new chart\" button\n+   */\n+  getCreateChartButton(): Button {\n+    return new Button(\n+      this.page,\n+      this.page.getByRole('button', { name: /create new chart/i }),\n+    );\n+  }\n+\n+  /**\n+   * Navigate to the chart creation page\n+   */\n+  async goto(): Promise<void> {\n+    await this.page.goto('chart/add');\n+  }\n+\n+  /**\n+   * Wait for the page to load (dataset selector visible)\n+   */\n+  async waitForPageLoad(): Promise<void> {\n+    await expect(this.getDatasetSelect().element).toBeVisible({\n+      timeout: 10000,\n+    });\n+  }\n+\n+  /**\n+   * Select a dataset from the dropdown\n+   * @param datasetName - The name of the dataset to select\n+   */\n+  async selectDataset(datasetName: string): Promise<void> {\n+    await this.getDatasetSelect().selectOption(datasetName);\n+  }\n+\n+  /**\n+   * Select a visualization type from the gallery\n+   * @param vizType - The visualization type to select (e.g., 'Table', 'Bar Chart')\n+   */\n+  async selectVizType(vizType: string): Promise<void> {\n+    const vizGallery = this.getVizGallery();\n+    await expect(vizGallery).toBeVisible();\n+\n+    // Button names in the gallery are duplicated (e.g., \"Table Table\", \"Bar Chart Bar Chart\")\n+    // because they include both the image alt text and the label text.\n+    // Use exact match with the duplicated pattern to avoid matching similar names.\n+    const vizTypeItem = vizGallery.getByRole('button', {\n+      name: `${vizType} ${vizType}`,\n+      exact: true,\n+    });\n+    await vizTypeItem.click();\n+  }\n+\n+  /**\n+   * Click the \"Create new chart\" button to navigate to Explore\n+   */\n+  async clickCreateNewChart(): Promise<void> {\n+    await this.getCreateChartButton().click();\n+  }\n+\n+  /**\n+   * Verify the dataset is pre-selected (shown in the selector)\n+   * @param datasetName - The expected dataset name\n+   */\n+  async expectDatasetSelected(datasetName: string): Promise<void> {\n+    // For Ant Design selects, the selected value is displayed in a sibling element,\n+    // not in the combobox input. Check the container for the displayed text.\n+    await expect(this.getDatasetSelectContainer()).toContainText(datasetName);\n+  }\n+\n+  /**\n+   * Check if the \"Create new chart\" button is enabled\n+   */\n+  async isCreateButtonEnabled(): Promise<boolean> {\n+    return this.getCreateChartButton().isEnabled();\n+  }\n+}", "pull_request_number": 36684}
{"sha": "ff129c7364cfcf994cc86e36cf0c4ce0ce989822", "filename": "superset-frontend/playwright/pages/CreateDatasetPage.ts", "status": "added", "additions": 138, "deletions": 0, "changes": 138, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fpages%2FCreateDatasetPage.ts", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fpages%2FCreateDatasetPage.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplaywright%2Fpages%2FCreateDatasetPage.ts?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -0,0 +1,138 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import { Page } from '@playwright/test';\n+import { Button, Select } from '../components/core';\n+\n+/**\n+ * Create Dataset Page object for the dataset creation wizard.\n+ */\n+export class CreateDatasetPage {\n+  readonly page: Page;\n+\n+  /**\n+   * Data-test selectors for the create dataset form elements.\n+   * Using data-test attributes avoids strict mode violations with multiple selects.\n+   */\n+  private static readonly SELECTORS = {\n+    DATABASE: '[data-test=\"select-database\"]',\n+    SCHEMA: '[data-test=\"Select schema or type to search schemas\"]',\n+    TABLE: '[data-test=\"Select table or type to search tables\"]',\n+  } as const;\n+\n+  constructor(page: Page) {\n+    this.page = page;\n+  }\n+\n+  /**\n+   * Gets the database selector using data-test attribute\n+   */\n+  getDatabaseSelect(): Select {\n+    return new Select(this.page, CreateDatasetPage.SELECTORS.DATABASE);\n+  }\n+\n+  /**\n+   * Gets the schema selector using data-test attribute\n+   */\n+  getSchemaSelect(): Select {\n+    return new Select(this.page, CreateDatasetPage.SELECTORS.SCHEMA);\n+  }\n+\n+  /**\n+   * Gets the table selector using data-test attribute\n+   */\n+  getTableSelect(): Select {\n+    return new Select(this.page, CreateDatasetPage.SELECTORS.TABLE);\n+  }\n+\n+  /**\n+   * Gets the create and explore button\n+   */\n+  getCreateAndExploreButton(): Button {\n+    return new Button(\n+      this.page,\n+      this.page.getByRole('button', { name: /Create and explore dataset/i }),\n+    );\n+  }\n+\n+  /**\n+   * Navigate to the create dataset page\n+   */\n+  async goto(): Promise<void> {\n+    await this.page.goto('dataset/add/');\n+  }\n+\n+  /**\n+   * Select a database from the dropdown\n+   * @param databaseName - The name of the database to select\n+   */\n+  async selectDatabase(databaseName: string): Promise<void> {\n+    await this.getDatabaseSelect().selectOption(databaseName);\n+  }\n+\n+  /**\n+   * Select a schema from the dropdown\n+   * @param schemaName - The name of the schema to select\n+   */\n+  async selectSchema(schemaName: string): Promise<void> {\n+    await this.getSchemaSelect().selectOption(schemaName);\n+  }\n+\n+  /**\n+   * Select a table from the dropdown\n+   * @param tableName - The name of the table to select\n+   */\n+  async selectTable(tableName: string): Promise<void> {\n+    await this.getTableSelect().selectOption(tableName);\n+  }\n+\n+  /**\n+   * Click the \"Create dataset\" button (without exploring)\n+   * Uses the dropdown menu to select \"Create dataset\" option\n+   */\n+  async clickCreateDataset(): Promise<void> {\n+    // Find the \"Create and explore dataset\" button, then its sibling dropdown trigger\n+    // This avoids ambiguity if other \"down\" buttons exist on the page\n+    const mainButton = this.page.getByRole('button', {\n+      name: /Create and explore dataset/i,\n+    });\n+    // The dropdown trigger is in the same button group, find it relative to main button\n+    const dropdownTrigger = mainButton\n+      .locator('xpath=following-sibling::button')\n+      .first();\n+    await dropdownTrigger.click();\n+\n+    // Click \"Create dataset\" option from the dropdown menu\n+    await this.page.getByText('Create dataset', { exact: true }).click();\n+  }\n+\n+  /**\n+   * Click the \"Create and explore dataset\" button\n+   */\n+  async clickCreateAndExploreDataset(): Promise<void> {\n+    await this.getCreateAndExploreButton().click();\n+  }\n+\n+  /**\n+   * Wait for the page to load\n+   */\n+  async waitForPageLoad(): Promise<void> {\n+    await this.getDatabaseSelect().element.waitFor({ state: 'visible' });\n+  }\n+}", "pull_request_number": 36684}
{"sha": "77e9a87db2548b5fa301206aaea3ca9f3639265c", "filename": "superset-frontend/playwright/pages/DatasetListPage.ts", "status": "modified", "additions": 84, "deletions": 15, "changes": 99, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fpages%2FDatasetListPage.ts", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Fpages%2FDatasetListPage.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplaywright%2Fpages%2FDatasetListPage.ts?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -18,7 +18,8 @@\n  */\n \n import { Page, Locator } from '@playwright/test';\n-import { Table } from '../components/core';\n+import { Button, Table } from '../components/core';\n+import { BulkSelect } from '../components/ListView';\n import { URL } from '../utils/urls';\n \n /**\n@@ -27,17 +28,26 @@ import { URL } from '../utils/urls';\n export class DatasetListPage {\n   private readonly page: Page;\n   private readonly table: Table;\n+  readonly bulkSelect: BulkSelect;\n \n   private static readonly SELECTORS = {\n     DATASET_LINK: '[data-test=\"internal-link\"]',\n-    DELETE_ACTION: '.action-button svg[data-icon=\"delete\"]',\n-    EXPORT_ACTION: '.action-button svg[data-icon=\"upload\"]',\n-    DUPLICATE_ACTION: '.action-button svg[data-icon=\"copy\"]',\n+  } as const;\n+\n+  /**\n+   * Action button names for getByRole('button', { name })\n+   */\n+  private static readonly ACTION_BUTTONS = {\n+    DELETE: 'delete',\n+    EDIT: 'edit',\n+    EXPORT: 'upload', // Export button uses upload icon\n+    DUPLICATE: 'copy',\n   } as const;\n \n   constructor(page: Page) {\n     this.page = page;\n     this.table = new Table(page);\n+    this.bulkSelect = new BulkSelect(page, this.table);\n   }\n \n   /**\n@@ -85,31 +95,90 @@ export class DatasetListPage {\n    * @param datasetName - The name of the dataset to delete\n    */\n   async clickDeleteAction(datasetName: string): Promise<void> {\n-    await this.table.clickRowAction(\n-      datasetName,\n-      DatasetListPage.SELECTORS.DELETE_ACTION,\n-    );\n+    const row = this.table.getRow(datasetName);\n+    await row\n+      .getByRole('button', { name: DatasetListPage.ACTION_BUTTONS.DELETE })\n+      .click();\n+  }\n+\n+  /**\n+   * Clicks the edit action button for a dataset\n+   * @param datasetName - The name of the dataset to edit\n+   */\n+  async clickEditAction(datasetName: string): Promise<void> {\n+    const row = this.table.getRow(datasetName);\n+    await row\n+      .getByRole('button', { name: DatasetListPage.ACTION_BUTTONS.EDIT })\n+      .click();\n   }\n \n   /**\n    * Clicks the export action button for a dataset\n    * @param datasetName - The name of the dataset to export\n    */\n   async clickExportAction(datasetName: string): Promise<void> {\n-    await this.table.clickRowAction(\n-      datasetName,\n-      DatasetListPage.SELECTORS.EXPORT_ACTION,\n-    );\n+    const row = this.table.getRow(datasetName);\n+    await row\n+      .getByRole('button', { name: DatasetListPage.ACTION_BUTTONS.EXPORT })\n+      .click();\n   }\n \n   /**\n    * Clicks the duplicate action button for a dataset (virtual datasets only)\n    * @param datasetName - The name of the dataset to duplicate\n    */\n   async clickDuplicateAction(datasetName: string): Promise<void> {\n-    await this.table.clickRowAction(\n-      datasetName,\n-      DatasetListPage.SELECTORS.DUPLICATE_ACTION,\n+    const row = this.table.getRow(datasetName);\n+    await row\n+      .getByRole('button', { name: DatasetListPage.ACTION_BUTTONS.DUPLICATE })\n+      .click();\n+  }\n+\n+  /**\n+   * Clicks the \"Bulk select\" button to enable bulk selection mode\n+   */\n+  async clickBulkSelectButton(): Promise<void> {\n+    await this.bulkSelect.enable();\n+  }\n+\n+  /**\n+   * Selects a dataset's checkbox in bulk select mode\n+   * @param datasetName - The name of the dataset to select\n+   */\n+  async selectDatasetCheckbox(datasetName: string): Promise<void> {\n+    await this.bulkSelect.selectRow(datasetName);\n+  }\n+\n+  /**\n+   * Clicks a bulk action button by name (e.g., \"Export\", \"Delete\")\n+   * @param actionName - The name of the bulk action to click\n+   */\n+  async clickBulkAction(actionName: string): Promise<void> {\n+    await this.bulkSelect.clickAction(actionName);\n+  }\n+\n+  /**\n+   * Gets the \"+ Dataset\" button for creating new datasets.\n+   * Uses specific selector to avoid matching the \"Datasets\" nav link.\n+   */\n+  getAddDatasetButton(): Button {\n+    return new Button(\n+      this.page,\n+      this.page.getByRole('button', { name: /^\\+ Dataset$|^plus Dataset$/ }),\n     );\n   }\n+\n+  /**\n+   * Clicks the \"+ Dataset\" button to navigate to create dataset page\n+   */\n+  async clickAddDataset(): Promise<void> {\n+    await this.getAddDatasetButton().click();\n+  }\n+\n+  /**\n+   * Clicks the import button to open the import modal\n+   */\n+  async clickImportButton(): Promise<void> {\n+    await this.page.getByTestId('import-button').click();\n+  }\n }", "pull_request_number": 36684}
{"sha": "4250ddcb674400cb340b277cbdea0c53783c2197", "filename": "superset-frontend/playwright/tests/experimental/dataset/create-dataset.spec.ts", "status": "added", "additions": 219, "deletions": 0, "changes": 219, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Ftests%2Fexperimental%2Fdataset%2Fcreate-dataset.spec.ts", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Ftests%2Fexperimental%2Fdataset%2Fcreate-dataset.spec.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplaywright%2Ftests%2Fexperimental%2Fdataset%2Fcreate-dataset.spec.ts?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -0,0 +1,219 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import { test, expect } from '../../../helpers/fixtures/testAssets';\n+import type { TestAssets } from '../../../helpers/fixtures/testAssets';\n+import type { Page, TestInfo } from '@playwright/test';\n+import { ExplorePage } from '../../../pages/ExplorePage';\n+import { CreateDatasetPage } from '../../../pages/CreateDatasetPage';\n+import { DatasetListPage } from '../../../pages/DatasetListPage';\n+import { ChartCreationPage } from '../../../pages/ChartCreationPage';\n+import { ENDPOINTS } from '../../../helpers/api/dataset';\n+import { waitForPost } from '../../../helpers/api/intercepts';\n+import { expectStatusOneOf } from '../../../helpers/api/assertions';\n+import { apiPostDatabase } from '../../../helpers/api/database';\n+\n+interface GsheetsSetupResult {\n+  sheetName: string;\n+  dbName: string;\n+  createDatasetPage: CreateDatasetPage;\n+}\n+\n+/**\n+ * Sets up gsheets database and navigates to create dataset page.\n+ * Skips test if gsheets connector unavailable (test.skip() throws, so no return).\n+ * @param testInfo - Test info for parallelIndex to avoid name collisions in parallel runs\n+ * @returns Setup result with names and page object\n+ */\n+async function setupGsheetsDataset(\n+  page: Page,\n+  testAssets: TestAssets,\n+  testInfo: TestInfo,\n+): Promise<GsheetsSetupResult> {\n+  // Public Google Sheet for testing (published to web, no auth required).\n+  // This is a Netflix dataset that is publicly accessible via the Google Visualization API.\n+  // NOTE: This sheet is hosted on an external Google account and is not created by the test itself.\n+  // If this sheet is deleted, its ID changes, or its sharing settings are restricted,\n+  // these tests will start failing when they attempt to create a database pointing at it.\n+  // In that case, create or select a new publicly readable test sheet, update `sheetUrl`\n+  // to use its URL, and update this comment to describe who owns/maintains that sheet\n+  // and the expected access controls (e.g., \"anyone with the link can view\").\n+  const sheetUrl =\n+    'https://docs.google.com/spreadsheets/d/19XNqckHGKGGPh83JGFdFGP4Bw9gdXeujq5EoIGwttdM/edit#gid=347941303';\n+  // Include parallelIndex to avoid collisions when tests run in parallel\n+  const uniqueSuffix = `${Date.now()}_${testInfo.parallelIndex}`;\n+  const sheetName = `test_netflix_${uniqueSuffix}`;\n+  const dbName = `test_gsheets_db_${uniqueSuffix}`;\n+\n+  // Create a Google Sheets database via API\n+  // The catalog must be in `extra` as JSON with engine_params.catalog format\n+  const catalogDict = { [sheetName]: sheetUrl };\n+  const createDbRes = await apiPostDatabase(page, {\n+    database_name: dbName,\n+    engine: 'gsheets',\n+    sqlalchemy_uri: 'gsheets://',\n+    configuration_method: 'dynamic_form',\n+    expose_in_sqllab: true,\n+    extra: JSON.stringify({\n+      engine_params: {\n+        catalog: catalogDict,\n+      },\n+    }),\n+  });\n+\n+  // Check if gsheets connector is available\n+  if (!createDbRes.ok()) {\n+    const errorBody = await createDbRes.json();\n+    const errorText = JSON.stringify(errorBody);\n+    // Skip test if gsheets connector not installed\n+    if (\n+      errorText.includes('gsheets') ||\n+      errorText.includes('No such DB engine')\n+    ) {\n+      await test.info().attach('skip-reason', {\n+        body: `Google Sheets connector unavailable: ${errorText}`,\n+        contentType: 'text/plain',\n+      });\n+      test.skip(); // throws, no return needed\n+    }\n+    throw new Error(`Failed to create gsheets database: ${errorText}`);\n+  }\n+\n+  const createDbBody = await createDbRes.json();\n+  const dbId = createDbBody.result?.id ?? createDbBody.id;\n+  if (!dbId) {\n+    throw new Error('Database creation did not return an ID');\n+  }\n+  testAssets.trackDatabase(dbId);\n+\n+  // Navigate to create dataset page\n+  const createDatasetPage = new CreateDatasetPage(page);\n+  await createDatasetPage.goto();\n+  await createDatasetPage.waitForPageLoad();\n+\n+  // Select the Google Sheets database\n+  await createDatasetPage.selectDatabase(dbName);\n+\n+  // Try to select the sheet - if not found due to timeout, skip\n+  try {\n+    await createDatasetPage.selectTable(sheetName);\n+  } catch (error) {\n+    // Only skip on TimeoutError (sheet not loaded); re-throw everything else\n+    if (!(error instanceof Error) || error.name !== 'TimeoutError') {\n+      throw error;\n+    }\n+    await test.info().attach('skip-reason', {\n+      body: `Table \"${sheetName}\" not found in dropdown after timeout.`,\n+      contentType: 'text/plain',\n+    });\n+    test.skip(); // throws, no return needed\n+  }\n+\n+  return { sheetName, dbName, createDatasetPage };\n+}\n+\n+test('should create a dataset via wizard', async ({ page, testAssets }) => {\n+  const { sheetName, createDatasetPage } = await setupGsheetsDataset(\n+    page,\n+    testAssets,\n+    test.info(),\n+  );\n+\n+  // Set up response intercept to capture new dataset ID\n+  const createResponsePromise = waitForPost(page, ENDPOINTS.DATASET, {\n+    pathMatch: true,\n+  });\n+\n+  // Click \"Create and explore dataset\" button\n+  await createDatasetPage.clickCreateAndExploreDataset();\n+\n+  // Wait for dataset creation and capture ID for cleanup\n+  const createResponse = expectStatusOneOf(\n+    await createResponsePromise,\n+    [200, 201],\n+  );\n+  const createBody = await createResponse.json();\n+  const newDatasetId = createBody.result?.id ?? createBody.id;\n+\n+  if (newDatasetId) {\n+    testAssets.trackDataset(newDatasetId);\n+  }\n+\n+  // Verify we navigated to Chart Creation page with dataset pre-selected\n+  await page.waitForURL(/.*\\/chart\\/add.*/);\n+  const chartCreationPage = new ChartCreationPage(page);\n+  await chartCreationPage.waitForPageLoad();\n+\n+  // Verify the dataset is pre-selected\n+  await chartCreationPage.expectDatasetSelected(sheetName);\n+\n+  // Select a visualization type and create chart\n+  await chartCreationPage.selectVizType('Table');\n+\n+  // Click \"Create new chart\" to go to Explore\n+  await chartCreationPage.clickCreateNewChart();\n+\n+  // Verify we navigated to Explore page\n+  await page.waitForURL(/.*\\/explore\\/.*/);\n+  const explorePage = new ExplorePage(page);\n+  await explorePage.waitForPageLoad();\n+\n+  // Verify the dataset name is shown in Explore\n+  const loadedDatasetName = await explorePage.getDatasetName();\n+  expect(loadedDatasetName).toContain(sheetName);\n+});\n+\n+test('should create a dataset without exploring', async ({\n+  page,\n+  testAssets,\n+}) => {\n+  const { sheetName, createDatasetPage } = await setupGsheetsDataset(\n+    page,\n+    testAssets,\n+    test.info(),\n+  );\n+\n+  // Set up response intercept to capture dataset ID\n+  const createResponsePromise = waitForPost(page, ENDPOINTS.DATASET, {\n+    pathMatch: true,\n+  });\n+\n+  // Click \"Create dataset\" (not explore)\n+  await createDatasetPage.clickCreateDataset();\n+\n+  // Capture dataset ID from response for cleanup\n+  const createResponse = expectStatusOneOf(\n+    await createResponsePromise,\n+    [200, 201],\n+  );\n+  const createBody = await createResponse.json();\n+  const datasetId = createBody.result?.id ?? createBody.id;\n+  if (datasetId) {\n+    testAssets.trackDataset(datasetId);\n+  }\n+\n+  // Verify redirect to dataset list (not chart creation)\n+  // Note: \"Create dataset\" action does not show a toast\n+  await page.waitForURL(/.*tablemodelview\\/list.*/);\n+\n+  // Wait for table load, verify row visible\n+  const datasetListPage = new DatasetListPage(page);\n+  await datasetListPage.waitForTableLoad();\n+  await expect(datasetListPage.getDatasetRow(sheetName)).toBeVisible();\n+});", "pull_request_number": 36684}
{"sha": "968ff621ba9474e6e8448ef567a95455ac5aea46", "filename": "superset-frontend/playwright/tests/experimental/dataset/dataset-list.spec.ts", "status": "modified", "additions": 542, "deletions": 87, "changes": 629, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Ftests%2Fexperimental%2Fdataset%2Fdataset-list.spec.ts", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Ftests%2Fexperimental%2Fdataset%2Fdataset-list.spec.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplaywright%2Ftests%2Fexperimental%2Fdataset%2Fdataset-list.spec.ts?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -17,76 +17,90 @@\n  * under the License.\n  */\n \n-import { test, expect } from '@playwright/test';\n+import {\n+  test as testWithAssets,\n+  expect,\n+} from '../../../helpers/fixtures/testAssets';\n+import type { Response } from '@playwright/test';\n+import path from 'path';\n+import * as unzipper from 'unzipper';\n import { DatasetListPage } from '../../../pages/DatasetListPage';\n import { ExplorePage } from '../../../pages/ExplorePage';\n+import { ConfirmDialog } from '../../../components/modals/ConfirmDialog';\n import { DeleteConfirmationModal } from '../../../components/modals/DeleteConfirmationModal';\n+import { ImportDatasetModal } from '../../../components/modals/ImportDatasetModal';\n import { DuplicateDatasetModal } from '../../../components/modals/DuplicateDatasetModal';\n+import { EditDatasetModal } from '../../../components/modals/EditDatasetModal';\n import { Toast } from '../../../components/core/Toast';\n import {\n   apiDeleteDataset,\n   apiGetDataset,\n+  apiPostVirtualDataset,\n   getDatasetByName,\n-  createTestVirtualDataset,\n   ENDPOINTS,\n } from '../../../helpers/api/dataset';\n+import { createTestDataset } from './dataset-test-helpers';\n+import {\n+  waitForGet,\n+  waitForPost,\n+  waitForPut,\n+} from '../../../helpers/api/intercepts';\n+import { expectStatusOneOf } from '../../../helpers/api/assertions';\n \n /**\n- * Test data constants\n- * PHYSICAL_DATASET: A physical dataset from examples (for navigation tests)\n- * Tests that need virtual datasets (duplicate/delete) create their own hermetic data\n+ * Extend testWithAssets with datasetListPage navigation (beforeEach equivalent).\n  */\n-const TEST_DATASETS = {\n-  /** Physical dataset for basic navigation tests */\n-  PHYSICAL_DATASET: 'birth_names',\n-} as const;\n+const test = testWithAssets.extend<{ datasetListPage: DatasetListPage }>({\n+  datasetListPage: async ({ page }, use) => {\n+    const datasetListPage = new DatasetListPage(page);\n+    await datasetListPage.goto();\n+    await datasetListPage.waitForTableLoad();\n+    await use(datasetListPage);\n+  },\n+});\n \n /**\n- * Dataset List E2E Tests\n- *\n- * Uses flat test() structure per project convention (matches login.spec.ts).\n- * Shared state and hooks are at file scope.\n+ * Helper to validate an export zip response.\n+ * Verifies headers, parses zip contents, and validates expected structure.\n  */\n+async function expectValidExportZip(\n+  response: Response,\n+  options: { minDatasetCount?: number; checkContentDisposition?: boolean } = {},\n+): Promise<void> {\n+  const { minDatasetCount = 1, checkContentDisposition = false } = options;\n+\n+  // Verify headers\n+  expect(response.headers()['content-type']).toContain('application/zip');\n+  if (checkContentDisposition) {\n+    expect(response.headers()['content-disposition']).toMatch(\n+      /filename=.*dataset_export.*\\.zip/,\n+    );\n+  }\n \n-// File-scope state (reset in beforeEach)\n-let datasetListPage: DatasetListPage;\n-let explorePage: ExplorePage;\n-let testResources: { datasetIds: number[] } = { datasetIds: [] };\n-\n-test.beforeEach(async ({ page }) => {\n-  datasetListPage = new DatasetListPage(page);\n-  explorePage = new ExplorePage(page);\n-  testResources = { datasetIds: [] }; // Reset for each test\n+  // Parse and validate zip contents\n+  const body = await response.body();\n+  expect(body.length).toBeGreaterThan(0);\n \n-  // Navigate to dataset list page\n-  await datasetListPage.goto();\n-  await datasetListPage.waitForTableLoad();\n-});\n+  const entries: string[] = [];\n+  const directory = await unzipper.Open.buffer(body);\n+  directory.files.forEach(file => entries.push(file.path));\n \n-test.afterEach(async ({ page }) => {\n-  // Cleanup any resources created during the test\n-  const promises = [];\n-  for (const datasetId of testResources.datasetIds) {\n-    promises.push(\n-      apiDeleteDataset(page, datasetId, {\n-        failOnStatusCode: false,\n-      }).catch(error => {\n-        // Log cleanup failures to avoid silent resource leaks\n-        console.warn(\n-          `[Cleanup] Failed to delete dataset ${datasetId}:`,\n-          String(error),\n-        );\n-      }),\n-    );\n-  }\n-  await Promise.all(promises);\n-});\n+  // Validate structure\n+  const datasetYamlFiles = entries.filter(\n+    entry => entry.includes('datasets/') && entry.endsWith('.yaml'),\n+  );\n+  expect(datasetYamlFiles.length).toBeGreaterThanOrEqual(minDatasetCount);\n+  expect(entries.some(entry => entry.endsWith('metadata.yaml'))).toBe(true);\n+}\n \n test('should navigate to Explore when dataset name is clicked', async ({\n   page,\n+  datasetListPage,\n }) => {\n-  // Use existing physical dataset (loaded in CI via --load-examples)\n-  const datasetName = TEST_DATASETS.PHYSICAL_DATASET;\n+  const explorePage = new ExplorePage(page);\n+\n+  // Use existing example dataset (hermetic - loaded in CI via --load-examples)\n+  const datasetName = 'members_channels_2';\n   const dataset = await getDatasetByName(page, datasetName);\n   expect(dataset).not.toBeNull();\n \n@@ -108,16 +122,20 @@ test('should navigate to Explore when dataset name is clicked', async ({\n   await expect(explorePage.getVizSwitcher()).toContainText('Table');\n });\n \n-test('should delete a dataset with confirmation', async ({ page }) => {\n-  // Create a virtual dataset for this test (hermetic - no dependency on examples)\n-  const datasetName = `test_delete_${Date.now()}`;\n-  const datasetId = await createTestVirtualDataset(page, datasetName);\n-  expect(datasetId).not.toBeNull();\n-\n-  // Track for cleanup in case test fails partway through\n-  testResources = { datasetIds: [datasetId!] };\n+test('should delete a dataset with confirmation', async ({\n+  page,\n+  datasetListPage,\n+  testAssets,\n+}) => {\n+  // Create throwaway dataset for deletion\n+  const { id: datasetId, name: datasetName } = await createTestDataset(\n+    page,\n+    testAssets,\n+    test.info(),\n+    { prefix: 'test_delete' },\n+  );\n \n-  // Refresh page to see new dataset\n+  // Refresh to see the new dataset\n   await datasetListPage.goto();\n   await datasetListPage.waitForTableLoad();\n \n@@ -148,31 +166,44 @@ test('should delete a dataset with confirmation', async ({ page }) => {\n \n   // Verify dataset is removed from list\n   await expect(datasetListPage.getDatasetRow(datasetName)).not.toBeVisible();\n-});\n-\n-test('should duplicate a dataset with new name', async ({ page }) => {\n-  // Create a virtual dataset for this test (hermetic - no dependency on examples)\n-  const originalName = `test_original_${Date.now()}`;\n-  const originalId = await createTestVirtualDataset(page, originalName);\n-  expect(originalId).not.toBeNull();\n \n-  // Track original for cleanup\n-  testResources = { datasetIds: [originalId!] };\n+  // Verify via API that dataset no longer exists (404)\n+  await expect\n+    .poll(\n+      async () => {\n+        const response = await apiGetDataset(page, datasetId, {\n+          failOnStatusCode: false,\n+        });\n+        return response.status();\n+      },\n+      { timeout: 10000, message: `Dataset ${datasetId} should return 404` },\n+    )\n+    .toBe(404);\n+});\n \n-  const duplicateName = `duplicate_${originalName}`;\n+test('should duplicate a dataset with new name', async ({\n+  page,\n+  datasetListPage,\n+  testAssets,\n+}) => {\n+  // Create a virtual dataset first (duplicate UI only works for virtual datasets)\n+  const { id: originalId, name: originalName } = await createTestDataset(\n+    page,\n+    testAssets,\n+    test.info(),\n+    { prefix: 'test_duplicate_source' },\n+  );\n+  const duplicateName = `duplicate_${Date.now()}_${test.info().parallelIndex}`;\n \n-  // Refresh page to see new dataset\n+  // Navigate to list and verify original dataset is visible\n   await datasetListPage.goto();\n   await datasetListPage.waitForTableLoad();\n-\n-  // Verify original dataset is visible in list\n   await expect(datasetListPage.getDatasetRow(originalName)).toBeVisible();\n \n   // Set up response intercept to capture duplicate dataset ID\n-  const duplicateResponsePromise = page.waitForResponse(\n-    response =>\n-      response.url().includes(`${ENDPOINTS.DATASET}duplicate`) &&\n-      response.status() === 201,\n+  const duplicateResponsePromise = waitForPost(\n+    page,\n+    ENDPOINTS.DATASET_DUPLICATE,\n   );\n \n   // Click duplicate action button\n@@ -188,13 +219,17 @@ test('should duplicate a dataset with new name', async ({ page }) => {\n   // Click the Duplicate button\n   await duplicateModal.clickDuplicate();\n \n-  // Get the duplicate dataset ID from response\n-  const duplicateResponse = await duplicateResponsePromise;\n+  // Get the duplicate dataset ID from response (handle both response shapes)\n+  const duplicateResponse = expectStatusOneOf(\n+    await duplicateResponsePromise,\n+    [200, 201],\n+  );\n   const duplicateData = await duplicateResponse.json();\n-  const duplicateId = duplicateData.id;\n+  const duplicateId = duplicateData.result?.id ?? duplicateData.id;\n+  expect(duplicateId, 'Duplicate API should return dataset id').toBeTruthy();\n \n-  // Track both original and duplicate for cleanup\n-  testResources = { datasetIds: [originalId!, duplicateId] };\n+  // Track duplicate for cleanup (original is already tracked by createTestDataset)\n+  testAssets.trackDataset(duplicateId);\n \n   // Modal should close\n   await duplicateModal.waitForHidden();\n@@ -210,17 +245,437 @@ test('should duplicate a dataset with new name', async ({ page }) => {\n   await expect(datasetListPage.getDatasetRow(originalName)).toBeVisible();\n   await expect(datasetListPage.getDatasetRow(duplicateName)).toBeVisible();\n \n-  // API Verification: Compare original and duplicate datasets\n-  const originalResponseData = await apiGetDataset(page, originalId!);\n-  const originalDataFull = await originalResponseData.json();\n-  const duplicateResponseData = await apiGetDataset(page, duplicateId);\n-  const duplicateDataFull = await duplicateResponseData.json();\n+  // API Verification: Fetch both datasets via detail API for consistent comparison\n+  // (list API may return undefined for fields that detail API returns as null)\n+  const [originalDetailRes, duplicateDetailRes] = await Promise.all([\n+    apiGetDataset(page, originalId),\n+    apiGetDataset(page, duplicateId),\n+  ]);\n+  const originalDetail = (await originalDetailRes.json()).result;\n+  const duplicateDetail = (await duplicateDetailRes.json()).result;\n \n   // Verify key properties were copied correctly\n-  expect(duplicateDataFull.result.sql).toBe(originalDataFull.result.sql);\n-  expect(duplicateDataFull.result.database.id).toBe(\n-    originalDataFull.result.database.id,\n-  );\n+  expect(duplicateDetail.sql).toBe(originalDetail.sql);\n+  expect(duplicateDetail.database.id).toBe(originalDetail.database.id);\n+  expect(duplicateDetail.schema).toBe(originalDetail.schema);\n   // Name should be different (the duplicate name)\n-  expect(duplicateDataFull.result.table_name).toBe(duplicateName);\n+  expect(duplicateDetail.table_name).toBe(duplicateName);\n+});\n+\n+test('should export a dataset as a zip file', async ({\n+  page,\n+  datasetListPage,\n+}) => {\n+  // Use existing example dataset\n+  const datasetName = 'members_channels_2';\n+  const dataset = await getDatasetByName(page, datasetName);\n+  expect(dataset).not.toBeNull();\n+\n+  // Verify dataset is visible in list\n+  await expect(datasetListPage.getDatasetRow(datasetName)).toBeVisible();\n+\n+  // Set up API response intercept for export endpoint\n+  // Note: We intercept the API response instead of relying on download events because\n+  // Superset uses blob downloads (createObjectURL) which don't trigger Playwright's\n+  // download event consistently, especially in app-prefix configurations.\n+  const exportResponsePromise = waitForGet(page, ENDPOINTS.DATASET_EXPORT);\n+\n+  // Click export action button\n+  await datasetListPage.clickExportAction(datasetName);\n+\n+  // Wait for export API response and validate zip contents\n+  const exportResponse = expectStatusOneOf(await exportResponsePromise, [200]);\n+  await expectValidExportZip(exportResponse, { checkContentDisposition: true });\n+});\n+\n+test('should export multiple datasets via bulk select action', async ({\n+  page,\n+  datasetListPage,\n+  testAssets,\n+}) => {\n+  // Create 2 throwaway datasets for bulk export\n+  const [dataset1, dataset2] = await Promise.all([\n+    createTestDataset(page, testAssets, test.info(), {\n+      prefix: 'bulk_export_1',\n+    }),\n+    createTestDataset(page, testAssets, test.info(), {\n+      prefix: 'bulk_export_2',\n+    }),\n+  ]);\n+\n+  // Refresh to see new datasets\n+  await datasetListPage.goto();\n+  await datasetListPage.waitForTableLoad();\n+\n+  // Verify both datasets are visible in list\n+  await expect(datasetListPage.getDatasetRow(dataset1.name)).toBeVisible();\n+  await expect(datasetListPage.getDatasetRow(dataset2.name)).toBeVisible();\n+\n+  // Enable bulk select mode\n+  await datasetListPage.clickBulkSelectButton();\n+\n+  // Select both datasets\n+  await datasetListPage.selectDatasetCheckbox(dataset1.name);\n+  await datasetListPage.selectDatasetCheckbox(dataset2.name);\n+\n+  // Set up API response intercept for export endpoint\n+  const exportResponsePromise = waitForGet(page, ENDPOINTS.DATASET_EXPORT);\n+\n+  // Click bulk export action\n+  await datasetListPage.clickBulkAction('Export');\n+\n+  // Wait for export API response and validate zip contains multiple datasets\n+  const exportResponse = expectStatusOneOf(await exportResponsePromise, [200]);\n+  await expectValidExportZip(exportResponse, { minDatasetCount: 2 });\n+});\n+\n+test('should edit dataset name via modal', async ({\n+  page,\n+  datasetListPage,\n+  testAssets,\n+}) => {\n+  // Create throwaway dataset for editing\n+  const { id: datasetId, name: datasetName } = await createTestDataset(\n+    page,\n+    testAssets,\n+    test.info(),\n+    { prefix: 'test_edit' },\n+  );\n+\n+  // Refresh to see new dataset\n+  await datasetListPage.goto();\n+  await datasetListPage.waitForTableLoad();\n+\n+  // Verify dataset is visible in list\n+  await expect(datasetListPage.getDatasetRow(datasetName)).toBeVisible();\n+\n+  // Click edit action to open modal\n+  await datasetListPage.clickEditAction(datasetName);\n+\n+  // Wait for edit modal to be ready\n+  const editModal = new EditDatasetModal(page);\n+  await editModal.waitForReady();\n+\n+  // Enable edit mode by clicking the lock icon\n+  await editModal.enableEditMode();\n+\n+  // Edit the dataset name\n+  const newName = `test_renamed_${Date.now()}`;\n+  await editModal.fillName(newName);\n+\n+  // Set up response intercept for save\n+  const saveResponsePromise = waitForPut(\n+    page,\n+    `${ENDPOINTS.DATASET}${datasetId}`,\n+  );\n+\n+  // Click Save button\n+  await editModal.clickSave();\n+\n+  // Handle the \"Confirm save\" dialog that may appear for datasets with sync columns enabled\n+  const confirmDialog = new ConfirmDialog(page);\n+  await confirmDialog.clickOk({ timeout: 2000 });\n+\n+  // Wait for save to complete and verify success\n+  expectStatusOneOf(await saveResponsePromise, [200, 201]);\n+\n+  // Modal should close\n+  await editModal.waitForHidden();\n+\n+  // Verify success toast appears\n+  const toast = new Toast(page);\n+  await expect(toast.getSuccess()).toBeVisible({ timeout: 10000 });\n+\n+  // Verify via API that name was saved\n+  const updatedDatasetRes = await apiGetDataset(page, datasetId);\n+  const updatedDataset = (await updatedDatasetRes.json()).result;\n+  expect(updatedDataset.table_name).toBe(newName);\n+});\n+\n+test('should bulk delete multiple datasets', async ({\n+  page,\n+  datasetListPage,\n+  testAssets,\n+}) => {\n+  // Create 2 throwaway datasets for bulk delete\n+  const [dataset1, dataset2] = await Promise.all([\n+    createTestDataset(page, testAssets, test.info(), {\n+      prefix: 'bulk_delete_1',\n+    }),\n+    createTestDataset(page, testAssets, test.info(), {\n+      prefix: 'bulk_delete_2',\n+    }),\n+  ]);\n+\n+  // Refresh to see new datasets\n+  await datasetListPage.goto();\n+  await datasetListPage.waitForTableLoad();\n+\n+  // Verify both datasets are visible in list\n+  await expect(datasetListPage.getDatasetRow(dataset1.name)).toBeVisible();\n+  await expect(datasetListPage.getDatasetRow(dataset2.name)).toBeVisible();\n+\n+  // Enable bulk select mode\n+  await datasetListPage.clickBulkSelectButton();\n+\n+  // Select both datasets\n+  await datasetListPage.selectDatasetCheckbox(dataset1.name);\n+  await datasetListPage.selectDatasetCheckbox(dataset2.name);\n+\n+  // Click bulk delete action\n+  await datasetListPage.clickBulkAction('Delete');\n+\n+  // Delete confirmation modal should appear\n+  const deleteModal = new DeleteConfirmationModal(page);\n+  await deleteModal.waitForVisible();\n+\n+  // Type \"DELETE\" to confirm\n+  await deleteModal.fillConfirmationInput('DELETE');\n+\n+  // Click the Delete button\n+  await deleteModal.clickDelete();\n+\n+  // Modal should close\n+  await deleteModal.waitForHidden();\n+\n+  // Verify success toast appears\n+  const toast = new Toast(page);\n+  await expect(toast.getSuccess()).toBeVisible();\n+\n+  // Verify both datasets are removed from list\n+  await expect(datasetListPage.getDatasetRow(dataset1.name)).not.toBeVisible();\n+  await expect(datasetListPage.getDatasetRow(dataset2.name)).not.toBeVisible();\n+\n+  // Verify via API that datasets no longer exist (404)\n+  // Use polling with explicit timeout since deletes may be async\n+  await expect\n+    .poll(\n+      async () => {\n+        const response = await apiGetDataset(page, dataset1.id, {\n+          failOnStatusCode: false,\n+        });\n+        return response.status();\n+      },\n+      { timeout: 10000, message: `Dataset ${dataset1.id} should return 404` },\n+    )\n+    .toBe(404);\n+  await expect\n+    .poll(\n+      async () => {\n+        const response = await apiGetDataset(page, dataset2.id, {\n+          failOnStatusCode: false,\n+        });\n+        return response.status();\n+      },\n+      { timeout: 10000, message: `Dataset ${dataset2.id} should return 404` },\n+    )\n+    .toBe(404);\n+});\n+\n+// Import test uses a fixed dataset name from the zip fixture.\n+// Uses test.describe only because Playwright's serial mode API requires it -\n+// this prevents race conditions when parallel workers import the same fixture.\n+// (Deviation from \"avoid describe\" guideline is necessary for functional reasons)\n+test.describe('import dataset', () => {\n+  test.describe.configure({ mode: 'serial' });\n+  test('should import a dataset from a zip file', async ({\n+    page,\n+    datasetListPage,\n+    testAssets,\n+  }) => {\n+    // Dataset name from fixture (test_netflix_1768502050965)\n+    // Note: Fixture contains a Google Sheets dataset - test will skip if gsheets connector unavailable\n+    const importedDatasetName = 'test_netflix_1768502050965';\n+    const fixturePath = path.resolve(\n+      __dirname,\n+      '../../../fixtures/dataset_export.zip',\n+    );\n+\n+    // Cleanup: Delete any existing dataset with the same name from previous runs\n+    const existingDataset = await getDatasetByName(page, importedDatasetName);\n+    if (existingDataset) {\n+      await apiDeleteDataset(page, existingDataset.id, {\n+        failOnStatusCode: false,\n+      });\n+    }\n+\n+    // Click the import button\n+    await datasetListPage.clickImportButton();\n+\n+    // Wait for import modal to be ready\n+    const importModal = new ImportDatasetModal(page);\n+    await importModal.waitForReady();\n+\n+    // Upload the fixture zip file\n+    await importModal.uploadFile(fixturePath);\n+\n+    // Set up response intercept to catch the import POST\n+    // Use pathMatch to avoid false matches if URL lacks trailing slash\n+    let importResponsePromise = waitForPost(page, ENDPOINTS.DATASET_IMPORT, {\n+      pathMatch: true,\n+    });\n+\n+    // Click Import button\n+    await importModal.clickImport();\n+\n+    // Wait for first import response\n+    let importResponse = await importResponsePromise;\n+\n+    // Handle overwrite confirmation if dataset already exists\n+    // First response may be 409/422 indicating overwrite is required - this is expected\n+    const overwriteInput = importModal.getOverwriteInput();\n+    await overwriteInput\n+      .waitFor({ state: 'visible', timeout: 3000 })\n+      .catch(error => {\n+        // Only ignore TimeoutError (input not visible); re-throw other errors\n+        if (!(error instanceof Error) || error.name !== 'TimeoutError') {\n+          throw error;\n+        }\n+      });\n+\n+    if (await overwriteInput.isVisible()) {\n+      // Set up new intercept for the actual import after overwrite confirmation\n+      importResponsePromise = waitForPost(page, ENDPOINTS.DATASET_IMPORT, {\n+        pathMatch: true,\n+      });\n+      await importModal.fillOverwriteConfirmation();\n+      await importModal.clickImport();\n+      // Wait for the second (final) import response\n+      importResponse = await importResponsePromise;\n+    }\n+\n+    // Check final import response for gsheets connector errors\n+    if (!importResponse.ok()) {\n+      const errorBody = await importResponse.json().catch(() => ({}));\n+      const errorText = JSON.stringify(errorBody);\n+      // Skip test if gsheets connector not installed\n+      if (\n+        errorText.includes('gsheets') ||\n+        errorText.includes('No such DB engine') ||\n+        errorText.includes('Could not load database driver')\n+      ) {\n+        await test.info().attach('skip-reason', {\n+          body: `Import failed due to missing gsheets connector: ${errorText}`,\n+          contentType: 'text/plain',\n+        });\n+        test.skip();\n+        return;\n+      }\n+      // Re-throw other errors\n+      throw new Error(`Import failed: ${errorText}`);\n+    }\n+\n+    // Modal should close on success\n+    await importModal.waitForHidden({ timeout: 30000 });\n+\n+    // Verify success toast appears\n+    const toast = new Toast(page);\n+    await expect(toast.getSuccess()).toBeVisible({ timeout: 10000 });\n+\n+    // Refresh the page to see the imported dataset\n+    await datasetListPage.goto();\n+    await datasetListPage.waitForTableLoad();\n+\n+    // Verify dataset appears in list\n+    await expect(\n+      datasetListPage.getDatasetRow(importedDatasetName),\n+    ).toBeVisible();\n+\n+    // Get dataset ID for cleanup\n+    const importedDataset = await getDatasetByName(page, importedDatasetName);\n+    expect(importedDataset).not.toBeNull();\n+    testAssets.trackDataset(importedDataset!.id);\n+  });\n+});\n+\n+test('should edit column date format via modal', async ({\n+  page,\n+  datasetListPage,\n+  testAssets,\n+}) => {\n+  // Create virtual dataset with a date column for testing\n+  // Using SQL to create a dataset with 'ds' column avoids duplication issues\n+  const datasetName = `test_date_format_${Date.now()}_${test.info().parallelIndex}`;\n+  const baseDataset = await getDatasetByName(page, 'members_channels_2');\n+  expect(baseDataset, 'members_channels_2 dataset must exist').not.toBeNull();\n+\n+  const createResponse = await apiPostVirtualDataset(page, {\n+    database: baseDataset!.database.id,\n+    schema: baseDataset!.schema ?? null,\n+    table_name: datasetName,\n+    sql: \"SELECT CAST('2024-01-01' AS DATE) as ds, 'test' as name\",\n+  });\n+  expectStatusOneOf(createResponse, [200, 201]);\n+  const createBody = await createResponse.json();\n+  const datasetId = createBody.result?.id ?? createBody.id;\n+  expect(datasetId, 'Virtual dataset creation should return id').toBeTruthy();\n+  testAssets.trackDataset(datasetId);\n+\n+  // Navigate to dataset list, click edit action\n+  await datasetListPage.goto();\n+  await datasetListPage.waitForTableLoad();\n+  await datasetListPage.clickEditAction(datasetName);\n+\n+  // Enable edit mode, navigate to Columns tab\n+  const editModal = new EditDatasetModal(page);\n+  await editModal.waitForReady();\n+  await editModal.enableEditMode();\n+  await editModal.clickColumnsTab();\n+\n+  // Expand 'ds' column row and fill date format (scoped to row)\n+  const dateFormat = '%Y-%m-%d';\n+  await editModal.fillColumnDateFormat('ds', dateFormat);\n+\n+  // Save and handle confirmation dialog conditionally\n+  await editModal.clickSave();\n+  await new ConfirmDialog(page).clickOk({ timeout: 2000 });\n+  await editModal.waitForHidden();\n+\n+  // Verify via API\n+  const updatedRes = await apiGetDataset(page, datasetId);\n+  const columns = (await updatedRes.json()).result.columns;\n+  const dsColumn = columns.find(\n+    (c: { column_name: string }) => c.column_name === 'ds',\n+  );\n+  expect(dsColumn, 'ds column should exist in dataset').toBeDefined();\n+  expect(dsColumn.python_date_format).toBe(dateFormat);\n+});\n+\n+test('should edit dataset description via modal', async ({\n+  page,\n+  datasetListPage,\n+  testAssets,\n+}) => {\n+  // Create throwaway dataset for editing description\n+  const { id: datasetId, name: datasetName } = await createTestDataset(\n+    page,\n+    testAssets,\n+    test.info(),\n+    { prefix: 'test_description' },\n+  );\n+\n+  // Navigate to dataset list, click edit action\n+  await datasetListPage.goto();\n+  await datasetListPage.waitForTableLoad();\n+  await datasetListPage.clickEditAction(datasetName);\n+\n+  // Enable edit mode, navigate to Settings tab\n+  const editModal = new EditDatasetModal(page);\n+  await editModal.waitForReady();\n+  await editModal.enableEditMode();\n+  await editModal.clickSettingsTab();\n+\n+  // Fill description field\n+  const description = `Test description ${Date.now()}`;\n+  await editModal.fillDescription(description);\n+\n+  // Save and handle confirmation dialog conditionally\n+  await editModal.clickSave();\n+  await new ConfirmDialog(page).clickOk({ timeout: 2000 });\n+  await editModal.waitForHidden();\n+\n+  // Verify via API\n+  const updatedRes = await apiGetDataset(page, datasetId);\n+  const result = (await updatedRes.json()).result;\n+  expect(result.description).toBe(description);\n });", "pull_request_number": 36684}
{"sha": "8f619580ae8fecfd9c6b060404a8963b36bde6d3", "filename": "superset-frontend/playwright/tests/experimental/dataset/dataset-test-helpers.ts", "status": "added", "additions": 67, "deletions": 0, "changes": 67, "blob_url": "https://github.com/apache/superset/blob/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Ftests%2Fexperimental%2Fdataset%2Fdataset-test-helpers.ts", "raw_url": "https://github.com/apache/superset/raw/82b8f2eee4aa0ab976e4e9847f0630589881206f/superset-frontend%2Fplaywright%2Ftests%2Fexperimental%2Fdataset%2Fdataset-test-helpers.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplaywright%2Ftests%2Fexperimental%2Fdataset%2Fdataset-test-helpers.ts?ref=82b8f2eee4aa0ab976e4e9847f0630589881206f", "patch": "@@ -0,0 +1,67 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import type { Page, TestInfo } from '@playwright/test';\n+import type { TestAssets } from '../../../helpers/fixtures/testAssets';\n+import { createTestVirtualDataset } from '../../../helpers/api/dataset';\n+\n+interface TestDatasetResult {\n+  id: number;\n+  name: string;\n+}\n+\n+interface CreateTestDatasetOptions {\n+  /** Prefix for generated name (default: 'test') */\n+  prefix?: string;\n+}\n+\n+/**\n+ * Creates a test virtual dataset.\n+ * Uses createTestVirtualDataset() to create a simple virtual dataset for testing.\n+ *\n+ * Note: The dataset duplicate API only works with virtual datasets. This helper\n+ * creates virtual datasets directly to avoid that limitation.\n+ *\n+ * @example\n+ * // Basic usage\n+ * const { id, name } = await createTestDataset(page, testAssets, test.info());\n+ *\n+ * @example\n+ * // Custom prefix\n+ * const { id, name } = await createTestDataset(page, testAssets, test.info(), {\n+ *   prefix: 'test_delete',\n+ * });\n+ */\n+export async function createTestDataset(\n+  page: Page,\n+  testAssets: TestAssets,\n+  testInfo: TestInfo,\n+  options?: CreateTestDatasetOptions,\n+): Promise<TestDatasetResult> {\n+  const prefix = options?.prefix ?? 'test';\n+  const name = `${prefix}_${Date.now()}_${testInfo.parallelIndex}`;\n+\n+  const id = await createTestVirtualDataset(page, name);\n+  if (!id) {\n+    throw new Error(`Failed to create test dataset: ${name}`);\n+  }\n+  testAssets.trackDataset(id);\n+\n+  return { id, name };\n+}", "pull_request_number": 36684}
{"sha": "228cc2a39b002ac7a7fe04b232d50c8e621d0f4a", "filename": ".rat-excludes", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/apache/superset/blob/fcb90f6f70684fe26559fc93680ef8380cfa9a06/.rat-excludes", "raw_url": "https://github.com/apache/superset/raw/fcb90f6f70684fe26559fc93680ef8380cfa9a06/.rat-excludes", "contents_url": "https://api.github.com/repos/apache/superset/contents/.rat-excludes?ref=fcb90f6f70684fe26559fc93680ef8380cfa9a06", "patch": "@@ -71,6 +71,7 @@ temporary_superset_ui/*\n google-big-query.svg\n google-sheets.svg\n ibm-db2.svg\n+netlify.png\n postgresql.svg\n snowflake.svg\n ydb.svg", "pull_request_number": 37451}
{"sha": "9b5e2feb04b9d326f2880609b636b1c489819c2f", "filename": "docs/docusaurus.config.ts", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/apache/superset/blob/fcb90f6f70684fe26559fc93680ef8380cfa9a06/docs%2Fdocusaurus.config.ts", "raw_url": "https://github.com/apache/superset/raw/fcb90f6f70684fe26559fc93680ef8380cfa9a06/docs%2Fdocusaurus.config.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/docs%2Fdocusaurus.config.ts?ref=fcb90f6f70684fe26559fc93680ef8380cfa9a06", "patch": "@@ -473,8 +473,10 @@ const config: Config = {\n     footer: {\n       links: [],\n       copyright: `\n-          <div class=\"footer__applitools\">\n-            We use &nbsp;<a href=\"https://applitools.com/\" target=\"_blank\" rel=\"nofollow\"><img src=\"/img/applitools.png\" title=\"Applitools\" /></a>\n+          <div class=\"footer__ci-services\">\n+            <span>CI powered by</span>\n+            <a href=\"https://applitools.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><img src=\"/img/applitools.png\" alt=\"Applitools\" title=\"Applitools - Visual Testing\" /></a>\n+            <a href=\"https://www.netlify.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><img src=\"/img/netlify.png\" alt=\"Netlify\" title=\"Netlify - Deploy Previews\" /></a>\n           </div>\n           <p>Copyright \u00a9 ${new Date().getFullYear()},\n           The <a href=\"https://www.apache.org/\" target=\"_blank\" rel=\"noreferrer\">Apache Software Foundation</a>,", "pull_request_number": 37451}
{"sha": "ba6d9b1bc93b8dd71b0abeafe1c7bf876a2ac46d", "filename": "docs/i18n/en/docusaurus-theme-classic/footer.json", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/fcb90f6f70684fe26559fc93680ef8380cfa9a06/docs%2Fi18n%2Fen%2Fdocusaurus-theme-classic%2Ffooter.json", "raw_url": "https://github.com/apache/superset/raw/fcb90f6f70684fe26559fc93680ef8380cfa9a06/docs%2Fi18n%2Fen%2Fdocusaurus-theme-classic%2Ffooter.json", "contents_url": "https://api.github.com/repos/apache/superset/contents/docs%2Fi18n%2Fen%2Fdocusaurus-theme-classic%2Ffooter.json?ref=fcb90f6f70684fe26559fc93680ef8380cfa9a06", "patch": "@@ -1,6 +1,6 @@\n {\n   \"copyright\": {\n-    \"message\": \"\\n          <div class=\\\"footer__applitools\\\">\\n            We use &nbsp;<a href=\\\"https://applitools.com/\\\" target=\\\"_blank\\\" rel=\\\"nofollow\\\"><img src=\\\"/img/applitools.png\\\" title=\\\"Applitools\\\" /></a>\\n          </div>\\n          <p>Copyright \u00a9 2026,\\n          The <a href=\\\"https://www.apache.org/\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\">Apache Software Foundation</a>,\\n          Licensed under the Apache <a href=\\\"https://apache.org/licenses/LICENSE-2.0\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\">License</a>.</p>\\n          <p><small>Apache Superset, Apache, Superset, the Superset logo, and the Apache feather logo are either registered trademarks or trademarks of The Apache Software Foundation. All other products or name brands are trademarks of their respective holders, including The Apache Software Foundation.\\n          <a href=\\\"https://www.apache.org/\\\" target=\\\"_blank\\\">Apache Software Foundation</a> resources</small></p>\\n          <img class=\\\"footer__divider\\\" src=\\\"/img/community/line.png\\\" alt=\\\"Divider\\\" />\\n          <p>\\n            <small>\\n              <a href=\\\"/docs/security/\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\">Security</a>&nbsp;|&nbsp;\\n              <a href=\\\"https://www.apache.org/foundation/sponsorship.html\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\">Donate</a>&nbsp;|&nbsp;\\n              <a href=\\\"https://www.apache.org/foundation/thanks.html\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\">Thanks</a>&nbsp;|&nbsp;\\n              <a href=\\\"https://apache.org/events/current-event\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\">Events</a>&nbsp;|&nbsp;\\n              <a href=\\\"https://apache.org/licenses/\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\">License</a>&nbsp;|&nbsp;\\n              <a href=\\\"https://privacy.apache.org/policies/privacy-policy-public.html\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\">Privacy</a>\\n            </small>\\n          </p>\\n          <!-- telemetry/analytics pixel: -->\\n          <img referrerPolicy=\\\"no-referrer-when-downgrade\\\" src=\\\"https://static.scarf.sh/a.png?x-pxid=39ae6855-95fc-4566-86e5-360d542b0a68\\\" />\\n          \",\n+    \"message\": \"\\n          <div class=\\\"footer__ci-services\\\">\\n            <span>CI powered by</span>\\n            <a href=\\\"https://applitools.com/\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener noreferrer\\\"><img src=\\\"/img/applitools.png\\\" alt=\\\"Applitools\\\" title=\\\"Applitools - Visual Testing\\\" /></a>\\n            <a href=\\\"https://www.netlify.com/\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener noreferrer\\\"><img src=\\\"/img/netlify.png\\\" alt=\\\"Netlify\\\" title=\\\"Netlify - Deploy Previews\\\" /></a>\\n          </div>\\n          <p>Copyright \u00a9 2026,\\n          The <a href=\\\"https://www.apache.org/\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\">Apache Software Foundation</a>,\\n          Licensed under the Apache <a href=\\\"https://apache.org/licenses/LICENSE-2.0\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\">License</a>.</p>\\n          <p><small>Apache Superset, Apache, Superset, the Superset logo, and the Apache feather logo are either registered trademarks or trademarks of The Apache Software Foundation. All other products or name brands are trademarks of their respective holders, including The Apache Software Foundation.\\n          <a href=\\\"https://www.apache.org/\\\" target=\\\"_blank\\\">Apache Software Foundation</a> resources</small></p>\\n          <img class=\\\"footer__divider\\\" src=\\\"/img/community/line.png\\\" alt=\\\"Divider\\\" />\\n          <p>\\n            <small>\\n              <a href=\\\"/docs/security/\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\">Security</a>&nbsp;|&nbsp;\\n              <a href=\\\"https://www.apache.org/foundation/sponsorship.html\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\">Donate</a>&nbsp;|&nbsp;\\n              <a href=\\\"https://www.apache.org/foundation/thanks.html\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\">Thanks</a>&nbsp;|&nbsp;\\n              <a href=\\\"https://apache.org/events/current-event\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\">Events</a>&nbsp;|&nbsp;\\n              <a href=\\\"https://apache.org/licenses/\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\">License</a>&nbsp;|&nbsp;\\n              <a href=\\\"https://privacy.apache.org/policies/privacy-policy-public.html\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\">Privacy</a>\\n            </small>\\n          </p>\\n          <!-- telemetry/analytics pixel: -->\\n          <img referrerPolicy=\\\"no-referrer-when-downgrade\\\" src=\\\"https://static.scarf.sh/a.png?x-pxid=39ae6855-95fc-4566-86e5-360d542b0a68\\\" />\\n          \",\n     \"description\": \"The footer copyright\"\n   }\n }", "pull_request_number": 37451}
{"sha": "56d6d006cc17f0828e3ead6cba680aa0b44aa626", "filename": "docs/src/styles/main.less", "status": "modified", "additions": 33, "deletions": 5, "changes": 38, "blob_url": "https://github.com/apache/superset/blob/fcb90f6f70684fe26559fc93680ef8380cfa9a06/docs%2Fsrc%2Fstyles%2Fmain.less", "raw_url": "https://github.com/apache/superset/raw/fcb90f6f70684fe26559fc93680ef8380cfa9a06/docs%2Fsrc%2Fstyles%2Fmain.less", "contents_url": "https://api.github.com/repos/apache/superset/contents/docs%2Fsrc%2Fstyles%2Fmain.less?ref=fcb90f6f70684fe26559fc93680ef8380cfa9a06", "patch": "@@ -226,17 +226,36 @@ a > span > svg {\n   font-size: 15px;\n }\n \n-.footer__applitools {\n+.footer__ci-services {\n   background-color: #0d3e49;\n   color: #e1e1e1;\n   position: absolute;\n   top: 0;\n   left: 0;\n   width: 100%;\n-  padding: 16px 0;\n+  padding: 12px 0;\n+  display: flex;\n+  align-items: center;\n+  justify-content: center;\n+  gap: 16px;\n+\n+  span {\n+    font-size: 13px;\n+    opacity: 0.85;\n+  }\n+\n+  a {\n+    display: inline-flex;\n+    align-items: center;\n+    transition: opacity 0.2s;\n+\n+    &:hover {\n+      opacity: 0.8;\n+    }\n+  }\n \n   img {\n-    height: 34px;\n+    height: 28px;\n   }\n }\n \n@@ -252,7 +271,16 @@ a > span > svg {\n }\n \n @media only screen and (max-width: 996px) {\n-  .footer__applitools img {\n-    height: 28px;\n+  .footer__ci-services {\n+    gap: 12px;\n+    padding: 10px 16px;\n+\n+    span {\n+      font-size: 12px;\n+    }\n+\n+    img {\n+      height: 22px;\n+    }\n   }\n }", "pull_request_number": 37451}
{"sha": "d6ed07eb7463ac27953e37dad71e8221a455b2d7", "filename": "docs/static/img/netlify.png", "status": "added", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/apache/superset/blob/fcb90f6f70684fe26559fc93680ef8380cfa9a06/docs%2Fstatic%2Fimg%2Fnetlify.png", "raw_url": "https://github.com/apache/superset/raw/fcb90f6f70684fe26559fc93680ef8380cfa9a06/docs%2Fstatic%2Fimg%2Fnetlify.png", "contents_url": "https://api.github.com/repos/apache/superset/contents/docs%2Fstatic%2Fimg%2Fnetlify.png?ref=fcb90f6f70684fe26559fc93680ef8380cfa9a06", "pull_request_number": 37451}
{"sha": "7f46ae309f60b97f390d6e81b6b2c4ce53ca3a33", "filename": "superset-frontend/package.json", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/apache/superset/blob/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fpackage.json", "raw_url": "https://github.com/apache/superset/raw/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fpackage.json", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackage.json?ref=b17dccce7fa962e09b5b6ea49fd4112f6bb795e4", "patch": "@@ -210,6 +210,7 @@\n     \"scroll-into-view-if-needed\": \"^3.1.0\",\n     \"simple-zstd\": \"^1.4.2\",\n     \"stream-browserify\": \"^3.0.0\",\n+    \"stylis-plugin-rtl\": \"^2.1.1\",\n     \"tinycolor2\": \"^1.4.2\",\n     \"urijs\": \"^1.19.8\",\n     \"use-event-callback\": \"^0.1.0\",", "pull_request_number": 34629}
{"sha": "70d2a272897b2accfd0ffd124fe9685c3e7d8b2c", "filename": "superset-frontend/packages/superset-core/src/ui/theme/Theme.tsx", "status": "modified", "additions": 35, "deletions": 8, "changes": 43, "blob_url": "https://github.com/apache/superset/blob/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fpackages%2Fsuperset-core%2Fsrc%2Fui%2Ftheme%2FTheme.tsx", "raw_url": "https://github.com/apache/superset/raw/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fpackages%2Fsuperset-core%2Fsrc%2Fui%2Ftheme%2FTheme.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-core%2Fsrc%2Fui%2Ftheme%2FTheme.tsx?ref=b17dccce7fa962e09b5b6ea49fd4112f6bb795e4", "patch": "@@ -20,12 +20,14 @@\n // eslint-disable-next-line no-restricted-syntax\n import React from 'react';\n import { theme as antdThemeImport, ConfigProvider } from 'antd';\n+import stylisRTLPlugin from 'stylis-plugin-rtl';\n import {\n   ThemeProvider,\n   CacheProvider as EmotionCacheProvider,\n } from '@emotion/react';\n import createCache from '@emotion/cache';\n import { noop, mergeWith } from 'lodash';\n+import { DirectionType } from 'antd/es/config-provider';\n import { GlobalStyles } from './GlobalStyles';\n import {\n   AntdThemeConfig,\n@@ -90,6 +92,18 @@ export class Theme {\n     return antdThemeImport.getDesignToken(antdConfig);\n   }\n \n+  createCache() {\n+    return {\n+      ltr: createCache({\n+        key: 'superset-ltr',\n+      }),\n+      rtl: createCache({\n+        key: 'superset-rtl',\n+        stylisPlugins: [stylisRTLPlugin],\n+      }),\n+    };\n+  }\n+\n   /**\n    * Update the theme using any theme configuration\n    * Automatically handles both AntdThemeConfig and SerializableThemeConfig\n@@ -109,11 +123,7 @@ export class Theme {\n     } as SupersetTheme;\n \n     // Update the providers with the fully formed theme\n-    this.updateProviders(\n-      this.theme,\n-      this.antdConfig,\n-      createCache({ key: 'superset' }),\n-    );\n+    this.updateProviders(this.theme, this.antdConfig, this.createCache());\n   }\n \n   /**\n@@ -152,6 +162,15 @@ export class Theme {\n     this.setConfig(newConfig);\n   }\n \n+  setDirection(direction: DirectionType): void {\n+    // Update the providers with the fully formed theme\n+    this.updateProviders(\n+      { ...this.theme, direction },\n+      this.antdConfig,\n+      this.createCache(),\n+    );\n+  }\n+\n   json(): string {\n     return JSON.stringify(serializeThemeConfig(this.antdConfig), null, 2);\n   }\n@@ -174,18 +193,26 @@ export class Theme {\n     const [themeState, setThemeState] = React.useState({\n       theme: this.theme,\n       antdConfig: this.antdConfig,\n-      emotionCache: createCache({ key: 'superset' }),\n+      emotionCache: this.createCache(),\n     });\n+    const { direction = 'ltr' } = themeState.theme;\n \n     this.updateProviders = (theme, antdConfig, emotionCache) => {\n       setThemeState({ theme, antdConfig, emotionCache });\n+      const dir = (theme && (theme as any).direction) ?? 'ltr';\n+      // Ensure we update the document direction attribute on every change,\n+      // and safely guard for non-browser environments.\n+      if (typeof document !== 'undefined' && document.documentElement) {\n+        document.documentElement.setAttribute('dir', dir);\n+        document.documentElement.setAttribute('data-direction', dir);\n+      }\n     };\n \n     return (\n-      <EmotionCacheProvider value={themeState.emotionCache}>\n+      <EmotionCacheProvider value={themeState.emotionCache?.[direction] ?? themeState.emotionCache?.ltr}>\n         <ThemeProvider theme={themeState.theme}>\n           <GlobalStyles />\n-          <ConfigProvider theme={themeState.antdConfig}>\n+          <ConfigProvider theme={themeState.antdConfig} direction={direction}>\n             {children}\n           </ConfigProvider>\n         </ThemeProvider>", "pull_request_number": 34629}
{"sha": "35f21ee473fdbb4939b4bc72adbf74bf318f1c7a", "filename": "superset-frontend/packages/superset-core/src/ui/theme/types.ts", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/apache/superset/blob/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fpackages%2Fsuperset-core%2Fsrc%2Fui%2Ftheme%2Ftypes.ts", "raw_url": "https://github.com/apache/superset/raw/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fpackages%2Fsuperset-core%2Fsrc%2Fui%2Ftheme%2Ftypes.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-core%2Fsrc%2Fui%2Ftheme%2Ftypes.ts?ref=b17dccce7fa962e09b5b6ea49fd4112f6bb795e4", "patch": "@@ -24,6 +24,7 @@ import { theme as antdThemeImport } from 'antd';\n  * Get AntdThemeConfig type from the theme object\n  */\n import type { ThemeConfig } from 'antd';\n+import type { DirectionType } from 'antd/es/config-provider';\n import { Theme } from '.';\n \n /**\n@@ -125,6 +126,9 @@ export interface SupersetSpecificTokens {\n   brandLogoHref: string;\n   brandLogoHeight: string;\n \n+  // Direction-related\n+  direction: DirectionType;\n+\n   // Spinner-related\n   brandSpinnerUrl?: string;\n   brandSpinnerSvg?: string;\n@@ -402,6 +406,7 @@ export interface ThemeContextType {\n   themeMode: ThemeMode;\n   setTheme: (config: AnyThemeConfig) => void;\n   setThemeMode: (newMode: ThemeMode) => void;\n+  setDirection: (newDirection: DirectionType) => void;\n   resetTheme: () => void;\n   setTemporaryTheme: (config: AnyThemeConfig, themeId?: number | null) => void;\n   clearLocalOverrides: () => void;", "pull_request_number": 34629}
{"sha": "36e682c4e513d2da2df0b0b7726b526f1a277325", "filename": "superset-frontend/packages/superset-ui-core/src/components/DynamicEditableTitle/index.tsx", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/apache/superset/blob/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FDynamicEditableTitle%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FDynamicEditableTitle%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FDynamicEditableTitle%2Findex.tsx?ref=b17dccce7fa962e09b5b6ea49fd4112f6bb795e4", "patch": "@@ -57,9 +57,9 @@ const titleStyles = (theme: SupersetTheme) => css`\n \n   & .input-sizer {\n     position: absolute;\n-    left: -9999px;\n     display: inline-block;\n     white-space: pre;\n+    opacity: 0;\n   }\n `;\n \n@@ -90,10 +90,11 @@ export const DynamicEditableTitle = memo(\n         if (sizerRef.current.setSelectionRange) {\n           const { length } = sizerRef.current.value;\n           sizerRef.current.setSelectionRange(length, length);\n-          sizerRef.current.scrollLeft = sizerRef.current.scrollWidth;\n+          sizerRef.current.scrollLeft =\n+            theme.direction === 'rtl' ? 0 : sizerRef.current.scrollWidth;\n         }\n       }\n-    }, [isEditing]);\n+    }, [isEditing, theme.direction]);\n \n     // a trick to make the input grow when user types text\n     // we make additional span component, place it somewhere out of view and copy input", "pull_request_number": 34629}
{"sha": "d32cd8ce99d160a5083dcb822274d6047184c03e", "filename": "superset-frontend/packages/superset-ui-core/src/components/ListViewCard/index.tsx", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/apache/superset/blob/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FListViewCard%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FListViewCard%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FListViewCard%2Findex.tsx?ref=b17dccce7fa962e09b5b6ea49fd4112f6bb795e4", "patch": "@@ -95,10 +95,12 @@ const TitleLink = styled.span`\n const TitleRight = styled.span`\n   ${({ theme }) => css`\n     position: absolute;\n-    right: -1px;\n     font-weight: 400;\n     bottom: ${theme.sizeUnit * 3}px;\n-    right: ${theme.sizeUnit * 2}px;\n+    /* emit a physical fallback matching the theme direction for deterministic positioning */\n+    ${theme.direction === 'rtl'\n+      ? `left: ${theme.sizeUnit * 2}px;`\n+      : `right: ${theme.sizeUnit * 2}px;`}\n   `}\n `;\n const CoverFooter = styled.div`", "pull_request_number": 34629}
{"sha": "0f8a590cea2b76b8f3ccf26ebdac81b0400fe5f6", "filename": "superset-frontend/packages/superset-ui-core/src/components/PageHeaderWithActions/index.tsx", "status": "modified", "additions": 6, "deletions": 13, "changes": 19, "blob_url": "https://github.com/apache/superset/blob/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FPageHeaderWithActions%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FPageHeaderWithActions%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FPageHeaderWithActions%2Findex.tsx?ref=b17dccce7fa962e09b5b6ea49fd4112f6bb795e4", "patch": "@@ -19,7 +19,7 @@\n import { ReactNode, ReactElement } from 'react';\n import { t } from '@superset-ui/core';\n import { css, SupersetTheme, useTheme } from '@apache-superset/core/ui';\n-import { Icons } from '@superset-ui/core/components/Icons';\n+import { Icons, Flex } from '@superset-ui/core/components';\n import type { DropdownProps } from '../Dropdown/types';\n import type { TooltipPlacement } from '../Tooltip/types';\n import type { CertifiedBadgeProps } from '../CertifiedBadge/types';\n@@ -70,13 +70,6 @@ const headerStyles = (theme: SupersetTheme) => css`\n     height: 100%;\n   }\n \n-  .title-panel {\n-    display: flex;\n-    align-items: center;\n-    min-width: 0;\n-    margin-right: ${theme.sizeUnit * 12}px;\n-  }\n-\n   .right-button-panel {\n     display: flex;\n     align-items: center;\n@@ -133,22 +126,22 @@ export const PageHeaderWithActions = ({\n }: PageHeaderWithActionsProps) => {\n   const theme = useTheme();\n   return (\n-    <div css={headerStyles} className=\"header-with-actions\">\n-      <div className=\"title-panel\">\n+    <div css={headerStyles(theme)} className=\"header-with-actions\">\n+      <Flex align=\"center\" gap={theme.sizeUnit * 12}>\n         <DynamicEditableTitle {...editableTitleProps} />\n         {showTitlePanelItems && (\n-          <div css={buttonsStyles}>\n+          <div css={buttonsStyles(theme)}>\n             {certificatiedBadgeProps?.certifiedBy && (\n               <CertifiedBadge {...certificatiedBadgeProps} />\n             )}\n             {showFaveStar && <FaveStar {...faveStarProps} />}\n             {titlePanelAdditionalItems}\n           </div>\n         )}\n-      </div>\n+      </Flex>\n       <div className=\"right-button-panel\">\n         {rightPanelAdditionalItems}\n-        <div css={additionalActionsContainerStyles}>\n+        <div css={additionalActionsContainerStyles(theme)}>\n           {showMenuDropdown && (\n             <Dropdown\n               trigger={['click']}", "pull_request_number": 34629}
{"sha": "fe7198b1a6946340240f1b1e171e5133403a032e", "filename": "superset-frontend/src/constants.ts", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/apache/superset/blob/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fsrc%2Fconstants.ts", "raw_url": "https://github.com/apache/superset/raw/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fsrc%2Fconstants.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fconstants.ts?ref=b17dccce7fa962e09b5b6ea49fd4112f6bb795e4", "patch": "@@ -195,6 +195,19 @@ export enum Actions {\n   UPDATE = 'update',\n }\n \n+export const rtlLanguages = [\n+  'ar',\n+  'fa',\n+  'he',\n+  'iw',\n+  'sd',\n+  'dv',\n+  'ps',\n+  'ug',\n+  'ur',\n+  'yi',\n+];\n+\n /**\n  * Default threshold for CSV streaming export.\n  * Exports with row counts >= this value will use streaming with progress tracking.", "pull_request_number": 34629}
{"sha": "3a08039ec4db8f14fca31e0ed3433e9fe96b0907", "filename": "superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FDashboardBuilder%2FDashboardBuilder.tsx", "raw_url": "https://github.com/apache/superset/raw/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FDashboardBuilder%2FDashboardBuilder.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FDashboardBuilder%2FDashboardBuilder.tsx?ref=b17dccce7fa962e09b5b6ea49fd4112f6bb795e4", "patch": "@@ -635,7 +635,7 @@ const DashboardBuilder = () => {\n           editMode={editMode}\n           // you cannot drop on/displace tabs if they already exist\n           disableDragDrop={!!topLevelTabs}\n-          style={draggableStyle}\n+          css={draggableStyle}\n         >\n           {renderDraggableContent}\n         </Droppable>", "pull_request_number": 34629}
{"sha": "84246943e11a0adbd90a64f7488450280b789748", "filename": "superset-frontend/src/features/home/LanguagePicker.stories.tsx", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/apache/superset/blob/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fsrc%2Ffeatures%2Fhome%2FLanguagePicker.stories.tsx", "raw_url": "https://github.com/apache/superset/raw/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fsrc%2Ffeatures%2Fhome%2FLanguagePicker.stories.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ffeatures%2Fhome%2FLanguagePicker.stories.tsx?ref=b17dccce7fa962e09b5b6ea49fd4112f6bb795e4", "patch": "@@ -62,6 +62,7 @@ const mockedProps = {\n       url: '/lang/it',\n     },\n   },\n+  setDirection: () => {},\n };\n \n const Template = (args: any) => <LanguagePicker {...args} />;", "pull_request_number": 34629}
{"sha": "c77c90230204ef9a52999d2496108a862032aa34", "filename": "superset-frontend/src/features/home/LanguagePicker.test.tsx", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/apache/superset/blob/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fsrc%2Ffeatures%2Fhome%2FLanguagePicker.test.tsx", "raw_url": "https://github.com/apache/superset/raw/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fsrc%2Ffeatures%2Fhome%2FLanguagePicker.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ffeatures%2Fhome%2FLanguagePicker.test.tsx?ref=b17dccce7fa962e09b5b6ea49fd4112f6bb795e4", "patch": "@@ -34,6 +34,7 @@ const mockedProps = {\n       url: '/lang/it',\n     },\n   },\n+  setDirection: () => {},\n };\n \n const TestLanguagePicker = ({ locale, languages }: typeof mockedProps) => {", "pull_request_number": 34629}
{"sha": "be5a4b30ff21c36a9ee9aeb5bed6cd888079f764", "filename": "superset-frontend/src/features/home/LanguagePicker.tsx", "status": "modified", "additions": 14, "deletions": 3, "changes": 17, "blob_url": "https://github.com/apache/superset/blob/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fsrc%2Ffeatures%2Fhome%2FLanguagePicker.tsx", "raw_url": "https://github.com/apache/superset/raw/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fsrc%2Ffeatures%2Fhome%2FLanguagePicker.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ffeatures%2Fhome%2FLanguagePicker.tsx?ref=b17dccce7fa962e09b5b6ea49fd4112f6bb795e4", "patch": "@@ -16,12 +16,14 @@\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n-import { useMemo } from 'react';\n+import { useMemo, useEffect } from 'react';\n import { MenuItem } from '@superset-ui/core/components/Menu';\n import { t } from '@superset-ui/core';\n import { styled } from '@apache-superset/core/ui';\n import { Icons } from '@superset-ui/core/components/Icons';\n import { Typography } from '@superset-ui/core/components/Typography';\n+import { DirectionType } from 'antd/es/config-provider';\n+import { rtlLanguages } from 'src/constants';\n \n export interface Languages {\n   [key: string]: {\n@@ -34,6 +36,7 @@ export interface Languages {\n interface LanguagePickerProps {\n   locale: string;\n   languages: Languages;\n+  setDirection: (newDirection: DirectionType) => void;\n }\n \n const StyledLabel = styled.div`\n@@ -55,8 +58,15 @@ const StyledLabel = styled.div`\n export const useLanguageMenuItems = ({\n   locale,\n   languages,\n-}: LanguagePickerProps): MenuItem =>\n-  useMemo(() => {\n+  setDirection,\n+}: LanguagePickerProps): MenuItem => {\n+  useEffect(() => {\n+    const languageCode = locale.split('-')[0];\n+    const isRtl = rtlLanguages.includes(languageCode);\n+    setDirection(isRtl ? 'rtl' : 'ltr');\n+  }, [locale, setDirection]);\n+\n+  return useMemo(() => {\n     const items: MenuItem[] = Object.keys(languages).map(langKey => ({\n       key: langKey,\n       label: (\n@@ -84,3 +94,4 @@ export const useLanguageMenuItems = ({\n       popupClassName: 'language-picker-popup',\n     };\n   }, [languages, locale]);\n+};", "pull_request_number": 34629}
{"sha": "45f68b9d12e4cc4773b7a480f8f24ccc5ff35f60", "filename": "superset-frontend/src/features/home/Menu.tsx", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/apache/superset/blob/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fsrc%2Ffeatures%2Fhome%2FMenu.tsx", "raw_url": "https://github.com/apache/superset/raw/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fsrc%2Ffeatures%2Fhome%2FMenu.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ffeatures%2Fhome%2FMenu.tsx?ref=b17dccce7fa962e09b5b6ea49fd4112f6bb795e4", "patch": "@@ -47,6 +47,10 @@ const StyledHeader = styled.header`\n     padding: 0 ${theme.sizeUnit * 4}px;\n     z-index: 10;\n \n+    .main-nav {\n+      display: flex;\n+    }\n+\n     &:nth-last-of-type(2) nav {\n       margin-bottom: 2px;\n     }", "pull_request_number": 34629}
{"sha": "42e95a273d96c6d63e028c3769d456af8e4313ca", "filename": "superset-frontend/src/features/home/RightMenu.tsx", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/apache/superset/blob/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fsrc%2Ffeatures%2Fhome%2FRightMenu.tsx", "raw_url": "https://github.com/apache/superset/raw/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fsrc%2Ffeatures%2Fhome%2FRightMenu.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ffeatures%2Fhome%2FRightMenu.tsx?ref=b17dccce7fa962e09b5b6ea49fd4112f6bb795e4", "patch": "@@ -152,6 +152,7 @@ const RightMenu = ({\n   const showUploads = allowUploads || isAdmin;\n   const {\n     setThemeMode,\n+    setDirection,\n     themeMode,\n     clearLocalOverrides,\n     hasDevOverride,", "pull_request_number": 34629}
{"sha": "996c882bf40bc338ce12fa76c7290e313bc31a32", "filename": "superset-frontend/src/features/home/SubMenu.tsx", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/apache/superset/blob/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fsrc%2Ffeatures%2Fhome%2FSubMenu.tsx", "raw_url": "https://github.com/apache/superset/raw/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fsrc%2Ffeatures%2Fhome%2FSubMenu.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ffeatures%2Fhome%2FSubMenu.tsx?ref=b17dccce7fa962e09b5b6ea49fd4112f6bb795e4", "patch": "@@ -82,6 +82,7 @@ const StyledHeader = styled.div<{ backgroundColor?: string }>`\n   }\n   .menu {\n     align-items: center;\n+    justify-content: space-between;\n   }\n \n   .menu > .ant-menu {", "pull_request_number": 34629}
{"sha": "62a0cb231889c047fe6eb2b7186661589fc2e1f3", "filename": "superset-frontend/src/theme/ThemeController.ts", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/apache/superset/blob/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fsrc%2Ftheme%2FThemeController.ts", "raw_url": "https://github.com/apache/superset/raw/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fsrc%2Ftheme%2FThemeController.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ftheme%2FThemeController.ts?ref=b17dccce7fa962e09b5b6ea49fd4112f6bb795e4", "patch": "@@ -28,6 +28,7 @@ import {\n   normalizeThemeConfig,\n } from '@apache-superset/core/ui';\n import { makeApi } from '@superset-ui/core';\n+import { DirectionType } from 'antd/es/config-provider';\n import type {\n   BootstrapThemeData,\n   BootstrapThemeDataConfig,\n@@ -330,6 +331,16 @@ export class ThemeController {\n     this.updateTheme(theme);\n   }\n \n+  /**\n+   * Sets the direction ('ltr', 'rtl', undefined).\n+   * @param direction - The new direction to apply\n+   */\n+  public setDirection(direction: DirectionType): void {\n+    this.validateThemeUpdatePermission();\n+\n+    this.globalTheme.setDirection(direction);\n+  }\n+\n   /**\n    * Resets the theme to the default theme.\n    */", "pull_request_number": 34629}
{"sha": "acb33671aef7beb500240204d939670c5760fbda", "filename": "superset-frontend/src/theme/ThemeProvider.tsx", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/apache/superset/blob/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fsrc%2Ftheme%2FThemeProvider.tsx", "raw_url": "https://github.com/apache/superset/raw/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset-frontend%2Fsrc%2Ftheme%2FThemeProvider.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ftheme%2FThemeProvider.tsx?ref=b17dccce7fa962e09b5b6ea49fd4112f6bb795e4", "patch": "@@ -24,6 +24,7 @@ import {\n   useMemo,\n   useState,\n } from 'react';\n+import { DirectionType } from 'antd/es/config-provider';\n import {} from '@superset-ui/core';\n import {\n   type AnyThemeConfig,\n@@ -71,6 +72,11 @@ export function SupersetThemeProvider({\n     [themeController],\n   );\n \n+  const setDirection = useCallback(\n+    (direction: DirectionType) => themeController.setDirection(direction),\n+    [themeController],\n+  );\n+\n   const resetTheme = useCallback(\n     () => themeController.resetTheme(),\n     [themeController],\n@@ -129,6 +135,7 @@ export function SupersetThemeProvider({\n       themeMode: currentThemeMode,\n       setTheme,\n       setThemeMode,\n+      setDirection,\n       resetTheme,\n       setTemporaryTheme,\n       clearLocalOverrides,\n@@ -145,6 +152,7 @@ export function SupersetThemeProvider({\n       currentThemeMode,\n       setTheme,\n       setThemeMode,\n+      setDirection,\n       resetTheme,\n       setTemporaryTheme,\n       clearLocalOverrides,", "pull_request_number": 34629}
{"sha": "7fa1724d507c6ca978ee0b4c306bdbeeb7060b58", "filename": "superset/config.py", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset%2Fconfig.py", "raw_url": "https://github.com/apache/superset/raw/b17dccce7fa962e09b5b6ea49fd4112f6bb795e4/superset%2Fconfig.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Fconfig.py?ref=b17dccce7fa962e09b5b6ea49fd4112f6bb795e4", "patch": "@@ -768,6 +768,8 @@ class D3TimeFormat(TypedDict, total=False):\n         # Fonts\n         \"fontFamily\": \"Inter, Helvetica, Arial\",\n         \"fontFamilyCode\": \"'Fira Code', 'Courier New', monospace\",\n+        # Direction\n+        \"direction\": \"ltr\",\n         # Extra tokens\n         \"transitionTiming\": 0.3,\n         \"brandIconMaxWidth\": 37,", "pull_request_number": 34629}
{"sha": "f86395f0a5c9df6ba2e2e3716edb925899d2988b", "filename": ".gitignore", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/apache/superset/blob/aecd47a49421789204f7ff54e8db6a72ed48f6fa/.gitignore", "raw_url": "https://github.com/apache/superset/raw/aecd47a49421789204f7ff54e8db6a72ed48f6fa/.gitignore", "contents_url": "https://api.github.com/repos/apache/superset/contents/.gitignore?ref=aecd47a49421789204f7ff54e8db6a72ed48f6fa", "patch": "@@ -73,10 +73,6 @@ superset/static/assets/*\n superset/static/uploads/*\n !superset/static/uploads/.gitkeep\n superset/static/version_info.json\n-superset-frontend/**/esm/*\n-superset-frontend/**/lib/*\n-superset-frontend/**/storybook-static/*\n-superset-frontend/migration-storybook.log\n yarn-error.log\n *.map\n *.min.js", "pull_request_number": 37496}
{"sha": "71eded3092714ff0717ec3c9c8020c6401a36e5f", "filename": "superset-frontend/.gitignore", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/apache/superset/blob/aecd47a49421789204f7ff54e8db6a72ed48f6fa/superset-frontend%2F.gitignore", "raw_url": "https://github.com/apache/superset/raw/aecd47a49421789204f7ff54e8db6a72ed48f6fa/superset-frontend%2F.gitignore", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2F.gitignore?ref=aecd47a49421789204f7ff54e8db6a72ed48f6fa", "patch": "@@ -8,3 +8,7 @@ src/temp\n .temp_cache/\n .tsbuildinfo\n .swc/\n+**/esm/*\n+**/lib/*\n+**/storybook-static/*\n+migration-storybook.log", "pull_request_number": 37496}
{"sha": "a40f5750446cc08d7599404bdcc09592dce21942", "filename": "superset-frontend/src/explore/components/controls/CurrencyControl/CurrencyControl.test.tsx", "status": "modified", "additions": 28, "deletions": 1, "changes": 29, "blob_url": "https://github.com/apache/superset/blob/6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2Fcontrols%2FCurrencyControl%2FCurrencyControl.test.tsx", "raw_url": "https://github.com/apache/superset/raw/6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2Fcontrols%2FCurrencyControl%2FCurrencyControl.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2Fcontrols%2FCurrencyControl%2FCurrencyControl.test.tsx?ref=6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641", "patch": "@@ -16,7 +16,7 @@\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n-import { render } from 'spec/helpers/testing-library';\n+import { render, selectOption } from 'spec/helpers/testing-library';\n import { CurrencyControl } from './CurrencyControl';\n \n test('CurrencyControl renders position and symbol selects', () => {\n@@ -36,3 +36,30 @@ test('CurrencyControl renders position and symbol selects', () => {\n   ).toBeInTheDocument();\n   expect(container.querySelectorAll('.ant-select')).toHaveLength(2);\n });\n+\n+test('CurrencyControl handles string currency value', async () => {\n+  const onChange = jest.fn();\n+  const { container } = render(\n+    <CurrencyControl\n+      onChange={onChange}\n+      value='{\"symbol\":\"USD\",\"symbolPosition\":\"prefix\"}'\n+    />,\n+    {\n+      useRedux: true,\n+      initialState: {\n+        common: { currencies: ['USD', 'EUR'] },\n+        explore: { datasource: {} },\n+      },\n+    },\n+  );\n+\n+  expect(\n+    container.querySelector('[data-test=\"currency-control-container\"]'),\n+  ).toBeInTheDocument();\n+\n+  await selectOption('Suffix', 'Currency prefix or suffix');\n+  expect(onChange).toHaveBeenLastCalledWith({\n+    symbol: 'USD',\n+    symbolPosition: 'suffix',\n+  });\n+});", "pull_request_number": 37455}
{"sha": "3da754330fde6318e2ed853a30bdd0d1b0b13b35", "filename": "superset-frontend/src/explore/components/controls/CurrencyControl/CurrencyControl.tsx", "status": "modified", "additions": 31, "deletions": 8, "changes": 39, "blob_url": "https://github.com/apache/superset/blob/6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2Fcontrols%2FCurrencyControl%2FCurrencyControl.tsx", "raw_url": "https://github.com/apache/superset/raw/6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2Fcontrols%2FCurrencyControl%2FCurrencyControl.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2Fcontrols%2FCurrencyControl%2FCurrencyControl.tsx?ref=6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641", "patch": "@@ -29,7 +29,7 @@ import ControlHeader from '../../ControlHeader';\n \n export interface CurrencyControlProps {\n   onChange: (currency: Partial<Currency>) => void;\n-  value?: Partial<Currency>;\n+  value?: Partial<Currency> | string | null;\n   symbolSelectOverrideProps?: Partial<SelectProps>;\n   currencySelectOverrideProps?: Partial<SelectProps>;\n   symbolSelectAdditionalStyles?: CSSObject;\n@@ -59,16 +59,37 @@ export const CURRENCY_SYMBOL_POSITION_OPTIONS = [\n   { value: 'suffix', label: t('Suffix') },\n ];\n \n+const isCurrencyObject = (value: unknown): value is Partial<Currency> =>\n+  !!value && typeof value === 'object' && !Array.isArray(value);\n+\n export const CurrencyControl = ({\n   onChange,\n-  value: currency = {},\n+  value: rawCurrency = {},\n   symbolSelectOverrideProps = {},\n   currencySelectOverrideProps = {},\n   symbolSelectAdditionalStyles,\n   currencySelectAdditionalStyles,\n   ...props\n }: CurrencyControlProps) => {\n   const theme = useTheme();\n+  const normalizedCurrency = useMemo<Partial<Currency>>(() => {\n+    if (isCurrencyObject(rawCurrency)) {\n+      return rawCurrency;\n+    }\n+\n+    if (typeof rawCurrency === 'string') {\n+      try {\n+        const parsed = JSON.parse(rawCurrency) as unknown;\n+        if (isCurrencyObject(parsed)) {\n+          return parsed;\n+        }\n+      } catch {\n+        return {};\n+      }\n+    }\n+\n+    return {};\n+  }, [rawCurrency]);\n   const currencies = useSelector<ViewState, string[]>(\n     state => state.common?.currencies,\n   );\n@@ -155,10 +176,12 @@ export const CurrencyControl = ({\n           options={CURRENCY_SYMBOL_POSITION_OPTIONS}\n           placeholder={t('Prefix or suffix')}\n           onChange={(symbolPosition: string) => {\n-            onChange({ ...currency, symbolPosition });\n+            onChange({ ...normalizedCurrency, symbolPosition });\n           }}\n-          onClear={() => onChange({ ...currency, symbolPosition: undefined })}\n-          value={currency?.symbolPosition}\n+          onClear={() =>\n+            onChange({ ...normalizedCurrency, symbolPosition: undefined })\n+          }\n+          value={normalizedCurrency?.symbolPosition}\n           allowClear\n           {...symbolSelectOverrideProps}\n         />\n@@ -167,10 +190,10 @@ export const CurrencyControl = ({\n           options={currenciesOptions}\n           placeholder={t('Currency')}\n           onChange={(symbol: string) => {\n-            onChange({ ...currency, symbol });\n+            onChange({ ...normalizedCurrency, symbol });\n           }}\n-          onClear={() => onChange({ ...currency, symbol: undefined })}\n-          value={currency?.symbol}\n+          onClear={() => onChange({ ...normalizedCurrency, symbol: undefined })}\n+          value={normalizedCurrency?.symbol}\n           allowClear\n           allowNewOptions\n           sortComparator={currencySortComparator}", "pull_request_number": 37455}
{"sha": "ad519c00f99b22d4af95a0f937cc26ea0a1a0721", "filename": "superset/connectors/sqla/models.py", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/apache/superset/blob/6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641/superset%2Fconnectors%2Fsqla%2Fmodels.py", "raw_url": "https://github.com/apache/superset/raw/6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641/superset%2Fconnectors%2Fsqla%2Fmodels.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Fconnectors%2Fsqla%2Fmodels.py?ref=6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641", "patch": "@@ -102,6 +102,7 @@\n     SQLA_QUERY_KEYS,\n )\n from superset.models.slice import Slice\n+from superset.models.sql_types.base import CurrencyType\n from superset.sql.parse import Table\n from superset.superset_typing import (\n     AdhocColumn,\n@@ -1086,7 +1087,7 @@ class SqlMetric(AuditMixinNullable, ImportExportMixin, CertificationMixin, Model\n     metric_type = Column(String(32))\n     description = Column(utils.MediumText())\n     d3format = Column(String(128))\n-    currency = Column(JSON, nullable=True)\n+    currency = Column(CurrencyType, nullable=True)\n     warning_text = Column(Text)\n     table_id = Column(Integer, ForeignKey(\"tables.id\", ondelete=\"CASCADE\"))\n     expression = Column(utils.MediumText(), nullable=False)", "pull_request_number": 37455}
{"sha": "406f4663d2d8777a70c98fa96b261c8174a42eac", "filename": "superset/datasets/schemas.py", "status": "modified", "additions": 17, "deletions": 5, "changes": 22, "blob_url": "https://github.com/apache/superset/blob/6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641/superset%2Fdatasets%2Fschemas.py", "raw_url": "https://github.com/apache/superset/raw/6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641/superset%2Fdatasets%2Fschemas.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Fdatasets%2Fschemas.py?ref=6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641", "patch": "@@ -32,6 +32,7 @@\n from superset import security_manager\n from superset.connectors.sqla.models import SqlaTable\n from superset.exceptions import SupersetMarshmallowValidationError\n+from superset.models.sql_types import parse_currency_string\n from superset.utils import json\n \n get_delete_ids_schema = {\"type\": \"array\", \"items\": {\"type\": \"integer\"}}\n@@ -97,6 +98,20 @@ class DatasetMetricCurrencyPutSchema(Schema):\n     symbolPosition = fields.String(validate=Length(1, 128))  # noqa: N815\n \n \n+class CurrencyField(fields.Nested):\n+    \"\"\"\n+    Nested field that tolerates legacy string payloads for currency.\n+    \"\"\"\n+\n+    def _deserialize(\n+        self, value: Any, attr: str | None, data: dict[str, Any], **kwargs: Any\n+    ) -> Any:\n+        if isinstance(value, str):\n+            value = parse_currency_string(value)\n+\n+        return super()._deserialize(value, attr, data, **kwargs)\n+\n+\n class DatasetMetricsPutSchema(Schema):\n     id = fields.Integer()\n     expression = fields.String(required=True)\n@@ -105,7 +120,7 @@ class DatasetMetricsPutSchema(Schema):\n     metric_name = fields.String(required=True, validate=Length(1, 255))\n     metric_type = fields.String(allow_none=True, validate=Length(1, 32))\n     d3format = fields.String(allow_none=True, validate=Length(1, 128))\n-    currency = fields.Nested(DatasetMetricCurrencyPutSchema, allow_none=True)\n+    currency = CurrencyField(DatasetMetricCurrencyPutSchema, allow_none=True)\n     verbose_name = fields.String(allow_none=True, metadata={Length: (1, 1024)})\n     warning_text = fields.String(allow_none=True)\n     uuid = fields.UUID(allow_none=True)\n@@ -276,9 +291,6 @@ def fix_fields(self, data: dict[str, Any], **kwargs: Any) -> dict[str, Any]:\n         if isinstance(data.get(\"extra\"), str):\n             data[\"extra\"] = json.loads(data[\"extra\"])\n \n-        if isinstance(data.get(\"currency\"), str):\n-            data[\"currency\"] = json.loads(data[\"currency\"])\n-\n         return data\n \n     metric_name = fields.String(required=True)\n@@ -287,7 +299,7 @@ def fix_fields(self, data: dict[str, Any], **kwargs: Any) -> dict[str, Any]:\n     expression = fields.String(required=True)\n     description = fields.String(allow_none=True)\n     d3format = fields.String(allow_none=True)\n-    currency = fields.Nested(ImportMetricCurrencySchema, allow_none=True)\n+    currency = CurrencyField(ImportMetricCurrencySchema, allow_none=True)\n     extra = fields.Dict(allow_none=True)\n     warning_text = fields.String(allow_none=True)\n ", "pull_request_number": 37455}
{"sha": "05407b9f442f82cdbdb86c4b88a272c6c199d5db", "filename": "superset/models/sql_types/__init__.py", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/apache/superset/blob/6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641/superset%2Fmodels%2Fsql_types%2F__init__.py", "raw_url": "https://github.com/apache/superset/raw/6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641/superset%2Fmodels%2Fsql_types%2F__init__.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Fmodels%2Fsql_types%2F__init__.py?ref=6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641", "patch": "@@ -14,3 +14,10 @@\n # KIND, either express or implied.  See the License for the\n # specific language governing permissions and limitations\n # under the License.\n+\n+from superset.models.sql_types.base import CurrencyType, parse_currency_string\n+\n+__all__ = [\n+    \"CurrencyType\",\n+    \"parse_currency_string\",\n+]", "pull_request_number": 37455}
{"sha": "355d9df5115c7a96dc4cd3d8db5bdb16b0184340", "filename": "superset/models/sql_types/base.py", "status": "added", "additions": 106, "deletions": 0, "changes": 106, "blob_url": "https://github.com/apache/superset/blob/6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641/superset%2Fmodels%2Fsql_types%2Fbase.py", "raw_url": "https://github.com/apache/superset/raw/6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641/superset%2Fmodels%2Fsql_types%2Fbase.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Fmodels%2Fsql_types%2Fbase.py?ref=6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641", "patch": "@@ -0,0 +1,106 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+\"\"\"Base SQL types for Superset models.\"\"\"\n+\n+from __future__ import annotations\n+\n+# pylint: disable=abstract-method\n+import ast\n+from typing import Any\n+\n+from sqlalchemy.engine.interfaces import Dialect\n+from sqlalchemy.types import JSON, TypeDecorator\n+\n+from superset.utils import json\n+\n+\n+def _try_parse_currency(value: str) -> Any | None:\n+    try:\n+        return json.loads(value)\n+    except (json.JSONDecodeError, TypeError):\n+        pass\n+\n+    try:\n+        return ast.literal_eval(value)\n+    except (ValueError, SyntaxError):\n+        return None\n+\n+\n+def parse_currency_string(value: str) -> dict[str, Any]:\n+    if not value:\n+        return {}\n+\n+    current: Any = value\n+    for _ in range(2):\n+        if isinstance(current, dict):\n+            return current\n+        if not isinstance(current, str):\n+            return {}\n+\n+        parsed = _try_parse_currency(current)\n+        if parsed is None:\n+            return {}\n+        if isinstance(parsed, str):\n+            current = parsed\n+            continue\n+        if isinstance(parsed, dict):\n+            return parsed\n+        return {}\n+\n+    return {}\n+\n+\n+class CurrencyType(TypeDecorator):\n+    \"\"\"\n+    Custom SQLAlchemy type for metric currency that ensures string values\n+    are parsed to dicts when read from the database.\n+\n+    This handles legacy data that was stored as stringified JSON before\n+    the currency column was migrated from VARCHAR to JSON type. Some data\n+    may have been double-encoded or stored with Python dict formatting.\n+\n+    Example problematic values this handles:\n+    - '{\"symbol\": \"USD\", \"symbolPosition\": \"prefix\"}'  (JSON string)\n+    - \"{'symbol': 'EUR', 'symbolPosition': 'suffix'}\"  (Python dict string)\n+    \"\"\"\n+\n+    impl = JSON\n+    cache_ok = True\n+\n+    def process_result_value(\n+        self, value: Any, dialect: Dialect\n+    ) -> dict[str, Any] | None:\n+        \"\"\"\n+        Process value when reading from database.\n+\n+        Ensures the returned value is always a dict (or None), even if\n+        the stored value is a string representation of a dict.\n+\n+        Args:\n+            value: The value from the database (could be None, dict, or string)\n+            dialect: The SQLAlchemy dialect being used\n+\n+        Returns:\n+            A dict representing the currency configuration, or None\n+        \"\"\"\n+        if value is None:\n+            return None\n+\n+        if isinstance(value, str):\n+            return parse_currency_string(value)\n+\n+        return value", "pull_request_number": 37455}
{"sha": "c0692fe974194468c3ef621459cc8b13406ba111", "filename": "tests/integration_tests/datasets/api_tests.py", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641/tests%2Fintegration_tests%2Fdatasets%2Fapi_tests.py", "raw_url": "https://github.com/apache/superset/raw/6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641/tests%2Fintegration_tests%2Fdatasets%2Fapi_tests.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/tests%2Fintegration_tests%2Fdatasets%2Fapi_tests.py?ref=6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641", "patch": "@@ -1510,7 +1510,7 @@ def test_update_dataset_update_metric_invalid_currency(self):\n                 {\n                     \"metric_name\": \"test\",\n                     \"expression\": \"COUNT(*)\",\n-                    \"currency\": '{\"symbol\": \"USD\", \"symbolPosition\": \"suffix\"}',\n+                    \"currency\": {\"symbol\": \"\", \"symbolPosition\": \"\"},\n                 },\n             ]\n         }", "pull_request_number": 37455}
{"sha": "40d63f3af8bbddad0450ba526ee6cdc103c0e476", "filename": "tests/unit_tests/datasets/schema_tests.py", "status": "modified", "additions": 56, "deletions": 0, "changes": 56, "blob_url": "https://github.com/apache/superset/blob/6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641/tests%2Funit_tests%2Fdatasets%2Fschema_tests.py", "raw_url": "https://github.com/apache/superset/raw/6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641/tests%2Funit_tests%2Fdatasets%2Fschema_tests.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/tests%2Funit_tests%2Fdatasets%2Fschema_tests.py?ref=6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641", "patch": "@@ -75,3 +75,59 @@ def test_dataset_put_schema_currency_code_column_optional() -> None:\n         \"currency_code_column\" not in result\n         or result.get(\"currency_code_column\") is None\n     )\n+\n+\n+def test_dataset_metrics_put_schema_parses_currency_string() -> None:\n+    \"\"\"Test that DatasetMetricsPutSchema parses string currency payloads.\"\"\"\n+    from superset.datasets.schemas import DatasetMetricsPutSchema\n+\n+    schema = DatasetMetricsPutSchema()\n+    data = {\n+        \"expression\": \"SUM(amount)\",\n+        \"metric_name\": \"sum_amount\",\n+        \"currency\": '{\"symbol\": \"EUR\", \"symbolPosition\": \"suffix\"}',\n+    }\n+    result = schema.load(data)\n+    assert result[\"currency\"] == {\"symbol\": \"EUR\", \"symbolPosition\": \"suffix\"}\n+\n+\n+def test_dataset_metrics_put_schema_parses_python_dict_string() -> None:\n+    \"\"\"Test that DatasetMetricsPutSchema parses Python dict currency strings.\"\"\"\n+    from superset.datasets.schemas import DatasetMetricsPutSchema\n+\n+    schema = DatasetMetricsPutSchema()\n+    data = {\n+        \"expression\": \"SUM(amount)\",\n+        \"metric_name\": \"sum_amount\",\n+        \"currency\": \"{'symbol': 'GBP', 'symbolPosition': 'prefix'}\",\n+    }\n+    result = schema.load(data)\n+    assert result[\"currency\"] == {\"symbol\": \"GBP\", \"symbolPosition\": \"prefix\"}\n+\n+\n+def test_dataset_metrics_put_schema_handles_malformed_currency() -> None:\n+    \"\"\"Test that DatasetMetricsPutSchema normalizes malformed currency strings.\"\"\"\n+    from superset.datasets.schemas import DatasetMetricsPutSchema\n+\n+    schema = DatasetMetricsPutSchema()\n+    data = {\n+        \"expression\": \"SUM(amount)\",\n+        \"metric_name\": \"sum_amount\",\n+        \"currency\": \"not valid json\",\n+    }\n+    result = schema.load(data)\n+    assert result[\"currency\"] == {}\n+\n+\n+def test_import_v1_metric_schema_parses_currency_string() -> None:\n+    \"\"\"Test that ImportV1MetricSchema parses string currency payloads.\"\"\"\n+    from superset.datasets.schemas import ImportV1MetricSchema\n+\n+    schema = ImportV1MetricSchema()\n+    data = {\n+        \"metric_name\": \"sum_amount\",\n+        \"expression\": \"SUM(amount)\",\n+        \"currency\": '{\"symbol\": \"CAD\", \"symbolPosition\": \"suffix\"}',\n+    }\n+    result = schema.load(data)\n+    assert result[\"currency\"] == {\"symbol\": \"CAD\", \"symbolPosition\": \"suffix\"}", "pull_request_number": 37455}
{"sha": "13a83393a9124bf6ec36540556b4808abd47e206", "filename": "tests/unit_tests/models/sql_types/__init__.py", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/apache/superset/blob/6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641/tests%2Funit_tests%2Fmodels%2Fsql_types%2F__init__.py", "raw_url": "https://github.com/apache/superset/raw/6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641/tests%2Funit_tests%2Fmodels%2Fsql_types%2F__init__.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/tests%2Funit_tests%2Fmodels%2Fsql_types%2F__init__.py?ref=6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641", "patch": "@@ -0,0 +1,16 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.", "pull_request_number": 37455}
{"sha": "58f94d3b850b1329283fbba0e5caf5df0e7360f9", "filename": "tests/unit_tests/models/sql_types/currency_type_test.py", "status": "added", "additions": 129, "deletions": 0, "changes": 129, "blob_url": "https://github.com/apache/superset/blob/6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641/tests%2Funit_tests%2Fmodels%2Fsql_types%2Fcurrency_type_test.py", "raw_url": "https://github.com/apache/superset/raw/6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641/tests%2Funit_tests%2Fmodels%2Fsql_types%2Fcurrency_type_test.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/tests%2Funit_tests%2Fmodels%2Fsql_types%2Fcurrency_type_test.py?ref=6ca4a7fd9304453f2e4eabf3f9b48251cdbdf641", "patch": "@@ -0,0 +1,129 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+\"\"\"Tests for CurrencyType - a custom SQLAlchemy type for metric currency.\"\"\"\n+\n+from unittest.mock import MagicMock\n+\n+import pytest\n+\n+from superset.models.sql_types.base import CurrencyType\n+\n+\n+@pytest.fixture\n+def currency_type() -> CurrencyType:\n+    \"\"\"Create a CurrencyType instance for testing.\"\"\"\n+    return CurrencyType()\n+\n+\n+@pytest.fixture\n+def mock_dialect() -> MagicMock:\n+    \"\"\"Create a mock SQLAlchemy dialect.\"\"\"\n+    return MagicMock()\n+\n+\n+def test_process_result_value_with_none(\n+    currency_type: CurrencyType, mock_dialect: MagicMock\n+) -> None:\n+    \"\"\"Test that None values are returned as-is.\"\"\"\n+    result = currency_type.process_result_value(None, mock_dialect)\n+    assert result is None\n+\n+\n+def test_process_result_value_with_dict(\n+    currency_type: CurrencyType, mock_dialect: MagicMock\n+) -> None:\n+    \"\"\"Test that dict values are returned as-is.\"\"\"\n+    value = {\"symbol\": \"USD\", \"symbolPosition\": \"prefix\"}\n+    result = currency_type.process_result_value(value, mock_dialect)\n+    assert result == {\"symbol\": \"USD\", \"symbolPosition\": \"prefix\"}\n+\n+\n+def test_process_result_value_with_empty_dict(\n+    currency_type: CurrencyType, mock_dialect: MagicMock\n+) -> None:\n+    \"\"\"Test that empty dict values are returned as-is.\"\"\"\n+    result = currency_type.process_result_value({}, mock_dialect)\n+    assert result == {}\n+\n+\n+def test_process_result_value_with_json_string(\n+    currency_type: CurrencyType, mock_dialect: MagicMock\n+) -> None:\n+    \"\"\"Test that JSON string values are parsed to dict.\"\"\"\n+    value = '{\"symbol\": \"EUR\", \"symbolPosition\": \"suffix\"}'\n+    result = currency_type.process_result_value(value, mock_dialect)\n+    assert result == {\"symbol\": \"EUR\", \"symbolPosition\": \"suffix\"}\n+\n+\n+def test_process_result_value_with_python_dict_string(\n+    currency_type: CurrencyType, mock_dialect: MagicMock\n+) -> None:\n+    \"\"\"Test that Python dict string (single quotes) values are parsed to dict.\"\"\"\n+    value = \"{'symbol': 'GBP', 'symbolPosition': 'prefix'}\"\n+    result = currency_type.process_result_value(value, mock_dialect)\n+    assert result == {\"symbol\": \"GBP\", \"symbolPosition\": \"prefix\"}\n+\n+\n+def test_process_result_value_with_double_encoded_json_string(\n+    currency_type: CurrencyType, mock_dialect: MagicMock\n+) -> None:\n+    \"\"\"Test that double-encoded JSON strings are parsed to dict.\"\"\"\n+    value = '\"{\\\\\"symbol\\\\\": \\\\\"EUR\\\\\", \\\\\"symbolPosition\\\\\": \\\\\"suffix\\\\\"}\"'\n+    result = currency_type.process_result_value(value, mock_dialect)\n+    assert result == {\"symbol\": \"EUR\", \"symbolPosition\": \"suffix\"}\n+\n+\n+def test_process_result_value_with_malformed_string(\n+    currency_type: CurrencyType, mock_dialect: MagicMock\n+) -> None:\n+    \"\"\"Test that malformed string values return empty dict.\"\"\"\n+    value = \"not valid json at all\"\n+    result = currency_type.process_result_value(value, mock_dialect)\n+    assert result == {}\n+\n+\n+def test_process_result_value_with_empty_string(\n+    currency_type: CurrencyType, mock_dialect: MagicMock\n+) -> None:\n+    \"\"\"Test that empty string values return empty dict.\"\"\"\n+    result = currency_type.process_result_value(\"\", mock_dialect)\n+    assert result == {}\n+\n+\n+def test_process_result_value_with_partial_json_string(\n+    currency_type: CurrencyType, mock_dialect: MagicMock\n+) -> None:\n+    \"\"\"Test that partial JSON string (only symbol) is parsed correctly.\"\"\"\n+    value = '{\"symbol\": \"JPY\"}'\n+    result = currency_type.process_result_value(value, mock_dialect)\n+    assert result == {\"symbol\": \"JPY\"}\n+\n+\n+def test_cache_ok_is_true(currency_type: CurrencyType) -> None:\n+    \"\"\"Test that cache_ok is True for SQLAlchemy compatibility.\"\"\"\n+    assert currency_type.cache_ok is True\n+\n+\n+def test_impl_is_json(currency_type: CurrencyType) -> None:\n+    \"\"\"Test that the underlying implementation is JSON type.\"\"\"\n+    from sqlalchemy.types import JSON\n+\n+    impl = currency_type.impl\n+    if isinstance(impl, type):\n+        assert issubclass(impl, JSON)\n+    else:\n+        assert isinstance(impl, JSON)", "pull_request_number": 37455}
{"sha": "3d009d5ad220948ccf57cb6c221caff8e6d8b679", "filename": "superset-frontend/packages/superset-ui-chart-controls/src/types.ts", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/apache/superset/blob/4b90d9ebda6f4e6eabaed0b4cfcf7968e0ea3135/superset-frontend%2Fpackages%2Fsuperset-ui-chart-controls%2Fsrc%2Ftypes.ts", "raw_url": "https://github.com/apache/superset/raw/4b90d9ebda6f4e6eabaed0b4cfcf7968e0ea3135/superset-frontend%2Fpackages%2Fsuperset-ui-chart-controls%2Fsrc%2Ftypes.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-chart-controls%2Fsrc%2Ftypes.ts?ref=4b90d9ebda6f4e6eabaed0b4cfcf7968e0ea3135", "patch": "@@ -572,6 +572,7 @@ export type ControlFormItemSpec<T extends ControlType = ControlType> = {\n       creatable?: boolean;\n       minWidth?: number | string;\n       validators?: ControlFormValueValidator<string>[];\n+      tokenSeparators?: string[];\n     }\n   : T extends 'RadioButtonControl'\n     ? {", "pull_request_number": 37454}
{"sha": "8d09344a15df9ce79ffbb2ae5d92a23beabbb917", "filename": "superset-frontend/src/explore/components/controls/ColumnConfigControl/ColumnConfigConstants.test.tsx", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/apache/superset/blob/4b90d9ebda6f4e6eabaed0b4cfcf7968e0ea3135/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2Fcontrols%2FColumnConfigControl%2FColumnConfigConstants.test.tsx", "raw_url": "https://github.com/apache/superset/raw/4b90d9ebda6f4e6eabaed0b4cfcf7968e0ea3135/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2Fcontrols%2FColumnConfigControl%2FColumnConfigConstants.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2Fcontrols%2FColumnConfigControl%2FColumnConfigConstants.test.tsx?ref=4b90d9ebda6f4e6eabaed0b4cfcf7968e0ea3135", "patch": "@@ -0,0 +1,33 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import { SHARED_COLUMN_CONFIG_PROPS } from './constants';\n+\n+const tokenSeparators =\n+  SHARED_COLUMN_CONFIG_PROPS.d3NumberFormat.tokenSeparators;\n+\n+test('should allow commas in D3 format inputs', () => {\n+  expect(tokenSeparators).toBeDefined();\n+  expect(tokenSeparators).not.toContain(',');\n+});\n+\n+test('should have correct default token separators', () => {\n+  const expectedSeparators = ['\\r\\n', '\\n', '\\t', ';'];\n+  expect(tokenSeparators).toEqual(expectedSeparators);\n+});", "pull_request_number": 37454}
{"sha": "19cc7a2e5b9e302d27050212f0c320ec84b7b549", "filename": "superset-frontend/src/explore/components/controls/ColumnConfigControl/constants.tsx", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/4b90d9ebda6f4e6eabaed0b4cfcf7968e0ea3135/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2Fcontrols%2FColumnConfigControl%2Fconstants.tsx", "raw_url": "https://github.com/apache/superset/raw/4b90d9ebda6f4e6eabaed0b4cfcf7968e0ea3135/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2Fcontrols%2FColumnConfigControl%2Fconstants.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2Fcontrols%2FColumnConfigControl%2Fconstants.tsx?ref=4b90d9ebda6f4e6eabaed0b4cfcf7968e0ea3135", "patch": "@@ -58,6 +58,8 @@ const d3NumberFormat: ControlFormItemSpec<'Select'> = {\n   creatable: true,\n   minWidth: '14em',\n   debounceDelay: 500,\n+  // default value tokenSeparators in superset-frontend/packages/superset-ui-core/src/components/Select/constants.ts\n+  tokenSeparators: ['\\r\\n', '\\n', '\\t', ';'],\n };\n \n const d3TimeFormat: ControlFormItemSpec<'Select'> = {", "pull_request_number": 37454}
{"sha": "bc3c5e344bdf54b95ebccc8b66048838bb6085db", "filename": "superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/DraggableFilter.tsx", "status": "modified", "additions": 24, "deletions": 88, "changes": 112, "blob_url": "https://github.com/apache/superset/blob/bf6266eae8b7e5e8cc0321dad49d124425aca77b/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FnativeFilters%2FFiltersConfigModal%2FDraggableFilter.tsx", "raw_url": "https://github.com/apache/superset/raw/bf6266eae8b7e5e8cc0321dad49d124425aca77b/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FnativeFilters%2FFiltersConfigModal%2FDraggableFilter.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FnativeFilters%2FFiltersConfigModal%2FDraggableFilter.tsx?ref=bf6266eae8b7e5e8cc0321dad49d124425aca77b", "patch": "@@ -17,25 +17,21 @@\n  * under the License.\n  */\n import { styled } from '@apache-superset/core/ui';\n-import { useRef, FC } from 'react';\n-import {\n-  DragSourceMonitor,\n-  DropTargetMonitor,\n-  useDrag,\n-  useDrop,\n-  XYCoord,\n-} from 'react-dnd';\n+import { FC } from 'react';\n+import { CSS } from '@dnd-kit/utilities';\n+import { useSortable } from '@dnd-kit/sortable';\n+\n import { Icons } from '@superset-ui/core/components/Icons';\n import type { IconType } from '@superset-ui/core/components/Icons/types';\n \n interface TitleContainerProps {\n   readonly isDragging: boolean;\n }\n \n-const FILTER_TYPE = 'FILTER';\n-\n-const Container = styled.div<TitleContainerProps>`\n-  ${({ isDragging, theme }) => `\n+const Container = styled('div', {\n+  shouldForwardProp: propName => propName !== 'isDragging',\n+})<TitleContainerProps>`\n+  ${({ isDragging }) => `\n     opacity: ${isDragging ? 0.3 : 1};\n     cursor: ${isDragging ? 'grabbing' : 'pointer'};\n     width: 100%;\n@@ -54,92 +50,32 @@ const DragIcon = styled(Icons.Drag, {\n `;\n \n interface FilterTabTitleProps {\n-  index: number;\n-  filterIds: string[];\n-  onRearrange: (dragItemIndex: number, targetIndex: number) => void;\n-}\n-\n-interface DragItem {\n-  index: number;\n-  filterIds: string[];\n-  type: string;\n+  filterId: string;\n }\n \n export const DraggableFilter: FC<FilterTabTitleProps> = ({\n-  index,\n-  onRearrange,\n-  filterIds,\n+  filterId,\n   children,\n }) => {\n-  const ref = useRef<HTMLDivElement>(null);\n-  const [{ isDragging }, drag] = useDrag({\n-    item: { filterIds, type: FILTER_TYPE, index },\n-    collect: (monitor: DragSourceMonitor) => ({\n-      isDragging: monitor.isDragging(),\n-    }),\n-  });\n-  const [, drop] = useDrop({\n-    accept: FILTER_TYPE,\n-    hover: (item: DragItem, monitor: DropTargetMonitor) => {\n-      if (!ref.current) {\n-        return;\n-      }\n-\n-      const dragIndex = item.index;\n-      const hoverIndex = index;\n-\n-      // Don't replace items with themselves\n-      if (dragIndex === hoverIndex) {\n-        return;\n-      }\n-      // Determine rectangle on screen\n-      const hoverBoundingRect = ref.current?.getBoundingClientRect();\n-\n-      // Get vertical middle\n-      const hoverMiddleY =\n-        (hoverBoundingRect.bottom - hoverBoundingRect.top) / 2;\n-\n-      // Determine mouse position\n-      const clientOffset = monitor.getClientOffset();\n-\n-      // Get pixels to the top\n-      const hoverClientY = (clientOffset as XYCoord).y - hoverBoundingRect.top;\n-\n-      // Only perform the move when the mouse has crossed half of the items height\n-      // When dragging downwards, only move when the cursor is below 50%\n-      // When dragging upwards, only move when the cursor is above 50%\n \n-      // Dragging downwards\n-      if (dragIndex < hoverIndex && hoverClientY < hoverMiddleY) {\n-        return;\n-      }\n+  const { attributes, listeners, setNodeRef, isDragging, transform, transition } = useSortable({ id: filterId });\n \n-      // Dragging upwards\n-      if (dragIndex > hoverIndex && hoverClientY > hoverMiddleY) {\n-        return;\n-      }\n+  const style = {\n+    transform: transform ? CSS.Transform.toString(transform) : undefined,\n+    transition,\n+  };\n \n-      onRearrange(dragIndex, hoverIndex);\n-      // Note: we're mutating the monitor item here.\n-      // Generally it's better to avoid mutations,\n-      // but it's good here for the sake of performance\n-      // to avoid expensive index searches.\n-      // eslint-disable-next-line no-param-reassign\n-      item.index = hoverIndex;\n-    },\n-  });\n-  drag(drop(ref));\n   return (\n-    <Container ref={ref} isDragging={isDragging}>\n-      <DragIcon\n-        isDragging={isDragging}\n-        alt=\"Move icon\"\n-        className=\"dragIcon\"\n-        viewBox=\"4 4 16 16\"\n-      />\n-      <div css={{ flex: 1 }}>{children}</div>\n+    <Container ref={setNodeRef} style={style} isDragging={isDragging} {...listeners} {...attributes}>\n+        <DragIcon\n+            isDragging={isDragging}\n+            aria-label='Move filter'\n+            className=\"dragIcon\"\n+            viewBox=\"4 4 16 16\"\n+        />\n+        <div css={{ flex: 1 }}>{children}</div>\n     </Container>\n-  );\n+  )\n };\n \n export default DraggableFilter;", "pull_request_number": 36778}
{"sha": "af8e7258f299c09d17bdca3a168e9b4fad9059cb", "filename": "superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FilterTitleContainer.tsx", "status": "modified", "additions": 56, "deletions": 17, "changes": 73, "blob_url": "https://github.com/apache/superset/blob/bf6266eae8b7e5e8cc0321dad49d124425aca77b/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FnativeFilters%2FFiltersConfigModal%2FFilterTitleContainer.tsx", "raw_url": "https://github.com/apache/superset/raw/bf6266eae8b7e5e8cc0321dad49d124425aca77b/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FnativeFilters%2FFiltersConfigModal%2FFilterTitleContainer.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FnativeFilters%2FFiltersConfigModal%2FFilterTitleContainer.tsx?ref=bf6266eae8b7e5e8cc0321dad49d124425aca77b", "patch": "@@ -16,13 +16,25 @@\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n-import { forwardRef, ReactNode } from 'react';\n+import { forwardRef } from 'react';\n \n import { t } from '@superset-ui/core';\n import { styled } from '@apache-superset/core/ui';\n import { Icons } from '@superset-ui/core/components/Icons';\n import { FilterRemoval } from './types';\n import DraggableFilter from './DraggableFilter';\n+import {\n+  DndContext,\n+  DragEndEvent,\n+  PointerSensor,\n+  closestCenter,\n+  useSensor,\n+  useSensors,\n+} from '@dnd-kit/core';\n+import {\n+  SortableContext,\n+  verticalListSortingStrategy,\n+} from '@dnd-kit/sortable';\n \n export const FilterTitle = styled.div`\n   ${({ theme }) => `\n@@ -152,27 +164,54 @@ const FilterTitleContainer = forwardRef<HTMLDivElement, Props>(\n       );\n     };\n \n-    const renderFilterGroups = () => {\n-      const items: ReactNode[] = [];\n-      filters.forEach((item, index) => {\n-        items.push(\n+    const handleDragEnd = (event: DragEndEvent) => {\n+      const { active, over } = event;\n+      const activeId = active.id;\n+      const overId = over?.id;\n+      if (activeId == null || overId == null) return;\n+      const from = filters.indexOf(String(activeId));\n+      const to = filters.indexOf(String(overId));\n+      if (from === -1 || to === -1) return;\n+      onRearrange(from, to);\n+    };\n+\n+    /*\n+     * We need sensor in this case because we have other listeners in the same component\n+     * and dnd-kit listeners blocks other listeners preventing actions like undo and delete.\n+     * Using sensors we can set activation constraint and avoid blocking other actions.\n+     */\n+    const sensors = useSensors(\n+      useSensor(PointerSensor, {\n+        activationConstraint: {\n+          distance: 5,\n+        },\n+      }),\n+    );\n+\n+    const renderFilterGroups = () => (\n+      <SortableContext items={filters} strategy={verticalListSortingStrategy}>\n+        {filters.map(item => (\n           <DraggableFilter\n-            key={index}\n-            onRearrange={onRearrange}\n-            index={index}\n-            filterIds={[item]}\n+            // Need to pass key here to smoothly handle reordering of items\n+            key={item}\n+            filterId={item}\n           >\n             {renderComponent(item)}\n-          </DraggableFilter>,\n-        );\n-      });\n-      return items;\n-    };\n+          </DraggableFilter>\n+        ))}\n+      </SortableContext>\n+    );\n \n     return (\n-      <Container data-test=\"filter-title-container\" ref={ref}>\n-        {renderFilterGroups()}\n-      </Container>\n+      <DndContext\n+        collisionDetection={closestCenter}\n+        onDragEnd={handleDragEnd}\n+        sensors={sensors}\n+      >\n+        <Container data-test=\"filter-title-container\" ref={ref}>\n+          {renderFilterGroups()}\n+        </Container>\n+      </DndContext>\n     );\n   },\n );", "pull_request_number": 36778}
{"sha": "e87f006534f2ef15b2d0d0dd2d89c878c52d408b", "filename": "superset/viz.py", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/apache/superset/blob/79e865ddfa1f44d76bf46c4094e6cf4d08f78dea/superset%2Fviz.py", "raw_url": "https://github.com/apache/superset/raw/79e865ddfa1f44d76bf46c4094e6cf4d08f78dea/superset%2Fviz.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Fviz.py?ref=79e865ddfa1f44d76bf46c4094e6cf4d08f78dea", "patch": "@@ -1625,6 +1625,16 @@ def get_data(self, df: pd.DataFrame) -> VizData:\n             form_data = slc.form_data\n             form_data = self._apply_layer_filtering(form_data, layer_index)\n \n+            # Preserve dashboard context from parent form for embedded dashboards\n+            # This allows guest users to access datasources in embedded mode\n+            if \"dashboardId\" in self.form_data:\n+                form_data[\"dashboardId\"] = self.form_data[\"dashboardId\"]\n+            # Preserve parent slice_id for permission checks\n+            if \"slice_id\" in self.form_data:\n+                form_data[\"parent_slice_id\"] = self.form_data[\"slice_id\"]\n+                # Also preserve the individual layer's slice_id for proper association\n+                form_data[\"slice_id\"] = slc.id\n+\n             viz_type_name = form_data.get(\"viz_type\")\n             viz_class = viz_types.get(viz_type_name)\n             if not viz_class:", "pull_request_number": 37483}
{"sha": "dbc0ea53cf41e462348da65c4200215fe8bcdbeb", "filename": ".gitignore", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/apache/superset/blob/43f99c9f1765aed7d97c7a08f7254a30879ebf18/.gitignore", "raw_url": "https://github.com/apache/superset/raw/43f99c9f1765aed7d97c7a08f7254a30879ebf18/.gitignore", "contents_url": "https://api.github.com/repos/apache/superset/contents/.gitignore?ref=43f99c9f1765aed7d97c7a08f7254a30879ebf18", "patch": "@@ -61,6 +61,7 @@ tmp\n rat-results.txt\n superset/app/\n superset-websocket/config.json\n+.direnv\n \n # Node.js, webpack artifacts, storybook\n *.entry.js", "pull_request_number": 37481}
{"sha": "88ddcd1946f6049107063dcec0b549fb85851fdc", "filename": "superset-frontend/packages/superset-ui-core/src/components/Timer/index.tsx", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/apache/superset/blob/58b58a22da313045c4cf2c865cef331457eec844/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FTimer%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/58b58a22da313045c4cf2c865cef331457eec844/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FTimer%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FTimer%2Findex.tsx?ref=58b58a22da313045c4cf2c865cef331457eec844", "patch": "@@ -35,7 +35,9 @@ export function Timer({\n   status = 'success',\n }: TimerProps) {\n   const theme = useTheme();\n-  const [clockStr, setClockStr] = useState('00:00:00.00');\n+  const [clockStr, setClockStr] = useState(\n+    startTime && endTime ? fDuration(startTime, endTime) : '00:00:00.00',\n+  );\n   const timer = useRef<ReturnType<typeof setInterval>>();\n \n   useEffect(() => {", "pull_request_number": 36936}
{"sha": "14d4e2273b2756c88c7f091b1704d3f77dce9461", "filename": "superset-frontend/packages/superset-ui-core/src/query/types/Query.ts", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/apache/superset/blob/58b58a22da313045c4cf2c865cef331457eec844/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fquery%2Ftypes%2FQuery.ts", "raw_url": "https://github.com/apache/superset/raw/58b58a22da313045c4cf2c865cef331457eec844/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fquery%2Ftypes%2FQuery.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fquery%2Ftypes%2FQuery.ts?ref=58b58a22da313045c4cf2c865cef331457eec844", "patch": "@@ -316,6 +316,7 @@ export type Query = {\n   errorMessage: string | null;\n   extra: {\n     progress: string | null;\n+    progress_text?: string;\n     errors?: SupersetError[];\n   };\n   id: string;", "pull_request_number": 36936}
{"sha": "99858a99e647119781382a27be16e7a9d2ed7f75", "filename": "superset-frontend/src/SqlLab/actions/sqlLab.ts", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/58b58a22da313045c4cf2c865cef331457eec844/superset-frontend%2Fsrc%2FSqlLab%2Factions%2FsqlLab.ts", "raw_url": "https://github.com/apache/superset/raw/58b58a22da313045c4cf2c865cef331457eec844/superset-frontend%2Fsrc%2FSqlLab%2Factions%2FsqlLab.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2FSqlLab%2Factions%2FsqlLab.ts?ref=58b58a22da313045c4cf2c865cef331457eec844", "patch": "@@ -392,7 +392,7 @@ export function startQuery(query: Query, runPreviewOnly?: boolean) {\n     id: query.id ? query.id : nanoid(11),\n     progress: 0,\n     startDttm: now(),\n-    state: query.runAsync ? 'pending' : 'running',\n+    state: 'pending',\n     cached: false,\n   });\n   return { type: START_QUERY, query, runPreviewOnly } as const;", "pull_request_number": 36936}
{"sha": "92a5d900dc5e82d9c6bcf0c60615e745227f12eb", "filename": "superset-frontend/src/SqlLab/components/QueryStatusBar/QueryStatusBar.test.tsx", "status": "added", "additions": 161, "deletions": 0, "changes": 161, "blob_url": "https://github.com/apache/superset/blob/58b58a22da313045c4cf2c865cef331457eec844/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FQueryStatusBar%2FQueryStatusBar.test.tsx", "raw_url": "https://github.com/apache/superset/raw/58b58a22da313045c4cf2c865cef331457eec844/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FQueryStatusBar%2FQueryStatusBar.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FQueryStatusBar%2FQueryStatusBar.test.tsx?ref=58b58a22da313045c4cf2c865cef331457eec844", "patch": "@@ -0,0 +1,161 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import { isValidElement } from 'react';\n+import { render, screen } from 'spec/helpers/testing-library';\n+import { QueryState, type QueryResponse } from '@superset-ui/core';\n+import QueryStatusBar from '.';\n+\n+jest.mock('../QueryStateLabel', () => ({\n+  __esModule: true,\n+  default: ({ query }: { query: { state: QueryState } }) => (\n+    <div data-test=\"query-state-label\">{query.state}</div>\n+  ),\n+}));\n+\n+const createMockQuery = (\n+  overrides: Partial<QueryResponse> = {},\n+): QueryResponse =>\n+  ({\n+    id: 'test-query-id',\n+    dbId: 1,\n+    sql: 'SELECT * FROM test',\n+    sqlEditorId: 'test-editor',\n+    tab: 'Test Tab',\n+    ctas: false,\n+    cached: false,\n+    progress: 0,\n+    startDttm: Date.now() - 1000,\n+    endDttm: undefined,\n+    state: QueryState.Running,\n+    tempSchema: null,\n+    tempTable: null,\n+    userId: 1,\n+    executedSql: null,\n+    rows: 0,\n+    queryLimit: 100,\n+    catalog: null,\n+    schema: 'test_schema',\n+    errorMessage: null,\n+    extra: {},\n+    results: undefined,\n+    ...overrides,\n+  }) as QueryResponse;\n+\n+test('is valid element', () => {\n+  const query = createMockQuery();\n+  expect(isValidElement(<QueryStatusBar query={query} />)).toBe(true);\n+});\n+\n+test('renders query state label', () => {\n+  const query = createMockQuery({ state: QueryState.Running });\n+  render(<QueryStatusBar query={query} />);\n+  expect(screen.getByTestId('query-state-label')).toBeInTheDocument();\n+  expect(screen.getByText('Query State:')).toBeInTheDocument();\n+});\n+\n+test('renders elapsed time section', () => {\n+  const query = createMockQuery({ state: QueryState.Running });\n+  render(<QueryStatusBar query={query} />);\n+  expect(screen.getByText('Elapsed:')).toBeInTheDocument();\n+});\n+\n+test('renders steps for running query', () => {\n+  const query = createMockQuery({ state: QueryState.Running, progress: 50 });\n+  render(<QueryStatusBar query={query} />);\n+  expect(screen.getByText('Validate query')).toBeInTheDocument();\n+  expect(screen.getByText('Connect to engine')).toBeInTheDocument();\n+  expect(screen.getByText('Running')).toBeInTheDocument();\n+  expect(screen.getByText('Download to client')).toBeInTheDocument();\n+  expect(screen.getByText('Finish')).toBeInTheDocument();\n+});\n+\n+test('renders steps for pending query', () => {\n+  const query = createMockQuery({ state: QueryState.Pending });\n+  render(<QueryStatusBar query={query} />);\n+  expect(screen.getByText('Validate query')).toBeInTheDocument();\n+});\n+\n+test('returns null when query is successful with results', () => {\n+  const query = createMockQuery({\n+    state: QueryState.Success,\n+    results: {\n+      displayLimitReached: false,\n+      columns: [],\n+      selected_columns: [],\n+      expanded_columns: [],\n+      data: [],\n+      query: { limit: 100 },\n+    },\n+  });\n+  const { container } = render(<QueryStatusBar query={query} />);\n+  expect(container).toBeEmptyDOMElement();\n+});\n+\n+test('displays progress percentage when available', () => {\n+  const query = createMockQuery({\n+    state: QueryState.Running,\n+    progress: 75,\n+  });\n+  render(<QueryStatusBar query={query} />);\n+  expect(screen.getByText('(75%)')).toBeInTheDocument();\n+});\n+\n+test('displays progress text when available', () => {\n+  const query = createMockQuery({\n+    state: QueryState.Running,\n+    progress: 50,\n+    extra: { progress: null, progress_text: 'Processing rows' },\n+  });\n+  render(<QueryStatusBar query={query} />);\n+  expect(screen.getByText('(50%, Processing rows)')).toBeInTheDocument();\n+});\n+\n+test('displays only progress text when no percentage', () => {\n+  const query = createMockQuery({\n+    state: QueryState.Running,\n+    progress: 0,\n+    extra: { progress: null, progress_text: 'Initializing' },\n+  });\n+  render(<QueryStatusBar query={query} />);\n+  expect(screen.getByText('(Initializing)')).toBeInTheDocument();\n+});\n+\n+test('renders for failed query state', () => {\n+  const query = createMockQuery({\n+    state: QueryState.Failed,\n+    errorMessage: 'Query failed',\n+  });\n+  render(<QueryStatusBar query={query} />);\n+  expect(screen.getByTestId('query-state-label')).toBeInTheDocument();\n+});\n+\n+test('renders for stopped query state', () => {\n+  const query = createMockQuery({ state: QueryState.Stopped });\n+  render(<QueryStatusBar query={query} />);\n+  expect(screen.getByTestId('query-state-label')).toBeInTheDocument();\n+});\n+\n+test('renders for fetching state', () => {\n+  const query = createMockQuery({\n+    state: QueryState.Fetching,\n+    progress: 100,\n+  });\n+  render(<QueryStatusBar query={query} />);\n+  expect(screen.getByText('Download to client')).toBeInTheDocument();\n+});", "pull_request_number": 36936}
{"sha": "69230fea1782a5a527391367f30d2435a85fea6e", "filename": "superset-frontend/src/SqlLab/components/QueryStatusBar/index.tsx", "status": "added", "additions": 214, "deletions": 0, "changes": 214, "blob_url": "https://github.com/apache/superset/blob/58b58a22da313045c4cf2c865cef331457eec844/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FQueryStatusBar%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/58b58a22da313045c4cf2c865cef331457eec844/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FQueryStatusBar%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FQueryStatusBar%2Findex.tsx?ref=58b58a22da313045c4cf2c865cef331457eec844", "patch": "@@ -0,0 +1,214 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import { FC, useMemo, createContext, useContext, useRef } from 'react';\n+import { t, styled } from '@apache-superset/core';\n+import {\n+  Flex,\n+  Steps,\n+  type StepsProps,\n+  StyledSpin,\n+  Timer,\n+} from '@superset-ui/core/components';\n+import { QueryResponse, QueryState, usePrevious } from '@superset-ui/core';\n+import QueryStateLabel from '../QueryStateLabel';\n+\n+type QueryStatusBarProps = {\n+  query: QueryResponse;\n+};\n+\n+const STATE_TO_STEP: Record<string, number> = {\n+  offline: 4,\n+  failed: 4,\n+  pending: 0,\n+  fetching: 3,\n+  running: 2,\n+  stopped: 4,\n+  success: 4,\n+};\n+\n+const ERROR_STATE = [QueryState.Failed, QueryState.Stopped];\n+\n+const StyledSteps = styled.div`\n+  & .ant-steps {\n+    margin: ${({ theme }) => theme.sizeUnit * 2}px 0;\n+  }\n+`;\n+\n+const ActiveDot = styled.div`\n+  position: relative;\n+  display: flex;\n+  align-items: center;\n+  justify-content: center;\n+\n+  &::before,\n+  &::after {\n+    content: '';\n+    position: absolute;\n+    width: 8px;\n+    height: 8px;\n+    border-radius: 50%;\n+    background-color: ${({ theme }) => theme.colorPrimary};\n+    top: -1px;\n+    opacity: 0;\n+    animation: pulse 2s ease-out infinite;\n+  }\n+\n+  &::after {\n+    animation-delay: 1s;\n+  }\n+\n+  @keyframes pulse {\n+    0% {\n+      transform: scale(0.5);\n+      opacity: 0.8;\n+    }\n+    100% {\n+      transform: scale(3);\n+      opacity: 0;\n+    }\n+  }\n+`;\n+\n+const progressContext = createContext<[number, string]>([0, '']);\n+\n+const ProgressStatus = () => {\n+  const [percent, progressText] = useContext(progressContext);\n+\n+  return (\n+    <>\n+      {percent > 0 ? (\n+        <span>\n+          ({percent}%{progressText && `, ${progressText}`})\n+        </span>\n+      ) : (\n+        <>{progressText && <span>({progressText})</span>}</>\n+      )}\n+    </>\n+  );\n+};\n+\n+const ProgressSpin = () => {\n+  const [percent] = useContext(progressContext);\n+  return (\n+    <>\n+      {typeof percent === 'number' && percent > 0 && (\n+        <StyledSpin size=\"small\" percent={percent} />\n+      )}\n+    </>\n+  );\n+};\n+\n+const customDot: StepsProps['progressDot'] = (dot, { status }) =>\n+  status === 'process' ? (\n+    <ActiveDot>\n+      <ProgressSpin />\n+    </ActiveDot>\n+  ) : (\n+    <>{dot}</>\n+  );\n+\n+const QueryStatusBar: FC<QueryStatusBarProps> = ({ query }) => {\n+  const steps = [\n+    {\n+      title: t('Validate query'),\n+    },\n+    {\n+      title: t('Connect to engine'),\n+    },\n+    {\n+      title: (\n+        <Flex align=\"center\" gap=\"small\">\n+          {t('Running')}\n+          <ProgressStatus />\n+        </Flex>\n+      ),\n+    },\n+    {\n+      title: t('Download to client'),\n+    },\n+    {\n+      title: t('Finish'),\n+    },\n+  ];\n+\n+  const hasError = useMemo(\n+    () => ERROR_STATE.includes(query.state),\n+    [query.state],\n+  );\n+  const prevStepRef = useRef<number>(0);\n+  const progress = query.progress > 0 ? query.progress : undefined;\n+  const { progress_text: progressText } = query.extra ?? {};\n+  const state =\n+    query.state === QueryState.Success &&\n+    prevStepRef.current === STATE_TO_STEP[QueryState.Running] &&\n+    !query.results\n+      ? QueryState.Fetching\n+      : query.state;\n+\n+  const currentIndex = STATE_TO_STEP[state] || 0;\n+  const prevStep = usePrevious(currentIndex);\n+  prevStepRef.current = prevStep ?? prevStepRef.current;\n+\n+  if (query.state === QueryState.Success && query.results) {\n+    return null;\n+  }\n+\n+  if (\n+    query.state === QueryState.Failed &&\n+    prevStep === STATE_TO_STEP[QueryState.Failed]\n+  ) {\n+    return null;\n+  }\n+\n+  return (\n+    <StyledSteps>\n+      <Flex justify=\"space-between\">\n+        <Flex gap=\"small\" align=\"center\">\n+          <span>{t('Query State')}:</span>\n+          <QueryStateLabel query={query} />\n+        </Flex>\n+        <Flex gap=\"small\" align=\"center\">\n+          <span>{t('Elapsed')}:</span>\n+          <Timer\n+            startTime={query.startDttm}\n+            endTime={query.endDttm}\n+            status=\"default\"\n+            isRunning={currentIndex < steps.length - 2}\n+          />\n+        </Flex>\n+      </Flex>\n+      <progressContext.Provider value={[progress ?? 0, progressText ?? '']}>\n+        <Steps\n+          size=\"small\"\n+          current={hasError ? prevStep : currentIndex}\n+          items={steps}\n+          status={\n+            hasError\n+              ? 'error'\n+              : currentIndex < steps.length - 1\n+                ? 'process'\n+                : 'finish'\n+          }\n+          {...(!hasError && { progressDot: customDot })}\n+        />\n+      </progressContext.Provider>\n+    </StyledSteps>\n+  );\n+};\n+export default QueryStatusBar;", "pull_request_number": 36936}
{"sha": "e12627777f47098f7f7dcd756f9147216812a5d2", "filename": "superset-frontend/src/SqlLab/components/ResultSet/ResultSet.test.tsx", "status": "modified", "additions": 0, "deletions": 46, "changes": 46, "blob_url": "https://github.com/apache/superset/blob/58b58a22da313045c4cf2c865cef331457eec844/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FResultSet%2FResultSet.test.tsx", "raw_url": "https://github.com/apache/superset/raw/58b58a22da313045c4cf2c865cef331457eec844/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FResultSet%2FResultSet.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FResultSet%2FResultSet.test.tsx?ref=58b58a22da313045c4cf2c865cef331457eec844", "patch": "@@ -35,7 +35,6 @@ import {\n   cachedQuery,\n   failedQueryWithErrors,\n   queries,\n-  runningQuery,\n   stoppedQuery,\n   initialState,\n   user,\n@@ -85,32 +84,6 @@ const stoppedQueryState = {\n     },\n   },\n };\n-const runningQueryState = {\n-  ...initialState,\n-  sqlLab: {\n-    ...initialState.sqlLab,\n-    queries: {\n-      [runningQuery.id]: runningQuery,\n-    },\n-  },\n-};\n-const fetchingQueryState = {\n-  ...initialState,\n-  sqlLab: {\n-    ...initialState.sqlLab,\n-    queries: {\n-      [mockedProps.queryId]: {\n-        dbId: 1,\n-        cached: false,\n-        ctas: false,\n-        id: 'ryhHUZCGb',\n-        progress: 100,\n-        state: 'fetching',\n-        startDttm: Date.now() - 500,\n-      },\n-    },\n-  },\n-};\n const cachedQueryState = {\n   ...initialState,\n   sqlLab: {\n@@ -332,25 +305,6 @@ describe('ResultSet', () => {\n     expect(alert).toBeInTheDocument();\n   });\n \n-  test('should render running/pending/fetching query', async () => {\n-    const { getByTestId } = setup(\n-      { ...mockedProps, queryId: runningQuery.id },\n-      mockStore(runningQueryState),\n-    );\n-    const progressBar = getByTestId('progress-bar');\n-    expect(progressBar).toBeInTheDocument();\n-  });\n-\n-  test('should render fetching w/ 100 progress query', async () => {\n-    const { getByRole, getByText } = setup(\n-      mockedProps,\n-      mockStore(fetchingQueryState),\n-    );\n-    const loading = getByRole('status');\n-    expect(loading).toBeInTheDocument();\n-    expect(getByText('fetching')).toBeInTheDocument();\n-  });\n-\n   test('should render a failed query with an errors object', async () => {\n     const { errors } = failedQueryWithErrors;\n ", "pull_request_number": 36936}
{"sha": "9bd2337bbf1980d5025654d33105018a25a5d01e", "filename": "superset-frontend/src/SqlLab/components/ResultSet/index.tsx", "status": "modified", "additions": 6, "deletions": 23, "changes": 29, "blob_url": "https://github.com/apache/superset/blob/58b58a22da313045c4cf2c865cef331457eec844/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FResultSet%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/58b58a22da313045c4cf2c865cef331457eec844/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FResultSet%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FResultSet%2Findex.tsx?ref=58b58a22da313045c4cf2c865cef331457eec844", "patch": "@@ -36,7 +36,6 @@ import {\n   Tooltip,\n   Input,\n   Label,\n-  Loading,\n } from '@superset-ui/core/components';\n import {\n   CopyToClipboard,\n@@ -62,7 +61,6 @@ import {\n import { EXPLORE_CHART_DEFAULT, SqlLabRootState } from 'src/SqlLab/types';\n import { mountExploreUrl } from 'src/explore/exploreUtils';\n import { postFormData } from 'src/explore/exploreUtils/formData';\n-import ProgressBar from '@superset-ui/core/components/ProgressBar';\n import { addDangerToast } from 'src/components/MessageToasts/actions';\n import { prepareCopyToClipboardTabularData } from 'src/utils/common';\n import { getItem, LocalStorageKeys } from 'src/utils/localStorageHelpers';\n@@ -90,7 +88,6 @@ import { makeUrl } from 'src/utils/pathUtils';\n import ExploreCtasResultsButton from '../ExploreCtasResultsButton';\n import ExploreResultsButton from '../ExploreResultsButton';\n import HighlightedSql from '../HighlightedSql';\n-import QueryStateLabel from '../QueryStateLabel';\n import PanelToolbar from 'src/components/PanelToolbar';\n import { ViewContribution } from 'src/SqlLab/contributions';\n \n@@ -816,34 +813,20 @@ const ResultSet = ({\n     }\n   }\n \n-  let progressBar;\n-  if (query.progress > 0) {\n-    progressBar = (\n-      <ProgressBar percent={parseInt(query.progress.toFixed(0), 10)} striped />\n-    );\n-  }\n-\n   const progressMsg = query?.extra?.progress ?? null;\n \n   return (\n-    <>\n-      <ResultlessStyles>\n-        <div>{!progressBar && <Loading position=\"normal\" />}</div>\n-        {/* show loading bar whenever progress bar is completed but needs time to render */}\n-        <div>{query.progress === 100 && <Loading position=\"normal\" />}</div>\n-        <QueryStateLabel query={query} />\n-        <div>\n-          {progressMsg && <Alert type=\"success\" message={progressMsg} />}\n-        </div>\n-        <div>{query.progress !== 100 && progressBar}</div>\n-        {trackingUrl && <div>{trackingUrl}</div>}\n-      </ResultlessStyles>\n+    <ResultlessStyles>\n+      {progressMsg && (\n+        <Alert type=\"success\" message={progressMsg} closable={false} />\n+      )}\n+      {trackingUrl && <div>{trackingUrl}</div>}\n       <StreamingExportModal\n         visible={showStreamingModal}\n         onCancel={handleCloseStreamingModal}\n         progress={progress}\n       />\n-    </>\n+    </ResultlessStyles>\n   );\n };\n ", "pull_request_number": 36936}
{"sha": "77345a050736a96e8cd842e748f5964fd742e04c", "filename": "superset-frontend/src/SqlLab/components/SouthPane/Results.tsx", "status": "modified", "additions": 29, "deletions": 22, "changes": 51, "blob_url": "https://github.com/apache/superset/blob/58b58a22da313045c4cf2c865cef331457eec844/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FSouthPane%2FResults.tsx", "raw_url": "https://github.com/apache/superset/raw/58b58a22da313045c4cf2c865cef331457eec844/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FSouthPane%2FResults.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FSouthPane%2FResults.tsx?ref=58b58a22da313045c4cf2c865cef331457eec844", "patch": "@@ -16,7 +16,7 @@\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n-import { FC } from 'react';\n+import { FC, useMemo } from 'react';\n import { shallowEqual, useSelector } from 'react-redux';\n import { EmptyState } from '@superset-ui/core/components';\n import { t } from '@apache-superset/core';\n@@ -26,6 +26,7 @@ import { styled, Alert } from '@apache-superset/core/ui';\n import { SqlLabRootState } from 'src/SqlLab/types';\n import ResultSet from '../ResultSet';\n import { LOCALSTORAGE_MAX_QUERY_AGE_MS } from '../../constants';\n+import QueryStatusBar from '../QueryStatusBar';\n \n type Props = {\n   latestQueryId?: string;\n@@ -53,10 +54,14 @@ const Results: FC<Props> = ({\n     ({ sqlLab: { databases } }: SqlLabRootState) => databases,\n     shallowEqual,\n   );\n-  const latestQuery = useSelector(\n-    ({ sqlLab: { queries } }: SqlLabRootState) => queries[latestQueryId || ''],\n+  const queries = useSelector(\n+    ({ sqlLab: { queries } }: SqlLabRootState) => queries,\n     shallowEqual,\n   );\n+  const latestQuery = useMemo(\n+    () => queries[latestQueryId ?? ''],\n+    [queries, latestQueryId],\n+  );\n \n   if (\n     !latestQuery ||\n@@ -72,30 +77,32 @@ const Results: FC<Props> = ({\n     );\n   }\n \n-  if (\n+  const hasNoStoredResults =\n     isFeatureEnabled(FeatureFlag.SqllabBackendPersistence) &&\n     latestQuery.state === 'success' &&\n     !latestQuery.resultsKey &&\n-    !latestQuery.results\n-  ) {\n-    return (\n-      <Alert\n-        type=\"info\"\n-        message={t('No stored results found, you need to re-run your query')}\n-      />\n-    );\n-  }\n+    !latestQuery.results;\n \n   return (\n-    <ResultSet\n-      search\n-      queryId={latestQuery.id}\n-      database={databases[latestQuery.dbId]}\n-      displayLimit={displayLimit}\n-      defaultQueryLimit={defaultQueryLimit}\n-      showSql\n-      showSqlInline\n-    />\n+    <>\n+      <QueryStatusBar key={latestQueryId} query={latestQuery} />\n+      {hasNoStoredResults ? (\n+        <Alert\n+          type=\"info\"\n+          message={t('No stored results found, you need to re-run your query')}\n+        />\n+      ) : (\n+        <ResultSet\n+          search\n+          queryId={latestQuery.id}\n+          database={databases[latestQuery.dbId]}\n+          displayLimit={displayLimit}\n+          defaultQueryLimit={defaultQueryLimit}\n+          showSql\n+          showSqlInline\n+        />\n+      )}\n+    </>\n   );\n };\n ", "pull_request_number": 36936}
{"sha": "b3b6f41fdd1dfaacf7231b3c25aeca59d350e931", "filename": "docker-compose-light.yml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/apache/superset/blob/3ed42208308f280c2d302f4c5da08a03b9dc8060/docker-compose-light.yml", "raw_url": "https://github.com/apache/superset/raw/3ed42208308f280c2d302f4c5da08a03b9dc8060/docker-compose-light.yml", "contents_url": "https://api.github.com/repos/apache/superset/contents/docker-compose-light.yml?ref=3ed42208308f280c2d302f4c5da08a03b9dc8060", "patch": "@@ -159,8 +159,8 @@ services:\n       SCARF_ANALYTICS: \"${SCARF_ANALYTICS:-}\"\n       # configuring the dev-server to use the host.docker.internal to connect to the backend\n       superset: \"http://superset-light:8088\"\n-      # Webpack dev server configuration\n-      WEBPACK_DEVSERVER_HOST: \"${WEBPACK_DEVSERVER_HOST:-127.0.0.1}\"\n+      # Webpack dev server must bind to 0.0.0.0 to be accessible from outside the container\n+      WEBPACK_DEVSERVER_HOST: \"${WEBPACK_DEVSERVER_HOST:-0.0.0.0}\"\n       WEBPACK_DEVSERVER_PORT: \"${WEBPACK_DEVSERVER_PORT:-9000}\"\n     ports:\n       - \"${NODE_PORT:-9001}:9000\"  # Parameterized port, accessible on all interfaces", "pull_request_number": 36433}
{"sha": "8ab4b117f239f83ef6611fd25bc691a9e9ead423", "filename": "docker-compose.yml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/3ed42208308f280c2d302f4c5da08a03b9dc8060/docker-compose.yml", "raw_url": "https://github.com/apache/superset/raw/3ed42208308f280c2d302f4c5da08a03b9dc8060/docker-compose.yml", "contents_url": "https://api.github.com/repos/apache/superset/contents/docker-compose.yml?ref=3ed42208308f280c2d302f4c5da08a03b9dc8060", "patch": "@@ -175,7 +175,7 @@ services:\n       SCARF_ANALYTICS: \"${SCARF_ANALYTICS:-}\"\n       # configuring the dev-server to use the host.docker.internal to connect to the backend\n       superset: \"http://superset:8088\"\n-      # Bind to all interfaces so Docker port mapping works\n+      # Webpack dev server must bind to 0.0.0.0 to be accessible from outside the container\n       WEBPACK_DEVSERVER_HOST: \"0.0.0.0\"\n     ports:\n       - \"127.0.0.1:${NODE_PORT:-9000}:9000\"  # exposing the dynamic webpack dev server", "pull_request_number": 36433}
{"sha": "892178c41128655e1cca17ad9b2e2d64ce5321ed", "filename": "superset-frontend/babel.config.js", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/apache/superset/blob/3ed42208308f280c2d302f4c5da08a03b9dc8060/superset-frontend%2Fbabel.config.js", "raw_url": "https://github.com/apache/superset/raw/3ed42208308f280c2d302f4c5da08a03b9dc8060/superset-frontend%2Fbabel.config.js", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fbabel.config.js?ref=3ed42208308f280c2d302f4c5da08a03b9dc8060", "patch": "@@ -54,7 +54,6 @@ module.exports = {\n     ['@babel/plugin-transform-runtime', { corejs: 3 }],\n     // only used in packages/superset-ui-core/src/chart/components/reactify.tsx\n     ['babel-plugin-typescript-to-proptypes', { loose: true }],\n-    'react-hot-loader/babel',\n     [\n       '@emotion/babel-plugin',\n       {", "pull_request_number": 36433}
{"sha": "0650db5386a140081ed3c884b90f6589a8b3b7e1", "filename": "superset-frontend/package-lock.json", "status": "modified", "additions": 612, "deletions": 3528, "changes": 4140, "blob_url": "https://github.com/apache/superset/blob/3ed42208308f280c2d302f4c5da08a03b9dc8060/superset-frontend%2Fpackage-lock.json", "raw_url": "https://github.com/apache/superset/raw/3ed42208308f280c2d302f4c5da08a03b9dc8060/superset-frontend%2Fpackage-lock.json", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackage-lock.json?ref=3ed42208308f280c2d302f4c5da08a03b9dc8060", "pull_request_number": 36433}
{"sha": "843e3df93ef0f63011931190ffcb67d4eebcc041", "filename": "superset-frontend/package.json", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/3ed42208308f280c2d302f4c5da08a03b9dc8060/superset-frontend%2Fpackage.json", "raw_url": "https://github.com/apache/superset/raw/3ed42208308f280c2d302f4c5da08a03b9dc8060/superset-frontend%2Fpackage.json", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackage.json?ref=3ed42208308f280c2d302f4c5da08a03b9dc8060", "patch": "@@ -186,7 +186,6 @@\n     \"react-dnd-html5-backend\": \"^11.1.3\",\n     \"react-dom\": \"^17.0.2\",\n     \"react-google-recaptcha\": \"^3.1.0\",\n-    \"react-hot-loader\": \"^4.13.1\",\n     \"react-intersection-observer\": \"^10.0.0\",\n     \"react-json-tree\": \"^0.20.0\",\n     \"react-lines-ellipsis\": \"^0.16.1\",\n@@ -239,7 +238,6 @@\n     \"@cypress/react\": \"^8.0.2\",\n     \"@emotion/babel-plugin\": \"^11.13.5\",\n     \"@emotion/jest\": \"^11.14.2\",\n-    \"@hot-loader/react-dom\": \"^17.0.2\",\n     \"@istanbuljs/nyc-config-typescript\": \"^1.0.1\",\n     \"@mihkeleidast/storybook-addon-source\": \"^1.0.1\",\n     \"@playwright/test\": \"^1.57.0\",", "pull_request_number": 36433}
{"sha": "4595e822ebdcec619e8ad2a0fe902c6d2828e82b", "filename": "superset-frontend/src/preamble.ts", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/apache/superset/blob/3ed42208308f280c2d302f4c5da08a03b9dc8060/superset-frontend%2Fsrc%2Fpreamble.ts", "raw_url": "https://github.com/apache/superset/raw/3ed42208308f280c2d302f4c5da08a03b9dc8060/superset-frontend%2Fsrc%2Fpreamble.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fpreamble.ts?ref=3ed42208308f280c2d302f4c5da08a03b9dc8060", "patch": "@@ -16,7 +16,6 @@\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n-import { setConfig as setHotLoaderConfig } from 'react-hot-loader';\n import { configure, LanguagePack } from '@apache-superset/core/ui';\n import { makeApi, initFeatureFlags, SupersetClient } from '@superset-ui/core';\n import { extendedDayjs as dayjs } from '@superset-ui/core/utils/dates';\n@@ -40,11 +39,6 @@ import 'dayjs/plugin/localizedFormat';\n \n configure();\n \n-// Set hot reloader config\n-if (process.env.WEBPACK_MODE === 'development') {\n-  setHotLoaderConfig({ logLevel: 'debug', trackTailUpdates: false });\n-}\n-\n // Grab initial bootstrap data\n const bootstrapData = getBootstrapData();\n ", "pull_request_number": 36433}
{"sha": "f8322fd8772a9dfec2f63c3e5676a0a41ade0d54", "filename": "superset-frontend/src/theme.ts", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/apache/superset/blob/3ed42208308f280c2d302f4c5da08a03b9dc8060/superset-frontend%2Fsrc%2Ftheme.ts", "raw_url": "https://github.com/apache/superset/raw/3ed42208308f280c2d302f4c5da08a03b9dc8060/superset-frontend%2Fsrc%2Ftheme.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ftheme.ts?ref=3ed42208308f280c2d302f4c5da08a03b9dc8060", "patch": "@@ -17,3 +17,9 @@\n  * under the License.\n  */\n import 'src/public-path';\n+\n+// Accept HMR updates for this entry point\n+declare const module: { hot?: { accept: () => void } };\n+if (module.hot) {\n+  module.hot.accept();\n+}", "pull_request_number": 36433}
{"sha": "87df93f8b28f9af7c978bcd3fb11840989d7d72d", "filename": "superset-frontend/src/views/App.tsx", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/apache/superset/blob/3ed42208308f280c2d302f4c5da08a03b9dc8060/superset-frontend%2Fsrc%2Fviews%2FApp.tsx", "raw_url": "https://github.com/apache/superset/raw/3ed42208308f280c2d302f4c5da08a03b9dc8060/superset-frontend%2Fsrc%2Fviews%2FApp.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fviews%2FApp.tsx?ref=3ed42208308f280c2d302f4c5da08a03b9dc8060", "patch": "@@ -17,7 +17,6 @@\n  * under the License.\n  */\n import { Suspense, useEffect } from 'react';\n-import { hot } from 'react-hot-loader/root';\n import {\n   BrowserRouter as Router,\n   Switch,\n@@ -110,4 +109,4 @@ const App = () => (\n   </Router>\n );\n \n-export default hot(App);\n+export default App;", "pull_request_number": 36433}
{"sha": "6b82103ca7c41b2e4bba4ca53f0b01a52abaaa09", "filename": "superset-frontend/webpack.config.js", "status": "modified", "additions": 29, "deletions": 18, "changes": 47, "blob_url": "https://github.com/apache/superset/blob/3ed42208308f280c2d302f4c5da08a03b9dc8060/superset-frontend%2Fwebpack.config.js", "raw_url": "https://github.com/apache/superset/raw/3ed42208308f280c2d302f4c5da08a03b9dc8060/superset-frontend%2Fwebpack.config.js", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fwebpack.config.js?ref=3ed42208308f280c2d302f4c5da08a03b9dc8060", "patch": "@@ -219,16 +219,13 @@ if (!isDevMode) {\n   );\n }\n \n-const PREAMBLE = [path.join(APP_DIR, '/src/preamble.ts')];\n-if (isDevMode) {\n-  // A Superset webpage normally includes two JS bundles in dev, `theme.ts` and\n-  // the main entrypoint. Only the main entry should have the dev server client,\n-  // otherwise the websocket client will initialize twice, creating two sockets.\n-  // Ref: https://github.com/gaearon/react-hot-loader/issues/141\n-  PREAMBLE.unshift(\n-    `webpack-dev-server/client?http://localhost:${devserverPort}`,\n-  );\n-}\n+// In dev mode, include theme.ts in preamble to avoid separate chunk HMR issues\n+const PREAMBLE = isDevMode\n+  ? [\n+      path.join(APP_DIR, '/src/theme.ts'),\n+      path.join(APP_DIR, '/src/preamble.ts'),\n+    ]\n+  : [path.join(APP_DIR, '/src/preamble.ts')];\n \n function addPreamble(entry) {\n   return PREAMBLE.concat([path.join(APP_DIR, entry)]);\n@@ -296,17 +293,28 @@ function createSwcLoader(syntax = 'typescript', tsx = true) {\n const config = {\n   entry: {\n     preamble: PREAMBLE,\n-    theme: path.join(APP_DIR, '/src/theme.ts'),\n+    // In dev mode, theme is included in preamble to avoid separate chunk HMR issues\n+    ...(isDevMode ? {} : { theme: path.join(APP_DIR, '/src/theme.ts') }),\n     menu: addPreamble('src/views/menu.tsx'),\n     spa: addPreamble('/src/views/index.tsx'),\n     embedded: addPreamble('/src/embedded/index.tsx'),\n   },\n   cache: {\n-    type: 'filesystem', // Enable filesystem caching\n+    type: 'filesystem',\n     cacheDirectory: path.resolve(__dirname, '.temp_cache'),\n+    // Separate cache for dev vs prod builds\n+    name: `${isDevMode ? 'development' : 'production'}-cache`,\n+    // Invalidate cache when these files change\n     buildDependencies: {\n-      config: [__filename],\n+      config: [\n+        __filename,\n+        path.resolve(__dirname, 'package-lock.json'),\n+        path.resolve(__dirname, 'babel.config.js'),\n+        path.resolve(__dirname, 'tsconfig.json'),\n+      ],\n     },\n+    // Compress cache for smaller disk usage (slight CPU tradeoff)\n+    compression: isDevMode ? false : 'gzip',\n   },\n   output,\n   stats: 'minimal',\n@@ -356,11 +364,9 @@ const config = {\n               'prop-types-extra',\n               'redux',\n               'react-redux',\n-              'react-hot-loader',\n               'react-sortable-hoc',\n               'react-table',\n               'react-ace',\n-              '@hot-loader.*',\n               'webpack.*',\n               '@?babel.*',\n               'lodash.*',\n@@ -469,7 +475,10 @@ const config = {\n       {\n         test: /\\.tsx?$/,\n         exclude: [/\\.test.tsx?$/, /node_modules/],\n-        use: ['thread-loader', createSwcLoader('typescript', true)],\n+        // Skip thread-loader in dev mode - it breaks HMR by running in worker threads\n+        use: isDevMode\n+          ? [createSwcLoader('typescript', true)]\n+          : ['thread-loader', createSwcLoader('typescript', true)],\n       },\n       {\n         test: /\\.jsx?$/,\n@@ -626,10 +635,12 @@ if (isDevMode) {\n \n   config.devServer = {\n     devMiddleware: {\n+      publicPath: '/static/assets/',\n       writeToDisk: true,\n     },\n     historyApiFallback: true,\n-    hot: true,\n+    hot: 'only', // HMR only, no page reload fallback\n+    liveReload: false,\n     host: devserverHost,\n     port: devserverPort,\n     allowedHosts: [\n@@ -649,7 +660,7 @@ if (isDevMode) {\n         warnings: false,\n         runtimeErrors: error => !/ResizeObserver/.test(error.message),\n       },\n-      logging: 'error',\n+      logging: 'info', // Show HMR messages\n       webSocketURL: {\n         hostname: '0.0.0.0',\n         pathname: '/ws',", "pull_request_number": 36433}
{"sha": "7320597a5c418502be41088977997f70be9e5b63", "filename": "superset-frontend/webpack.proxy-config.js", "status": "modified", "additions": 21, "deletions": 3, "changes": 24, "blob_url": "https://github.com/apache/superset/blob/3ed42208308f280c2d302f4c5da08a03b9dc8060/superset-frontend%2Fwebpack.proxy-config.js", "raw_url": "https://github.com/apache/superset/raw/3ed42208308f280c2d302f4c5da08a03b9dc8060/superset-frontend%2Fwebpack.proxy-config.js", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fwebpack.proxy-config.js?ref=3ed42208308f280c2d302f4c5da08a03b9dc8060", "patch": "@@ -50,6 +50,7 @@ function toDevHTML(originalHtml) {\n     /(<head>\\s*<title>)([\\s\\S]*)(<\\/title>)/i,\n     '$1[DEV] $2 $3',\n   );\n+\n   if (manifest) {\n     const loaded = new Set();\n     // replace bundled asset files, HTML comment tags generated by Jinja macros\n@@ -153,7 +154,17 @@ function processHTML(proxyResponse, response) {\n module.exports = newManifest => {\n   manifest = newManifest;\n   return {\n-    context: '/',\n+    context: path => {\n+      // Don't proxy hot update files - webpack-dev-server needs to serve these directly for HMR\n+      if (path.includes('.hot-update.')) {\n+        return false;\n+      }\n+      // Don't proxy WebSocket connections for HMR\n+      if (path === '/ws') {\n+        return false;\n+      }\n+      return true;\n+    },\n     target: backend,\n     hostRewrite: true,\n     changeOrigin: true,\n@@ -163,13 +174,17 @@ module.exports = newManifest => {\n       try {\n         copyHeaders(proxyResponse, response);\n         if (isHTML(response)) {\n+          // For HTML responses, flush headers before processing starts\n+          // processHTML sets up async handlers that will call response.end()\n+          response.flushHeaders();\n           processHTML(proxyResponse, response);\n         } else {\n           const isCSV = (proxyResponse.headers['content-type'] || '').includes(\n             'text/csv',\n           );\n \n           if (isCSV) {\n+            response.flushHeaders();\n             proxyResponse.on('data', chunk => {\n               response.write(chunk);\n               if (response.flush) {\n@@ -183,12 +198,15 @@ module.exports = newManifest => {\n               response.end();\n             });\n           } else {\n+            response.flushHeaders();\n             proxyResponse.pipe(response);\n           }\n         }\n-        response.flushHeaders();\n       } catch (e) {\n-        response.setHeader('content-type', 'text/plain');\n+        // Only try to set headers if they haven't been sent yet\n+        if (!response.headersSent) {\n+          response.setHeader('content-type', 'text/plain');\n+        }\n         response.write(`Error requesting ${request.path} from proxy:\\n\\n`);\n         response.end(e.stack);\n       }", "pull_request_number": 36433}
{"sha": "42a87cd2729101b19413394b848a1cae4b46548e", "filename": "superset-frontend/src/features/themes/ThemeModal.test.tsx", "status": "modified", "additions": 110, "deletions": 17, "changes": 127, "blob_url": "https://github.com/apache/superset/blob/b9929d7895ec23049bed5214ec11b0205b3c337e/superset-frontend%2Fsrc%2Ffeatures%2Fthemes%2FThemeModal.test.tsx", "raw_url": "https://github.com/apache/superset/raw/b9929d7895ec23049bed5214ec11b0205b3c337e/superset-frontend%2Fsrc%2Ffeatures%2Fthemes%2FThemeModal.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ffeatures%2Fthemes%2FThemeModal.test.tsx?ref=b9929d7895ec23049bed5214ec11b0205b3c337e", "patch": "@@ -17,7 +17,7 @@\n  * under the License.\n  */\n \n-import { render, screen } from 'spec/helpers/testing-library';\n+import { render, screen, waitFor } from 'spec/helpers/testing-library';\n import userEvent from '@testing-library/user-event';\n import fetchMock from 'fetch-mock';\n import ThemeModal from './ThemeModal';\n@@ -37,6 +37,27 @@ jest.mock('src/dashboard/util/permissionUtils', () => ({\n   isUserAdmin: jest.fn(() => true),\n }));\n \n+// Mock JsonEditor to avoid direct DOM manipulation in tests\n+jest.mock('@superset-ui/core/components/AsyncAceEditor', () => ({\n+  ...jest.requireActual('@superset-ui/core/components/AsyncAceEditor'),\n+  JsonEditor: ({\n+    onChange,\n+    value,\n+    readOnly,\n+  }: {\n+    onChange: (value: string) => void;\n+    value: string;\n+    readOnly?: boolean;\n+  }) => (\n+    <textarea\n+      data-test=\"json-editor\"\n+      value={value}\n+      onChange={e => onChange(e.target.value)}\n+      readOnly={readOnly}\n+    />\n+  ),\n+}));\n+\n const mockTheme: ThemeObject = {\n   id: 1,\n   theme_name: 'Test Theme',\n@@ -78,6 +99,19 @@ afterEach(() => {\n   jest.clearAllMocks();\n });\n \n+// Helper to add valid JSON data to the theme\n+// Uses the mocked JsonEditor textarea for testing\n+const addValidJsonData = async () => {\n+  const validJson = JSON.stringify(\n+    { token: { colorPrimary: '#1890ff' } },\n+    null,\n+    2,\n+  );\n+  const jsonEditor = screen.getByTestId('json-editor');\n+  await userEvent.clear(jsonEditor);\n+  await userEvent.type(jsonEditor, validJson);\n+};\n+\n test('renders modal with add theme dialog when show is true', () => {\n   render(\n     <ThemeModal\n@@ -272,10 +306,16 @@ test('enables save button when theme name is entered', async () => {\n \n   const nameInput = screen.getByPlaceholderText('Enter theme name');\n   await userEvent.type(nameInput, 'My New Theme');\n+  await addValidJsonData();\n \n-  const saveButton = await screen.findByRole('button', { name: 'Add' });\n-\n-  expect(saveButton).toBeEnabled();\n+  // Wait for validation to complete and button to become enabled\n+  await waitFor(\n+    () => {\n+      const saveButton = screen.getByRole('button', { name: 'Add' });\n+      expect(saveButton).toBeEnabled();\n+    },\n+    { timeout: 10000 },\n+  );\n });\n \n test('validates JSON format and enables save button', async () => {\n@@ -293,10 +333,16 @@ test('validates JSON format and enables save button', async () => {\n \n   const nameInput = screen.getByPlaceholderText('Enter theme name');\n   await userEvent.type(nameInput, 'Test Theme');\n+  await addValidJsonData();\n \n-  const saveButton = await screen.findByRole('button', { name: 'Add' });\n-\n-  expect(saveButton).toBeEnabled();\n+  // Wait for validation to complete and button to become enabled\n+  await waitFor(\n+    () => {\n+      const saveButton = screen.getByRole('button', { name: 'Add' });\n+      expect(saveButton).toBeEnabled();\n+    },\n+    { timeout: 10000 },\n+  );\n });\n \n test('shows unsaved changes alert when closing modal with modifications', async () => {\n@@ -407,6 +453,19 @@ test('saves changes when clicking Save button in unsaved changes alert', async (\n \n   const nameInput = screen.getByPlaceholderText('Enter theme name');\n   await userEvent.type(nameInput, 'Modified Theme');\n+  await addValidJsonData();\n+\n+  // Wait for validation to complete before canceling\n+  await waitFor(\n+    () => {\n+      const addButton = screen.getByRole('button', { name: 'Add' });\n+      expect(addButton).toBeEnabled();\n+    },\n+    { timeout: 10000 },\n+  );\n+\n+  // Give extra time for all state updates to complete\n+  await new Promise(resolve => setTimeout(resolve, 500));\n \n   const cancelButton = screen.getByRole('button', { name: 'Cancel' });\n   await userEvent.click(cancelButton);\n@@ -415,13 +474,26 @@ test('saves changes when clicking Save button in unsaved changes alert', async (\n     await screen.findByText('You have unsaved changes'),\n   ).toBeInTheDocument();\n \n-  const saveButton = screen.getByRole('button', { name: 'Save' });\n+  // Wait for the Save button in the alert to be enabled\n+  const saveButton = await waitFor(\n+    () => {\n+      const button = screen.getByRole('button', { name: 'Save' });\n+      expect(button).toBeEnabled();\n+      return button;\n+    },\n+    { timeout: 10000 },\n+  );\n   await userEvent.click(saveButton);\n \n   // Wait for API call to complete\n   await screen.findByRole('dialog');\n-  expect(fetchMock.called()).toBe(true);\n-});\n+  await waitFor(\n+    () => {\n+      expect(fetchMock.called()).toBe(true);\n+    },\n+    { timeout: 15000 },\n+  );\n+}, 30000);\n \n test('discards changes when clicking Discard button in unsaved changes alert', async () => {\n   const onHide = jest.fn();\n@@ -472,12 +544,23 @@ test('creates new theme when saving', async () => {\n \n   const nameInput = screen.getByPlaceholderText('Enter theme name');\n   await userEvent.type(nameInput, 'New Theme');\n-\n-  const saveButton = await screen.findByRole('button', { name: 'Add' });\n+  await addValidJsonData();\n+\n+  // Wait for validation to complete and button to become enabled\n+  const saveButton = await waitFor(\n+    () => {\n+      const button = screen.getByRole('button', { name: 'Add' });\n+      expect(button).toBeEnabled();\n+      return button;\n+    },\n+    { timeout: 10000 },\n+  );\n   await userEvent.click(saveButton);\n \n   expect(await screen.findByRole('dialog')).toBeInTheDocument();\n-  expect(fetchMock.called('glob:*/api/v1/theme/', 'POST')).toBe(true);\n+  await waitFor(() => {\n+    expect(fetchMock.called('glob:*/api/v1/theme/', 'POST')).toBe(true);\n+  });\n });\n \n test('updates existing theme when saving', async () => {\n@@ -525,14 +608,24 @@ test('handles API errors gracefully', async () => {\n \n   const nameInput = screen.getByPlaceholderText('Enter theme name');\n   await userEvent.type(nameInput, 'New Theme');\n-\n-  const saveButton = await screen.findByRole('button', { name: 'Add' });\n-  expect(saveButton).toBeEnabled();\n+  await addValidJsonData();\n+\n+  // Wait for validation to complete and button to become enabled\n+  const saveButton = await waitFor(\n+    () => {\n+      const button = screen.getByRole('button', { name: 'Add' });\n+      expect(button).toBeEnabled();\n+      return button;\n+    },\n+    { timeout: 10000 },\n+  );\n \n   await userEvent.click(saveButton);\n \n   await screen.findByRole('dialog');\n-  expect(fetchMock.called()).toBe(true);\n+  await waitFor(() => {\n+    expect(fetchMock.called()).toBe(true);\n+  });\n });\n \n test('applies theme locally when clicking Apply button', async () => {", "pull_request_number": 37378}
{"sha": "3f2db574c7b8e6ed011c8d4190c926dcf9e1a25d", "filename": "superset-frontend/src/features/themes/ThemeModal.tsx", "status": "modified", "additions": 30, "deletions": 26, "changes": 56, "blob_url": "https://github.com/apache/superset/blob/b9929d7895ec23049bed5214ec11b0205b3c337e/superset-frontend%2Fsrc%2Ffeatures%2Fthemes%2FThemeModal.tsx", "raw_url": "https://github.com/apache/superset/raw/b9929d7895ec23049bed5214ec11b0205b3c337e/superset-frontend%2Fsrc%2Ffeatures%2Fthemes%2FThemeModal.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ffeatures%2Fthemes%2FThemeModal.tsx?ref=b9929d7895ec23049bed5214ec11b0205b3c337e", "patch": "@@ -44,8 +44,8 @@ import {\n   Space,\n   Tooltip,\n } from '@superset-ui/core/components';\n-import { useJsonValidation } from '@superset-ui/core/components/AsyncAceEditor';\n import { Typography } from '@superset-ui/core/components/Typography';\n+import { useThemeValidation } from 'src/theme/hooks/useThemeValidation';\n \n import { OnlyKeyWithType } from 'src/utils/types';\n import { ThemeObject } from './types';\n@@ -127,10 +127,9 @@ const ThemeModal: FunctionComponent<ThemeModalProps> = ({\n     SupersetText?.THEME_MODAL?.DOCUMENTATION_URL ||\n     'https://superset.apache.org/docs/configuration/theming/';\n \n-  // JSON validation annotations using reusable hook\n-  const jsonAnnotations = useJsonValidation(currentTheme?.json_data, {\n-    enabled: !isReadOnly,\n-    errorPrefix: 'Invalid JSON syntax',\n+  // Theme validation (structure + token names)\n+  const validation = useThemeValidation(currentTheme?.json_data || '', {\n+    enabled: !isReadOnly && Boolean(currentTheme?.json_data),\n   });\n \n   // theme fetch logic\n@@ -286,27 +285,22 @@ const ThemeModal: FunctionComponent<ThemeModalProps> = ({\n     [currentTheme],\n   );\n \n-  const validate = useCallback(() => {\n-    if (isReadOnly) {\n+  const validate = () => {\n+    if (isReadOnly || !currentTheme) {\n       setDisableSave(true);\n       return;\n     }\n \n-    if (\n-      currentTheme?.theme_name.length &&\n-      currentTheme?.json_data?.length &&\n-      isValidJson(currentTheme.json_data)\n-    ) {\n-      setDisableSave(false);\n-    } else {\n-      setDisableSave(true);\n-    }\n-  }, [\n-    currentTheme?.theme_name,\n-    currentTheme?.json_data,\n-    isReadOnly,\n-    isValidJson,\n-  ]);\n+    const hasValidName = Boolean(currentTheme?.theme_name?.trim());\n+    const hasValidJsonData = Boolean(currentTheme?.json_data?.trim());\n+\n+    // Block save only on ERRORS (not warnings)\n+    // Errors: JSON syntax errors, empty themes\n+    // Warnings: Unknown tokens, null values (non-blocking)\n+    const canSave = hasValidName && hasValidJsonData && !validation.hasErrors;\n+\n+    setDisableSave(!canSave);\n+  };\n \n   // Initialize\n   useEffect(() => {\n@@ -340,7 +334,12 @@ const ThemeModal: FunctionComponent<ThemeModalProps> = ({\n   // Validation\n   useEffect(() => {\n     validate();\n-  }, [validate]);\n+  }, [\n+    currentTheme ? currentTheme.theme_name : '',\n+    currentTheme ? currentTheme.json_data : '',\n+    isReadOnly,\n+    validation.hasErrors,\n+  ]);\n \n   // Show/hide\n   useEffect(() => {\n@@ -470,7 +469,10 @@ const ThemeModal: FunctionComponent<ThemeModalProps> = ({\n                   >\n                     {t('documentation')}\n                   </a>\n-                  {t(' for details.')}\n+                  {t(' for details.')}{' '}\n+                  <Typography.Text type=\"secondary\">\n+                    {t('Unknown tokens will be highlighted as warnings.')}\n+                  </Typography.Text>\n                 </span>\n               }\n             />\n@@ -487,9 +489,10 @@ const ThemeModal: FunctionComponent<ThemeModalProps> = ({\n                 readOnly={isReadOnly}\n                 showGutter\n                 showPrintMargin={false}\n-                annotations={jsonAnnotations}\n+                annotations={validation.annotations}\n               />\n             </StyledJsonEditor>\n+\n             {canDevelopThemes && (\n               <div className=\"apply-button-container\">\n                 <Tooltip\n@@ -501,7 +504,8 @@ const ThemeModal: FunctionComponent<ThemeModalProps> = ({\n                     onClick={onApply}\n                     disabled={\n                       !currentTheme?.json_data ||\n-                      !isValidJson(currentTheme.json_data)\n+                      !isValidJson(currentTheme.json_data) ||\n+                      validation.hasErrors\n                     }\n                     buttonStyle=\"secondary\"\n                   >", "pull_request_number": 37378}
{"sha": "5a34aadc6e7a5134fc89b6de9f86611866bb44be", "filename": "superset-frontend/src/theme/ThemeController.ts", "status": "modified", "additions": 97, "deletions": 18, "changes": 115, "blob_url": "https://github.com/apache/superset/blob/b9929d7895ec23049bed5214ec11b0205b3c337e/superset-frontend%2Fsrc%2Ftheme%2FThemeController.ts", "raw_url": "https://github.com/apache/superset/raw/b9929d7895ec23049bed5214ec11b0205b3c337e/superset-frontend%2Fsrc%2Ftheme%2FThemeController.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ftheme%2FThemeController.ts?ref=b9929d7895ec23049bed5214ec11b0205b3c337e", "patch": "@@ -229,14 +229,8 @@ export class ThemeController {\n         return this.dashboardThemes.get(themeId)!;\n       }\n \n-      // Fetch theme config from API using SupersetClient for proper auth\n-      const getTheme = makeApi<void, { result: { json_data: string } }>({\n-        method: 'GET',\n-        endpoint: `/api/v1/theme/${themeId}`,\n-      });\n-\n-      const { result } = await getTheme();\n-      const themeConfig = JSON.parse(result.json_data);\n+      // Use the enhanced fetchCrudTheme method which includes validation if feature flag is enabled\n+      const themeConfig = await this.fetchCrudTheme(themeId);\n \n       if (themeConfig) {\n         // Controller creates and owns the dashboard theme\n@@ -329,7 +323,6 @@ export class ThemeController {\n \n     const theme: AnyThemeConfig | null = this.getThemeForMode(mode);\n     if (!theme) {\n-      console.warn(`Theme for mode ${mode} not found, falling back to default`);\n       this.fallbackToDefaultMode();\n       return;\n     }\n@@ -535,7 +528,7 @@ export class ThemeController {\n    * Updates the theme.\n    * @param theme - The new theme to apply\n    */\n-  private updateTheme(theme?: AnyThemeConfig): void {\n+  private async updateTheme(theme?: AnyThemeConfig): Promise<void> {\n     try {\n       // If no config provided, use current mode to get theme\n       if (!theme) {\n@@ -551,18 +544,32 @@ export class ThemeController {\n       this.persistMode();\n       this.notifyListeners();\n     } catch (error) {\n-      console.error('Failed to update theme:', error);\n-      this.fallbackToDefaultMode();\n+      await this.fallbackToDefaultMode();\n     }\n   }\n \n   /**\n-   * Fallback to default mode with error recovery.\n+   * Fallback to default mode with runtime error recovery.\n+   * Tries to fetch a fresh system default theme from the API.\n    */\n-  private fallbackToDefaultMode(): void {\n+  private async fallbackToDefaultMode(): Promise<void> {\n     this.currentMode = ThemeMode.DEFAULT;\n \n-    // Get the default theme which will have the correct algorithm\n+    // Try to fetch fresh system default theme from server\n+    const freshSystemTheme = await this.fetchSystemDefaultTheme();\n+\n+    if (freshSystemTheme) {\n+      try {\n+        await this.applyThemeWithRecovery(freshSystemTheme);\n+        this.persistMode();\n+        this.notifyListeners();\n+        return;\n+      } catch (error) {\n+        // Fresh theme also failed, continue to final fallback\n+      }\n+    }\n+\n+    // Final fallback: use cached default theme or built-in theme\n     const defaultTheme: AnyThemeConfig =\n       this.getThemeForMode(ThemeMode.DEFAULT) || this.defaultTheme || {};\n \n@@ -796,10 +803,25 @@ export class ThemeController {\n       this.loadFonts(fontUrls);\n     } catch (error) {\n       console.error('Failed to apply theme:', error);\n-      this.fallbackToDefaultMode();\n+      // Re-throw the error so updateTheme can handle fallback logic\n+      throw error;\n     }\n   }\n \n+  private async applyThemeWithRecovery(theme: AnyThemeConfig): Promise<void> {\n+    // Note: This method re-throws errors to the caller instead of calling\n+    // fallbackToDefaultMode directly, to avoid infinite recursion since\n+    // fallbackToDefaultMode calls this method. The caller's try/catch\n+    // handles the fallback flow.\n+    const normalizedConfig = normalizeThemeConfig(theme);\n+    this.globalTheme.setConfig(normalizedConfig);\n+\n+    // Load custom fonts if specified, mirroring applyTheme() behavior\n+    const fontUrls = (normalizedConfig?.token as Record<string, unknown>)\n+      ?.fontUrls as string[] | undefined;\n+    this.loadFonts(fontUrls);\n+  }\n+\n   /**\n    * Loads custom fonts from theme configuration.\n    * Injects CSS @import statements for font URLs that haven't been loaded yet.\n@@ -896,25 +918,82 @@ export class ThemeController {\n   /**\n    * Fetches a theme configuration from the CRUD API.\n    * @param themeId - The ID of the theme to fetch\n-   * @returns The theme configuration or null if not found\n+   * @returns The theme configuration or null if fetch fails\n    */\n   private async fetchCrudTheme(\n     themeId: string,\n   ): Promise<AnyThemeConfig | null> {\n     try {\n       // Use SupersetClient for proper authentication handling\n-      const getTheme = makeApi<void, { result: { json_data: string } }>({\n+      const getTheme = makeApi<\n+        void,\n+        { result: { json_data: string; theme_name?: string } }\n+      >({\n         method: 'GET',\n         endpoint: `/api/v1/theme/${themeId}`,\n       });\n \n       const { result } = await getTheme();\n       const themeConfig = JSON.parse(result.json_data);\n \n+      if (!themeConfig || typeof themeConfig !== 'object') {\n+        console.error(`Invalid theme configuration for theme ${themeId}`);\n+        return null;\n+      }\n+\n+      // Return theme as-is\n+      // Invalid tokens will be handled by Ant Design at runtime\n+      // Runtime errors will be caught by applyThemeWithRecovery()\n       return themeConfig;\n     } catch (error) {\n       console.error('Failed to fetch CRUD theme:', error);\n       return null;\n     }\n   }\n+\n+  /**\n+   * Fetches a fresh system default theme from the API for runtime recovery.\n+   * Tries multiple fallback strategies to find a valid theme.\n+   *\n+   * Note: Uses raw fetch() instead of SupersetClient because ThemeController\n+   * initializes early in the app lifecycle, before SupersetClient is fully\n+   * configured. This avoids boot-time circular dependencies.\n+   *\n+   * @returns The system default theme configuration or null if not found\n+   */\n+  private async fetchSystemDefaultTheme(): Promise<AnyThemeConfig | null> {\n+    try {\n+      // Try to fetch theme marked as system default (is_system_default=true)\n+      const defaultResponse = await fetch(\n+        '/api/v1/theme/?q=(filters:!((col:is_system_default,opr:eq,value:!t)))',\n+      );\n+      if (defaultResponse.ok) {\n+        const data = await defaultResponse.json();\n+        if (data.result?.length > 0) {\n+          const themeConfig = JSON.parse(data.result[0].json_data);\n+          if (themeConfig && typeof themeConfig === 'object') {\n+            return themeConfig;\n+          }\n+        }\n+      }\n+\n+      // Fallback: Try to fetch system theme named 'THEME_DEFAULT'\n+      const fallbackResponse = await fetch(\n+        '/api/v1/theme/?q=(filters:!((col:theme_name,opr:eq,value:THEME_DEFAULT),(col:is_system,opr:eq,value:!t)))',\n+      );\n+      if (fallbackResponse.ok) {\n+        const fallbackData = await fallbackResponse.json();\n+        if (fallbackData.result?.length > 0) {\n+          const themeConfig = JSON.parse(fallbackData.result[0].json_data);\n+          if (themeConfig && typeof themeConfig === 'object') {\n+            return themeConfig;\n+          }\n+        }\n+      }\n+    } catch (error) {\n+      // Silently handle fetch errors\n+    }\n+\n+    return null;\n+  }\n }", "pull_request_number": 37378}
{"sha": "a0bf70539b12fd924e69af4f141e2a83810de1cc", "filename": "superset-frontend/src/theme/hooks/useThemeValidation.test.ts", "status": "added", "additions": 133, "deletions": 0, "changes": 133, "blob_url": "https://github.com/apache/superset/blob/b9929d7895ec23049bed5214ec11b0205b3c337e/superset-frontend%2Fsrc%2Ftheme%2Fhooks%2FuseThemeValidation.test.ts", "raw_url": "https://github.com/apache/superset/raw/b9929d7895ec23049bed5214ec11b0205b3c337e/superset-frontend%2Fsrc%2Ftheme%2Fhooks%2FuseThemeValidation.test.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ftheme%2Fhooks%2FuseThemeValidation.test.ts?ref=b9929d7895ec23049bed5214ec11b0205b3c337e", "patch": "@@ -0,0 +1,133 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import { renderHook } from '@testing-library/react-hooks';\n+import { useThemeValidation } from './useThemeValidation';\n+\n+test('useThemeValidation validates valid theme with standard tokens', () => {\n+  const validTheme = JSON.stringify({\n+    token: {\n+      colorPrimary: '#1890ff',\n+      fontSize: 14,\n+    },\n+  });\n+\n+  const { result } = renderHook(() => useThemeValidation(validTheme));\n+\n+  expect(result.current.hasErrors).toBe(false);\n+  expect(result.current.hasWarnings).toBe(false);\n+  expect(result.current.annotations).toHaveLength(0);\n+});\n+\n+test('useThemeValidation shows warnings for unknown tokens', () => {\n+  const themeWithUnknownToken = JSON.stringify({\n+    token: {\n+      colorPrimary: '#1890ff',\n+      unknownToken: 'value',\n+    },\n+  });\n+\n+  const { result } = renderHook(() =>\n+    useThemeValidation(themeWithUnknownToken),\n+  );\n+\n+  expect(result.current.hasErrors).toBe(false);\n+  expect(result.current.hasWarnings).toBe(true);\n+  expect(result.current.annotations.length).toBeGreaterThan(0);\n+  expect(result.current.annotations[0].type).toBe('warning');\n+});\n+\n+test('useThemeValidation shows error for empty theme', () => {\n+  const emptyTheme = JSON.stringify({});\n+\n+  const { result } = renderHook(() => useThemeValidation(emptyTheme));\n+\n+  expect(result.current.hasErrors).toBe(true);\n+  expect(result.current.annotations.length).toBeGreaterThan(0);\n+  expect(result.current.annotations[0].type).toBe('error');\n+  expect(result.current.annotations[0].text).toContain('cannot be empty');\n+});\n+\n+test('useThemeValidation shows error for invalid JSON syntax', () => {\n+  const invalidJson = '{invalid json}';\n+\n+  const { result } = renderHook(() => useThemeValidation(invalidJson));\n+\n+  expect(result.current.hasErrors).toBe(true);\n+  expect(result.current.annotations.length).toBeGreaterThan(0);\n+  expect(result.current.annotations[0].type).toBe('error');\n+});\n+\n+test('useThemeValidation skips validation for empty string', () => {\n+  const { result } = renderHook(() => useThemeValidation(''));\n+\n+  expect(result.current.hasErrors).toBe(false);\n+  expect(result.current.hasWarnings).toBe(false);\n+  expect(result.current.annotations).toHaveLength(0);\n+});\n+\n+test('useThemeValidation validates Superset custom tokens', () => {\n+  const themeWithCustomToken = JSON.stringify({\n+    token: {\n+      brandLogoUrl: '/static/logo.png',\n+      brandSpinnerSvg: '<svg></svg>',\n+    },\n+  });\n+\n+  const { result } = renderHook(() => useThemeValidation(themeWithCustomToken));\n+\n+  expect(result.current.hasErrors).toBe(false);\n+  expect(result.current.hasWarnings).toBe(false);\n+  expect(result.current.annotations).toHaveLength(0);\n+});\n+\n+test('useThemeValidation allows theme with only algorithm', () => {\n+  const themeWithAlgorithm = JSON.stringify({\n+    algorithm: 'dark',\n+  });\n+\n+  const { result } = renderHook(() => useThemeValidation(themeWithAlgorithm));\n+\n+  expect(result.current.hasErrors).toBe(false);\n+  expect(result.current.annotations).toHaveLength(0);\n+});\n+\n+test('useThemeValidation shows warning for null token value', () => {\n+  const themeWithNullValue = JSON.stringify({\n+    token: {\n+      colorPrimary: null,\n+    },\n+  });\n+\n+  const { result } = renderHook(() => useThemeValidation(themeWithNullValue));\n+\n+  expect(result.current.hasErrors).toBe(false);\n+  expect(result.current.hasWarnings).toBe(true);\n+  expect(result.current.annotations[0].type).toBe('warning');\n+  expect(result.current.annotations[0].text).toContain('null/undefined');\n+});\n+\n+test('useThemeValidation respects enabled option', () => {\n+  const invalidJson = '{invalid}';\n+\n+  const { result } = renderHook(() =>\n+    useThemeValidation(invalidJson, { enabled: false }),\n+  );\n+\n+  expect(result.current.annotations).toHaveLength(0);\n+});", "pull_request_number": 37378}
{"sha": "4b8b5bd0b61694b8b962d583eb2209b8a85b5e8e", "filename": "superset-frontend/src/theme/hooks/useThemeValidation.ts", "status": "added", "additions": 155, "deletions": 0, "changes": 155, "blob_url": "https://github.com/apache/superset/blob/b9929d7895ec23049bed5214ec11b0205b3c337e/superset-frontend%2Fsrc%2Ftheme%2Fhooks%2FuseThemeValidation.ts", "raw_url": "https://github.com/apache/superset/raw/b9929d7895ec23049bed5214ec11b0205b3c337e/superset-frontend%2Fsrc%2Ftheme%2Fhooks%2FuseThemeValidation.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ftheme%2Fhooks%2FuseThemeValidation.ts?ref=b9929d7895ec23049bed5214ec11b0205b3c337e", "patch": "@@ -0,0 +1,155 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import { useMemo, useState, useEffect } from 'react';\n+import { useJsonValidation } from '@superset-ui/core/components/AsyncAceEditor';\n+import type { JsonValidationAnnotation } from '@superset-ui/core/components/AsyncAceEditor';\n+import type { AnyThemeConfig } from '@apache-superset/core/ui';\n+import { validateTheme } from '../utils/themeStructureValidation';\n+\n+/**\n+ * Find the line number where a specific token appears in JSON string.\n+ * Uses improved logic to handle nested objects and avoid false positives.\n+ */\n+function findTokenLineInJson(jsonString: string, tokenName: string): number {\n+  if (!jsonString || !tokenName) {\n+    return 0;\n+  }\n+\n+  // Handle special _root token for structural errors\n+  if (tokenName === '_root') {\n+    return 0;\n+  }\n+\n+  const lines = jsonString.split('\\n');\n+\n+  // Look for the token name as a JSON property key\n+  // Pattern: \"tokenName\" followed by : (with possible whitespace)\n+  const propertyPattern = new RegExp(\n+    `\"${tokenName.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}\"\\\\s*:`,\n+  );\n+\n+  for (let i = 0; i < lines.length; i += 1) {\n+    if (propertyPattern.test(lines[i].trim())) {\n+      return i; // Return 0-based line number for AceEditor\n+    }\n+  }\n+\n+  // Fallback: simple string search for edge cases\n+  const searchPattern = `\"${tokenName}\"`;\n+  for (let i = 0; i < lines.length; i += 1) {\n+    if (lines[i].includes(searchPattern)) {\n+      return i;\n+    }\n+  }\n+\n+  // If token not found, return line 0\n+  return 0;\n+}\n+\n+export interface ThemeValidationResult {\n+  annotations: JsonValidationAnnotation[];\n+  hasErrors: boolean; // true if errors exist (blocks save)\n+  hasWarnings: boolean; // true if warnings exist (non-blocking)\n+}\n+\n+export interface UseThemeValidationOptions {\n+  /** Whether to enable validation. Default: true */\n+  enabled?: boolean;\n+  /** Debounce delay in milliseconds for validation. Default: 300 */\n+  debounceMs?: number;\n+}\n+\n+/**\n+ * Theme validation hook with live feedback.\n+ * - Errors (JSON syntax, empty theme) block save/apply\n+ * - Warnings (unknown tokens, null values) allow save/apply\n+ *\n+ * This hook validates structure and token names only.\n+ * Token values are validated by Ant Design at runtime.\n+ */\n+export function useThemeValidation(\n+  jsonValue?: string,\n+  options: UseThemeValidationOptions = {},\n+): ThemeValidationResult {\n+  const { enabled = true, debounceMs = 300 } = options;\n+\n+  const [debouncedValue, setDebouncedValue] = useState(jsonValue);\n+\n+  // Debounce for performance\n+  useEffect(() => {\n+    const timer = setTimeout(() => setDebouncedValue(jsonValue), debounceMs);\n+    return () => clearTimeout(timer);\n+  }, [jsonValue, debounceMs]);\n+\n+  // JSON syntax validation (ERRORS)\n+  const jsonAnnotations = useJsonValidation(debouncedValue, {\n+    enabled,\n+    errorPrefix: 'Invalid JSON',\n+  });\n+\n+  // Theme structure validation (ERRORS + WARNINGS)\n+  const themeAnnotations = useMemo(() => {\n+    // Skip if disabled or JSON is invalid\n+    if (!enabled || jsonAnnotations.length > 0 || !debouncedValue?.trim()) {\n+      return [];\n+    }\n+\n+    try {\n+      const config: AnyThemeConfig = JSON.parse(debouncedValue);\n+      const result = validateTheme(config);\n+\n+      const annotations: JsonValidationAnnotation[] = [];\n+\n+      // Convert errors to annotations (blocks save)\n+      result.errors.forEach(issue => {\n+        annotations.push({\n+          type: 'error',\n+          row: findTokenLineInJson(debouncedValue, issue.tokenName),\n+          column: 0,\n+          text: issue.message,\n+        });\n+      });\n+\n+      // Convert warnings to annotations (non-blocking)\n+      result.warnings.forEach(issue => {\n+        annotations.push({\n+          type: 'warning',\n+          row: findTokenLineInJson(debouncedValue, issue.tokenName),\n+          column: 0,\n+          text: issue.message,\n+        });\n+      });\n+\n+      return annotations;\n+    } catch {\n+      // JSON parsing error already caught by jsonAnnotations\n+      return [];\n+    }\n+  }, [enabled, debouncedValue, jsonAnnotations]);\n+\n+  return useMemo(() => {\n+    const allAnnotations = [...jsonAnnotations, ...themeAnnotations];\n+\n+    return {\n+      annotations: allAnnotations,\n+      hasErrors: allAnnotations.some(a => a.type === 'error'),\n+      hasWarnings: allAnnotations.some(a => a.type === 'warning'),\n+    };\n+  }, [jsonAnnotations, themeAnnotations]);\n+}", "pull_request_number": 37378}
{"sha": "e38384edc7db72a158bc2e653af614843c901ae7", "filename": "superset-frontend/src/theme/utils/antdTokenNames.test.ts", "status": "added", "additions": 102, "deletions": 0, "changes": 102, "blob_url": "https://github.com/apache/superset/blob/b9929d7895ec23049bed5214ec11b0205b3c337e/superset-frontend%2Fsrc%2Ftheme%2Futils%2FantdTokenNames.test.ts", "raw_url": "https://github.com/apache/superset/raw/b9929d7895ec23049bed5214ec11b0205b3c337e/superset-frontend%2Fsrc%2Ftheme%2Futils%2FantdTokenNames.test.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ftheme%2Futils%2FantdTokenNames.test.ts?ref=b9929d7895ec23049bed5214ec11b0205b3c337e", "patch": "@@ -0,0 +1,102 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import {\n+  isValidTokenName,\n+  isSupersetCustomToken,\n+  getAllValidTokenNames,\n+} from './antdTokenNames';\n+\n+test('isValidTokenName recognizes standard Ant Design tokens', () => {\n+  expect(isValidTokenName('colorPrimary')).toBe(true);\n+  expect(isValidTokenName('fontSize')).toBe(true);\n+  expect(isValidTokenName('padding')).toBe(true);\n+  expect(isValidTokenName('borderRadius')).toBe(true);\n+});\n+\n+test('isValidTokenName recognizes Superset custom tokens', () => {\n+  expect(isValidTokenName('brandLogoUrl')).toBe(true);\n+  expect(isValidTokenName('brandSpinnerSvg')).toBe(true);\n+  expect(isValidTokenName('fontSizeXS')).toBe(true);\n+  expect(isValidTokenName('echartsOptionsOverrides')).toBe(true);\n+});\n+\n+test('isValidTokenName rejects unknown tokens', () => {\n+  expect(isValidTokenName('fooBarBaz')).toBe(false);\n+  expect(isValidTokenName('colrPrimary')).toBe(false);\n+  expect(isValidTokenName('invalidToken')).toBe(false);\n+});\n+\n+test('isValidTokenName handles edge cases', () => {\n+  expect(isValidTokenName('')).toBe(false);\n+  expect(isValidTokenName('  ')).toBe(false);\n+});\n+\n+test('isSupersetCustomToken identifies Superset-specific tokens', () => {\n+  expect(isSupersetCustomToken('brandLogoUrl')).toBe(true);\n+  expect(isSupersetCustomToken('brandSpinnerSvg')).toBe(true);\n+  expect(isSupersetCustomToken('fontSizeXS')).toBe(true);\n+});\n+\n+test('isSupersetCustomToken returns false for Ant Design tokens', () => {\n+  expect(isSupersetCustomToken('colorPrimary')).toBe(false);\n+  expect(isSupersetCustomToken('fontSize')).toBe(false);\n+});\n+\n+test('isSupersetCustomToken returns false for unknown tokens', () => {\n+  expect(isSupersetCustomToken('fooBar')).toBe(false);\n+});\n+\n+test('getAllValidTokenNames returns categorized token names', () => {\n+  const result = getAllValidTokenNames();\n+\n+  expect(result).toHaveProperty('antdTokens');\n+  expect(result).toHaveProperty('supersetTokens');\n+  expect(result).toHaveProperty('total');\n+});\n+\n+test('getAllValidTokenNames has reasonable token counts', () => {\n+  const result = getAllValidTokenNames();\n+\n+  // Ant Design has ~500+ tokens\n+  expect(result.antdTokens.length).toBeGreaterThan(400);\n+\n+  // Superset has 15 custom tokens (from SupersetSpecificTokens interface)\n+  expect(result.supersetTokens.length).toBe(15);\n+\n+  // Total should be sum of both\n+  expect(result.total).toBe(\n+    result.antdTokens.length + result.supersetTokens.length,\n+  );\n+});\n+\n+test('getAllValidTokenNames includes known Superset tokens', () => {\n+  const result = getAllValidTokenNames();\n+\n+  expect(result.supersetTokens).toContain('brandLogoUrl');\n+  expect(result.supersetTokens).toContain('brandSpinnerSvg');\n+  expect(result.supersetTokens).toContain('fontSizeXS');\n+});\n+\n+test('getAllValidTokenNames includes known Ant Design tokens', () => {\n+  const result = getAllValidTokenNames();\n+\n+  expect(result.antdTokens).toContain('colorPrimary');\n+  expect(result.antdTokens).toContain('fontSize');\n+  expect(result.antdTokens).toContain('padding');\n+});", "pull_request_number": 37378}
{"sha": "b31713b044da9415cec4070b1dfb9a5432d560f6", "filename": "superset-frontend/src/theme/utils/antdTokenNames.ts", "status": "added", "additions": 113, "deletions": 0, "changes": 113, "blob_url": "https://github.com/apache/superset/blob/b9929d7895ec23049bed5214ec11b0205b3c337e/superset-frontend%2Fsrc%2Ftheme%2Futils%2FantdTokenNames.ts", "raw_url": "https://github.com/apache/superset/raw/b9929d7895ec23049bed5214ec11b0205b3c337e/superset-frontend%2Fsrc%2Ftheme%2Futils%2FantdTokenNames.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ftheme%2Futils%2FantdTokenNames.ts?ref=b9929d7895ec23049bed5214ec11b0205b3c337e", "patch": "@@ -0,0 +1,113 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import { theme } from 'antd';\n+\n+/**\n+ * Superset-specific custom tokens that extend Ant Design's token system.\n+ * These keys are derived from the SupersetSpecificTokens interface to ensure consistency.\n+ */\n+const SUPERSET_CUSTOM_TOKENS: Set<string> = new Set([\n+  // Font extensions\n+  'fontSizeXS',\n+  'fontSizeXXL',\n+  'fontWeightNormal',\n+  'fontWeightLight',\n+  'fontWeightStrong',\n+\n+  // Brand tokens\n+  'brandIconMaxWidth',\n+  'brandLogoAlt',\n+  'brandLogoUrl',\n+  'brandLogoMargin',\n+  'brandLogoHref',\n+  'brandLogoHeight',\n+\n+  // Spinner tokens\n+  'brandSpinnerUrl',\n+  'brandSpinnerSvg',\n+\n+  // ECharts tokens\n+  'echartsOptionsOverrides',\n+  'echartsOptionsOverridesByChartType',\n+]);\n+\n+/**\n+ * Lazy-loaded cache of valid token names.\n+ * Combines Ant Design tokens (extracted at runtime) + Superset custom tokens.\n+ */\n+let validTokenNamesCache: Set<string> | undefined;\n+\n+/**\n+ * Get all valid token names (Ant Design + Superset custom).\n+ * Uses lazy loading and caching for performance.\n+ */\n+function getValidTokenNames(): Set<string> {\n+  if (validTokenNamesCache === undefined) {\n+    // Extract all token names from Ant Design's default theme\n+    const antdTokens = theme.getDesignToken();\n+    const antdTokenNames = Object.keys(antdTokens);\n+\n+    // Combine with Superset custom tokens\n+    validTokenNamesCache = new Set([\n+      ...antdTokenNames,\n+      ...SUPERSET_CUSTOM_TOKENS,\n+    ]);\n+  }\n+  return validTokenNamesCache as Set<string>;\n+}\n+\n+/**\n+ * Check if a token name is valid (recognized by Ant Design OR Superset).\n+ * @param tokenName - The token name to validate\n+ * @returns true if the token is recognized, false otherwise\n+ */\n+export function isValidTokenName(tokenName: string): boolean {\n+  return getValidTokenNames().has(tokenName);\n+}\n+\n+/**\n+ * Check if a token is a Superset custom token (not from Ant Design).\n+ * @param tokenName - The token name to check\n+ * @returns true if it's a Superset-specific token\n+ */\n+export function isSupersetCustomToken(tokenName: string): boolean {\n+  return SUPERSET_CUSTOM_TOKENS.has(tokenName);\n+}\n+\n+/**\n+ * Get all valid token names, categorized by source.\n+ * Useful for debugging and testing.\n+ */\n+export function getAllValidTokenNames(): {\n+  antdTokens: string[];\n+  supersetTokens: string[];\n+  total: number;\n+} {\n+  const allTokens = getValidTokenNames();\n+  const antdTokens = Array.from(allTokens).filter(\n+    t => !isSupersetCustomToken(t),\n+  );\n+  const supersetTokens: string[] = Array.from(SUPERSET_CUSTOM_TOKENS);\n+\n+  return {\n+    antdTokens,\n+    supersetTokens,\n+    total: allTokens.size,\n+  };\n+}", "pull_request_number": 37378}
{"sha": "7e9687ca5e7c72282feeb4b1086122cb37840171", "filename": "superset-frontend/src/theme/utils/themeStructureValidation.test.ts", "status": "added", "additions": 184, "deletions": 0, "changes": 184, "blob_url": "https://github.com/apache/superset/blob/b9929d7895ec23049bed5214ec11b0205b3c337e/superset-frontend%2Fsrc%2Ftheme%2Futils%2FthemeStructureValidation.test.ts", "raw_url": "https://github.com/apache/superset/raw/b9929d7895ec23049bed5214ec11b0205b3c337e/superset-frontend%2Fsrc%2Ftheme%2Futils%2FthemeStructureValidation.test.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ftheme%2Futils%2FthemeStructureValidation.test.ts?ref=b9929d7895ec23049bed5214ec11b0205b3c337e", "patch": "@@ -0,0 +1,184 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import type { AnyThemeConfig } from '@apache-superset/core/ui';\n+import { validateTheme } from './themeStructureValidation';\n+\n+test('validateTheme validates a valid theme with standard tokens', () => {\n+  const theme: AnyThemeConfig = {\n+    token: {\n+      colorPrimary: '#1890ff',\n+      fontSize: 14,\n+    },\n+  };\n+\n+  const result = validateTheme(theme);\n+\n+  expect(result.valid).toBe(true);\n+  expect(result.errors).toHaveLength(0);\n+  expect(result.warnings).toHaveLength(0);\n+});\n+\n+test('validateTheme validates a theme with Superset custom tokens', () => {\n+  const theme: AnyThemeConfig = {\n+    token: {\n+      colorPrimary: '#1890ff',\n+      brandLogoUrl: '/static/logo.png',\n+      brandSpinnerSvg: '<svg></svg>',\n+    },\n+  };\n+\n+  const result = validateTheme(theme);\n+\n+  expect(result.valid).toBe(true);\n+  expect(result.errors).toHaveLength(0);\n+  expect(result.warnings).toHaveLength(0);\n+});\n+\n+test('validateTheme warns about unknown token names', () => {\n+  const theme: AnyThemeConfig = {\n+    token: {\n+      colorPrimary: '#1890ff',\n+      fooBarBaz: 'invalid',\n+      colrPrimary: '#ff0000', // Typo\n+    },\n+  };\n+\n+  const result = validateTheme(theme);\n+\n+  expect(result.valid).toBe(true); // Warnings don't block\n+  expect(result.errors).toHaveLength(0);\n+  expect(result.warnings).toHaveLength(2);\n+  expect(result.warnings[0].tokenName).toBe('fooBarBaz');\n+  expect(result.warnings[1].tokenName).toBe('colrPrimary');\n+  expect(result.warnings[0].severity).toBe('warning');\n+});\n+\n+test('validateTheme warns about null/undefined token values', () => {\n+  const theme: AnyThemeConfig = {\n+    token: {\n+      colorPrimary: null,\n+      fontSize: undefined,\n+    },\n+  };\n+\n+  const result = validateTheme(theme);\n+\n+  expect(result.valid).toBe(true);\n+  expect(result.warnings).toHaveLength(2);\n+  expect(result.warnings[0].message).toContain('null/undefined');\n+  expect(result.warnings[1].message).toContain('null/undefined');\n+});\n+\n+test('validateTheme errors on empty theme object', () => {\n+  const theme: AnyThemeConfig = {};\n+\n+  const result = validateTheme(theme);\n+\n+  expect(result.valid).toBe(false);\n+  expect(result.errors).toHaveLength(1);\n+  expect(result.errors[0].tokenName).toBe('_root');\n+  expect(result.errors[0].message).toContain('cannot be empty');\n+});\n+\n+test('validateTheme errors on null theme config', () => {\n+  const result = validateTheme(null as any);\n+\n+  expect(result.valid).toBe(false);\n+  expect(result.errors).toHaveLength(1);\n+  expect(result.errors[0].message).toContain('must be a valid object');\n+});\n+\n+test('validateTheme allows theme with only algorithm', () => {\n+  const theme: AnyThemeConfig = {\n+    algorithm: 'dark' as any,\n+  };\n+\n+  const result = validateTheme(theme);\n+\n+  expect(result.valid).toBe(true);\n+  expect(result.errors).toHaveLength(0);\n+});\n+\n+test('validateTheme allows theme with only components', () => {\n+  const theme: AnyThemeConfig = {\n+    components: {\n+      Button: {\n+        colorPrimary: '#1890ff',\n+      },\n+    },\n+  };\n+\n+  const result = validateTheme(theme);\n+\n+  expect(result.valid).toBe(true);\n+  expect(result.errors).toHaveLength(0);\n+});\n+\n+test('validateTheme errors on theme with empty token object but no algorithm or components', () => {\n+  const theme: AnyThemeConfig = {\n+    token: {},\n+  };\n+\n+  const result = validateTheme(theme);\n+\n+  expect(result.valid).toBe(false);\n+  expect(result.errors).toHaveLength(1);\n+  expect(result.errors[0].message).toContain('cannot be empty');\n+});\n+\n+test('validateTheme combines errors and warnings correctly', () => {\n+  const theme: AnyThemeConfig = {\n+    token: {\n+      colorPrimary: '#1890ff',\n+      unknownToken: 'value',\n+      nullToken: null,\n+    },\n+  };\n+\n+  const result = validateTheme(theme);\n+\n+  expect(result.valid).toBe(true); // No errors, just warnings\n+  expect(result.errors).toHaveLength(0);\n+  expect(result.warnings.length).toBeGreaterThan(0);\n+});\n+\n+test('validateTheme errors when token is an array instead of object', () => {\n+  const theme = {\n+    token: ['colorPrimary', '#1890ff'],\n+  } as unknown as AnyThemeConfig;\n+\n+  const result = validateTheme(theme);\n+\n+  expect(result.valid).toBe(false);\n+  expect(result.errors).toHaveLength(1);\n+  expect(result.errors[0].tokenName).toBe('_root');\n+  expect(result.errors[0].message).toContain('must be an object');\n+});\n+\n+test('validateTheme errors when token is a string instead of object', () => {\n+  const theme = {\n+    token: 'colorPrimary',\n+  } as unknown as AnyThemeConfig;\n+\n+  const result = validateTheme(theme);\n+\n+  expect(result.valid).toBe(false);\n+  expect(result.errors).toHaveLength(1);\n+  expect(result.errors[0].message).toContain('must be an object');\n+});", "pull_request_number": 37378}
{"sha": "6da0656a2ad28dd0d2fcee8f61e29992958761c1", "filename": "superset-frontend/src/theme/utils/themeStructureValidation.ts", "status": "added", "additions": 116, "deletions": 0, "changes": 116, "blob_url": "https://github.com/apache/superset/blob/b9929d7895ec23049bed5214ec11b0205b3c337e/superset-frontend%2Fsrc%2Ftheme%2Futils%2FthemeStructureValidation.ts", "raw_url": "https://github.com/apache/superset/raw/b9929d7895ec23049bed5214ec11b0205b3c337e/superset-frontend%2Fsrc%2Ftheme%2Futils%2FthemeStructureValidation.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ftheme%2Futils%2FthemeStructureValidation.ts?ref=b9929d7895ec23049bed5214ec11b0205b3c337e", "patch": "@@ -0,0 +1,116 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import type { AnyThemeConfig } from '@apache-superset/core/ui';\n+import { isValidTokenName } from './antdTokenNames';\n+\n+export interface ValidationIssue {\n+  tokenName: string;\n+  severity: 'error' | 'warning';\n+  message: string;\n+}\n+\n+export interface ValidationResult {\n+  valid: boolean; // false if ANY errors exist (warnings don't affect this)\n+  errors: ValidationIssue[];\n+  warnings: ValidationIssue[];\n+}\n+\n+/**\n+ * Validates theme structure and token names.\n+ * - ERRORS block save/apply (invalid structure, empty themes)\n+ * - WARNINGS allow save/apply but show in editor (unknown tokens, null values)\n+ *\n+ * This validation does NOT check token values - Ant Design handles that at runtime.\n+ */\n+export function validateTheme(themeConfig: AnyThemeConfig): ValidationResult {\n+  const errors: ValidationIssue[] = [];\n+  const warnings: ValidationIssue[] = [];\n+\n+  // ERROR: Null/invalid config\n+  if (!themeConfig || typeof themeConfig !== 'object') {\n+    errors.push({\n+      tokenName: '_root',\n+      severity: 'error',\n+      message: 'Theme configuration must be a valid object',\n+    });\n+    return { valid: false, errors, warnings };\n+  }\n+\n+  // ERROR: Empty theme (no tokens, no algorithm, no components)\n+  const hasTokens =\n+    themeConfig.token && Object.keys(themeConfig.token).length > 0;\n+  const hasAlgorithm = Boolean(themeConfig.algorithm);\n+  const hasComponents =\n+    themeConfig.components && Object.keys(themeConfig.components).length > 0;\n+\n+  if (!hasTokens && !hasAlgorithm && !hasComponents) {\n+    errors.push({\n+      tokenName: '_root',\n+      severity: 'error',\n+      message:\n+        'Theme cannot be empty. Add at least one token, algorithm, or component override.',\n+    });\n+    return { valid: false, errors, warnings };\n+  }\n+\n+  // WARNING: Unknown token names (likely typos)\n+  // Guard against non-object token values (e.g., string, array, number)\n+  const rawToken = themeConfig.token;\n+  const tokens =\n+    rawToken && typeof rawToken === 'object' && !Array.isArray(rawToken)\n+      ? rawToken\n+      : {};\n+\n+  if (rawToken && tokens !== rawToken) {\n+    errors.push({\n+      tokenName: '_root',\n+      severity: 'error',\n+      message:\n+        'Token configuration must be an object, not an array or primitive',\n+    });\n+    return { valid: false, errors, warnings };\n+  }\n+\n+  Object.entries(tokens).forEach(([name, value]) => {\n+    // Null/undefined check\n+    if (value === null || value === undefined) {\n+      warnings.push({\n+        tokenName: name,\n+        severity: 'warning',\n+        message: `Token '${name}' has null/undefined value`,\n+      });\n+      return;\n+    }\n+\n+    // Token name validation\n+    if (!isValidTokenName(name)) {\n+      warnings.push({\n+        tokenName: name,\n+        severity: 'warning',\n+        message: `Unknown token '${name}' - may be ignored by Ant Design`,\n+      });\n+    }\n+  });\n+\n+  return {\n+    valid: errors.length === 0,\n+    errors,\n+    warnings,\n+  };\n+}", "pull_request_number": 37378}
{"sha": "7657d8ea9bce1fe7a413d493df71eefaa5474cb3", "filename": "superset-frontend/src/dashboard/components/gridComponents/Divider/Divider.test.tsx", "status": "renamed", "additions": 7, "deletions": 10, "changes": 17, "blob_url": "https://github.com/apache/superset/blob/b1debc6ab886f65618256a386c4ab9af8495a89f/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FgridComponents%2FDivider%2FDivider.test.tsx", "raw_url": "https://github.com/apache/superset/raw/b1debc6ab886f65618256a386c4ab9af8495a89f/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FgridComponents%2FDivider%2FDivider.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FgridComponents%2FDivider%2FDivider.test.tsx?ref=b1debc6ab886f65618256a386c4ab9af8495a89f", "patch": "@@ -24,26 +24,24 @@ import {\n   DASHBOARD_GRID_TYPE,\n } from 'src/dashboard/util/componentTypes';\n import { screen, render, userEvent } from 'spec/helpers/testing-library';\n-import Divider from './Divider';\n+import Divider, { DividerProps } from './Divider';\n \n-// eslint-disable-next-line no-restricted-globals -- TODO: Migrate from describe blocks\n+// eslint-disable-next-line no-restricted-globals -- TODO: migrate from describe blocks\n describe('Divider', () => {\n-  const props = {\n+  const baseProps: DividerProps = {\n     id: 'id',\n     parentId: 'parentId',\n     component: newComponentFactory(DIVIDER_TYPE),\n     depth: 1,\n     parentComponent: newComponentFactory(DASHBOARD_GRID_TYPE),\n     index: 0,\n     editMode: false,\n-    handleComponentDrop() {},\n-    deleteComponent() {},\n+    handleComponentDrop: jest.fn(),\n+    deleteComponent: (id: string, parentId: string) => {},\n   };\n \n-  const setup = overrideProps =>\n-    // We have to wrap provide DragDropContext for the underlying DragDroppable\n-    // otherwise we cannot assert on DragDroppable children\n-    render(<Divider {...props} {...overrideProps} />, {\n+  const setup = (overrideProps: Partial<DividerProps> = {}) =>\n+    render(<Divider {...baseProps} {...overrideProps} />, {\n       useDnd: true,\n     });\n \n@@ -64,7 +62,6 @@ describe('Divider', () => {\n     expect(screen.queryByTestId('hover-menu')).not.toBeInTheDocument();\n     expect(screen.queryByRole('button')).not.toBeInTheDocument();\n \n-    // we cannot set props on the Divider because of the WithDragDropContext wrapper\n     setup({ editMode: true });\n     expect(screen.getByTestId('hover-menu')).toBeInTheDocument();\n     expect(screen.getByRole('button').firstChild).toHaveAttribute(", "previous_filename": "superset-frontend/src/dashboard/components/gridComponents/Divider/Divider.test.jsx", "pull_request_number": 36335}
{"sha": "a241f3dd6271705a50e9ecb0638abb4bd061b571", "filename": "superset-frontend/src/dashboard/components/gridComponents/Divider/Divider.tsx", "status": "renamed", "additions": 18, "deletions": 19, "changes": 37, "blob_url": "https://github.com/apache/superset/blob/b1debc6ab886f65618256a386c4ab9af8495a89f/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FgridComponents%2FDivider%2FDivider.tsx", "raw_url": "https://github.com/apache/superset/raw/b1debc6ab886f65618256a386c4ab9af8495a89f/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FgridComponents%2FDivider%2FDivider.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FgridComponents%2FDivider%2FDivider.tsx?ref=b1debc6ab886f65618256a386c4ab9af8495a89f", "patch": "@@ -16,31 +16,32 @@\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n+\n import { PureComponent } from 'react';\n-import PropTypes from 'prop-types';\n import { css, styled } from '@apache-superset/core/ui';\n \n import { Draggable } from '../../dnd/DragDroppable';\n import HoverMenu from '../../menu/HoverMenu';\n import DeleteComponentButton from '../../DeleteComponentButton';\n-import { componentShape } from '../../../util/propShapes';\n+import type { ConnectDragSource } from 'react-dnd';\n+import type { LayoutItem } from 'src/dashboard/types';\n \n-const propTypes = {\n-  id: PropTypes.string.isRequired,\n-  parentId: PropTypes.string.isRequired,\n-  component: componentShape.isRequired,\n-  depth: PropTypes.number.isRequired,\n-  parentComponent: componentShape.isRequired,\n-  index: PropTypes.number.isRequired,\n-  editMode: PropTypes.bool.isRequired,\n-  handleComponentDrop: PropTypes.func.isRequired,\n-  deleteComponent: PropTypes.func.isRequired,\n-};\n+export interface DividerProps {\n+  id: string;\n+  parentId: string;\n+  component: LayoutItem;\n+  depth: number;\n+  parentComponent: LayoutItem;\n+  index: number;\n+  editMode: boolean;\n+  handleComponentDrop: (dropResult: unknown) => void;\n+  deleteComponent: (id: string, parentId: string) => void;\n+}\n \n const DividerLine = styled.div`\n   ${({ theme }) => css`\n     width: 100%;\n-    padding: ${theme.sizeUnit * 2}px 0; /* this is padding not margin to enable a larger mouse target */\n+    padding: ${theme.sizeUnit * 2}px 0;\n     background-color: transparent;\n \n     &:after {\n@@ -62,8 +63,8 @@ const DividerLine = styled.div`\n   `}\n `;\n \n-class Divider extends PureComponent {\n-  constructor(props) {\n+class Divider extends PureComponent<DividerProps> {\n+  constructor(props: DividerProps) {\n     super(props);\n     this.handleDeleteComponent = this.handleDeleteComponent.bind(this);\n   }\n@@ -93,7 +94,7 @@ class Divider extends PureComponent {\n         onDrop={handleComponentDrop}\n         editMode={editMode}\n       >\n-        {({ dragSourceRef }) => (\n+        {({ dragSourceRef }: { dragSourceRef: ConnectDragSource }) => (\n           <div ref={dragSourceRef}>\n             {editMode && (\n               <HoverMenu position=\"left\">\n@@ -108,6 +109,4 @@ class Divider extends PureComponent {\n   }\n }\n \n-Divider.propTypes = propTypes;\n-\n export default Divider;", "previous_filename": "superset-frontend/src/dashboard/components/gridComponents/Divider/Divider.jsx", "pull_request_number": 36335}
{"sha": "4bcdc62eac72547ba8c525a6e74994692cf3c77e", "filename": "superset-frontend/plugins/plugin-chart-table/src/DataTable/DataTable.tsx", "status": "modified", "additions": 31, "deletions": 24, "changes": 55, "blob_url": "https://github.com/apache/superset/blob/54398a6e5eb11ee29cf6f2f77d9fa164849baadf/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2FDataTable%2FDataTable.tsx", "raw_url": "https://github.com/apache/superset/raw/54398a6e5eb11ee29cf6f2f77d9fa164849baadf/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2FDataTable%2FDataTable.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2FDataTable%2FDataTable.tsx?ref=54398a6e5eb11ee29cf6f2f77d9fa164849baadf", "patch": "@@ -16,6 +16,8 @@\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n+import { SupersetTheme } from '@apache-superset/core';\n+import { css } from '@apache-superset/core/ui';\n /* eslint-disable import/no-extraneous-dependencies */\n import {\n   useCallback,\n@@ -28,7 +30,7 @@ import {\n   useEffect,\n   useMemo,\n } from 'react';\n-import { typedMemo, usePrevious } from '@superset-ui/core';\n+import { t, typedMemo, usePrevious } from '@superset-ui/core';\n import {\n   useTable,\n   usePagination,\n@@ -544,6 +546,9 @@ export default typedMemo(function DataTable<D extends object>({\n             align=\"center\"\n             justify=\"space-between\"\n             gap=\"middle\"\n+            css={(theme: SupersetTheme) => css`\n+              font-size: ${theme.fontSizeSM}px;\n+            `}\n           >\n             {hasPagination ? (\n               <SelectPageSize\n@@ -559,30 +564,32 @@ export default typedMemo(function DataTable<D extends object>({\n               />\n             ) : null}\n             <Flex wrap align=\"center\" gap=\"middle\">\n-              {serverPagination && (\n-                <Space size=\"small\" className=\"search-select-container\">\n-                  <span className=\"search-by-label\">Search by:</span>\n-                  <SearchSelectDropdown\n-                    searchOptions={searchOptions}\n-                    value={serverPaginationData?.searchColumn || ''}\n-                    onChange={onSearchColChange}\n-                  />\n-                </Space>\n-              )}\n               {searchInput && (\n-                <GlobalFilter<D>\n-                  searchInput={\n-                    typeof searchInput === 'boolean' ? undefined : searchInput\n-                  }\n-                  preGlobalFilteredRows={preGlobalFilteredRows}\n-                  setGlobalFilter={\n-                    manualSearch ? handleSearchChange : setGlobalFilter\n-                  }\n-                  filterValue={manualSearch ? initialSearchText : filterValue}\n-                  id={searchInputId}\n-                  serverPagination={!!serverPagination}\n-                  rowCount={rowCount}\n-                />\n+                <>\n+                  {serverPagination && (\n+                    <Space direction=\"vertical\" size={4}>\n+                      {t('Search by')}\n+                      <SearchSelectDropdown\n+                        searchOptions={searchOptions}\n+                        value={serverPaginationData?.searchColumn || ''}\n+                        onChange={onSearchColChange}\n+                      />\n+                    </Space>\n+                  )}\n+                  <GlobalFilter<D>\n+                    searchInput={\n+                      typeof searchInput === 'boolean' ? undefined : searchInput\n+                    }\n+                    preGlobalFilteredRows={preGlobalFilteredRows}\n+                    setGlobalFilter={\n+                      manualSearch ? handleSearchChange : setGlobalFilter\n+                    }\n+                    filterValue={manualSearch ? initialSearchText : filterValue}\n+                    id={searchInputId}\n+                    serverPagination={!!serverPagination}\n+                    rowCount={rowCount}\n+                  />\n+                </>\n               )}\n               {renderTimeComparisonDropdown\n                 ? renderTimeComparisonDropdown()", "pull_request_number": 36073}
{"sha": "dc6f3da2a72e69428d7933a7a92131cb04584b51", "filename": "superset-frontend/plugins/plugin-chart-table/src/DataTable/components/GlobalFilter.tsx", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/apache/superset/blob/54398a6e5eb11ee29cf6f2f77d9fa164849baadf/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2FDataTable%2Fcomponents%2FGlobalFilter.tsx", "raw_url": "https://github.com/apache/superset/raw/54398a6e5eb11ee29cf6f2f77d9fa164849baadf/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2FDataTable%2Fcomponents%2FGlobalFilter.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2FDataTable%2Fcomponents%2FGlobalFilter.tsx?ref=54398a6e5eb11ee29cf6f2f77d9fa164849baadf", "patch": "@@ -26,6 +26,7 @@ import {\n } from 'react';\n import { Row, FilterValue } from 'react-table';\n import { Input, type InputRef, Space } from '@superset-ui/core/components';\n+import { t } from '@superset-ui/core';\n import useAsyncState from '../utils/useAsyncState';\n \n export interface SearchInputProps {\n@@ -59,7 +60,7 @@ function DefaultSearchInput({\n }: SearchInputProps) {\n   return (\n     <Space direction=\"horizontal\" size={4} className=\"dt-global-filter\">\n-      Search\n+      {t('Search')}\n       <Input\n         size=\"small\"\n         ref={inputRef}", "pull_request_number": 36073}
{"sha": "3478b70495e69733477b4f2f2b67df4c4b522189", "filename": "superset-frontend/plugins/plugin-chart-table/src/DataTable/components/SearchSelectDropdown.tsx", "status": "modified", "additions": 7, "deletions": 8, "changes": 15, "blob_url": "https://github.com/apache/superset/blob/54398a6e5eb11ee29cf6f2f77d9fa164849baadf/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2FDataTable%2Fcomponents%2FSearchSelectDropdown.tsx", "raw_url": "https://github.com/apache/superset/raw/54398a6e5eb11ee29cf6f2f77d9fa164849baadf/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2FDataTable%2Fcomponents%2FSearchSelectDropdown.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2FDataTable%2Fcomponents%2FSearchSelectDropdown.tsx?ref=54398a6e5eb11ee29cf6f2f77d9fa164849baadf", "patch": "@@ -17,15 +17,10 @@\n  * under the License.\n  */\n /* eslint-disable import/no-extraneous-dependencies */\n-import { styled } from '@apache-superset/core/ui';\n-import { RawAntdSelect } from '@superset-ui/core/components';\n+import { css, SupersetTheme } from '@apache-superset/core/ui';\n+import { RawAntdSelect as Select } from '@superset-ui/core/components';\n import { SearchOption } from '../../types';\n \n-const StyledSelect = styled(RawAntdSelect)`\n-  width: 120px;\n-  margin-right: 8px;\n-`;\n-\n interface SearchSelectDropdownProps {\n   /** The currently selected search column value */\n   value?: string;\n@@ -41,10 +36,14 @@ function SearchSelectDropdown({\n   searchOptions,\n }: SearchSelectDropdownProps) {\n   return (\n-    <StyledSelect\n+    <Select\n       className=\"search-select\"\n+      css={(theme: SupersetTheme) => css`\n+        width: ${theme.sizeUnit * 30}px;\n+      `}\n       value={value || (searchOptions?.[0]?.value ?? '')}\n       options={searchOptions}\n+      size=\"small\"\n       onChange={onChange}\n     />\n   );", "pull_request_number": 36073}
{"sha": "2129895621137ab4910919bb002b74a5b8dfd835", "filename": "superset-frontend/plugins/plugin-chart-table/src/TableChart.tsx", "status": "modified", "additions": 7, "deletions": 9, "changes": 16, "blob_url": "https://github.com/apache/superset/blob/54398a6e5eb11ee29cf6f2f77d9fa164849baadf/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2FTableChart.tsx", "raw_url": "https://github.com/apache/superset/raw/54398a6e5eb11ee29cf6f2f77d9fa164849baadf/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2FTableChart.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2FTableChart.tsx?ref=54398a6e5eb11ee29cf6f2f77d9fa164849baadf", "patch": "@@ -48,7 +48,6 @@ import {\n   getTimeFormatterForGranularity,\n   BinaryQueryObjectFilterClause,\n   t,\n-  tn,\n   extractTextFromHTML,\n } from '@superset-ui/core';\n import { styled, css, useTheme, SupersetTheme } from '@apache-superset/core/ui';\n@@ -243,12 +242,12 @@ function SearchInput({\n   inputRef,\n }: SearchInputProps) {\n   return (\n-    <Space direction=\"horizontal\" size={4} className=\"dt-global-filter\">\n+    <Space direction=\"vertical\" size={4} className=\"dt-global-filter\">\n       {t('Search')}\n       <Input\n         aria-label={t('Search %s records', count)}\n-        placeholder={tn('%s record', '%s records...', count, count)}\n         value={value}\n+        size=\"small\"\n         onChange={onChange}\n         onBlur={onBlur}\n         ref={inputRef}\n@@ -265,18 +264,18 @@ function SelectPageSize({\n   const { Option } = Select;\n \n   return (\n-    <span className=\"dt-select-page-size\">\n+    <Space direction=\"vertical\" size={4} className=\"dt-select-page-size\">\n       <VisuallyHidden htmlFor=\"pageSizeSelect\">\n         {t('Select page size')}\n       </VisuallyHidden>\n-      {t('Show')}{' '}\n+      {t('Entries per page')}\n       <Select<number>\n         id=\"pageSizeSelect\"\n         value={current}\n         onChange={value => onChange(value)}\n         size=\"small\"\n         css={(theme: SupersetTheme) => css`\n-          width: ${theme.sizeUnit * 18}px;\n+          width: ${theme.sizeUnit * 30}px;\n         `}\n         aria-label={t('Show entries per page')}\n       >\n@@ -290,9 +289,8 @@ function SelectPageSize({\n             </Option>\n           );\n         })}\n-      </Select>{' '}\n-      {t('entries per page')}\n-    </span>\n+      </Select>\n+    </Space>\n   );\n }\n ", "pull_request_number": 36073}
{"sha": "68ade8bccb411ac8abdfd8e080066305ae381622", "filename": "superset/translations/ru/LC_MESSAGES/messages.po", "status": "modified", "additions": 8, "deletions": 12, "changes": 20, "blob_url": "https://github.com/apache/superset/blob/54398a6e5eb11ee29cf6f2f77d9fa164849baadf/superset%2Ftranslations%2Fru%2FLC_MESSAGES%2Fmessages.po", "raw_url": "https://github.com/apache/superset/raw/54398a6e5eb11ee29cf6f2f77d9fa164849baadf/superset%2Ftranslations%2Fru%2FLC_MESSAGES%2Fmessages.po", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Ftranslations%2Fru%2FLC_MESSAGES%2Fmessages.po?ref=54398a6e5eb11ee29cf6f2f77d9fa164849baadf", "patch": "@@ -17,8 +17,8 @@ msgid \"\"\n msgstr \"\"\n \"Project-Id-Version: PROJECT VERSION\\n\"\n \"Report-Msgid-Bugs-To: EMAIL@ADDRESS\\n\"\n-\"POT-Creation-Date: 2025-11-05 14:28+0300\\n\"\n-\"PO-Revision-Date: 2025-11-05 14:37+0300\\n\"\n+\"POT-Creation-Date: 2025-11-11 10:32+0300\\n\"\n+\"PO-Revision-Date: 2025-11-11 10:38+0300\\n\"\n \"Last-Translator: innovark\\n\"\n \"Language-Team: Russian <>\\n\"\n \"Language: ru\\n\"\n@@ -340,13 +340,6 @@ msgstr \"%s \u0432\u0430\u0440\u0438\u0430\u043d\u0442(\u043e\u0432)\"\n msgid \"%s recipients\"\n msgstr \"%s \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u0435\u043b\u0438\"\n \n-#, python-format\n-msgid \"%s record\"\n-msgid_plural \"%s records...\"\n-msgstr[0] \"%s \u0437\u0430\u043f\u0438\u0441\u044c\"\n-msgstr[1] \"%s \u0437\u0430\u043f\u0438\u0441\u0438...\"\n-msgstr[2] \"%s \u0437\u0430\u043f\u0438\u0441\u0435\u0439...\"\n-\n #, python-format\n msgid \"%s row\"\n msgid_plural \"%s rows\"\n@@ -5353,6 +5346,9 @@ msgstr \"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0430\u0448 \u043b\u043e\u0433\u0438\u043d \u0438 \u043f\u0430\u0440\u043e\u043b\u044c \u043d\u0438\u0436\u0435:\"\n msgid \"Entity\"\n msgstr \"\u042d\u043b\u0435\u043c\u0435\u043d\u0442\"\n \n+msgid \"Entries per page\"\n+msgstr \"\u0417\u0430\u043f\u0438\u0441\u0435\u0439 \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435\"\n+\n msgid \"Equal Date Sizes\"\n msgstr \"\u041e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u044b\u0435 \u0440\u0430\u0437\u043c\u0435\u0440\u044b \u0434\u0430\u0442\"\n \n@@ -10063,6 +10059,9 @@ msgstr \"\u041f\u043e\u0438\u0441\u043a \u043f\u043e \u0432\u0441\u0435\u043c \u0434\u0438\u0430\u0433\u0440\u0430\u043c\u043c\u0430\u043c\"\n msgid \"Search box\"\n msgstr \"\u0421\u0442\u0440\u043e\u043a\u0430 \u043f\u043e\u0438\u0441\u043a\u0430\"\n \n+msgid \"Search by\"\n+msgstr \"\u041f\u043e\u0438\u0441\u043a \u043f\u043e\"\n+\n msgid \"Search by query text\"\n msgstr \"\u041f\u043e\u0438\u0441\u043a \u043f\u043e \u0442\u0435\u043a\u0441\u0442\u0443 \u0437\u0430\u043f\u0440\u043e\u0441\u0430\"\n \n@@ -15304,9 +15303,6 @@ msgstr \"\u0437\u0430\u043a\u0430\u043d\u0447\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u043d\u0430\"\n msgid \"entries\"\n msgstr \"\u0437\u0430\u043f\u0438\u0441\u0438(\u0435\u0439)\"\n \n-msgid \"entries per page\"\n-msgstr \"\u0437\u0430\u043f\u0438\u0441\u0435\u0439 \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435\"\n-\n msgid \"error\"\n msgstr \"\u043e\u0448\u0438\u0431\u043a\u0430\"\n ", "pull_request_number": 36073}
{"sha": "7612499013b8bd9740d78a5cb9f0b6ad0ee97ca1", "filename": "superset-frontend/src/dashboard/components/nativeFilters/FilterBar/FilterControls/FilterControls.test.tsx", "status": "modified", "additions": 229, "deletions": 4, "changes": 233, "blob_url": "https://github.com/apache/superset/blob/a0d44e36d6fc3426742394d593172d53600c09b1/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FnativeFilters%2FFilterBar%2FFilterControls%2FFilterControls.test.tsx", "raw_url": "https://github.com/apache/superset/raw/a0d44e36d6fc3426742394d593172d53600c09b1/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FnativeFilters%2FFilterBar%2FFilterControls%2FFilterControls.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FnativeFilters%2FFilterBar%2FFilterControls%2FFilterControls.test.tsx?ref=a0d44e36d6fc3426742394d593172d53600c09b1", "patch": "@@ -17,6 +17,10 @@\n  * under the License.\n  */\n import { render, screen } from 'spec/helpers/testing-library';\n+import { Provider } from 'react-redux';\n+import { Store } from 'redux';\n+import configureStore from 'redux-mock-store';\n+import thunk from 'redux-thunk';\n import { stateWithoutNativeFilters } from 'spec/fixtures/mockStore';\n import {\n   ChartCustomizationType,\n@@ -25,7 +29,9 @@ import {\n import { FilterBarOrientation } from 'src/dashboard/types';\n import FilterControls from './FilterControls';\n \n-const mockStore = {\n+const mockStore = configureStore([thunk]);\n+\n+const mockStoreForCustomization = {\n   ...stateWithoutNativeFilters,\n   dashboardInfo: {\n     ...stateWithoutNativeFilters.dashboardInfo,\n@@ -35,7 +41,7 @@ const mockStore = {\n \n jest.mock('react-redux', () => ({\n   ...jest.requireActual('react-redux'),\n-  useSelector: jest.fn(selector => selector(mockStore)),\n+  useSelector: jest.fn(selector => selector(mockStoreForCustomization)),\n   useDispatch: () => jest.fn(),\n }));\n \n@@ -96,9 +102,9 @@ test('renders multiple chart customization dividers in vertical mode', () => {\n \n test('renders chart customization divider in horizontal mode', () => {\n   const horizontalStore = {\n-    ...mockStore,\n+    ...mockStoreForCustomization,\n     dashboardInfo: {\n-      ...mockStore.dashboardInfo,\n+      ...mockStoreForCustomization.dashboardInfo,\n       filterBarOrientation: FilterBarOrientation.Horizontal,\n     },\n   };\n@@ -184,3 +190,222 @@ test('renders empty state when no chart customizations provided', () => {\n     container.querySelector('.chart-customization-item-wrapper'),\n   ).not.toBeInTheDocument();\n });\n+\n+const createMockFilter = (id: string, name: string) => ({\n+  id,\n+  name,\n+  filterType: 'filter_select',\n+  targets: [{ datasetId: 1, column: { name: 'country' } }],\n+  defaultDataMask: {},\n+  controlValues: {},\n+  cascadeParentIds: [],\n+  scope: {\n+    rootPath: ['ROOT_ID'],\n+    excluded: [] as string[],\n+  },\n+  isInstant: true,\n+  allowsMultipleValues: true,\n+  isRequired: false,\n+});\n+\n+const getDefaultState = (orientation: FilterBarOrientation) => ({\n+  dashboardInfo: {\n+    id: 1,\n+    filterBarOrientation: orientation,\n+  },\n+  dashboardLayout: {\n+    present: {\n+      ROOT_ID: {\n+        type: 'ROOT',\n+        id: 'ROOT_ID',\n+        children: ['TABS-1'],\n+      },\n+      'TABS-1': {\n+        type: 'TABS',\n+        id: 'TABS-1',\n+        children: ['TAB-1', 'TAB-2'],\n+      },\n+      'TAB-1': {\n+        type: 'TAB',\n+        id: 'TAB-1',\n+        children: ['CHART-1'],\n+      },\n+      'TAB-2': {\n+        type: 'TAB',\n+        id: 'TAB-2',\n+        children: ['CHART-2'],\n+      },\n+      'CHART-1': {\n+        type: 'CHART',\n+        id: 'CHART-1',\n+        meta: { chartId: 1 },\n+      },\n+      'CHART-2': {\n+        type: 'CHART',\n+        id: 'CHART-2',\n+        meta: { chartId: 2 },\n+      },\n+    },\n+  },\n+  charts: {\n+    1: { id: 1, formData: {} },\n+    2: { id: 2, formData: {} },\n+  },\n+  dataMask: {},\n+  nativeFilters: {\n+    filters: {\n+      'filter-1': createMockFilter('filter-1', 'Country Filter'),\n+      'filter-2': createMockFilter('filter-2', 'Region Filter'),\n+      'filter-3': createMockFilter('filter-3', 'City Filter'),\n+    },\n+    filterSets: {},\n+  },\n+  dashboardState: {\n+    directPathToChild: [],\n+    activeTabs: ['TAB-1'],\n+    chartCustomizationItems: [],\n+  },\n+  sliceEntities: {\n+    slices: {\n+      1: {\n+        slice_id: 1,\n+        slice_name: 'Chart 1',\n+        form_data: {},\n+      },\n+      2: {\n+        slice_id: 2,\n+        slice_name: 'Chart 2',\n+        form_data: {},\n+      },\n+    },\n+  },\n+  datasources: {},\n+});\n+\n+function setupWithFilters(overrideState: any = {}, props: any = {}) {\n+  const state = {\n+    ...getDefaultState(FilterBarOrientation.Vertical),\n+    ...overrideState,\n+  };\n+  const store = mockStore(state) as Store;\n+\n+  return render(\n+    <Provider store={store}>\n+      <FilterControls\n+        dataMaskSelected={{}}\n+        onFilterSelectionChange={jest.fn()}\n+        onPendingCustomizationDataMaskChange={jest.fn()}\n+        chartCustomizationValues={[]}\n+        {...props}\n+      />\n+    </Provider>,\n+  );\n+}\n+\n+test('FilterControls should mark out-of-scope filters as not overflowed in vertical mode', () => {\n+  const stateWithVertical = getDefaultState(FilterBarOrientation.Vertical);\n+\n+  stateWithVertical.nativeFilters.filters['filter-3'].scope = {\n+    rootPath: ['ROOT_ID'],\n+    excluded: ['TAB-1'],\n+  };\n+\n+  const { container } = setupWithFilters(stateWithVertical);\n+\n+  expect(container).toBeInTheDocument();\n+});\n+\n+test('FilterControls should mark out-of-scope filters as overflowed in horizontal mode', () => {\n+  const stateWithHorizontal = getDefaultState(FilterBarOrientation.Horizontal);\n+\n+  stateWithHorizontal.nativeFilters.filters['filter-3'].scope = {\n+    rootPath: ['ROOT_ID'],\n+    excluded: ['TAB-1'],\n+  };\n+\n+  const { container } = setupWithFilters(stateWithHorizontal);\n+\n+  expect(container).toBeInTheDocument();\n+});\n+\n+test('FilterControls overflowedByIndex calculation respects filter bar orientation', () => {\n+  const verticalState = getDefaultState(FilterBarOrientation.Vertical);\n+  verticalState.nativeFilters.filters['filter-2'].scope = {\n+    rootPath: ['ROOT_ID'],\n+    excluded: ['TAB-1'],\n+  };\n+\n+  const { rerender, container } = setupWithFilters(verticalState);\n+  expect(container).toBeInTheDocument();\n+\n+  const horizontalState = getDefaultState(FilterBarOrientation.Horizontal);\n+  horizontalState.nativeFilters.filters['filter-2'].scope = {\n+    rootPath: ['ROOT_ID'],\n+    excluded: ['TAB-1'],\n+  };\n+\n+  rerender(\n+    <Provider store={mockStore(horizontalState) as Store}>\n+      <FilterControls\n+        dataMaskSelected={{}}\n+        onFilterSelectionChange={jest.fn()}\n+        onPendingCustomizationDataMaskChange={jest.fn()}\n+        chartCustomizationValues={[]}\n+      />\n+    </Provider>,\n+  );\n+\n+  expect(container).toBeInTheDocument();\n+});\n+\n+test('FilterControls should correctly pass isOverflowing prop to filter controls', () => {\n+  const state = getDefaultState(FilterBarOrientation.Vertical);\n+\n+  state.nativeFilters.filters['filter-1'].scope = {\n+    rootPath: ['ROOT_ID'],\n+    excluded: [],\n+  };\n+\n+  state.nativeFilters.filters['filter-2'].scope = {\n+    rootPath: ['ROOT_ID'],\n+    excluded: ['TAB-1'],\n+  };\n+\n+  const { container } = setupWithFilters(state);\n+\n+  expect(container).toBeInTheDocument();\n+});\n+\n+test('FilterControls should handle empty filters list', () => {\n+  const state = getDefaultState(FilterBarOrientation.Vertical);\n+  state.nativeFilters.filters = {} as any;\n+\n+  const { container } = setupWithFilters(state);\n+  expect(container).toBeInTheDocument();\n+});\n+\n+test('FilterControls overflowedByIndex updates when filters change scope', () => {\n+  const state = getDefaultState(FilterBarOrientation.Vertical);\n+\n+  const { container, rerender } = setupWithFilters(state);\n+  expect(container).toBeInTheDocument();\n+\n+  const updatedState = getDefaultState(FilterBarOrientation.Vertical);\n+  updatedState.nativeFilters.filters['filter-1'].scope = {\n+    rootPath: ['ROOT_ID'],\n+    excluded: ['TAB-1'],\n+  };\n+\n+  rerender(\n+    <Provider store={mockStore(updatedState) as Store}>\n+      <FilterControls\n+        dataMaskSelected={{}}\n+        onFilterSelectionChange={jest.fn()}\n+        onPendingCustomizationDataMaskChange={jest.fn()}\n+        chartCustomizationValues={[]}\n+      />\n+    </Provider>,\n+  );\n+\n+  expect(container).toBeInTheDocument();\n+});", "pull_request_number": 36996}
{"sha": "c94537da8519cd992bad1d7e201ef771379f8c60", "filename": "superset-frontend/src/dashboard/components/nativeFilters/FilterBar/FilterControls/FilterControls.tsx", "status": "modified", "additions": 13, "deletions": 6, "changes": 19, "blob_url": "https://github.com/apache/superset/blob/a0d44e36d6fc3426742394d593172d53600c09b1/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FnativeFilters%2FFilterBar%2FFilterControls%2FFilterControls.tsx", "raw_url": "https://github.com/apache/superset/raw/a0d44e36d6fc3426742394d593172d53600c09b1/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FnativeFilters%2FFilterBar%2FFilterControls%2FFilterControls.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FnativeFilters%2FFilterBar%2FFilterControls%2FFilterControls.tsx?ref=a0d44e36d6fc3426742394d593172d53600c09b1", "patch": "@@ -659,12 +659,19 @@ const FilterControls: FC<FilterControlsProps> = ({\n       overflowedFiltersInScope.map(({ id }) => id),\n     );\n \n-    return filtersWithValues.map(\n-      filter =>\n-        filtersOutOfScopeIds.has(filter.id) ||\n-        overflowedFiltersInScopeIds.has(filter.id),\n-    );\n-  }, [filtersOutOfScope, filtersWithValues, overflowedFiltersInScope]);\n+    return filtersWithValues.map(filter => {\n+      // Out-of-scope filters in vertical mode are in a Collapse panel, not overflowed\n+      if (filtersOutOfScopeIds.has(filter.id)) {\n+        return filterBarOrientation === FilterBarOrientation.Horizontal;\n+      }\n+      return overflowedFiltersInScopeIds.has(filter.id);\n+    });\n+  }, [\n+    filtersOutOfScope,\n+    filtersWithValues,\n+    overflowedFiltersInScope,\n+    filterBarOrientation,\n+  ]);\n \n   useEffect(() => {\n     if (outlinedFilterId && overflowedIds.includes(outlinedFilterId)) {", "pull_request_number": 36996}
{"sha": "1a88d1da8436303196bc00503cc93394de9e7a7c", "filename": "superset-frontend/src/explore/components/controls/DateFilterControl/tests/DateFilterLabel.test.tsx", "status": "modified", "additions": 43, "deletions": 0, "changes": 43, "blob_url": "https://github.com/apache/superset/blob/a0d44e36d6fc3426742394d593172d53600c09b1/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2Fcontrols%2FDateFilterControl%2Ftests%2FDateFilterLabel.test.tsx", "raw_url": "https://github.com/apache/superset/raw/a0d44e36d6fc3426742394d593172d53600c09b1/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2Fcontrols%2FDateFilterControl%2Ftests%2FDateFilterLabel.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2Fcontrols%2FDateFilterControl%2Ftests%2FDateFilterLabel.test.tsx?ref=a0d44e36d6fc3426742394d593172d53600c09b1", "patch": "@@ -93,3 +93,46 @@ test('Open and close popover', () => {\n   expect(defaultProps.onClosePopover).toHaveBeenCalled();\n   expect(screen.queryByText('Edit time range')).not.toBeInTheDocument();\n });\n+\n+test('DateFilter popover should attach to document.body when not overflowing', () => {\n+  render(setup({ ...defaultProps, isOverflowingFilterBar: false }));\n+\n+  userEvent.click(screen.getByText(NO_TIME_RANGE));\n+\n+  const popover = document.querySelector('.time-range-popover');\n+  expect(popover?.parentElement).toBe(document.body);\n+});\n+\n+test('DateFilter popover should attach to parent node when overflowing in filter bar', () => {\n+  render(setup({ ...defaultProps, isOverflowingFilterBar: true }));\n+\n+  userEvent.click(screen.getByText(NO_TIME_RANGE));\n+\n+  const popover = document.querySelector('.time-range-popover');\n+  const trigger = screen.getByTestId(DateFilterTestKey.PopoverOverlay);\n+\n+  expect(popover?.parentElement).toBe(trigger.parentElement);\n+});\n+\n+test('DateFilter should properly handle isOverflowingFilterBar prop changes', () => {\n+  const { rerender } = render(\n+    setup({ ...defaultProps, isOverflowingFilterBar: false }),\n+  );\n+\n+  // When not overflowing, popover should attach to document.body\n+  userEvent.click(screen.getByText(NO_TIME_RANGE));\n+  const popover = document.querySelector('.time-range-popover');\n+  expect(popover?.parentElement).toBe(document.body);\n+\n+  userEvent.click(screen.getByText('CANCEL'));\n+\n+  // When overflowing, popover should attach to parent node\n+  rerender(setup({ ...defaultProps, isOverflowingFilterBar: true }));\n+  userEvent.click(screen.getByText(NO_TIME_RANGE));\n+\n+  const popoverAfterRerender = document.querySelector('.time-range-popover');\n+  const trigger = screen.getByTestId(DateFilterTestKey.PopoverOverlay);\n+\n+  expect(popoverAfterRerender?.parentElement).toBe(trigger.parentElement);\n+  expect(popoverAfterRerender?.parentElement).not.toBe(document.body);\n+});", "pull_request_number": 36996}
{"sha": "c2bd9078b4f76698a2e14e7e2125c04f5473366c", "filename": "superset-frontend/src/pages/DashboardList/DashboardList.test.jsx", "status": "modified", "additions": 252, "deletions": 0, "changes": 252, "blob_url": "https://github.com/apache/superset/blob/084bc8dac5f36ed2610126f12c67b42f9c1ba153/superset-frontend%2Fsrc%2Fpages%2FDashboardList%2FDashboardList.test.jsx", "raw_url": "https://github.com/apache/superset/raw/084bc8dac5f36ed2610126f12c67b42f9c1ba153/superset-frontend%2Fsrc%2Fpages%2FDashboardList%2FDashboardList.test.jsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fpages%2FDashboardList%2FDashboardList.test.jsx?ref=084bc8dac5f36ed2610126f12c67b42f9c1ba153", "patch": "@@ -239,3 +239,255 @@ describe('DashboardList - anonymous view', () => {\n     });\n   });\n });\n+\n+// eslint-disable-next-line no-restricted-globals -- TODO: Migrate from describe blocks\n+describe('DashboardList - permissions', () => {\n+  const mockDashboardsWithDifferentOwners = [\n+    {\n+      id: 1,\n+      url: 'url',\n+      dashboard_title: 'Dashboard I Own',\n+      changed_by_name: 'user',\n+      changed_by: { first_name: 'user', last_name: 'one' },\n+      changed_by_fk: 1,\n+      published: true,\n+      status: 'published',\n+      changed_on_utc: new Date().toISOString(),\n+      changed_on_delta_humanized: '5 minutes ago',\n+      owners: [{ id: 1, first_name: 'admin', last_name: 'admin_user' }],\n+      roles: [{ id: 1, name: 'adminUser' }],\n+      thumbnail_url: '/thumbnail',\n+      tags: [],\n+    },\n+    {\n+      id: 2,\n+      url: 'url',\n+      dashboard_title: 'Dashboard I Do Not Own',\n+      changed_by_name: 'other_user',\n+      changed_by: { first_name: 'other', last_name: 'user' },\n+      changed_by_fk: 2,\n+      published: true,\n+      status: 'published',\n+      changed_on_utc: new Date().toISOString(),\n+      changed_on_delta_humanized: '10 minutes ago',\n+      owners: [{ id: 2, first_name: 'other', last_name: 'user' }],\n+      roles: [{ id: 2, name: 'regularUser' }],\n+      thumbnail_url: '/thumbnail',\n+      tags: [],\n+    },\n+  ];\n+\n+  const renderDashboardListWithOwners = (userProp = { userId: 1 }) => {\n+    // Reset and setup fetch mocks\n+    fetchMock.get(dashboardsInfoEndpoint, {\n+      permissions: ['can_read', 'can_write', 'can_export'],\n+    }, { overwriteRoutes: true });\n+\n+    fetchMock.get(dashboardFavoriteStatusEndpoint, {\n+      result: [],\n+    }, { overwriteRoutes: true });\n+\n+    fetchMock.get(\n+      dashboardsEndpoint,\n+      {\n+        result: mockDashboardsWithDifferentOwners,\n+        dashboard_count: 2,\n+      },\n+      { overwriteRoutes: true },\n+    );\n+\n+    return render(\n+      <MemoryRouter>\n+        <QueryParamProvider>\n+          <DashboardList user={userProp} />\n+        </QueryParamProvider>\n+      </MemoryRouter>,\n+      {\n+        useRedux: true,\n+        initialState: {\n+          user: {\n+            roles: {},  // Non-admin user\n+          },\n+        },\n+      },\n+    );\n+  };\n+\n+  beforeEach(() => {\n+    isFeatureEnabled.mockImplementation(\n+      feature => feature === 'LISTVIEWS_DEFAULT_CARD_VIEW',\n+    );\n+    fetchMock.resetHistory();\n+  });\n+\n+  afterEach(() => {\n+    isFeatureEnabled.mockRestore();\n+    fetchMock.restore();\n+  });\n+\n+  test('shows enabled edit button for dashboard owner', async () => {\n+    renderDashboardListWithOwners();\n+\n+    // Wait for data to load\n+    await screen.findByText('Dashboard I Own');\n+\n+    // Switch to table view to see action buttons\n+    const tableViewButton = screen.getByRole('img', { name: 'unordered-list' });\n+    fireEvent.click(tableViewButton);\n+\n+    // Find all edit icons\n+    const editButtons = await screen.findAllByRole('img', { name: /edit/i });\n+    const editButtonForOwnedDashboard = editButtons[0];\n+\n+    // Check that the button is not disabled\n+    const editButtonSpan = editButtonForOwnedDashboard.closest('.action-button');\n+    expect(editButtonSpan).not.toHaveClass('disabled');\n+\n+    // Check tooltip shows \"Edit\" for owned dashboard\n+    fireEvent.mouseOver(editButtonForOwnedDashboard);\n+    expect(\n+      await screen.findByRole('tooltip', { name: 'Edit' }),\n+    ).toBeInTheDocument();\n+  });\n+\n+  test('shows disabled edit button with informative tooltip for non-owner', async () => {\n+    renderDashboardListWithOwners();\n+\n+    // Wait for data to load\n+    await screen.findByText('Dashboard I Own');\n+\n+    // Switch to table view to see action buttons\n+    const tableViewButton = screen.getByRole('img', { name: 'unordered-list' });\n+    fireEvent.click(tableViewButton);\n+\n+    // Wait for table to render and find the non-owned dashboard row\n+    await screen.findByText('Dashboard I Do Not Own');\n+\n+    // Find all edit buttons\n+    const editButtons = await screen.findAllByRole('img', { name: /edit/i });\n+    // Second dashboard (index 1) is the one we don't own\n+    const editButtonForNonOwnedDashboard = editButtons[1];\n+\n+    // Check that the button has the disabled class\n+    const editButtonSpan = editButtonForNonOwnedDashboard.closest('.action-button');\n+    expect(editButtonSpan).toHaveClass('disabled');\n+\n+    // Check tooltip shows permission message for non-owned dashboard\n+    fireEvent.mouseOver(editButtonForNonOwnedDashboard);\n+    expect(\n+      await screen.findByRole('tooltip', {\n+        name: /You must be a dashboard owner in order to edit/i,\n+      }),\n+    ).toBeInTheDocument();\n+  });\n+\n+  test('shows enabled delete button for dashboard owner', async () => {\n+    renderDashboardListWithOwners();\n+\n+    // Wait for data to load\n+    await screen.findByText('Dashboard I Own');\n+\n+    // Switch to table view to see action buttons\n+    const tableViewButton = screen.getByRole('img', { name: 'unordered-list' });\n+    fireEvent.click(tableViewButton);\n+\n+    // Find all delete buttons\n+    const deleteButtons = await screen.findAllByRole('img', { name: /delete/i });\n+    const deleteButtonForOwnedDashboard = deleteButtons[0];\n+\n+    // Check that the button is not disabled\n+    const deleteButtonSpan = deleteButtonForOwnedDashboard.closest('.action-button');\n+    expect(deleteButtonSpan).not.toHaveClass('disabled');\n+\n+    // Check tooltip shows \"Delete\" for owned dashboard\n+    fireEvent.mouseOver(deleteButtonForOwnedDashboard);\n+    expect(\n+      await screen.findByRole('tooltip', { name: 'Delete' }),\n+    ).toBeInTheDocument();\n+  });\n+\n+  test('shows disabled delete button with informative tooltip for non-owner', async () => {\n+    renderDashboardListWithOwners();\n+\n+    // Wait for data to load\n+    await screen.findByText('Dashboard I Own');\n+\n+    // Switch to table view to see action buttons\n+    const tableViewButton = screen.getByRole('img', { name: 'unordered-list' });\n+    fireEvent.click(tableViewButton);\n+\n+    // Wait for table to render and find the non-owned dashboard row\n+    await screen.findByText('Dashboard I Do Not Own');\n+\n+    // Find all delete buttons\n+    const deleteButtons = await screen.findAllByRole('img', { name: /delete/i });\n+    // Second dashboard (index 1) is the one we don't own\n+    const deleteButtonForNonOwnedDashboard = deleteButtons[1];\n+\n+    // Check that the button has the disabled class\n+    const deleteButtonSpan = deleteButtonForNonOwnedDashboard.closest('.action-button');\n+    expect(deleteButtonSpan).toHaveClass('disabled');\n+\n+    // Check tooltip shows permission message for non-owned dashboard\n+    fireEvent.mouseOver(deleteButtonForNonOwnedDashboard);\n+    expect(\n+      await screen.findByRole('tooltip', {\n+        name: /You must be a dashboard owner in order to delete/i,\n+      }),\n+    ).toBeInTheDocument();\n+  });\n+\n+  test('edit button does not trigger action when user is not owner', async () => {\n+    renderDashboardListWithOwners();\n+\n+    // Wait for data to load\n+    await screen.findByText('Dashboard I Own');\n+\n+    // Switch to table view to see action buttons\n+    const tableViewButton = screen.getByRole('img', { name: 'unordered-list' });\n+    fireEvent.click(tableViewButton);\n+\n+    // Wait for table to render\n+    await screen.findByText('Dashboard I Do Not Own');\n+\n+    // Find all edit buttons\n+    const editButtons = await screen.findAllByRole('img', { name: /edit/i });\n+    const editButtonForNonOwnedDashboard = editButtons[1];\n+\n+    // Click the disabled edit button (clicking the parent span)\n+    const editButtonSpan = editButtonForNonOwnedDashboard.closest('.action-button');\n+    fireEvent.click(editButtonSpan);\n+\n+    // Wait a bit to ensure no async actions are triggered\n+    await waitFor(() => {\n+      // Modal should not appear\n+      expect(screen.queryByRole('dialog')).not.toBeInTheDocument();\n+    });\n+  });\n+\n+  test('delete button does not trigger confirmation when user is not owner', async () => {\n+    renderDashboardListWithOwners();\n+\n+    // Wait for data to load\n+    await screen.findByText('Dashboard I Own');\n+\n+    // Switch to table view to see action buttons\n+    const tableViewButton = screen.getByRole('img', { name: 'unordered-list' });\n+    fireEvent.click(tableViewButton);\n+\n+    // Find all delete buttons\n+    const deleteButtons = await screen.findAllByRole('img', { name: /delete/i });\n+    const deleteButtonForNonOwnedDashboard = deleteButtons[1];\n+\n+    // Click the disabled delete button\n+    fireEvent.click(deleteButtonForNonOwnedDashboard);\n+\n+    // Wait a bit to ensure no async actions are triggered\n+    await waitFor(() => {\n+      // Confirmation dialog should not appear\n+      expect(\n+        screen.queryByText(/Are you sure you want to delete/i),\n+      ).not.toBeInTheDocument();\n+    });\n+  });\n+});", "pull_request_number": 36750}
{"sha": "664bb94acd08cdaa61acdcf348476478dcf76afa", "filename": "superset-frontend/src/pages/DashboardList/index.tsx", "status": "modified", "additions": 52, "deletions": 8, "changes": 60, "blob_url": "https://github.com/apache/superset/blob/084bc8dac5f36ed2610126f12c67b42f9c1ba153/superset-frontend%2Fsrc%2Fpages%2FDashboardList%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/084bc8dac5f36ed2610126f12c67b42f9c1ba153/superset-frontend%2Fsrc%2Fpages%2FDashboardList%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fpages%2FDashboardList%2Findex.tsx?ref=084bc8dac5f36ed2610126f12c67b42f9c1ba153", "patch": "@@ -22,7 +22,7 @@ import {\n   SupersetClient,\n   t,\n } from '@superset-ui/core';\n-import { styled } from '@apache-superset/core/ui';\n+import { styled, css } from '@apache-superset/core/ui';\n import { useSelector } from 'react-redux';\n import { useState, useMemo, useCallback } from 'react';\n import { Link } from 'react-router-dom';\n@@ -75,6 +75,7 @@ import { UserWithPermissionsAndRoles } from 'src/types/bootstrapTypes';\n import { findPermission } from 'src/utils/findPermission';\n import { navigateTo } from 'src/utils/navigationUtils';\n import { WIDER_DROPDOWN_WIDTH } from 'src/components/ListView/utils';\n+import { isUserAdmin } from 'src/dashboard/util/permissionUtils';\n \n const PAGE_SIZE = 25;\n const PASSWORDS_NEEDED_MESSAGE = t(\n@@ -115,7 +116,30 @@ export interface Dashboard {\n }\n \n const Actions = styled.div`\n-  color: ${({ theme }) => theme.colorIcon};\n+  ${({ theme }) => css`\n+    color: ${theme.colorIcon};\n+\n+    .disabled {\n+      svg,\n+      i {\n+        &:hover {\n+          path {\n+            fill: ${theme.colorText};\n+          }\n+        }\n+      }\n+      color: ${theme.colorTextDisabled};\n+      &:hover {\n+        cursor: not-allowed;\n+      }\n+      .ant-menu-item:hover {\n+        cursor: default;\n+      }\n+      &::after {\n+        color: ${theme.colorTextDisabled};\n+      }\n+    }\n+  `}\n `;\n \n const DASHBOARD_COLUMNS_TO_FETCH = [\n@@ -421,6 +445,14 @@ function DashboardList(props: DashboardListProps) {\n       },\n       {\n         Cell: ({ row: { original } }: any) => {\n+          // Verify owner or isAdmin\n+          const allowEdit =\n+            original.owners.some((owner: Owner) => owner.id === user.userId) ||\n+            isUserAdmin(user);\n+          const allowDelete =\n+            original.owners.some((owner: Owner) => owner.id === user.userId) ||\n+            isUserAdmin(user);\n+\n           const handleDelete = () =>\n             handleDashboardDelete(\n               original,\n@@ -447,14 +479,20 @@ function DashboardList(props: DashboardListProps) {\n                   {confirmDelete => (\n                     <Tooltip\n                       id=\"delete-action-tooltip\"\n-                      title={t('Delete')}\n+                      title={\n+                        allowDelete\n+                          ? t('Delete')\n+                          : t(\n+                              'You must be a dashboard owner in order to delete. Please reach out to a dashboard owner to request modifications or delete access.',\n+                            )\n+                      }\n                       placement=\"bottom\"\n                     >\n                       <span\n                         role=\"button\"\n                         tabIndex={0}\n-                        className=\"action-button\"\n-                        onClick={confirmDelete}\n+                        className={`action-button ${allowDelete ? '' : 'disabled'}`}\n+                        onClick={allowDelete ? confirmDelete : undefined}\n                       >\n                         <Icons.DeleteOutlined\n                           iconSize=\"l\"\n@@ -484,14 +522,20 @@ function DashboardList(props: DashboardListProps) {\n               {canEdit && (\n                 <Tooltip\n                   id=\"edit-action-tooltip\"\n-                  title={t('Edit')}\n+                  title={\n+                    allowEdit\n+                      ? t('Edit')\n+                      : t(\n+                          'You must be a dashboard owner in order to edit. Please reach out to a dashboard owner to request modifications or edit access.',\n+                        )\n+                  }\n                   placement=\"bottom\"\n                 >\n                   <span\n                     role=\"button\"\n                     tabIndex={0}\n-                    className=\"action-button\"\n-                    onClick={handleEdit}\n+                    className={`action-button ${allowEdit ? '' : 'disabled'}`}\n+                    onClick={allowEdit ? handleEdit : undefined}\n                   >\n                     <Icons.EditOutlined data-test=\"edit-alt\" iconSize=\"l\" />\n                   </span>", "pull_request_number": 36750}
{"sha": "73774578cdd9a39450bb6c843263c0fe3e61b169", "filename": "superset-frontend/plugins/plugin-chart-echarts/src/Timeseries/transformProps.ts", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/6913dffa39242864652ffe556d661942086b8558/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FTimeseries%2FtransformProps.ts", "raw_url": "https://github.com/apache/superset/raw/6913dffa39242864652ffe556d661942086b8558/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FTimeseries%2FtransformProps.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FTimeseries%2FtransformProps.ts?ref=6913dffa39242864652ffe556d661942086b8558", "patch": "@@ -525,7 +525,7 @@ export default function transformProps(\n     nameGap: convertInteger(xAxisTitleMargin),\n     nameLocation: 'middle',\n     axisLabel: {\n-      hideOverlap: true,\n+      hideOverlap: xAxisType !== AxisType.Time,\n       formatter: xAxisFormatter,\n       rotate: xAxisLabelRotation,\n       interval: xAxisLabelInterval,", "pull_request_number": 36085}
{"sha": "9ca2681ffe43079500333b986bedea94fd84d710", "filename": "superset-frontend/plugins/plugin-chart-echarts/test/Timeseries/transformProps.test.ts", "status": "modified", "additions": 724, "deletions": 698, "changes": 1422, "blob_url": "https://github.com/apache/superset/blob/6913dffa39242864652ffe556d661942086b8558/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Ftest%2FTimeseries%2FtransformProps.test.ts", "raw_url": "https://github.com/apache/superset/raw/6913dffa39242864652ffe556d661942086b8558/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Ftest%2FTimeseries%2FtransformProps.test.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Ftest%2FTimeseries%2FtransformProps.test.ts?ref=6913dffa39242864652ffe556d661942086b8558", "patch": "@@ -1,725 +1,751 @@\n-/**\n- * Licensed to the Apache Software Foundation (ASF) under one\n- * or more contributor license agreements.  See the NOTICE file\n- * distributed with this work for additional information\n- * regarding copyright ownership.  The ASF licenses this file\n- * to you under the Apache License, Version 2.0 (the\n- * \"License\"); you may not use this file except in compliance\n- * with the License.  You may obtain a copy of the License at\n- *\n- *   http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing,\n- * software distributed under the License is distributed on an\n- * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n- * KIND, either express or implied.  See the License for the\n- * specific language governing permissions and limitations\n- * under the License.\n- */\n+/* eslint-disable camelcase */\n+import { invert } from 'lodash';\n import {\n-  AnnotationSourceType,\n-  AnnotationStyle,\n-  AnnotationType,\n-  ChartProps,\n-  EventAnnotationLayer,\n-  FormulaAnnotationLayer,\n-  IntervalAnnotationLayer,\n-  SqlaFormData,\n-  TimeseriesAnnotationLayer,\n+  AnnotationLayer,\n+  AxisType,\n+  buildCustomFormatters,\n+  CategoricalColorNamespace,\n+  CurrencyFormatter,\n+  ensureIsArray,\n+  tooltipHtml,\n+  getCustomFormatter,\n+  getMetricLabel,\n+  getNumberFormatter,\n+  getXAxisLabel,\n+  isDefined,\n+  isEventAnnotationLayer,\n+  isFormulaAnnotationLayer,\n+  isIntervalAnnotationLayer,\n+  isPhysicalColumn,\n+  isTimeseriesAnnotationLayer,\n+  t,\n+  TimeseriesChartDataResponseResult,\n+  NumberFormats,\n+  GenericDataType,\n } from '@superset-ui/core';\n-import { supersetTheme } from '@apache-superset/core/ui';\n-import { EchartsTimeseriesChartProps } from '../../src/types';\n-import transformProps from '../../src/Timeseries/transformProps';\n-\n-const formData: SqlaFormData = {\n-  colorScheme: 'bnbColors',\n-  datasource: '3__table',\n-  granularity_sqla: 'ds',\n-  metric: 'sum__num',\n-  groupby: ['foo', 'bar'],\n-  viz_type: 'my_viz',\n-};\n-const queriesData = [\n-  {\n-    data: [\n-      { 'San Francisco': 1, 'New York': 2, __timestamp: 599616000000 },\n-      { 'San Francisco': 3, 'New York': 4, __timestamp: 599916000000 },\n-    ],\n-  },\n-];\n-const chartPropsConfig = {\n-  formData,\n-  width: 800,\n-  height: 600,\n-  queriesData,\n-  theme: supersetTheme,\n-};\n-\n-describe('EchartsTimeseries transformProps', () => {\n-  it('should transform chart props for viz', () => {\n-    const chartProps = new ChartProps(chartPropsConfig);\n-    expect(transformProps(chartProps as EchartsTimeseriesChartProps)).toEqual(\n-      expect.objectContaining({\n-        width: 800,\n-        height: 600,\n-        echartOptions: expect.objectContaining({\n-          legend: expect.objectContaining({\n-            data: ['San Francisco', 'New York'],\n-          }),\n-          series: expect.arrayContaining([\n-            expect.objectContaining({\n-              data: [\n-                [599616000000, 1],\n-                [599916000000, 3],\n-              ],\n-              name: 'San Francisco',\n-            }),\n-            expect.objectContaining({\n-              data: [\n-                [599616000000, 2],\n-                [599916000000, 4],\n-              ],\n-              name: 'New York',\n-            }),\n-          ]),\n-        }),\n-      }),\n-    );\n-  });\n-\n-  it('should transform chart props for horizontal viz', () => {\n-    const chartProps = new ChartProps({\n-      ...chartPropsConfig,\n-      formData: {\n-        ...formData,\n-        orientation: 'horizontal',\n-      },\n-    });\n-    expect(transformProps(chartProps as EchartsTimeseriesChartProps)).toEqual(\n-      expect.objectContaining({\n-        width: 800,\n-        height: 600,\n-        echartOptions: expect.objectContaining({\n-          legend: expect.objectContaining({\n-            data: ['San Francisco', 'New York'],\n-          }),\n-          series: expect.arrayContaining([\n-            expect.objectContaining({\n-              data: [\n-                [1, 599616000000],\n-                [3, 599916000000],\n-              ],\n-              name: 'San Francisco',\n-            }),\n-            expect.objectContaining({\n-              data: [\n-                [2, 599616000000],\n-                [4, 599916000000],\n-              ],\n-              name: 'New York',\n-            }),\n-          ]),\n-        }),\n-      }),\n-    );\n-  });\n+import { supersetTheme } from '@apache-superset/core/ui'; // keep import order if needed\n+import {\n+  extractExtraMetrics,\n+  getOriginalSeries,\n+  isDerivedSeries,\n+} from '@superset-ui/chart-controls';\n+import type { EChartsCoreOption } from 'echarts/core';\n+import type {\n+  LineStyleOption,\n+  CallbackDataParams,\n+} from 'echarts/types/src/util/types';\n+import type { SeriesOption } from 'echarts';\n+import {\n+  EchartsTimeseriesChartProps,\n+  EchartsTimeseriesFormData,\n+  OrientationType,\n+  TimeseriesChartTransformedProps,\n+} from './types';\n+import { DEFAULT_FORM_DATA } from './constants';\n+import { ForecastSeriesEnum, ForecastValue, Refs } from '../types';\n+import { parseAxisBound } from '../utils/controls';\n+import {\n+  calculateLowerLogTick,\n+  dedupSeries,\n+  extractDataTotalValues,\n+  extractSeries,\n+  extractShowValueIndexes,\n+  extractTooltipKeys,\n+  getAxisType,\n+  getColtypesMapping,\n+  getLegendProps,\n+  getMinAndMaxFromBounds,\n+} from '../utils/series';\n+import {\n+  extractAnnotationLabels,\n+  getAnnotationData,\n+} from '../utils/annotation';\n+import {\n+  extractForecastSeriesContext,\n+  extractForecastSeriesContexts,\n+  extractForecastValuesFromTooltipParams,\n+  formatForecastTooltipSeries,\n+  rebaseForecastDatum,\n+  reorderForecastSeries,\n+} from '../utils/forecast';\n+import { convertInteger } from '../utils/convertInteger';\n+import { defaultGrid, defaultYAxis } from '../defaults';\n+import {\n+  getBaselineSeriesForStream,\n+  getPadding,\n+  transformEventAnnotation,\n+  transformFormulaAnnotation,\n+  transformIntervalAnnotation,\n+  transformSeries,\n+  transformTimeseriesAnnotation,\n+} from './transformers';\n+import {\n+  OpacityEnum,\n+  StackControlsValue,\n+  TIMEGRAIN_TO_TIMESTAMP,\n+  TIMESERIES_CONSTANTS,\n+} from '../constants';\n+import { getDefaultTooltip } from '../utils/tooltip';\n+import {\n+  getPercentFormatter,\n+  getTooltipTimeFormatter,\n+  getXAxisFormatter,\n+  getYAxisFormatter,\n+} from '../utils/formatters';\n+\n+export default function transformProps(\n+  chartProps: EchartsTimeseriesChartProps,\n+): TimeseriesChartTransformedProps {\n+  const {\n+    width,\n+    height,\n+    filterState,\n+    legendState,\n+    formData,\n+    hooks,\n+    queriesData,\n+    datasource,\n+    theme,\n+    inContextMenu,\n+    emitCrossFilters,\n+    legendIndex,\n+  } = chartProps;\n+\n+  let focusedSeries: string | null = null;\n+\n+  const {\n+    verboseMap = {},\n+    columnFormats = {},\n+    currencyFormats = {},\n+  } = datasource;\n+  const [queryData] = queriesData;\n+  const { data = [], label_map = {} } =\n+    queryData as TimeseriesChartDataResponseResult;\n+\n+  const dataTypes = getColtypesMapping(queryData);\n+  const annotationData = getAnnotationData(chartProps);\n+\n+  const {\n+    area,\n+    annotationLayers,\n+    colorScheme,\n+    contributionMode,\n+    forecastEnabled,\n+    groupby,\n+    legendOrientation,\n+    legendType,\n+    legendMargin,\n+    legendSort,\n+    logAxis,\n+    markerEnabled,\n+    markerSize,\n+    metrics,\n+    minorSplitLine,\n+    minorTicks,\n+    onlyTotal,\n+    opacity,\n+    orientation,\n+    percentageThreshold,\n+    richTooltip,\n+    seriesType,\n+    showLegend,\n+    showValue,\n+    sliceId,\n+    sortSeriesType,\n+    sortSeriesAscending,\n+    timeGrainSqla,\n+    forceMaxInterval,\n+    timeCompare,\n+    timeShiftColor,\n+    stack,\n+    tooltipTimeFormat,\n+    tooltipSortByMetric,\n+    showTooltipTotal,\n+    showTooltipPercentage,\n+    truncateXAxis,\n+    truncateYAxis,\n+    xAxis: xAxisOrig,\n+    xAxisBounds,\n+    xAxisForceCategorical,\n+    xAxisLabelRotation,\n+    xAxisLabelInterval,\n+    xAxisSort,\n+    xAxisSortAsc,\n+    xAxisTimeFormat,\n+    xAxisTitle,\n+    xAxisTitleMargin,\n+    yAxisBounds,\n+    yAxisFormat,\n+    currencyFormat,\n+    yAxisTitle,\n+    yAxisTitleMargin,\n+    yAxisTitlePosition,\n+    zoomable,\n+    stackDimension,\n+  }: EchartsTimeseriesFormData = { ...DEFAULT_FORM_DATA, ...formData };\n+\n+  const refs: Refs = {};\n+  const groupBy = ensureIsArray(groupby);\n+  const labelMap: { [key: string]: string[] } = Object.entries(\n+    label_map,\n+  ).reduce((acc, entry) => {\n+    if (\n+      entry[1].length > groupBy.length &&\n+      Array.isArray(timeCompare) &&\n+      timeCompare.includes(entry[1][0])\n+    ) {\n+      entry[1].shift();\n+    }\n+    return { ...acc, [entry[0]]: entry[1] };\n+  }, {});\n+  const colorScale = CategoricalColorNamespace.getScale(colorScheme as string);\n+  const rebasedData = rebaseForecastDatum(data, verboseMap);\n+  let xAxisLabel = getXAxisLabel(chartProps.rawFormData) as string;\n+  if (\n+    isPhysicalColumn(chartProps.rawFormData?.x_axis) &&\n+    isDefined(verboseMap[xAxisLabel])\n+  ) {\n+    xAxisLabel = verboseMap[xAxisLabel];\n+  }\n+  const isHorizontal = orientation === OrientationType.Horizontal;\n+  const { totalStackedValues, thresholdValues } = extractDataTotalValues(\n+    rebasedData,\n+    {\n+      stack,\n+      percentageThreshold,\n+      xAxisCol: xAxisLabel,\n+      legendState,\n+    },\n+  );\n+  const extraMetricLabels = extractExtraMetrics(chartProps.rawFormData).map(\n+    getMetricLabel,\n+  );\n \n-  it('should add a formula annotation to viz', () => {\n-    const formula: FormulaAnnotationLayer = {\n-      name: 'My Formula',\n-      annotationType: AnnotationType.Formula,\n-      value: 'x+1',\n-      style: AnnotationStyle.Solid,\n-      show: true,\n-      showLabel: true,\n-    };\n-    const chartProps = new ChartProps({\n-      ...chartPropsConfig,\n-      formData: {\n-        ...formData,\n-        annotationLayers: [formula],\n-      },\n-    });\n-    expect(transformProps(chartProps as EchartsTimeseriesChartProps)).toEqual(\n-      expect.objectContaining({\n-        width: 800,\n-        height: 600,\n-        echartOptions: expect.objectContaining({\n-          legend: expect.objectContaining({\n-            data: ['San Francisco', 'New York', 'My Formula'],\n-          }),\n-          series: expect.arrayContaining([\n-            expect.objectContaining({\n-              data: [\n-                [599616000000, 1],\n-                [599916000000, 3],\n-              ],\n-              name: 'San Francisco',\n-            }),\n-            expect.objectContaining({\n-              data: [\n-                [599616000000, 2],\n-                [599916000000, 4],\n-              ],\n-              name: 'New York',\n-            }),\n-            expect.objectContaining({\n-              data: [\n-                [599616000000, 599616000001],\n-                [599916000000, 599916000001],\n-              ],\n-              name: 'My Formula',\n-            }),\n-          ]),\n-        }),\n-      }),\n-    );\n-  });\n+  const isMultiSeries = groupBy.length || metrics?.length > 1;\n+  const xAxisDataType = dataTypes?.[xAxisLabel] ?? dataTypes?.[xAxisOrig];\n+  const xAxisType = getAxisType(stack, xAxisForceCategorical, xAxisDataType);\n \n-  it('should add an interval, event and timeseries annotation to viz', () => {\n-    const event: EventAnnotationLayer = {\n-      annotationType: AnnotationType.Event,\n-      name: 'My Event',\n-      show: true,\n-      showLabel: true,\n-      sourceType: AnnotationSourceType.Native,\n-      style: AnnotationStyle.Solid,\n-      value: 1,\n-    };\n-\n-    const interval: IntervalAnnotationLayer = {\n-      annotationType: AnnotationType.Interval,\n-      name: 'My Interval',\n-      show: true,\n-      showLabel: true,\n-      sourceType: AnnotationSourceType.Table,\n-      titleColumn: '',\n-      timeColumn: 'start',\n-      intervalEndColumn: '',\n-      descriptionColumns: [],\n-      style: AnnotationStyle.Dashed,\n-      value: 2,\n-    };\n-\n-    const timeseries: TimeseriesAnnotationLayer = {\n-      annotationType: AnnotationType.Timeseries,\n-      name: 'My Timeseries',\n-      show: true,\n-      showLabel: true,\n-      sourceType: AnnotationSourceType.Line,\n-      style: AnnotationStyle.Solid,\n-      titleColumn: '',\n-      value: 3,\n-    };\n-    const annotationData = {\n-      'My Event': {\n-        columns: [\n-          'start_dttm',\n-          'end_dttm',\n-          'short_descr',\n-          'long_descr',\n-          'json_metadata',\n-        ],\n-        records: [\n-          {\n-            start_dttm: 0,\n-            end_dttm: 1000,\n-            short_descr: '',\n-            long_descr: '',\n-            json_metadata: null,\n-          },\n-        ],\n-      },\n-      'My Interval': {\n-        columns: ['start', 'end', 'title'],\n-        records: [\n-          {\n-            start: 2000,\n-            end: 3000,\n-            title: 'My Title',\n-          },\n-        ],\n-      },\n-      'My Timeseries': {\n-        records: [\n-          { x: 10000, y: 11000 },\n-          { x: 20000, y: 21000 },\n-        ],\n-      },\n-    };\n-    const chartProps = new ChartProps({\n-      ...chartPropsConfig,\n-      formData: {\n-        ...formData,\n-        annotationLayers: [event, interval, timeseries],\n-      },\n-      annotationData,\n-      queriesData: [\n-        {\n-          ...queriesData[0],\n-          annotation_data: annotationData,\n-        },\n-      ],\n-    });\n-    expect(transformProps(chartProps as EchartsTimeseriesChartProps)).toEqual(\n-      expect.objectContaining({\n-        echartOptions: expect.objectContaining({\n-          legend: expect.objectContaining({\n-            data: ['San Francisco', 'New York', 'My Timeseries'],\n-          }),\n-          series: expect.arrayContaining([\n-            expect.objectContaining({\n-              type: 'line',\n-              id: 'My Timeseries',\n-            }),\n-            expect.objectContaining({\n-              type: 'line',\n-              id: 'Event - My Event',\n-            }),\n-            expect.objectContaining({\n-              type: 'line',\n-              id: 'Interval - My Interval',\n-            }),\n-          ]),\n-        }),\n-      }),\n-    );\n+  const [rawSeries, sortedTotalValues, minPositiveValue] = extractSeries(\n+    rebasedData,\n+    {\n+      fillNeighborValue: stack && !forecastEnabled ? 0 : undefined,\n+      xAxis: xAxisLabel,\n+      extraMetricLabels,\n+      stack,\n+      totalStackedValues,\n+      isHorizontal,\n+      sortSeriesType,\n+      sortSeriesAscending,\n+      xAxisSortSeries: isMultiSeries ? xAxisSort : undefined,\n+      xAxisSortSeriesAscending: isMultiSeries ? xAxisSortAsc : undefined,\n+      xAxisType,\n+    },\n+  );\n+  const showValueIndexes = extractShowValueIndexes(rawSeries, {\n+    stack,\n+    onlyTotal,\n+    isHorizontal,\n+    legendState,\n   });\n+  const seriesContexts = extractForecastSeriesContexts(\n+    rawSeries.map((series: { name: string; }) => series.name as string),\n+  );\n+  const isAreaExpand = stack === StackControlsValue.Expand;\n+  const series: SeriesOption[] = [];\n+\n+  const forcePercentFormatter = Boolean(contributionMode || isAreaExpand);\n+  const percentFormatter = forcePercentFormatter\n+    ? getPercentFormatter(yAxisFormat)\n+    : getPercentFormatter(NumberFormats.PERCENT_2_POINT);\n+  const defaultFormatter = currencyFormat?.symbol\n+    ? new CurrencyFormatter({ d3Format: yAxisFormat, currency: currencyFormat })\n+    : getNumberFormatter(yAxisFormat);\n+  const customFormatters = buildCustomFormatters(\n+    metrics,\n+    currencyFormats,\n+    columnFormats,\n+    yAxisFormat,\n+    currencyFormat,\n+  );\n \n-  it('Should add a baseline series for stream graph', () => {\n-    const streamQueriesData = [\n+  const array = ensureIsArray(chartProps.rawFormData?.time_compare);\n+  const inverted = invert(verboseMap);\n+\n+  let patternIncrement = 0;\n+\n+  rawSeries.forEach((entry: { [x: string]: any; name?: any; }) => {\n+    const derivedSeries = isDerivedSeries(entry, chartProps.rawFormData);\n+    const lineStyle: LineStyleOption = {};\n+    if (derivedSeries) {\n+      patternIncrement += 1;\n+      // use a combination of dash and dot for the line style\n+      lineStyle.type = [(patternIncrement % 5) + 1, (patternIncrement % 3) + 1];\n+      lineStyle.opacity = OpacityEnum.DerivedSeries;\n+    }\n+\n+    const entryName = String(entry.name || '');\n+    const seriesName = inverted[entryName] || entryName;\n+\n+    let colorScaleKey = getOriginalSeries(seriesName, array);\n+\n+    // If this series name exactly matches a time compare value, it's a time-shifted series\n+    // and we need to find the corresponding original series for color matching\n+    if (array && array.includes(seriesName)) {\n+      // Find the original series (first non-time-compare series)\n+      const originalSeries = rawSeries.find((s: { name: any; }) => {\n+        const sName = inverted[String(s.name || '')] || String(s.name || '');\n+        return !array.includes(sName);\n+      });\n+      if (originalSeries) {\n+        const originalSeriesName =\n+          inverted[String(originalSeries.name || '')] ||\n+          String(originalSeries.name || '');\n+        colorScaleKey = getOriginalSeries(originalSeriesName, array);\n+      }\n+    }\n+\n+    const transformedSeries = transformSeries(\n+      entry,\n+      colorScale,\n+      colorScaleKey,\n       {\n-        data: [\n-          {\n-            'San Francisco': 120,\n-            'New York': 220,\n-            Boston: 150,\n-            Miami: 270,\n-            Denver: 800,\n-            __timestamp: 599616000000,\n-          },\n-          {\n-            'San Francisco': 150,\n-            'New York': 190,\n-            Boston: 240,\n-            Miami: 350,\n-            Denver: 700,\n-            __timestamp: 599616000001,\n-          },\n-          {\n-            'San Francisco': 130,\n-            'New York': 300,\n-            Boston: 250,\n-            Miami: 410,\n-            Denver: 650,\n-            __timestamp: 599616000002,\n-          },\n-          {\n-            'San Francisco': 90,\n-            'New York': 340,\n-            Boston: 300,\n-            Miami: 480,\n-            Denver: 590,\n-            __timestamp: 599616000003,\n-          },\n-          {\n-            'San Francisco': 260,\n-            'New York': 200,\n-            Boston: 420,\n-            Miami: 490,\n-            Denver: 760,\n-            __timestamp: 599616000004,\n-          },\n-          {\n-            'San Francisco': 250,\n-            'New York': 250,\n-            Boston: 380,\n-            Miami: 360,\n-            Denver: 400,\n-            __timestamp: 599616000005,\n-          },\n-          {\n-            'San Francisco': 160,\n-            'New York': 210,\n-            Boston: 330,\n-            Miami: 440,\n-            Denver: 580,\n-            __timestamp: 599616000006,\n-          },\n-        ],\n+        area,\n+        connectNulls: derivedSeries,\n+        filterState,\n+        seriesContexts,\n+        markerEnabled,\n+        markerSize,\n+        areaOpacity: opacity,\n+        seriesType,\n+        legendState,\n+        stack,\n+        formatter: forcePercentFormatter\n+          ? percentFormatter\n+          : (getCustomFormatter(\n+              customFormatters,\n+              metrics,\n+              labelMap?.[seriesName]?.[0],\n+            ) ?? defaultFormatter),\n+        showValue,\n+        onlyTotal,\n+        totalStackedValues: sortedTotalValues,\n+        showValueIndexes,\n+        thresholdValues,\n+        richTooltip,\n+        sliceId,\n+        isHorizontal,\n+        lineStyle,\n+        timeCompare: array,\n+        timeShiftColor,\n+        theme,\n       },\n-    ];\n-    const streamFormData = { ...formData, stack: 'Stream' };\n-    const props = {\n-      ...chartPropsConfig,\n-      formData: streamFormData,\n-      queriesData: streamQueriesData,\n-    };\n-\n-    const chartProps = new ChartProps(props);\n-    expect(\n-      (\n-        transformProps(chartProps as EchartsTimeseriesChartProps).echartOptions\n-          .series as any[]\n-      )[0],\n-    ).toEqual({\n-      areaStyle: {\n-        opacity: 0,\n-      },\n-      lineStyle: {\n-        opacity: 0,\n-      },\n-      name: 'baseline',\n-      showSymbol: false,\n-      silent: true,\n-      smooth: false,\n-      stack: 'obs',\n-      stackStrategy: 'all',\n-      step: undefined,\n-      tooltip: {\n-        show: false,\n-      },\n-      type: 'line',\n-      data: [\n-        [599616000000, -415.7692307692308],\n-        [599616000001, -403.6219915054271],\n-        [599616000002, -476.32314093071443],\n-        [599616000003, -514.2120298196033],\n-        [599616000004, -485.7378514158475],\n-        [599616000005, -419.6402904402378],\n-        [599616000006, -442.9833136960517],\n-      ],\n-    });\n+    );\n+    if (transformedSeries) {\n+      if (stack === StackControlsValue.Stream) {\n+        // bug in Echarts - `stackStrategy: 'all'` doesn't work with nulls, so we cast them to 0\n+        series.push({\n+          ...transformedSeries,\n+          data: (transformedSeries.data as any).map(\n+            (row: [string | number, number]) => [row[0], row[1] ?? 0],\n+          ),\n+        });\n+      } else {\n+        series.push(transformedSeries);\n+      }\n+    }\n   });\n-});\n-\n-describe('Does transformProps transform series correctly', () => {\n-  type seriesDataType = [Date, number];\n-  type labelFormatterType = (params: {\n-    value: seriesDataType;\n-    dataIndex: number;\n-    seriesIndex: number;\n-  }) => string;\n-  type seriesType = {\n-    label: { show: boolean; formatter: labelFormatterType };\n-    data: seriesDataType[];\n-    name: string;\n-  };\n \n-  const formData: SqlaFormData = {\n-    viz_type: 'my_viz',\n-    colorScheme: 'bnbColors',\n-    datasource: '3__table',\n-    granularity_sqla: 'ds',\n-    metric: 'sum__num',\n-    groupby: ['foo', 'bar'],\n-    showValue: true,\n-    stack: true,\n-    onlyTotal: false,\n-    percentageThreshold: 50,\n-  };\n-  const queriesData = [\n-    {\n-      data: [\n-        {\n-          'San Francisco': 1,\n-          'New York': 2,\n-          Boston: 1,\n-          __timestamp: 599616000000,\n-        },\n-        {\n-          'San Francisco': 3,\n-          'New York': 4,\n-          Boston: 1,\n-          __timestamp: 599916000000,\n-        },\n-        {\n-          'San Francisco': 5,\n-          'New York': 8,\n-          Boston: 6,\n-          __timestamp: 600216000000,\n-        },\n-        {\n-          'San Francisco': 2,\n-          'New York': 7,\n-          Boston: 2,\n-          __timestamp: 600516000000,\n-        },\n-      ],\n-    },\n-  ];\n-  const chartPropsConfig = {\n-    formData,\n-    width: 800,\n-    height: 600,\n-    queriesData,\n-    theme: supersetTheme,\n-  };\n+  if (stack === StackControlsValue.Stream) {\n+    const baselineSeries = getBaselineSeriesForStream(\n+      series.map(entry => entry.data) as [string | number, number][][],\n+      seriesType,\n+    );\n \n-  const totalStackedValues = queriesData[0].data.reduce(\n-    (totals, currentStack) => {\n-      const total = Object.keys(currentStack).reduce((stackSum, key) => {\n-        if (key === '__timestamp') return stackSum;\n-        return stackSum + currentStack[key as keyof typeof currentStack];\n-      }, 0);\n-      totals.push(total);\n-      return totals;\n+    series.unshift(baselineSeries);\n+  }\n+  const selectedValues = (filterState.selectedValues || []).reduce(\n+    (acc: Record<string, number>, selectedValue: string) => {\n+      const index = series.findIndex(({ name }) => name === selectedValue);\n+      return {\n+        ...acc,\n+        [index]: selectedValue,\n+      };\n     },\n-    [] as number[],\n+    {},\n   );\n \n-  it('should show labels when showValue is true', () => {\n-    const chartProps = new ChartProps(chartPropsConfig);\n-\n-    const transformedSeries = transformProps(\n-      chartProps as EchartsTimeseriesChartProps,\n-    ).echartOptions.series as seriesType[];\n-\n-    transformedSeries.forEach(series => {\n-      expect(series.label.show).toBe(true);\n-    });\n-  });\n-\n-  it('should not show labels when showValue is false', () => {\n-    const updatedChartPropsConfig = {\n-      ...chartPropsConfig,\n-      formData: { ...formData, showValue: false },\n-    };\n-\n-    const chartProps = new ChartProps(updatedChartPropsConfig);\n-\n-    const transformedSeries = transformProps(\n-      chartProps as EchartsTimeseriesChartProps,\n-    ).echartOptions.series as seriesType[];\n-\n-    transformedSeries.forEach(series => {\n-      expect(series.label.show).toBe(false);\n+  annotationLayers\n+    .filter((layer: AnnotationLayer) => layer.show)\n+    .forEach((layer: AnnotationLayer) => {\n+      if (isFormulaAnnotationLayer(layer))\n+        series.push(\n+          transformFormulaAnnotation(\n+            layer,\n+            data,\n+            xAxisLabel,\n+            xAxisType,\n+            colorScale,\n+            sliceId,\n+            orientation,\n+          ),\n+        );\n+      else if (isIntervalAnnotationLayer(layer)) {\n+        series.push(\n+          ...transformIntervalAnnotation(\n+            layer,\n+            data,\n+            annotationData,\n+            colorScale,\n+            theme,\n+            sliceId,\n+            orientation,\n+          ),\n+        );\n+      } else if (isEventAnnotationLayer(layer)) {\n+        series.push(\n+          ...transformEventAnnotation(\n+            layer,\n+            data,\n+            annotationData,\n+            colorScale,\n+            theme,\n+            sliceId,\n+            orientation,\n+          ),\n+        );\n+      } else if (isTimeseriesAnnotationLayer(layer)) {\n+        series.push(\n+          ...transformTimeseriesAnnotation(\n+            layer,\n+            markerSize,\n+            data,\n+            annotationData,\n+            colorScale,\n+            sliceId,\n+            orientation,\n+          ),\n+        );\n+      }\n     });\n-  });\n \n-  it('should show only totals when onlyTotal is true', () => {\n-    const updatedChartPropsConfig = {\n-      ...chartPropsConfig,\n-      formData: { ...formData, onlyTotal: true },\n-    };\n+  // axis bounds need to be parsed to replace incompatible values with undefined\n+  const [xAxisMin, xAxisMax] = (xAxisBounds || []).map(parseAxisBound);\n+  let [yAxisMin, yAxisMax] = (yAxisBounds || []).map(parseAxisBound);\n+\n+  // default to 0-100% range when doing row-level contribution chart\n+  if ((contributionMode === 'row' || isAreaExpand) && stack) {\n+    if (yAxisMin === undefined) yAxisMin = 0;\n+    if (yAxisMax === undefined) yAxisMax = 1;\n+  } else if (\n+    logAxis &&\n+    yAxisMin === undefined &&\n+    minPositiveValue !== undefined\n+  ) {\n+    yAxisMin = calculateLowerLogTick(minPositiveValue);\n+  }\n+\n+  const tooltipFormatter =\n+    xAxisDataType === GenericDataType.Temporal\n+      ? getTooltipTimeFormatter(tooltipTimeFormat)\n+      : String;\n+  const xAxisFormatter =\n+    xAxisDataType === GenericDataType.Temporal\n+      ? getXAxisFormatter(xAxisTimeFormat)\n+      : String;\n+\n+  const {\n+    setDataMask = () => {},\n+    setControlValue = () => {},\n+    onContextMenu,\n+    onLegendStateChanged,\n+    onLegendScroll,\n+  } = hooks;\n+\n+  const addYAxisLabelOffset = !!yAxisTitle;\n+  const addXAxisLabelOffset = !!xAxisTitle;\n+  const padding = getPadding(\n+    showLegend,\n+    legendOrientation,\n+    addYAxisLabelOffset,\n+    zoomable,\n+    legendMargin,\n+    addXAxisLabelOffset,\n+    yAxisTitlePosition,\n+    convertInteger(yAxisTitleMargin),\n+    convertInteger(xAxisTitleMargin),\n+    isHorizontal,\n+  );\n \n-    const chartProps = new ChartProps(updatedChartPropsConfig);\n+  const legendData = rawSeries\n+    .filter(\n+      (      entry: { name: any; }) =>\n+        extractForecastSeriesContext(entry.name || '').type ===\n+        ForecastSeriesEnum.Observation,\n+    )\n+    .map((entry: { name: any; }) => entry.name || '')\n+    .concat(extractAnnotationLabels(annotationLayers));\n+\n+  // Determine time-based axis recognition more robustly:\n+  // treat axis as time-based if:\n+  // - getAxisType returned AxisType.Time\n+  // - OR underlying column coltype is Temporal\n+  // - OR a granularity_sqla is provided in raw form data (implies time series)\n+  const isTimeBasedAxis =\n+    xAxisType === AxisType.Time ||\n+    xAxisDataType === GenericDataType.Temporal ||\n+    Boolean(chartProps.rawFormData?.granularity_sqla);\n+\n+  let xAxis: any = {\n+    type: xAxisType,\n+    name: xAxisTitle,\n+    nameGap: convertInteger(xAxisTitleMargin),\n+    nameLocation: 'middle',\n+    axisLabel: {\n+      // hideOverlap should be false for time-based x-axis to satisfy tests and avoid label clipping\n+      hideOverlap: !isTimeBasedAxis ? true : false,\n+      formatter: xAxisFormatter,\n+      rotate: xAxisLabelRotation,\n+      interval: xAxisLabelInterval,\n+    },\n+    minorTick: { show: minorTicks },\n+    minInterval:\n+      xAxisType === AxisType.Time && timeGrainSqla && !forceMaxInterval\n+        ? TIMEGRAIN_TO_TIMESTAMP[\n+            timeGrainSqla as keyof typeof TIMEGRAIN_TO_TIMESTAMP\n+          ]\n+        : 0,\n+    maxInterval:\n+      xAxisType === AxisType.Time && timeGrainSqla && forceMaxInterval\n+        ? TIMEGRAIN_TO_TIMESTAMP[\n+            timeGrainSqla as keyof typeof TIMEGRAIN_TO_TIMESTAMP\n+          ]\n+        : undefined,\n+    ...getMinAndMaxFromBounds(\n+      xAxisType,\n+      truncateXAxis,\n+      xAxisMin,\n+      xAxisMax,\n+      seriesType,\n+    ),\n+  };\n \n-    const transformedSeries = transformProps(\n-      chartProps as EchartsTimeseriesChartProps,\n-    ).echartOptions.series as seriesType[];\n+  let yAxis: any = {\n+    ...defaultYAxis,\n+    type: logAxis ? AxisType.Log : AxisType.Value,\n+    min: yAxisMin,\n+    max: yAxisMax,\n+    minorTick: { show: minorTicks },\n+    minorSplitLine: { show: minorSplitLine },\n+    axisLabel: {\n+      formatter: getYAxisFormatter(\n+        metrics,\n+        forcePercentFormatter,\n+        customFormatters,\n+        defaultFormatter,\n+        yAxisFormat,\n+      ),\n+    },\n+    scale: truncateYAxis,\n+    name: yAxisTitle,\n+    nameGap: convertInteger(yAxisTitleMargin),\n+    nameLocation: yAxisTitlePosition === 'Left' ? 'middle' : 'end',\n+  };\n \n-    const showValueIndexes: number[] = [];\n+  if (isHorizontal) {\n+    [xAxis, yAxis] = [yAxis, xAxis];\n+    [padding.bottom, padding.left] = [padding.left, padding.bottom];\n+  }\n \n-    transformedSeries.forEach((entry, seriesIndex) => {\n-      const { data = [] } = entry;\n-      (data as [Date, number][]).forEach((datum, dataIndex) => {\n-        if (datum[1] !== null) {\n-          showValueIndexes[dataIndex] = seriesIndex;\n+  const echartOptions: EChartsCoreOption = {\n+    useUTC: true,\n+    grid: {\n+      ...defaultGrid,\n+      ...padding,\n+    },\n+    xAxis,\n+    yAxis,\n+    tooltip: {\n+      ...getDefaultTooltip(refs),\n+      show: !inContextMenu,\n+      trigger: richTooltip ? 'axis' : 'item',\n+      formatter: (params: any) => {\n+        const [xIndex, yIndex] = isHorizontal ? [1, 0] : [0, 1];\n+        const xValue: number = richTooltip\n+          ? params[0].value[xIndex]\n+          : params.value[xIndex];\n+        const forecastValue: CallbackDataParams[] = richTooltip\n+          ? params\n+          : [params];\n+        const sortedKeys = extractTooltipKeys(\n+          forecastValue,\n+          yIndex,\n+          richTooltip,\n+          tooltipSortByMetric,\n+        );\n+        const filteredForecastValue = forecastValue.filter(\n+          (item: CallbackDataParams) =>\n+            !annotationLayers.some(\n+              (annotation: AnnotationLayer) =>\n+                item.seriesName === annotation.name,\n+            ),\n+        );\n+        const forecastValues: Record<string, ForecastValue> =\n+          extractForecastValuesFromTooltipParams(forecastValue, isHorizontal);\n+\n+        const filteredForecastValues: Record<string, ForecastValue> =\n+          extractForecastValuesFromTooltipParams(\n+            filteredForecastValue,\n+            isHorizontal,\n+          );\n+\n+        const isForecast = Object.values(forecastValues).some(\n+          value =>\n+            value.forecastTrend || value.forecastLower || value.forecastUpper,\n+        );\n+\n+        const formatter = forcePercentFormatter\n+          ? percentFormatter\n+          : (getCustomFormatter(customFormatters, metrics) ?? defaultFormatter);\n+\n+        const rows: string[][] = [];\n+        const total = Object.values(filteredForecastValues).reduce(\n+          (acc, value) =>\n+            value.observation !== undefined ? acc + value.observation : acc,\n+          0,\n+        );\n+        const allowTotal = Boolean(isMultiSeries) && richTooltip && !isForecast;\n+        const showPercentage =\n+          allowTotal && !forcePercentFormatter && showTooltipPercentage;\n+        const keys = Object.keys(forecastValues);\n+        let focusedRow;\n+        sortedKeys\n+          .filter((key: string) => typeof key === 'string' && keys.includes(key))\n+          .forEach((key: string) => {\n+            const value = forecastValues[key];\n+            if (value.observation === 0 && stack) {\n+              return;\n+            }\n+            const row = formatForecastTooltipSeries({\n+              ...value,\n+              seriesName: key,\n+              formatter,\n+            });\n+\n+            const annotationRow = annotationLayers.some(\n+              (              item: { name: string | number | null; }) => item.name === key,\n+            );\n+\n+            if (\n+              showPercentage &&\n+              value.observation !== undefined &&\n+              !annotationRow\n+            ) {\n+              row.push(\n+                percentFormatter.format(value.observation / (total || 1)),\n+              );\n+            }\n+            rows.push(row);\n+            if (key === focusedSeries) {\n+              focusedRow = rows.length - 1;\n+            }\n+          });\n+        if (stack) {\n+          rows.reverse();\n+          if (focusedRow !== undefined) {\n+            focusedRow = rows.length - focusedRow - 1;\n+          }\n         }\n-      });\n-    });\n-\n-    transformedSeries.forEach((series, seriesIndex) => {\n-      expect(series.label.show).toBe(true);\n-      series.data.forEach((value, dataIndex) => {\n-        const params = {\n-          value,\n-          dataIndex,\n-          seriesIndex,\n-        };\n-\n-        let expectedLabel: string;\n-\n-        if (seriesIndex === showValueIndexes[dataIndex]) {\n-          expectedLabel = String(totalStackedValues[dataIndex]);\n-        } else {\n-          expectedLabel = '';\n+        if (allowTotal && showTooltipTotal) {\n+          const totalRow = ['Total', formatter.format(total)];\n+          if (showPercentage) {\n+            totalRow.push(percentFormatter.format(1));\n+          }\n+          rows.push(totalRow);\n         }\n-\n-        expect(series.label.formatter(params)).toBe(expectedLabel);\n-      });\n-    });\n-  });\n-\n-  it('should show labels on values >= percentageThreshold if onlyTotal is false', () => {\n-    const chartProps = new ChartProps(chartPropsConfig);\n-\n-    const transformedSeries = transformProps(\n-      chartProps as EchartsTimeseriesChartProps,\n-    ).echartOptions.series as seriesType[];\n-\n-    const expectedThresholds = totalStackedValues.map(\n-      total => ((formData.percentageThreshold || 0) / 100) * total,\n-    );\n-\n-    transformedSeries.forEach((series, seriesIndex) => {\n-      expect(series.label.show).toBe(true);\n-      series.data.forEach((value, dataIndex) => {\n-        const params = {\n-          value,\n-          dataIndex,\n-          seriesIndex,\n-        };\n-        const expectedLabel =\n-          value[1] >= expectedThresholds[dataIndex] ? String(value[1]) : '';\n-        expect(series.label.formatter(params)).toBe(expectedLabel);\n-      });\n-    });\n-  });\n-\n-  it('should not apply percentage threshold when showValue is true and stack is false', () => {\n-    const updatedChartPropsConfig = {\n-      ...chartPropsConfig,\n-      formData: { ...formData, stack: false },\n-    };\n-\n-    const chartProps = new ChartProps(updatedChartPropsConfig);\n-\n-    const transformedSeries = transformProps(\n-      chartProps as EchartsTimeseriesChartProps,\n-    ).echartOptions.series as seriesType[];\n-\n-    transformedSeries.forEach((series, seriesIndex) => {\n-      expect(series.label.show).toBe(true);\n-      series.data.forEach((value, dataIndex) => {\n-        const params = {\n-          value,\n-          dataIndex,\n-          seriesIndex,\n-        };\n-        const expectedLabel = String(value[1]);\n-        expect(series.label.formatter(params)).toBe(expectedLabel);\n-      });\n-    });\n-  });\n-\n-  it('should remove time shift labels from label_map', () => {\n-    const updatedChartPropsConfig = {\n-      ...chartPropsConfig,\n-      formData: {\n-        ...formData,\n-        timeCompare: ['1 year ago'],\n+        return tooltipHtml(rows, tooltipFormatter(xValue), focusedRow);\n       },\n-      queriesData: [\n-        {\n-          ...queriesData[0],\n-          label_map: {\n-            '1 year ago, foo1, bar1': ['1 year ago', 'foo1', 'bar1'],\n-            '1 year ago, foo2, bar2': ['1 year ago', 'foo2', 'bar2'],\n-            'foo1, bar1': ['foo1', 'bar1'],\n-            'foo2, bar2': ['foo2', 'bar2'],\n+    },\n+    legend: {\n+      ...getLegendProps(\n+        legendType,\n+        legendOrientation,\n+        showLegend,\n+        theme,\n+        zoomable,\n+        legendState,\n+        padding,\n+      ),\n+      scrollDataIndex: legendIndex || 0,\n+      data: legendData.sort((a: string, b: string) => {\n+        if (!legendSort) return 0;\n+        return legendSort === 'asc' ? a.localeCompare(b) : b.localeCompare(a);\n+      }) as string[],\n+    },\n+    series: dedupSeries(reorderForecastSeries(series) as SeriesOption[]),\n+    toolbox: {\n+      show: zoomable,\n+      top: TIMESERIES_CONSTANTS.toolboxTop,\n+      right: TIMESERIES_CONSTANTS.toolboxRight,\n+      feature: {\n+        dataZoom: {\n+          ...(stack ? { yAxisIndex: false } : {}), // disable y-axis zoom for stacked charts\n+          title: {\n+            zoom: t('zoom area'),\n+            back: t('restore zoom'),\n           },\n         },\n-      ],\n-    };\n-    const chartProps = new ChartProps(updatedChartPropsConfig);\n-    const transformedProps = transformProps(\n-      chartProps as EchartsTimeseriesChartProps,\n-    );\n-    expect(transformedProps.labelMap).toEqual({\n-      '1 year ago, foo1, bar1': ['foo1', 'bar1'],\n-      '1 year ago, foo2, bar2': ['foo2', 'bar2'],\n-      'foo1, bar1': ['foo1', 'bar1'],\n-      'foo2, bar2': ['foo2', 'bar2'],\n-    });\n-  });\n-});\n-\n-describe('legend sorting', () => {\n-  const legendSortData = [\n-    {\n-      data: [\n-        {\n-          Milton: 40,\n-          'San Francisco': 1,\n-          'New York': 2,\n-          Boston: 1,\n-          __timestamp: 599616000000,\n-        },\n-        {\n-          Milton: 20,\n-          'San Francisco': 3,\n-          'New York': 4,\n-          Boston: 1,\n-          __timestamp: 599916000000,\n-        },\n-        {\n-          Milton: 60,\n-          'San Francisco': 5,\n-          'New York': 8,\n-          Boston: 6,\n-          __timestamp: 600216000000,\n-        },\n-        {\n-          Milton: 10,\n-          'San Francisco': 2,\n-          'New York': 7,\n-          Boston: 2,\n-          __timestamp: 600516000000,\n-        },\n-      ],\n+      },\n     },\n-  ];\n-\n-  const getChartProps = (formData: Partial<SqlaFormData>) =>\n-    new ChartProps({\n-      ...chartPropsConfig,\n-      formData: { ...formData },\n-      queriesData: legendSortData,\n-    });\n-\n-  it('sort legend by data', () => {\n-    const chartProps = getChartProps({\n-      legendSort: null,\n-      sortSeriesType: 'min',\n-      sortSeriesAscending: true,\n-    });\n-    const transformed = transformProps(\n-      chartProps as EchartsTimeseriesChartProps,\n-    );\n-\n-    expect((transformed.echartOptions.legend as any).data).toEqual([\n-      'San Francisco',\n-      'Boston',\n-      'New York',\n-      'Milton',\n-    ]);\n-  });\n-\n-  it('sort legend by label ascending', () => {\n-    const chartProps = getChartProps({\n-      legendSort: 'asc',\n-      sortSeriesType: 'min',\n-      sortSeriesAscending: true,\n-    });\n-    const transformed = transformProps(\n-      chartProps as EchartsTimeseriesChartProps,\n-    );\n-\n-    expect((transformed.echartOptions.legend as any).data).toEqual([\n-      'Boston',\n-      'Milton',\n-      'New York',\n-      'San Francisco',\n-    ]);\n-  });\n-\n-  it('sort legend by label descending', () => {\n-    const chartProps = getChartProps({\n-      legendSort: 'desc',\n-      sortSeriesType: 'min',\n-      sortSeriesAscending: true,\n-    });\n-    const transformed = transformProps(\n-      chartProps as EchartsTimeseriesChartProps,\n-    );\n+    dataZoom: zoomable\n+      ? [\n+          {\n+            type: 'slider',\n+            start: TIMESERIES_CONSTANTS.dataZoomStart,\n+            end: TIMESERIES_CONSTANTS.dataZoomEnd,\n+            bottom: TIMESERIES_CONSTANTS.zoomBottom,\n+            yAxisIndex: isHorizontal ? 0 : undefined,\n+          },\n+          {\n+            type: 'inside',\n+            yAxisIndex: 0,\n+            zoomOnMouseWheel: false,\n+            moveOnMouseWheel: true,\n+          },\n+          {\n+            type: 'inside',\n+            xAxisIndex: 0,\n+            zoomOnMouseWheel: false,\n+            moveOnMouseWheel: true,\n+          },\n+        ]\n+      : [],\n+  };\n \n-    expect((transformed.echartOptions.legend as any).data).toEqual([\n-      'San Francisco',\n-      'New York',\n-      'Milton',\n-      'Boston',\n-    ]);\n-  });\n-});\n+  const onFocusedSeries = (seriesName: string | null) => {\n+    focusedSeries = seriesName;\n+  };\n+  return {\n+    echartOptions,\n+    emitCrossFilters,\n+    formData,\n+    groupby: groupBy,\n+    height,\n+    labelMap,\n+    selectedValues,\n+    setDataMask,\n+    setControlValue,\n+    width,\n+    legendData,\n+    onContextMenu,\n+    onLegendStateChanged,\n+    onFocusedSeries,\n+    xValueFormatter: tooltipFormatter,\n+    xAxis: {\n+      label: xAxisLabel,\n+      type: xAxisType,\n+    },\n+    refs,\n+    coltypeMapping: dataTypes,\n+    onLegendScroll,\n+  };\n+}\n\\ No newline at end of file", "pull_request_number": 36085}
{"sha": "a66f11033c0a4d4743c9bb446663002f25430023", "filename": "superset-frontend/src/dashboard/actions/dashboardState.js", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/apache/superset/blob/cf5f03752d43a363c20699931b810503a6c0fcb1/superset-frontend%2Fsrc%2Fdashboard%2Factions%2FdashboardState.js", "raw_url": "https://github.com/apache/superset/raw/cf5f03752d43a363c20699931b810503a6c0fcb1/superset-frontend%2Fsrc%2Fdashboard%2Factions%2FdashboardState.js", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fdashboard%2Factions%2FdashboardState.js?ref=cf5f03752d43a363c20699931b810503a6c0fcb1", "patch": "@@ -295,6 +295,7 @@ export function saveDashboardRequest(data, id, saveType) {\n       owners,\n       roles,\n       slug,\n+      description,\n       tags,\n     } = data;\n \n@@ -317,6 +318,7 @@ export function saveDashboardRequest(data, id, saveType) {\n         ? undefined\n         : ensureIsArray(roles).map(r => (hasId(r) ? r.id : r)),\n       slug: slug || null,\n+      description: description || null,\n       tags: !isFeatureEnabled(FeatureFlag.TaggingSystem)\n         ? undefined\n         : ensureIsArray(tags || []).map(r => (hasId(r) ? r.id : r)),\n@@ -453,6 +455,7 @@ export function saveDashboardRequest(data, id, saveType) {\n               css: cleanedData.css,\n               dashboard_title: cleanedData.dashboard_title,\n               slug: cleanedData.slug,\n+              description: cleanedData.description,\n               owners: cleanedData.owners,\n               roles: cleanedData.roles,\n               tags: cleanedData.tags || [],", "pull_request_number": 36071}
{"sha": "59f68df2d01ba72ae014969670fa5a52cd1799c8", "filename": "superset-frontend/src/dashboard/components/Header/index.jsx", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/apache/superset/blob/cf5f03752d43a363c20699931b810503a6c0fcb1/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FHeader%2Findex.jsx", "raw_url": "https://github.com/apache/superset/raw/cf5f03752d43a363c20699931b810503a6c0fcb1/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FHeader%2Findex.jsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FHeader%2Findex.jsx?ref=cf5f03752d43a363c20699931b810503a6c0fcb1", "patch": "@@ -424,6 +424,7 @@ const Header = () => {\n       owners: dashboardInfo.owners,\n       roles: dashboardInfo.roles,\n       slug,\n+      description: dashboardInfo.description,\n       tags: (dashboardInfo.tags || []).filter(\n         item => item.type === TagTypeEnum.Custom || !item.type,\n       ),\n@@ -478,6 +479,7 @@ const Header = () => {\n     refreshFrequency,\n     shouldPersistRefreshFrequency,\n     slug,\n+    dashboardInfo.description,\n   ]);\n \n   const {\n@@ -535,6 +537,7 @@ const Header = () => {\n     updates => {\n       boundActionCreators.dashboardInfoChanged({\n         slug: updates.slug,\n+        description: updates.description,\n         metadata: JSON.parse(updates.jsonMetadata || '{}'),\n         certified_by: updates.certifiedBy,\n         certification_details: updates.certificationDetails,", "pull_request_number": 36071}
{"sha": "9fd07f29153259bf827322f91964bcca88557926", "filename": "superset-frontend/src/dashboard/components/PropertiesModal/PropertiesModal.test.tsx", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/apache/superset/blob/cf5f03752d43a363c20699931b810503a6c0fcb1/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FPropertiesModal%2FPropertiesModal.test.tsx", "raw_url": "https://github.com/apache/superset/raw/cf5f03752d43a363c20699931b810503a6c0fcb1/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FPropertiesModal%2FPropertiesModal.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FPropertiesModal%2FPropertiesModal.test.tsx?ref=cf5f03752d43a363c20699931b810503a6c0fcb1", "patch": "@@ -209,7 +209,7 @@ describe('PropertiesModal', () => {\n     expect(screen.getByRole('button', { name: 'Save' })).toBeInTheDocument();\n \n     // Only General information section is expanded by default\n-    expect(screen.getAllByRole('textbox')).toHaveLength(2); // Name and Slug\n+    expect(screen.getAllByRole('textbox')).toHaveLength(3); // Name, Slug and Description\n \n     // Expand Styling section to see the ColorSchemeControlWrapper\n     const stylingHeaderText = screen.getByText('Styling');\n@@ -254,7 +254,7 @@ describe('PropertiesModal', () => {\n     expect(screen.getByText('Certification')).toBeInTheDocument();\n \n     // General information section is expanded by default\n-    expect(screen.getAllByRole('textbox')).toHaveLength(2); // Name and Slug are visible\n+    expect(screen.getAllByRole('textbox')).toHaveLength(3); // Name, Slug and Description are visible\n \n     // Expand Access & ownership to see Tags\n     const accessPanel = screen\n@@ -299,7 +299,7 @@ describe('PropertiesModal', () => {\n       await screen.findByTestId('dashboard-edit-properties-form'),\n     ).toBeInTheDocument();\n \n-    expect(screen.getAllByRole('textbox')).toHaveLength(2); // Only Name and Slug visible initially\n+    expect(screen.getAllByRole('textbox')).toHaveLength(3); // Only Name, Slug and Description visible initially\n \n     // Click on the Advanced settings collapse panel to expand it\n     const advancedHeaderText = screen.getByText('Advanced settings');", "pull_request_number": 36071}
{"sha": "17bb7f927e8cdfeadb148031f5839ad391262f66", "filename": "superset-frontend/src/dashboard/components/PropertiesModal/index.tsx", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/apache/superset/blob/cf5f03752d43a363c20699931b810503a6c0fcb1/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FPropertiesModal%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/cf5f03752d43a363c20699931b810503a6c0fcb1/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FPropertiesModal%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FPropertiesModal%2Findex.tsx?ref=cf5f03752d43a363c20699931b810503a6c0fcb1", "patch": "@@ -167,10 +167,12 @@ const PropertiesModal = ({\n         is_managed_externally,\n         theme,\n         css,\n+        description,\n       } = dashboardData;\n       const dashboardInfo = {\n         id,\n         title: dashboard_title,\n+        description: description || '',\n         slug: slug || '',\n         certifiedBy: certified_by || '',\n         certificationDetails: certification_details || '',\n@@ -280,7 +282,7 @@ const PropertiesModal = ({\n   };\n \n   const onFinish = () => {\n-    const { title, slug, certifiedBy, certificationDetails } =\n+    const { title, description = '', slug, certifiedBy, certificationDetails } =\n       form.getFieldsValue();\n     let currentJsonMetadata = jsonMetadata;\n \n@@ -358,6 +360,7 @@ const PropertiesModal = ({\n     const onSubmitProps = {\n       id: dashboardId,\n       title,\n+      description,\n       slug,\n       jsonMetadata: currentJsonMetadata,\n       owners,\n@@ -383,6 +386,7 @@ const PropertiesModal = ({\n     } else {\n       const saveData = {\n         dashboard_title: title,\n+        description: description || null,\n         slug: slug || null,\n         json_metadata: currentJsonMetadata || null,\n         owners: (owners || []).map(o => o.id),", "pull_request_number": 36071}
{"sha": "78f3ce5d8278ae6ce40ae64f2de33b53d6e0de73", "filename": "superset-frontend/src/dashboard/components/PropertiesModal/sections/BasicInfoSection.test.tsx", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/apache/superset/blob/cf5f03752d43a363c20699931b810503a6c0fcb1/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FPropertiesModal%2Fsections%2FBasicInfoSection.test.tsx", "raw_url": "https://github.com/apache/superset/raw/cf5f03752d43a363c20699931b810503a6c0fcb1/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FPropertiesModal%2Fsections%2FBasicInfoSection.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FPropertiesModal%2Fsections%2FBasicInfoSection.test.tsx?ref=cf5f03752d43a363c20699931b810503a6c0fcb1", "patch": "@@ -29,7 +29,7 @@ const defaultProps = {\n   },\n };\n \n-test('renders name and slug fields', () => {\n+test('renders name, description and slug fields', () => {\n   render(\n     <Form>\n       <BasicInfoSection {...defaultProps} />\n@@ -38,6 +38,7 @@ test('renders name and slug fields', () => {\n \n   expect(screen.getByTestId('dashboard-name-field')).toBeInTheDocument();\n   expect(screen.getByTestId('dashboard-slug-field')).toBeInTheDocument();\n+  expect(screen.getByTestId('dashboard-description-field')).toBeInTheDocument();\n   expect(screen.getByTestId('dashboard-title-input')).toBeInTheDocument();\n });\n ", "pull_request_number": 36071}
{"sha": "e544f1b7d6f66e7e3c3312edf34d5d52a81add66", "filename": "superset-frontend/src/dashboard/components/PropertiesModal/sections/BasicInfoSection.tsx", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/apache/superset/blob/cf5f03752d43a363c20699931b810503a6c0fcb1/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FPropertiesModal%2Fsections%2FBasicInfoSection.tsx", "raw_url": "https://github.com/apache/superset/raw/cf5f03752d43a363c20699931b810503a6c0fcb1/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FPropertiesModal%2Fsections%2FBasicInfoSection.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FPropertiesModal%2Fsections%2FBasicInfoSection.tsx?ref=cf5f03752d43a363c20699931b810503a6c0fcb1", "patch": "@@ -74,6 +74,18 @@ const BasicInfoSection = ({\n           />\n         </FormItem>\n       </ModalFormField>\n+      <ModalFormField\n+        label={t('Description')}\n+        testId=\"dashboard-description-field\"\n+        bottomSpacing={false}\n+      >\n+        <FormItem name=\"description\" noStyle>\n+          <Input.TextArea\n+            placeholder={t('A description for your dashboard')}\n+            data-test=\"dashboard-description-input\"\n+          />\n+        </FormItem>\n+      </ModalFormField>\n     </>\n   );\n };", "pull_request_number": 36071}
{"sha": "71285b7b3320ec903fa5a8d2c9815b5980ac03a1", "filename": "superset-frontend/src/pages/ChartList/index.tsx", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/apache/superset/blob/cf5f03752d43a363c20699931b810503a6c0fcb1/superset-frontend%2Fsrc%2Fpages%2FChartList%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/cf5f03752d43a363c20699931b810503a6c0fcb1/superset-frontend%2Fsrc%2Fpages%2FChartList%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fpages%2FChartList%2Findex.tsx?ref=cf5f03752d43a363c20699931b810503a6c0fcb1", "patch": "@@ -89,6 +89,7 @@ const FlexRowContainer = styled.div`\n     text-overflow: ellipsis;\n     white-space: nowrap;\n     line-height: 1.2;\n+    min-width: 0;\n   }\n \n   svg {", "pull_request_number": 36071}
{"sha": "cbfafaf72bfc5d57f05820f804a695358d874694", "filename": "superset-frontend/src/pages/DashboardList/DashboardList.test.jsx", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/cf5f03752d43a363c20699931b810503a6c0fcb1/superset-frontend%2Fsrc%2Fpages%2FDashboardList%2FDashboardList.test.jsx", "raw_url": "https://github.com/apache/superset/raw/cf5f03752d43a363c20699931b810503a6c0fcb1/superset-frontend%2Fsrc%2Fpages%2FDashboardList%2FDashboardList.test.jsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fpages%2FDashboardList%2FDashboardList.test.jsx?ref=cf5f03752d43a363c20699931b810503a6c0fcb1", "patch": "@@ -136,7 +136,7 @@ describe('DashboardList', () => {\n \n     const calls = fetchMock.calls(/dashboard\\/\\?q/);\n     expect(calls[0][0]).toMatchInlineSnapshot(\n-      `\"http://localhost/api/v1/dashboard/?q=(order_column:changed_on_delta_humanized,order_direction:desc,page:0,page_size:25,select_columns:!(id,dashboard_title,published,url,slug,changed_by,changed_by.id,changed_by.first_name,changed_by.last_name,changed_on_delta_humanized,owners,owners.id,owners.first_name,owners.last_name,tags.id,tags.name,tags.type,status,certified_by,certification_details,changed_on))\"`,\n+      `\"http://localhost/api/v1/dashboard/?q=(order_column:changed_on_delta_humanized,order_direction:desc,page:0,page_size:25,select_columns:!(id,dashboard_title,published,url,slug,description,changed_by,changed_by.id,changed_by.first_name,changed_by.last_name,changed_on_delta_humanized,owners,owners.id,owners.first_name,owners.last_name,tags.id,tags.name,tags.type,status,certified_by,certification_details,changed_on))\"`,\n     );\n   });\n ", "pull_request_number": 36071}
{"sha": "f85cbc4a61ea8170cccbf57a073b81cc34f0b8e9", "filename": "superset-frontend/src/pages/DashboardList/index.tsx", "status": "modified", "additions": 37, "deletions": 11, "changes": 48, "blob_url": "https://github.com/apache/superset/blob/cf5f03752d43a363c20699931b810503a6c0fcb1/superset-frontend%2Fsrc%2Fpages%2FDashboardList%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/cf5f03752d43a363c20699931b810503a6c0fcb1/superset-frontend%2Fsrc%2Fpages%2FDashboardList%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fpages%2FDashboardList%2Findex.tsx?ref=cf5f03752d43a363c20699931b810503a6c0fcb1", "patch": "@@ -38,6 +38,7 @@ import {\n   ConfirmStatusChange,\n   DeleteModal,\n   FaveStar,\n+  InfoTooltip,\n   Loading,\n   PublishedLabel,\n   Tooltip,\n@@ -118,12 +119,31 @@ const Actions = styled.div`\n   color: ${({ theme }) => theme.colorIcon};\n `;\n \n+const FlexRowContainer = styled.div`\n+  align-items: center;\n+  display: flex;\n+  gap: ${({ theme }) => theme.sizeUnit}px;\n+\n+  a {\n+    overflow: hidden;\n+    text-overflow: ellipsis;\n+    white-space: nowrap;\n+    line-height: 1.2;\n+    min-width: 0;\n+  }\n+\n+  svg {\n+    margin-right: ${({ theme }) => theme.sizeUnit}px;\n+  }\n+`;\n+\n const DASHBOARD_COLUMNS_TO_FETCH = [\n   'id',\n   'dashboard_title',\n   'published',\n   'url',\n   'slug',\n+  'description',\n   'changed_by',\n   'changed_by.id',\n   'changed_by.first_name',\n@@ -239,6 +259,7 @@ function DashboardList(props: DashboardListProps) {\n                 changed_by,\n                 dashboard_title = '',\n                 slug = '',\n+                description = '',\n                 json_metadata = '',\n                 changed_on_delta_humanized,\n                 url = '',\n@@ -253,6 +274,7 @@ function DashboardList(props: DashboardListProps) {\n                 changed_by,\n                 dashboard_title,\n                 slug,\n+                description,\n                 json_metadata,\n                 changed_on_delta_humanized,\n                 url,\n@@ -334,20 +356,24 @@ function DashboardList(props: DashboardListProps) {\n               dashboard_title: dashboardTitle,\n               certified_by: certifiedBy,\n               certification_details: certificationDetails,\n+              description,\n             },\n           },\n         }: any) => (\n-          <Link to={url} title={dashboardTitle}>\n-            {certifiedBy && (\n-              <>\n-                <CertifiedBadge\n-                  certifiedBy={certifiedBy}\n-                  details={certificationDetails}\n-                />{' '}\n-              </>\n-            )}\n-            {dashboardTitle}\n-          </Link>\n+          <FlexRowContainer>\n+            <Link to={url} title={dashboardTitle}>\n+              {certifiedBy && (\n+                <>\n+                  <CertifiedBadge\n+                    certifiedBy={certifiedBy}\n+                    details={certificationDetails}\n+                  />{' '}\n+                </>\n+              )}\n+              {dashboardTitle}\n+            </Link>\n+            {description && <InfoTooltip tooltip={description} />}\n+          </FlexRowContainer>\n         ),\n         Header: t('Name'),\n         accessor: 'dashboard_title',", "pull_request_number": 36071}
{"sha": "16c14041dbf9be1ae07a7cc6f7b3492160ea2cf8", "filename": "superset/dashboards/api.py", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/apache/superset/blob/cf5f03752d43a363c20699931b810503a6c0fcb1/superset%2Fdashboards%2Fapi.py", "raw_url": "https://github.com/apache/superset/raw/cf5f03752d43a363c20699931b810503a6c0fcb1/superset%2Fdashboards%2Fapi.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Fdashboards%2Fapi.py?ref=cf5f03752d43a363c20699931b810503a6c0fcb1", "patch": "@@ -175,6 +175,7 @@ def wraps(self: BaseSupersetModelRestApi, id_or_slug: str) -> Response:\n     \"published\",\n     \"status\",\n     \"slug\",\n+    \"description\",\n     \"url\",\n     \"thumbnail_url\",\n     \"certified_by\",\n@@ -338,6 +339,7 @@ def get_list(self, **kwargs: Any) -> Response:\n         \"certification_details\",\n         \"dashboard_title\",\n         \"slug\",\n+        \"description\",\n         \"owners\",\n         \"roles\",\n         \"position_json\",\n@@ -358,6 +360,7 @@ def get_list(self, **kwargs: Any) -> Response:\n         \"published\",\n         \"roles\",\n         \"slug\",\n+        \"description\",\n         \"tags\",\n         \"uuid\",\n     )", "pull_request_number": 36071}
{"sha": "d8935fb4aadeb7638988b5f702921cc89c9f98f3", "filename": "superset/dashboards/schemas.py", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/apache/superset/blob/cf5f03752d43a363c20699931b810503a6c0fcb1/superset%2Fdashboards%2Fschemas.py", "raw_url": "https://github.com/apache/superset/raw/cf5f03752d43a363c20699931b810503a6c0fcb1/superset%2Fdashboards%2Fschemas.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Fdashboards%2Fschemas.py?ref=cf5f03752d43a363c20699931b810503a6c0fcb1", "patch": "@@ -45,6 +45,7 @@\n     },\n }\n dashboard_title_description = \"A title for the dashboard.\"\n+description_description = \"A description for the dashboard.\"\n slug_description = \"Unique identifying part for the web address of the dashboard.\"\n owners_description = (\n     \"Owner are users ids allowed to delete or change this dashboard. \"\n@@ -241,6 +242,7 @@ class DashboardGetResponseSchema(Schema):\n     created_on_humanized = fields.String(data_key=\"created_on_delta_humanized\")\n     is_managed_externally = fields.Boolean(allow_none=True, dump_default=False)\n     uuid = fields.UUID(allow_none=True)\n+    description = fields.String(allow_none=True)\n \n     # pylint: disable=unused-argument\n     @post_dump()\n@@ -352,6 +354,10 @@ class DashboardPostSchema(BaseDashboardSchema):\n         allow_none=True,\n         validate=[Length(1, 255)],\n     )\n+    description = fields.String(\n+        metadata={\"description\": description_description},\n+        allow_none=True,\n+    )\n     owners = fields.List(fields.Integer(metadata={\"description\": owners_description}))\n     roles = fields.List(fields.Integer(metadata={\"description\": roles_description}))\n     position_json = fields.String(\n@@ -402,6 +408,10 @@ class DashboardPutSchema(BaseDashboardSchema):\n         allow_none=True,\n         validate=Length(0, 500),\n     )\n+    description = fields.String(\n+        metadata={\"description\": description_description},\n+        allow_none=True,\n+    )\n     slug = fields.String(\n         metadata={\"description\": slug_description},\n         allow_none=True,", "pull_request_number": 36071}
{"sha": "f89aa8a7c12e42f16b3e08d18f32e737c2e8c99d", "filename": "tests/integration_tests/base_tests.py", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/cf5f03752d43a363c20699931b810503a6c0fcb1/tests%2Fintegration_tests%2Fbase_tests.py", "raw_url": "https://github.com/apache/superset/raw/cf5f03752d43a363c20699931b810503a6c0fcb1/tests%2Fintegration_tests%2Fbase_tests.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/tests%2Fintegration_tests%2Fbase_tests.py?ref=cf5f03752d43a363c20699931b810503a6c0fcb1", "patch": "@@ -583,6 +583,7 @@ def insert_dashboard(\n         published: bool = False,\n         certified_by: Optional[str] = None,\n         certification_details: Optional[str] = None,\n+        desc: Optional[str] = None,\n     ) -> Dashboard:\n         obj_owners = list()  # noqa: C408\n         obj_roles = list()  # noqa: C408\n@@ -606,6 +607,7 @@ def insert_dashboard(\n         dashboard = Dashboard(\n             dashboard_title=dashboard_title,\n             slug=slug,\n+            description=desc,\n             owners=obj_owners,\n             roles=obj_roles,\n             position_json=position_json,", "pull_request_number": 36071}
{"sha": "c9f11bcf92cc4557ba301c14f7bdc9bfd8a5b332", "filename": "tests/integration_tests/dashboards/api_tests.py", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/apache/superset/blob/cf5f03752d43a363c20699931b810503a6c0fcb1/tests%2Fintegration_tests%2Fdashboards%2Fapi_tests.py", "raw_url": "https://github.com/apache/superset/raw/cf5f03752d43a363c20699931b810503a6c0fcb1/tests%2Fintegration_tests%2Fdashboards%2Fapi_tests.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/tests%2Fintegration_tests%2Fdashboards%2Fapi_tests.py?ref=cf5f03752d43a363c20699931b810503a6c0fcb1", "patch": "@@ -81,6 +81,7 @@ class TestDashboardApi(ApiOwnersTestCaseMixin, InsertChartMixin, SupersetTestCas\n     dashboard_data = {\n         \"dashboard_title\": \"title1_changed\",\n         \"slug\": \"slug1_changed\",\n+        \"description\": \"desc_changed\",\n         \"position_json\": '{\"b\": \"B\"}',\n         \"css\": \"css_changed\",\n         \"json_metadata\": '{\"refresh_frequency\": 30, \"timed_refresh_immune_slices\": [], \"expanded_slices\": {}, \"color_scheme\": \"\", \"label_colors\": {}, \"shared_label_colors\": [], \"map_label_colors\": {}, \"color_scheme_domain\": [], \"cross_filters_enabled\": false}',  # noqa: E501\n@@ -512,7 +513,7 @@ def test_get_dashboard(self):\n         \"\"\"\n         admin = self.get_user(\"admin\")\n         dashboard = self.insert_dashboard(\n-            \"title\", \"slug1\", [admin.id], created_by=admin\n+            \"title\", \"slug1\", [admin.id], created_by=admin, desc=\"description\"\n         )\n         self.login(ADMIN_USERNAME)\n         uri = f\"api/v1/dashboard/{dashboard.id}\"\n@@ -552,6 +553,7 @@ def test_get_dashboard(self):\n                 \"thumbnail_url\": dashboard.thumbnail_url,\n                 \"is_managed_externally\": False,\n                 \"theme\": None,\n+                \"description\": \"description\",\n             }\n         data = json.loads(rv.data.decode(\"utf-8\"))\n         assert \"changed_on\" in data[\"result\"]", "pull_request_number": 36071}
{"sha": "62c2423a1d803ca2142ce701d1d544bd09674cc7", "filename": "superset-frontend/packages/superset-ui-core/src/components/Pagination/index.tsx", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/apache/superset/blob/67f1e363162f88092c407859013028f386c73265/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FPagination%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/67f1e363162f88092c407859013028f386c73265/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FPagination%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FPagination%2Findex.tsx?ref=67f1e363162f88092c407859013028f386c73265", "patch": "@@ -0,0 +1,24 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import { Pagination as AntdPagination } from 'antd';\n+import type { PaginationProps as AntdPaginationProps } from 'antd';\n+\n+export type PaginationProps = AntdPaginationProps;\n+\n+export const Pagination = AntdPagination;", "pull_request_number": 36288}
{"sha": "96d17aa654714c427036b57348fbe2d73c8ebf41", "filename": "superset-frontend/packages/superset-ui-core/src/components/index.ts", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/67f1e363162f88092c407859013028f386c73265/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2Findex.ts", "raw_url": "https://github.com/apache/superset/raw/67f1e363162f88092c407859013028f386c73265/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2Findex.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2Findex.ts?ref=67f1e363162f88092c407859013028f386c73265", "patch": "@@ -147,6 +147,8 @@ export { Loading, type LoadingProps } from './Loading';\n \n export { Progress, type ProgressProps } from './Progress';\n \n+export { Pagination, type PaginationProps } from './Pagination';\n+\n export { Skeleton, type SkeletonProps } from './Skeleton';\n \n export { Switch, type SwitchProps } from './Switch';", "pull_request_number": 36288}
{"sha": "c1854462f8715bb79341aa08766a74bbeee0b21c", "filename": "superset-frontend/src/components/ListView/ListView.tsx", "status": "modified", "additions": 35, "deletions": 8, "changes": 43, "blob_url": "https://github.com/apache/superset/blob/67f1e363162f88092c407859013028f386c73265/superset-frontend%2Fsrc%2Fcomponents%2FListView%2FListView.tsx", "raw_url": "https://github.com/apache/superset/raw/67f1e363162f88092c407859013028f386c73265/superset-frontend%2Fsrc%2Fcomponents%2FListView%2FListView.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fcomponents%2FListView%2FListView.tsx?ref=67f1e363162f88092c407859013028f386c73265", "patch": "@@ -28,6 +28,7 @@ import {\n   Icons,\n   EmptyState,\n   Loading,\n+  Pagination,\n   type EmptyStateProps,\n } from '@superset-ui/core/components';\n import CardCollection from './CardCollection';\n@@ -91,6 +92,7 @@ const ListViewStyles = styled.div`\n     .row-count-container {\n       margin-top: ${theme.sizeUnit * 2}px;\n       color: ${theme.colorText};\n+      text-align: center;\n     }\n   `}\n `;\n@@ -446,14 +448,39 @@ export function ListView<T extends object = any>({\n             />\n           )}\n           {viewMode === 'card' && (\n-            <CardCollection\n-              bulkSelectEnabled={bulkSelectEnabled}\n-              prepareRow={prepareRow}\n-              renderCard={renderCard}\n-              rows={rows}\n-              loading={loading}\n-              showThumbnails={showThumbnails}\n-            />\n+            <>\n+              <CardCollection\n+                bulkSelectEnabled={bulkSelectEnabled}\n+                prepareRow={prepareRow}\n+                renderCard={renderCard}\n+                rows={rows}\n+                loading={loading}\n+                showThumbnails={showThumbnails}\n+              />\n+              {count > 0 && (\n+                <div className=\"pagination-container\">\n+                  <Pagination\n+                    current={pageIndex + 1}\n+                    pageSize={pageSize}\n+                    total={count}\n+                    onChange={page => {\n+                      gotoPage(page - 1);\n+                    }}\n+                    size=\"default\"\n+                    showSizeChanger={false}\n+                    showQuickJumper={false}\n+                    hideOnSinglePage\n+                    align=\"center\"\n+                  />\n+                  <div className=\"row-count-container\">\n+                    {`${pageIndex * pageSize + 1}-${Math.min(\n+                      (pageIndex + 1) * pageSize,\n+                      count,\n+                    )} of ${count}`}\n+                  </div>\n+                </div>\n+              )}\n+            </>\n           )}\n           {viewMode === 'table' && (\n             <>", "pull_request_number": 36288}
{"sha": "6d6cbcec23132d71bb7a0ec837fbf4de1ef19d02", "filename": "superset-frontend/plugins/plugin-chart-pivot-table/package.json", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/apache/superset/blob/f6af15764726e8254eb474a9e2b68832287a0d84/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fpackage.json", "raw_url": "https://github.com/apache/superset/raw/f6af15764726e8254eb474a9e2b68832287a0d84/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fpackage.json", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fpackage.json?ref=f6af15764726e8254eb474a9e2b68832287a0d84", "patch": "@@ -31,6 +31,11 @@\n     \"@ant-design/icons\": \"^5.2.6\",\n     \"@superset-ui/chart-controls\": \"*\",\n     \"@superset-ui/core\": \"*\",\n+    \"@testing-library/dom\": \"^8.20.1\",\n+    \"@testing-library/jest-dom\": \"*\",\n+    \"@testing-library/react\": \"^12.1.5\",\n+    \"@testing-library/react-hooks\": \"*\",\n+    \"@testing-library/user-event\": \"*\",\n     \"lodash\": \"^4.17.11\",\n     \"prop-types\": \"*\",\n     \"react\": \"^17.0.2\",", "pull_request_number": 36081}
{"sha": "20730dcdf2ece08eaf5793a127d555be69ce8433", "filename": "superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/Styles.js", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/apache/superset/blob/f6af15764726e8254eb474a9e2b68832287a0d84/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2Freact-pivottable%2FStyles.js", "raw_url": "https://github.com/apache/superset/raw/f6af15764726e8254eb474a9e2b68832287a0d84/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2Freact-pivottable%2FStyles.js", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2Freact-pivottable%2FStyles.js?ref=f6af15764726e8254eb474a9e2b68832287a0d84", "patch": "@@ -115,6 +115,10 @@ export const Styles = styled.div`\n       vertical-align: baseline;\n     }\n \n+    table.pvtTable tbody tr th.pvtRowLabel.pvtRowLabelLast {\n+      border-bottom: 1px solid ${theme.colorSplit};\n+    }\n+\n     .pvtTotal,\n     .pvtGrandTotal {\n       font-weight: ${theme.fontWeightStrong};", "pull_request_number": 36081}
{"sha": "6c3199c8cedeb0812763a7174a4ae09e44a8c930", "filename": "superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/apache/superset/blob/f6af15764726e8254eb474a9e2b68832287a0d84/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2Freact-pivottable%2FTableRenderers.jsx", "raw_url": "https://github.com/apache/superset/raw/f6af15764726e8254eb474a9e2b68832287a0d84/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2Freact-pivottable%2FTableRenderers.jsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2Freact-pivottable%2FTableRenderers.jsx?ref=f6af15764726e8254eb474a9e2b68832287a0d84", "patch": "@@ -609,6 +609,7 @@ export class TableRenderer extends Component {\n       rowTotalCallbacks,\n       namesMapping,\n       allowRenderHtml,\n+      visibleRowCount,\n     } = pivotSettings;\n \n     const {\n@@ -650,14 +651,20 @@ export class TableRenderer extends Component {\n           ? this.toggleRowKey(flatRowKey)\n           : null;\n \n+        const isLastRow = rowIdx + rowSpan === visibleRowCount;\n+        let cellClassName = valueCellClassName;\n+        if (isLastRow) {\n+          cellClassName += ' pvtRowLabelLast';\n+        }\n+\n         const headerCellFormattedValue =\n           dateFormatters && dateFormatters[rowAttrs[i]]\n             ? dateFormatters[rowAttrs[i]](r)\n             : r;\n         return (\n           <th\n             key={`rowKeyLabel-${i}`}\n-            className={valueCellClassName}\n+            className={cellClassName}\n             rowSpan={rowSpan}\n             colSpan={colSpan}\n             role=\"columnheader button\"\n@@ -916,6 +923,7 @@ export class TableRenderer extends Component {\n       maxColVisible: Math.max(...visibleColKeys.map(k => k.length)),\n       rowAttrSpans: this.calcAttrSpans(visibleRowKeys, rowAttrs.length),\n       colAttrSpans: this.calcAttrSpans(visibleColKeys, colAttrs.length),\n+      visibleRowCount: visibleRowKeys.length + (colTotals ? 1 : 0),\n       allowRenderHtml,\n       ...this.cachedBasePivotSettings,\n     };", "pull_request_number": 36081}
{"sha": "0077de4ad21d280aa8a08068145d82d7b349e040", "filename": "superset-frontend/plugins/plugin-chart-pivot-table/test/TableRenderer.test.tsx", "status": "added", "additions": 91, "deletions": 0, "changes": 91, "blob_url": "https://github.com/apache/superset/blob/f6af15764726e8254eb474a9e2b68832287a0d84/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Ftest%2FTableRenderer.test.tsx", "raw_url": "https://github.com/apache/superset/raw/f6af15764726e8254eb474a9e2b68832287a0d84/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Ftest%2FTableRenderer.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Ftest%2FTableRenderer.test.tsx?ref=f6af15764726e8254eb474a9e2b68832287a0d84", "patch": "@@ -0,0 +1,91 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import '@testing-library/jest-dom';\n+import { render } from '@testing-library/react';\n+import PivotTableChart from '../src/PivotTableChart';\n+import transformProps from '../src/plugin/transformProps';\n+import testData from './testData';\n+import { ProviderWrapper } from './testHelpers';\n+\n+test('applies pvtRowLabelLast class to last data row when colTotals is disabled', () => {\n+  const transformedProps = {\n+    ...transformProps(testData.withoutColTotals),\n+    margin: 32,\n+    legacy_order_by: null,\n+    order_desc: false,\n+  };\n+  const { container } = render(\n+    ProviderWrapper({\n+      children: <PivotTableChart {...transformedProps} />,\n+    }),\n+  );\n+\n+  const tableBody = container.querySelector('tbody');\n+  const dataRows = Array.from(tableBody?.querySelectorAll('tr') ?? []).filter(\n+    row => !row.classList.contains('pvtRowTotals'),\n+  );\n+\n+  // Get the last data row\n+  const lastDataRow = dataRows[dataRows.length - 1];\n+  expect(lastDataRow).toBeInTheDocument();\n+\n+  // Check if any cell in the last data row has pvtRowLabelLast class\n+  const lastRowCells = lastDataRow.querySelectorAll('th.pvtRowLabel');\n+  const hasLastClass = Array.from(lastRowCells).some(cell =>\n+    cell.classList.contains('pvtRowLabelLast'),\n+  );\n+\n+  expect(hasLastClass).toBe(true);\n+});\n+\n+test('does not apply pvtRowLabelLast class to last data row when colTotals is enabled', () => {\n+  const transformedProps = {\n+    ...transformProps(testData.withColTotals),\n+    margin: 32,\n+    legacy_order_by: null,\n+    order_desc: false,\n+  };\n+  const { container } = render(\n+    ProviderWrapper({\n+      children: <PivotTableChart {...transformedProps} />,\n+    }),\n+  );\n+\n+  const tableBody = container.querySelector('tbody');\n+  const dataRows = Array.from(tableBody?.querySelectorAll('tr') ?? []).filter(\n+    row => !row.classList.contains('pvtRowTotals'),\n+  );\n+\n+  // Get the last data row (before totals row)\n+  const lastDataRow = dataRows[dataRows.length - 1];\n+  expect(lastDataRow).toBeInTheDocument();\n+\n+  // Check if any cell in the last data row has pvtRowLabelLast class\n+  const lastRowCells = lastDataRow.querySelectorAll('th.pvtRowLabel');\n+  const hasLastClass = Array.from(lastRowCells).some(cell =>\n+    cell.classList.contains('pvtRowLabelLast'),\n+  );\n+\n+  // Should NOT have the class because totals row will have the border\n+  expect(hasLastClass).toBe(false);\n+\n+  // Verify totals row exists\n+  const totalsRow = container.querySelector('tr.pvtRowTotals');\n+  expect(totalsRow).toBeInTheDocument();\n+});", "pull_request_number": 36081}
{"sha": "05398d0e0146adf5eb363d4bc1b44462a358ac45", "filename": "superset-frontend/plugins/plugin-chart-pivot-table/test/testData.ts", "status": "added", "additions": 156, "deletions": 0, "changes": 156, "blob_url": "https://github.com/apache/superset/blob/f6af15764726e8254eb474a9e2b68832287a0d84/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Ftest%2FtestData.ts", "raw_url": "https://github.com/apache/superset/raw/f6af15764726e8254eb474a9e2b68832287a0d84/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Ftest%2FtestData.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Ftest%2FtestData.ts?ref=f6af15764726e8254eb474a9e2b68832287a0d84", "patch": "@@ -0,0 +1,156 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import {\n+  ChartDataResponseResult,\n+  ChartProps,\n+  DatasourceType,\n+  VizType,\n+  QueryFormData,\n+} from '@superset-ui/core';\n+import { supersetTheme } from '@apache-superset/core/ui';\n+import { GenericDataType } from '@apache-superset/core/api/core';\n+\n+const basicFormData: QueryFormData = {\n+  datasource: '1__table',\n+  viz_type: VizType.PivotTable,\n+  groupbyRows: ['country'],\n+  groupbyColumns: ['city'],\n+  metrics: ['SUM(sales)'],\n+  metricsLayout: 'COLUMNS',\n+  rowOrder: 'key_a_to_z',\n+  colOrder: 'key_a_to_z',\n+  aggregateFunction: 'Sum',\n+  rowSubTotals: false,\n+  colTotals: true,\n+  colSubTotals: false,\n+  rowTotals: true,\n+  valueFormat: 'SMART_NUMBER',\n+  dateFormat: 'smart_date',\n+  transposePivot: false,\n+  combineMetric: false,\n+  rowSubtotalPosition: false,\n+  colSubtotalPosition: false,\n+};\n+\n+const basicChartProps = {\n+  width: 800,\n+  height: 600,\n+  datasource: {\n+    id: 1,\n+    name: 'test_dataset',\n+    type: DatasourceType.Table,\n+    columns: [],\n+    metrics: [],\n+    columnFormats: {},\n+    verboseMap: {},\n+  },\n+  hooks: {},\n+  initialValues: {},\n+  queriesData: [\n+    {\n+      data: {\n+        columns: [],\n+        records: [],\n+      },\n+    },\n+  ],\n+  formData: basicFormData,\n+  theme: supersetTheme,\n+};\n+\n+const basicQueryResult: ChartDataResponseResult = {\n+  annotation_data: null,\n+  cache_key: null,\n+  cached_dttm: null,\n+  cache_timeout: null,\n+  data: [],\n+  colnames: [],\n+  coltypes: [],\n+  error: null,\n+  is_cached: false,\n+  query: 'SELECT ...',\n+  rowcount: 100,\n+  sql_rowcount: 100,\n+  stacktrace: null,\n+  status: 'success',\n+  from_dttm: null,\n+  to_dttm: null,\n+};\n+\n+// Shared test data\n+const pivotData = [\n+  { country: 'France', city: 'Paris', 'SUM(sales)': 1000 },\n+  { country: 'Germany', city: 'Berlin', 'SUM(sales)': 2000 },\n+  { country: 'Spain', city: 'Madrid', 'SUM(sales)': 1500 },\n+  { country: 'Italy', city: 'Rome', 'SUM(sales)': 3000 },\n+  { country: 'UK', city: 'London', 'SUM(sales)': 2500 },\n+];\n+\n+// Shared query result structure\n+const basicQueriesData = [\n+  {\n+    ...basicQueryResult,\n+    colnames: ['country', 'city', 'SUM(sales)'],\n+    coltypes: [\n+      GenericDataType.String,\n+      GenericDataType.String,\n+      GenericDataType.Numeric,\n+    ],\n+    data: pivotData,\n+  },\n+];\n+\n+/**\n+ * Pivot table data with colTotals enabled\n+ */\n+const withColTotals = {\n+  ...new ChartProps({\n+    ...basicChartProps,\n+    formData: {\n+      ...basicFormData,\n+      colTotals: true,\n+      rowTotals: true,\n+      rowSubTotals: false,\n+      colSubTotals: false,\n+    },\n+  }),\n+  queriesData: basicQueriesData,\n+};\n+\n+/**\n+ * Pivot table data without colTotals\n+ */\n+const withoutColTotals = {\n+  ...new ChartProps({\n+    ...basicChartProps,\n+    formData: {\n+      ...basicFormData,\n+      colTotals: false,\n+      rowTotals: false,\n+      rowSubTotals: false,\n+      colSubTotals: false,\n+    },\n+  }),\n+  queriesData: basicQueriesData,\n+};\n+\n+export default {\n+  withColTotals,\n+  withoutColTotals,\n+};", "pull_request_number": 36081}
{"sha": "ebb0db9bd7fbe5d0f9ba72aa0f82951ffe716acb", "filename": "superset-frontend/plugins/plugin-chart-pivot-table/test/testHelpers.tsx", "status": "added", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/apache/superset/blob/f6af15764726e8254eb474a9e2b68832287a0d84/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Ftest%2FtestHelpers.tsx", "raw_url": "https://github.com/apache/superset/raw/f6af15764726e8254eb474a9e2b68832287a0d84/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Ftest%2FtestHelpers.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Ftest%2FtestHelpers.tsx?ref=f6af15764726e8254eb474a9e2b68832287a0d84", "patch": "@@ -0,0 +1,37 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import {\n+  supersetTheme,\n+  ThemeProvider,\n+  EmotionCacheProvider,\n+  createEmotionCache,\n+} from '@apache-superset/core/ui';\n+\n+const emotionCache = createEmotionCache({\n+  key: 'test',\n+});\n+\n+export function ProviderWrapper(props: any) {\n+  const { children, theme = supersetTheme } = props;\n+  return (\n+    <EmotionCacheProvider value={emotionCache}>\n+      <ThemeProvider theme={theme}>{children}</ThemeProvider>\n+    </EmotionCacheProvider>\n+  );\n+}", "pull_request_number": 36081}
{"sha": "e24cb207084b803169a4ef4936d98e5b35c172ab", "filename": "superset-frontend/plugins/plugin-chart-pivot-table/test/tsconfig.json", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/apache/superset/blob/f6af15764726e8254eb474a9e2b68832287a0d84/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Ftest%2Ftsconfig.json", "raw_url": "https://github.com/apache/superset/raw/f6af15764726e8254eb474a9e2b68832287a0d84/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Ftest%2Ftsconfig.json", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Ftest%2Ftsconfig.json?ref=f6af15764726e8254eb474a9e2b68832287a0d84", "patch": "@@ -0,0 +1,9 @@\n+{\n+  \"compilerOptions\": {\n+    \"composite\": false,\n+    \"emitDeclarationOnly\": false,\n+    \"rootDir\": \"../../../\"\n+  },\n+  \"extends\": \"../../../tsconfig.json\",\n+  \"include\": [\"**/*\", \"../types/**/*\", \"../../../types/**/*\"]\n+}", "pull_request_number": 36081}
{"sha": "2a91c32ac5d7d63780cd9b32b2b6e07ff5f96191", "filename": "superset-frontend/packages/superset-ui-core/src/components/Select/Select.test.tsx", "status": "modified", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/apache/superset/blob/14a4336a691a16c0e259b07fc0f0f8a2549c89fe/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FSelect%2FSelect.test.tsx", "raw_url": "https://github.com/apache/superset/raw/14a4336a691a16c0e259b07fc0f0f8a2549c89fe/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FSelect%2FSelect.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FSelect%2FSelect.test.tsx?ref=14a4336a691a16c0e259b07fc0f0f8a2549c89fe", "patch": "@@ -1160,6 +1160,33 @@ describe('grouped options search', () => {\n   });\n });\n \n+test('should not call search after unmount', async () => {\n+  const mockOnSearch = jest.fn();\n+  const { unmount, rerender } = render(\n+    <Select\n+      {...defaultProps}\n+      allowNewOptions\n+      mode=\"multiple\"\n+      onSearch={mockOnSearch}\n+    />,\n+  );\n+  await type('12', 0);\n+  unmount();\n+  await new Promise(resolve => setTimeout(resolve, 300));\n+  expect(mockOnSearch).toHaveBeenCalledWith('12');\n+  rerender(\n+    <Select\n+      {...defaultProps}\n+      allowNewOptions\n+      mode=\"multiple\"\n+      onSearch={mockOnSearch}\n+    />,\n+  );\n+  await type('1234', 0);\n+  unmount();\n+  await new Promise(resolve => setTimeout(resolve, 300));\n+  expect(mockOnSearch).toHaveBeenCalledWith('1234');\n+});\n /*\n  TODO: Add tests that require scroll interaction. Needs further investigation.\n  - Fetches more data when scrolling and more data is available", "pull_request_number": 35218}
{"sha": "66981019634d80b41976d0804232b414219742f6", "filename": "superset-frontend/packages/superset-ui-core/src/components/Select/Select.tsx", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/apache/superset/blob/14a4336a691a16c0e259b07fc0f0f8a2549c89fe/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FSelect%2FSelect.tsx", "raw_url": "https://github.com/apache/superset/raw/14a4336a691a16c0e259b07fc0f0f8a2549c89fe/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FSelect%2FSelect.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FSelect%2FSelect.tsx?ref=14a4336a691a16c0e259b07fc0f0f8a2549c89fe", "patch": "@@ -400,7 +400,11 @@ const Select = forwardRef(\n       onSearch?.(searchValue);\n     }, Constants.FAST_DEBOUNCE);\n \n-    useEffect(() => () => handleOnSearch.cancel(), [handleOnSearch]);\n+    useEffect(() => {\n+      if (handleOnSearch !== undefined) {\n+        handleOnSearch.cancel();\n+      }\n+    }, [handleOnSearch]);\n \n     const handleOnDropdownVisibleChange = (isDropdownVisible: boolean) => {\n       setIsDropdownVisible(isDropdownVisible);", "pull_request_number": 35218}
{"sha": "e26d5dc60fe4c5a9e1080c46ba2b5255f6a14a72", "filename": "superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/ColumnSelect.test.tsx", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/apache/superset/blob/14a4336a691a16c0e259b07fc0f0f8a2549c89fe/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FnativeFilters%2FFiltersConfigModal%2FFiltersConfigForm%2FColumnSelect.test.tsx", "raw_url": "https://github.com/apache/superset/raw/14a4336a691a16c0e259b07fc0f0f8a2549c89fe/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FnativeFilters%2FFiltersConfigModal%2FFiltersConfigForm%2FColumnSelect.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FnativeFilters%2FFiltersConfigModal%2FFiltersConfigForm%2FColumnSelect.test.tsx?ref=14a4336a691a16c0e259b07fc0f0f8a2549c89fe", "patch": "@@ -84,11 +84,7 @@ test('Should render', async () => {\n         name: 'column_name_01',\n       }),\n     ).toBeInTheDocument();\n-  });\n-  await waitFor(() => {\n     expect(screen.getByTitle('column_name_02')).toBeInTheDocument();\n-  });\n-  await waitFor(() => {\n     expect(screen.getByTitle('column_name_03')).toBeInTheDocument();\n   });\n });\n@@ -135,11 +131,7 @@ test('Should filter results', async () => {\n         name: 'column_name_01',\n       }),\n     ).toBeInTheDocument();\n-  });\n-  await waitFor(() => {\n     expect(screen.queryByTitle('column_name_02')).not.toBeInTheDocument();\n-  });\n-  await waitFor(() => {\n     expect(screen.queryByTitle('column_name_03')).not.toBeInTheDocument();\n   });\n });", "pull_request_number": 35218}
{"sha": "eac5d13df7cf40dd2c9f439de4ebf7725f2bbcbf", "filename": "superset-frontend/plugins/legacy-preset-chart-deckgl/src/Multi/Multi.test.tsx", "status": "added", "additions": 524, "deletions": 0, "changes": 524, "blob_url": "https://github.com/apache/superset/blob/1e4391c546452411dc610508cfd1d68f155b36ed/superset-frontend%2Fplugins%2Flegacy-preset-chart-deckgl%2Fsrc%2FMulti%2FMulti.test.tsx", "raw_url": "https://github.com/apache/superset/raw/1e4391c546452411dc610508cfd1d68f155b36ed/superset-frontend%2Fplugins%2Flegacy-preset-chart-deckgl%2Fsrc%2FMulti%2FMulti.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Flegacy-preset-chart-deckgl%2Fsrc%2FMulti%2FMulti.test.tsx?ref=1e4391c546452411dc610508cfd1d68f155b36ed", "patch": "@@ -0,0 +1,524 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import { render, screen, waitFor } from '@testing-library/react';\n+import '@testing-library/jest-dom';\n+import { supersetTheme, ThemeProvider } from '@apache-superset/core/ui';\n+import { Provider } from 'react-redux';\n+import { configureStore } from '@reduxjs/toolkit';\n+import { DatasourceType, SupersetClient } from '@superset-ui/core';\n+import DeckMulti from './Multi';\n+import * as fitViewportModule from '../utils/fitViewport';\n+\n+// Mock DeckGLContainer\n+jest.mock('../DeckGLContainer', () => ({\n+  DeckGLContainerStyledWrapper: ({ viewport, layers }: any) => (\n+    <div\n+      data-test=\"deckgl-container\"\n+      data-viewport={JSON.stringify(viewport)}\n+      data-layers-count={layers?.length || 0}\n+    >\n+      DeckGL Container Mock\n+    </div>\n+  ),\n+}));\n+\n+// Mock SupersetClient\n+jest.mock('@superset-ui/core', () => ({\n+  ...jest.requireActual('@superset-ui/core'),\n+  SupersetClient: {\n+    get: jest.fn(),\n+  },\n+}));\n+\n+const mockStore = configureStore({\n+  reducer: {\n+    dataMask: () => ({}),\n+  },\n+});\n+\n+const baseMockProps = {\n+  formData: {\n+    datasource: 'test_datasource',\n+    viz_type: 'deck_multi',\n+    deck_slices: [1, 2],\n+    autozoom: false,\n+    mapbox_style: 'mapbox://styles/mapbox/light-v9',\n+  },\n+  payload: {\n+    data: {\n+      slices: [\n+        {\n+          slice_id: 1,\n+          form_data: {\n+            viz_type: 'deck_scatter',\n+            datasource: 'test_datasource',\n+          },\n+        },\n+        {\n+          slice_id: 2,\n+          form_data: {\n+            viz_type: 'deck_polygon',\n+            datasource: 'test_datasource',\n+          },\n+        },\n+      ],\n+      features: {\n+        deck_scatter: [{ position: [0, 0] }],\n+        deck_polygon: [\n+          {\n+            polygon: [\n+              [1, 1],\n+              [2, 2],\n+            ],\n+          },\n+        ],\n+        deck_path: [],\n+        deck_grid: [],\n+        deck_contour: [],\n+        deck_heatmap: [],\n+        deck_hex: [],\n+        deck_arc: [],\n+        deck_geojson: [],\n+        deck_screengrid: [],\n+      },\n+      mapboxApiKey: 'test-key',\n+    },\n+  },\n+  setControlValue: jest.fn(),\n+  viewport: { longitude: 0, latitude: 0, zoom: 1 },\n+  onAddFilter: jest.fn(),\n+  height: 600,\n+  width: 800,\n+  datasource: {\n+    id: 1,\n+    type: DatasourceType.Table,\n+    name: 'test_datasource',\n+    columns: [],\n+    metrics: [],\n+    columnFormats: {},\n+    currencyFormats: {},\n+    verboseMap: {},\n+  },\n+  onSelect: jest.fn(),\n+};\n+\n+const renderWithProviders = (component: React.ReactElement) =>\n+  render(\n+    <Provider store={mockStore}>\n+      <ThemeProvider theme={supersetTheme}>{component}</ThemeProvider>\n+    </Provider>,\n+  );\n+\n+describe('DeckMulti Autozoom Functionality', () => {\n+  beforeEach(() => {\n+    jest.clearAllMocks();\n+    (SupersetClient.get as jest.Mock).mockResolvedValue({\n+      json: {\n+        data: {\n+          features: [],\n+        },\n+      },\n+    });\n+  });\n+\n+  it('should NOT apply autozoom when autozoom is false', () => {\n+    const fitViewportSpy = jest.spyOn(fitViewportModule, 'default');\n+\n+    const props = {\n+      ...baseMockProps,\n+      formData: {\n+        ...baseMockProps.formData,\n+        autozoom: false,\n+      },\n+    };\n+\n+    renderWithProviders(<DeckMulti {...props} />);\n+\n+    // fitViewport should not be called when autozoom is false\n+    expect(fitViewportSpy).not.toHaveBeenCalled();\n+\n+    fitViewportSpy.mockRestore();\n+  });\n+\n+  it('should apply autozoom when autozoom is true', () => {\n+    const fitViewportSpy = jest.spyOn(fitViewportModule, 'default');\n+    fitViewportSpy.mockReturnValue({\n+      longitude: -122.4,\n+      latitude: 37.8,\n+      zoom: 10,\n+    });\n+\n+    const props = {\n+      ...baseMockProps,\n+      formData: {\n+        ...baseMockProps.formData,\n+        autozoom: true,\n+      },\n+    };\n+\n+    renderWithProviders(<DeckMulti {...props} />);\n+\n+    // fitViewport should be called with the points from all layers\n+    expect(fitViewportSpy).toHaveBeenCalledWith(\n+      expect.objectContaining({\n+        longitude: 0,\n+        latitude: 0,\n+        zoom: 1,\n+      }),\n+      expect.objectContaining({\n+        width: 800,\n+        height: 600,\n+        points: expect.any(Array),\n+      }),\n+    );\n+\n+    fitViewportSpy.mockRestore();\n+  });\n+\n+  it('should use adjusted viewport when autozoom is enabled', async () => {\n+    const fitViewportSpy = jest.spyOn(fitViewportModule, 'default');\n+    const adjustedViewport = {\n+      longitude: -122.4,\n+      latitude: 37.8,\n+      zoom: 12,\n+    };\n+    fitViewportSpy.mockReturnValue(adjustedViewport);\n+\n+    const props = {\n+      ...baseMockProps,\n+      formData: {\n+        ...baseMockProps.formData,\n+        autozoom: true,\n+      },\n+    };\n+\n+    renderWithProviders(<DeckMulti {...props} />);\n+\n+    await waitFor(() => {\n+      const container = screen.getByTestId('deckgl-container');\n+      const viewportData = JSON.parse(\n+        container.getAttribute('data-viewport') || '{}',\n+      );\n+\n+      expect(viewportData.longitude).toBe(adjustedViewport.longitude);\n+      expect(viewportData.latitude).toBe(adjustedViewport.latitude);\n+      expect(viewportData.zoom).toBe(adjustedViewport.zoom);\n+    });\n+\n+    fitViewportSpy.mockRestore();\n+  });\n+\n+  it('should set zoom to 0 when calculated zoom is negative', async () => {\n+    const fitViewportSpy = jest.spyOn(fitViewportModule, 'default');\n+    fitViewportSpy.mockReturnValue({\n+      longitude: 0,\n+      latitude: 0,\n+      zoom: -5, // negative zoom\n+    });\n+\n+    const props = {\n+      ...baseMockProps,\n+      formData: {\n+        ...baseMockProps.formData,\n+        autozoom: true,\n+      },\n+    };\n+\n+    renderWithProviders(<DeckMulti {...props} />);\n+\n+    await waitFor(() => {\n+      const container = screen.getByTestId('deckgl-container');\n+      const viewportData = JSON.parse(\n+        container.getAttribute('data-viewport') || '{}',\n+      );\n+\n+      // Zoom should be 0, not negative\n+      expect(viewportData.zoom).toBe(0);\n+    });\n+\n+    fitViewportSpy.mockRestore();\n+  });\n+\n+  it('should handle empty features gracefully when autozoom is enabled', () => {\n+    const fitViewportSpy = jest.spyOn(fitViewportModule, 'default');\n+\n+    const props = {\n+      ...baseMockProps,\n+      formData: {\n+        ...baseMockProps.formData,\n+        autozoom: true,\n+      },\n+      payload: {\n+        ...baseMockProps.payload,\n+        data: {\n+          ...baseMockProps.payload.data,\n+          features: {\n+            deck_scatter: [],\n+            deck_polygon: [],\n+            deck_path: [],\n+            deck_grid: [],\n+            deck_contour: [],\n+            deck_heatmap: [],\n+            deck_hex: [],\n+            deck_arc: [],\n+            deck_geojson: [],\n+            deck_screengrid: [],\n+          },\n+        },\n+      },\n+    };\n+\n+    renderWithProviders(<DeckMulti {...props} />);\n+\n+    // fitViewport should not be called when there are no points\n+    expect(fitViewportSpy).not.toHaveBeenCalled();\n+\n+    fitViewportSpy.mockRestore();\n+  });\n+\n+  it('should collect points from all layer types when autozoom is enabled', () => {\n+    const fitViewportSpy = jest.spyOn(fitViewportModule, 'default');\n+    fitViewportSpy.mockReturnValue({\n+      longitude: 0,\n+      latitude: 0,\n+      zoom: 10,\n+    });\n+\n+    const props = {\n+      ...baseMockProps,\n+      formData: {\n+        ...baseMockProps.formData,\n+        autozoom: true,\n+      },\n+      payload: {\n+        ...baseMockProps.payload,\n+        data: {\n+          ...baseMockProps.payload.data,\n+          features: {\n+            deck_scatter: [{ position: [1, 1] }, { position: [2, 2] }],\n+            deck_polygon: [\n+              {\n+                polygon: [\n+                  [3, 3],\n+                  [4, 4],\n+                ],\n+              },\n+            ],\n+            deck_arc: [{ sourcePosition: [5, 5], targetPosition: [6, 6] }],\n+            deck_path: [],\n+            deck_grid: [],\n+            deck_contour: [],\n+            deck_heatmap: [],\n+            deck_hex: [],\n+            deck_geojson: [],\n+            deck_screengrid: [],\n+          },\n+        },\n+      },\n+    };\n+\n+    renderWithProviders(<DeckMulti {...props} />);\n+\n+    expect(fitViewportSpy).toHaveBeenCalled();\n+    const callArgs = fitViewportSpy.mock.calls[0];\n+    const { points } = callArgs[1];\n+\n+    // Should have points from scatter (2), polygon (2), and arc (2) = 6 points total\n+    expect(points.length).toBeGreaterThan(0);\n+\n+    fitViewportSpy.mockRestore();\n+  });\n+\n+  it('should use original viewport when autozoom is disabled', async () => {\n+    const fitViewportSpy = jest.spyOn(fitViewportModule, 'default');\n+\n+    const originalViewport = { longitude: -100, latitude: 40, zoom: 5 };\n+    const props = {\n+      ...baseMockProps,\n+      viewport: originalViewport,\n+      formData: {\n+        ...baseMockProps.formData,\n+        autozoom: false,\n+      },\n+    };\n+\n+    renderWithProviders(<DeckMulti {...props} />);\n+\n+    await waitFor(() => {\n+      const container = screen.getByTestId('deckgl-container');\n+      const viewportData = JSON.parse(\n+        container.getAttribute('data-viewport') || '{}',\n+      );\n+\n+      // Should use original viewport without modification\n+      expect(viewportData.longitude).toBe(originalViewport.longitude);\n+      expect(viewportData.latitude).toBe(originalViewport.latitude);\n+      expect(viewportData.zoom).toBe(originalViewport.zoom);\n+    });\n+\n+    // fitViewport should not have been called\n+    expect(fitViewportSpy).not.toHaveBeenCalled();\n+\n+    fitViewportSpy.mockRestore();\n+  });\n+\n+  it('should apply autozoom when autozoom is undefined (backward compatibility)', () => {\n+    const fitViewportSpy = jest.spyOn(fitViewportModule, 'default');\n+    fitViewportSpy.mockReturnValue({\n+      longitude: -122.4,\n+      latitude: 37.8,\n+      zoom: 10,\n+    });\n+\n+    const props = {\n+      ...baseMockProps,\n+      formData: {\n+        ...baseMockProps.formData,\n+        autozoom: undefined, // Simulating existing charts created before this feature\n+      },\n+    };\n+\n+    renderWithProviders(<DeckMulti {...props} />);\n+\n+    // fitViewport should be called for backward compatibility with existing charts\n+    expect(fitViewportSpy).toHaveBeenCalledWith(\n+      expect.objectContaining({\n+        longitude: 0,\n+        latitude: 0,\n+        zoom: 1,\n+      }),\n+      expect.objectContaining({\n+        width: 800,\n+        height: 600,\n+        points: expect.any(Array),\n+      }),\n+    );\n+\n+    fitViewportSpy.mockRestore();\n+  });\n+\n+  it('should use adjusted viewport when autozoom is undefined', async () => {\n+    const fitViewportSpy = jest.spyOn(fitViewportModule, 'default');\n+    const adjustedViewport = {\n+      longitude: -122.4,\n+      latitude: 37.8,\n+      zoom: 12,\n+    };\n+    fitViewportSpy.mockReturnValue(adjustedViewport);\n+\n+    const props = {\n+      ...baseMockProps,\n+      formData: {\n+        ...baseMockProps.formData,\n+        autozoom: undefined, // Simulating existing charts\n+      },\n+    };\n+\n+    renderWithProviders(<DeckMulti {...props} />);\n+\n+    await waitFor(() => {\n+      const container = screen.getByTestId('deckgl-container');\n+      const viewportData = JSON.parse(\n+        container.getAttribute('data-viewport') || '{}',\n+      );\n+\n+      // Should use adjusted viewport for backward compatibility\n+      expect(viewportData.longitude).toBe(adjustedViewport.longitude);\n+      expect(viewportData.latitude).toBe(adjustedViewport.latitude);\n+      expect(viewportData.zoom).toBe(adjustedViewport.zoom);\n+    });\n+\n+    fitViewportSpy.mockRestore();\n+  });\n+});\n+\n+describe('DeckMulti Component Rendering', () => {\n+  beforeEach(() => {\n+    jest.clearAllMocks();\n+    (SupersetClient.get as jest.Mock).mockResolvedValue({\n+      json: {\n+        data: {\n+          features: [],\n+        },\n+      },\n+    });\n+  });\n+\n+  it('should render DeckGLContainer', async () => {\n+    renderWithProviders(<DeckMulti {...baseMockProps} />);\n+\n+    await waitFor(() => {\n+      expect(screen.getByTestId('deckgl-container')).toBeInTheDocument();\n+    });\n+  });\n+\n+  it('should pass correct props to DeckGLContainer', async () => {\n+    renderWithProviders(<DeckMulti {...baseMockProps} />);\n+\n+    await waitFor(() => {\n+      const container = screen.getByTestId('deckgl-container');\n+      const viewportData = JSON.parse(\n+        container.getAttribute('data-viewport') || '{}',\n+      );\n+\n+      expect(viewportData).toMatchObject({\n+        longitude: baseMockProps.viewport.longitude,\n+        latitude: baseMockProps.viewport.latitude,\n+        zoom: baseMockProps.viewport.zoom,\n+      });\n+    });\n+  });\n+\n+  it('should handle viewport changes', async () => {\n+    const { rerender } = renderWithProviders(<DeckMulti {...baseMockProps} />);\n+\n+    // Wait for initial render\n+    await waitFor(() => {\n+      expect(screen.getByTestId('deckgl-container')).toBeInTheDocument();\n+    });\n+\n+    const newViewport = { longitude: 10, latitude: 20, zoom: 8 };\n+    const updatedProps = {\n+      ...baseMockProps,\n+      viewport: newViewport,\n+      formData: {\n+        ...baseMockProps.formData,\n+        deck_slices: [1, 2, 3], // Change deck_slices to trigger loadLayers\n+      },\n+    };\n+\n+    rerender(\n+      <Provider store={mockStore}>\n+        <ThemeProvider theme={supersetTheme}>\n+          <DeckMulti {...updatedProps} />\n+        </ThemeProvider>\n+      </Provider>,\n+    );\n+\n+    await waitFor(() => {\n+      const container = screen.getByTestId('deckgl-container');\n+      const viewportData = JSON.parse(\n+        container.getAttribute('data-viewport') || '{}',\n+      );\n+\n+      expect(viewportData.longitude).toBe(newViewport.longitude);\n+      expect(viewportData.latitude).toBe(newViewport.latitude);\n+    });\n+  });\n+});", "pull_request_number": 37221}
{"sha": "1ee7ee12707b5e9da0755442f0ea77fc88d66a98", "filename": "superset-frontend/plugins/legacy-preset-chart-deckgl/src/Multi/Multi.tsx", "status": "modified", "additions": 26, "deletions": 19, "changes": 45, "blob_url": "https://github.com/apache/superset/blob/1e4391c546452411dc610508cfd1d68f155b36ed/superset-frontend%2Fplugins%2Flegacy-preset-chart-deckgl%2Fsrc%2FMulti%2FMulti.tsx", "raw_url": "https://github.com/apache/superset/raw/1e4391c546452411dc610508cfd1d68f155b36ed/superset-frontend%2Fplugins%2Flegacy-preset-chart-deckgl%2Fsrc%2FMulti%2FMulti.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Flegacy-preset-chart-deckgl%2Fsrc%2FMulti%2FMulti.tsx?ref=1e4391c546452411dc610508cfd1d68f155b36ed", "patch": "@@ -115,26 +115,33 @@ const DeckMulti = (props: DeckMultiProps) => {\n \n   const getAdjustedViewport = useCallback(() => {\n     let viewport = { ...props.viewport };\n-    const points = [\n-      ...getPointsPolygon(props.payload.data.features.deck_polygon || []),\n-      ...getPointsPath(props.payload.data.features.deck_path || []),\n-      ...getPointsGrid(props.payload.data.features.deck_grid || []),\n-      ...getPointsScatter(props.payload.data.features.deck_scatter || []),\n-      ...getPointsContour(props.payload.data.features.deck_contour || []),\n-      ...getPointsHeatmap(props.payload.data.features.deck_heatmap || []),\n-      ...getPointsHex(props.payload.data.features.deck_hex || []),\n-      ...getPointsArc(props.payload.data.features.deck_arc || []),\n-      ...getPointsGeojson(props.payload.data.features.deck_geojson || []),\n-      ...getPointsScreengrid(props.payload.data.features.deck_screengrid || []),\n-    ];\n-\n-    if (props.formData) {\n-      viewport = fitViewport(viewport, {\n-        width: props.width,\n-        height: props.height,\n-        points,\n-      });\n+\n+    // Default to autozoom enabled for backward compatibility (undefined treated as true)\n+    if (props.formData.autozoom !== false) {\n+      const points = [\n+        ...getPointsPolygon(props.payload.data.features.deck_polygon || []),\n+        ...getPointsPath(props.payload.data.features.deck_path || []),\n+        ...getPointsGrid(props.payload.data.features.deck_grid || []),\n+        ...getPointsScatter(props.payload.data.features.deck_scatter || []),\n+        ...getPointsContour(props.payload.data.features.deck_contour || []),\n+        ...getPointsHeatmap(props.payload.data.features.deck_heatmap || []),\n+        ...getPointsHex(props.payload.data.features.deck_hex || []),\n+        ...getPointsArc(props.payload.data.features.deck_arc || []),\n+        ...getPointsGeojson(props.payload.data.features.deck_geojson || []),\n+        ...getPointsScreengrid(\n+          props.payload.data.features.deck_screengrid || [],\n+        ),\n+      ];\n+\n+      if (props.formData && points.length > 0) {\n+        viewport = fitViewport(viewport, {\n+          width: props.width,\n+          height: props.height,\n+          points,\n+        });\n+      }\n     }\n+\n     if (viewport.zoom < 0) {\n       viewport.zoom = 0;\n     }", "pull_request_number": 37221}
{"sha": "dc37d54db3ba96da1639ce357ad878b3271ef439", "filename": "superset-frontend/plugins/legacy-preset-chart-deckgl/src/Multi/controlPanel.test.ts", "status": "added", "additions": 351, "deletions": 0, "changes": 351, "blob_url": "https://github.com/apache/superset/blob/1e4391c546452411dc610508cfd1d68f155b36ed/superset-frontend%2Fplugins%2Flegacy-preset-chart-deckgl%2Fsrc%2FMulti%2FcontrolPanel.test.ts", "raw_url": "https://github.com/apache/superset/raw/1e4391c546452411dc610508cfd1d68f155b36ed/superset-frontend%2Fplugins%2Flegacy-preset-chart-deckgl%2Fsrc%2FMulti%2FcontrolPanel.test.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Flegacy-preset-chart-deckgl%2Fsrc%2FMulti%2FcontrolPanel.test.ts?ref=1e4391c546452411dc610508cfd1d68f155b36ed", "patch": "@@ -0,0 +1,351 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import type {\n+  ControlPanelSectionConfig,\n+  ControlSetRow,\n+  ControlSetItem,\n+} from '@superset-ui/chart-controls';\n+import controlPanel from './controlPanel';\n+\n+test('controlPanel should have Map section', () => {\n+  const mapSection = controlPanel.controlPanelSections.find(\n+    (\n+      section: ControlPanelSectionConfig | null,\n+    ): section is ControlPanelSectionConfig =>\n+      section !== null && section.label === 'Map',\n+  );\n+\n+  expect(mapSection).toBeDefined();\n+  expect(mapSection?.expanded).toBe(true);\n+});\n+\n+test('controlPanel should have Query section', () => {\n+  const querySection = controlPanel.controlPanelSections.find(\n+    (\n+      section: ControlPanelSectionConfig | null,\n+    ): section is ControlPanelSectionConfig =>\n+      section !== null && section.label === 'Query',\n+  );\n+\n+  expect(querySection).toBeDefined();\n+  expect(querySection?.expanded).toBe(true);\n+});\n+\n+test('controlPanel Map section should include viewport control', () => {\n+  const mapSection = controlPanel.controlPanelSections.find(\n+    (\n+      section: ControlPanelSectionConfig | null,\n+    ): section is ControlPanelSectionConfig =>\n+      section !== null && section.label === 'Map',\n+  );\n+\n+  // viewport is imported from Shared_DeckGL and included in controlSetRows\n+  expect(mapSection?.controlSetRows).toBeDefined();\n+  expect(mapSection?.controlSetRows.length).toBeGreaterThan(0);\n+});\n+\n+test('controlPanel Map section should include autozoom control', () => {\n+  const mapSection = controlPanel.controlPanelSections.find(\n+    (\n+      section: ControlPanelSectionConfig | null,\n+    ): section is ControlPanelSectionConfig =>\n+      section !== null && section.label === 'Map',\n+  );\n+\n+  // autozoom is imported from Shared_DeckGL and included in controlSetRows\n+  expect(mapSection?.controlSetRows).toBeDefined();\n+  expect(mapSection?.controlSetRows.length).toBeGreaterThan(0);\n+});\n+\n+test('controlPanel should include deck_slices control with validation', () => {\n+  const mapSection = controlPanel.controlPanelSections.find(\n+    (\n+      section: ControlPanelSectionConfig | null,\n+    ): section is ControlPanelSectionConfig =>\n+      section !== null && section.label === 'Map',\n+  );\n+\n+  const deckSlicesRow = mapSection?.controlSetRows.find((row: ControlSetRow) =>\n+    row.some(\n+      (control: ControlSetItem) =>\n+        control &&\n+        typeof control === 'object' &&\n+        'name' in control &&\n+        control.name === 'deck_slices',\n+    ),\n+  );\n+\n+  const deckSlicesControl = deckSlicesRow?.find(\n+    (control: ControlSetItem) =>\n+      control &&\n+      typeof control === 'object' &&\n+      'name' in control &&\n+      control.name === 'deck_slices',\n+  ) as any;\n+\n+  expect(deckSlicesControl).toBeDefined();\n+  expect(deckSlicesControl?.config?.validators).toBeDefined();\n+  expect(deckSlicesControl?.config?.validators.length).toBeGreaterThan(0);\n+  expect(deckSlicesControl?.config?.multi).toBe(true);\n+  expect(deckSlicesControl?.config?.type).toBe('SelectAsyncControl');\n+});\n+\n+test('deck_slices control should have correct label and description', () => {\n+  const mapSection = controlPanel.controlPanelSections.find(\n+    (\n+      section: ControlPanelSectionConfig | null,\n+    ): section is ControlPanelSectionConfig =>\n+      section !== null && section.label === 'Map',\n+  );\n+\n+  const deckSlicesRow = mapSection?.controlSetRows.find((row: ControlSetRow) =>\n+    row.some(\n+      (control: ControlSetItem) =>\n+        control &&\n+        typeof control === 'object' &&\n+        'name' in control &&\n+        control.name === 'deck_slices',\n+    ),\n+  );\n+\n+  const deckSlicesControl = deckSlicesRow?.find(\n+    (control: ControlSetItem) =>\n+      control &&\n+      typeof control === 'object' &&\n+      'name' in control &&\n+      control.name === 'deck_slices',\n+  ) as any;\n+\n+  expect(deckSlicesControl?.config?.label).toBeDefined();\n+  expect(deckSlicesControl?.config?.description).toBeDefined();\n+  expect(deckSlicesControl?.config?.placeholder).toBeDefined();\n+});\n+\n+test('deck_slices control should have correct API endpoint', () => {\n+  const mapSection = controlPanel.controlPanelSections.find(\n+    (\n+      section: ControlPanelSectionConfig | null,\n+    ): section is ControlPanelSectionConfig =>\n+      section !== null && section.label === 'Map',\n+  );\n+\n+  const deckSlicesRow = mapSection?.controlSetRows.find((row: ControlSetRow) =>\n+    row.some(\n+      (control: ControlSetItem) =>\n+        control &&\n+        typeof control === 'object' &&\n+        'name' in control &&\n+        control.name === 'deck_slices',\n+    ),\n+  );\n+\n+  const deckSlicesControl = deckSlicesRow?.find(\n+    (control: ControlSetItem) =>\n+      control &&\n+      typeof control === 'object' &&\n+      'name' in control &&\n+      control.name === 'deck_slices',\n+  ) as any;\n+\n+  expect(deckSlicesControl?.config?.dataEndpoint).toBe(\n+    'api/v1/chart/?q=(filters:!((col:viz_type,opr:sw,value:deck)))',\n+  );\n+});\n+\n+test('deck_slices mutator should add index labels to selected charts', () => {\n+  const mapSection = controlPanel.controlPanelSections.find(\n+    (\n+      section: ControlPanelSectionConfig | null,\n+    ): section is ControlPanelSectionConfig =>\n+      section !== null && section.label === 'Map',\n+  );\n+\n+  const deckSlicesRow = mapSection?.controlSetRows.find((row: ControlSetRow) =>\n+    row.some(\n+      (control: ControlSetItem) =>\n+        control &&\n+        typeof control === 'object' &&\n+        'name' in control &&\n+        control.name === 'deck_slices',\n+    ),\n+  );\n+\n+  const deckSlicesControl = deckSlicesRow?.find(\n+    (control: ControlSetItem) =>\n+      control &&\n+      typeof control === 'object' &&\n+      'name' in control &&\n+      control.name === 'deck_slices',\n+  ) as any;\n+\n+  const mockData = {\n+    result: [\n+      { id: 1, slice_name: 'Chart A' },\n+      { id: 2, slice_name: 'Chart B' },\n+      { id: 3, slice_name: 'Chart C' },\n+    ],\n+  };\n+\n+  const selectedIds = [2, 3];\n+  const result = deckSlicesControl.config.mutator(mockData, selectedIds);\n+\n+  expect(result).toEqual([\n+    { value: 1, label: 'Chart A' },\n+    { value: 2, label: 'Chart B [1]' },\n+    { value: 3, label: 'Chart C [2]' },\n+  ]);\n+});\n+\n+test('deck_slices mutator should handle empty result', () => {\n+  const mapSection = controlPanel.controlPanelSections.find(\n+    (\n+      section: ControlPanelSectionConfig | null,\n+    ): section is ControlPanelSectionConfig =>\n+      section !== null && section.label === 'Map',\n+  );\n+\n+  const deckSlicesRow = mapSection?.controlSetRows.find((row: ControlSetRow) =>\n+    row.some(\n+      (control: ControlSetItem) =>\n+        control &&\n+        typeof control === 'object' &&\n+        'name' in control &&\n+        control.name === 'deck_slices',\n+    ),\n+  );\n+\n+  const deckSlicesControl = deckSlicesRow?.find(\n+    (control: ControlSetItem) =>\n+      control &&\n+      typeof control === 'object' &&\n+      'name' in control &&\n+      control.name === 'deck_slices',\n+  ) as any;\n+\n+  const mockData = {\n+    result: undefined,\n+  };\n+\n+  const result = deckSlicesControl.config.mutator(mockData, []);\n+\n+  expect(result).toEqual([]);\n+});\n+\n+test('deck_slices mutator should handle undefined selected values', () => {\n+  const mapSection = controlPanel.controlPanelSections.find(\n+    (\n+      section: ControlPanelSectionConfig | null,\n+    ): section is ControlPanelSectionConfig =>\n+      section !== null && section.label === 'Map',\n+  );\n+\n+  const deckSlicesRow = mapSection?.controlSetRows.find((row: ControlSetRow) =>\n+    row.some(\n+      (control: ControlSetItem) =>\n+        control &&\n+        typeof control === 'object' &&\n+        'name' in control &&\n+        control.name === 'deck_slices',\n+    ),\n+  );\n+\n+  const deckSlicesControl = deckSlicesRow?.find(\n+    (control: ControlSetItem) =>\n+      control &&\n+      typeof control === 'object' &&\n+      'name' in control &&\n+      control.name === 'deck_slices',\n+  ) as any;\n+\n+  const mockData = {\n+    result: [\n+      { id: 1, slice_name: 'Chart A' },\n+      { id: 2, slice_name: 'Chart B' },\n+    ],\n+  };\n+\n+  const result = deckSlicesControl.config.mutator(mockData, undefined);\n+\n+  expect(result).toEqual([\n+    { value: 1, label: 'Chart A' },\n+    { value: 2, label: 'Chart B' },\n+  ]);\n+});\n+\n+test('deck_slices mutator should preserve order based on selection', () => {\n+  const mapSection = controlPanel.controlPanelSections.find(\n+    (\n+      section: ControlPanelSectionConfig | null,\n+    ): section is ControlPanelSectionConfig =>\n+      section !== null && section.label === 'Map',\n+  );\n+\n+  const deckSlicesRow = mapSection?.controlSetRows.find((row: ControlSetRow) =>\n+    row.some(\n+      (control: ControlSetItem) =>\n+        control &&\n+        typeof control === 'object' &&\n+        'name' in control &&\n+        control.name === 'deck_slices',\n+    ),\n+  );\n+\n+  const deckSlicesControl = deckSlicesRow?.find(\n+    (control: ControlSetItem) =>\n+      control &&\n+      typeof control === 'object' &&\n+      'name' in control &&\n+      control.name === 'deck_slices',\n+  ) as any;\n+\n+  const mockData = {\n+    result: [\n+      { id: 1, slice_name: 'Chart A' },\n+      { id: 2, slice_name: 'Chart B' },\n+      { id: 3, slice_name: 'Chart C' },\n+      { id: 4, slice_name: 'Chart D' },\n+    ],\n+  };\n+\n+  // Select in specific order: 3, 1, 4\n+  const selectedIds = [3, 1, 4];\n+  const result = deckSlicesControl.config.mutator(mockData, selectedIds);\n+\n+  expect(result).toEqual([\n+    { value: 1, label: 'Chart A [2]' }, // second in selection\n+    { value: 2, label: 'Chart B' }, // not selected\n+    { value: 3, label: 'Chart C [1]' }, // first in selection\n+    { value: 4, label: 'Chart D [3]' }, // third in selection\n+  ]);\n+});\n+\n+test('Query section should include adhoc_filters control', () => {\n+  const querySection = controlPanel.controlPanelSections.find(\n+    (\n+      section: ControlPanelSectionConfig | null,\n+    ): section is ControlPanelSectionConfig =>\n+      section !== null && section.label === 'Query',\n+  );\n+\n+  const hasAdhocFilters = querySection?.controlSetRows.some(\n+    (row: ControlSetRow) => row.includes('adhoc_filters'),\n+  );\n+\n+  expect(hasAdhocFilters).toBe(true);\n+});", "pull_request_number": 37221}
{"sha": "3bf2613e8a5ebeaa944692b09fc0837c45a7bd75", "filename": "superset-frontend/plugins/legacy-preset-chart-deckgl/src/Multi/controlPanel.ts", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/apache/superset/blob/1e4391c546452411dc610508cfd1d68f155b36ed/superset-frontend%2Fplugins%2Flegacy-preset-chart-deckgl%2Fsrc%2FMulti%2FcontrolPanel.ts", "raw_url": "https://github.com/apache/superset/raw/1e4391c546452411dc610508cfd1d68f155b36ed/superset-frontend%2Fplugins%2Flegacy-preset-chart-deckgl%2Fsrc%2FMulti%2FcontrolPanel.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Flegacy-preset-chart-deckgl%2Fsrc%2FMulti%2FcontrolPanel.ts?ref=1e4391c546452411dc610508cfd1d68f155b36ed", "patch": "@@ -18,7 +18,7 @@\n  */\n import { t } from '@apache-superset/core';\n import { validateNonEmpty } from '@superset-ui/core';\n-import { viewport, mapboxStyle } from '../utilities/Shared_DeckGL';\n+import { viewport, mapboxStyle, autozoom } from '../utilities/Shared_DeckGL';\n \n export default {\n   controlPanelSections: [\n@@ -28,6 +28,7 @@ export default {\n       controlSetRows: [\n         [mapboxStyle],\n         [viewport],\n+        [autozoom],\n         [\n           {\n             name: 'deck_slices',", "pull_request_number": 37221}
{"sha": "42a87cd2729101b19413394b848a1cae4b46548e", "filename": "superset-frontend/src/features/themes/ThemeModal.test.tsx", "status": "modified", "additions": 110, "deletions": 17, "changes": 127, "blob_url": "https://github.com/apache/superset/blob/b75309c832df909f59cdbb55a8e8ca484fc4f037/superset-frontend%2Fsrc%2Ffeatures%2Fthemes%2FThemeModal.test.tsx", "raw_url": "https://github.com/apache/superset/raw/b75309c832df909f59cdbb55a8e8ca484fc4f037/superset-frontend%2Fsrc%2Ffeatures%2Fthemes%2FThemeModal.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ffeatures%2Fthemes%2FThemeModal.test.tsx?ref=b75309c832df909f59cdbb55a8e8ca484fc4f037", "patch": "@@ -17,7 +17,7 @@\n  * under the License.\n  */\n \n-import { render, screen } from 'spec/helpers/testing-library';\n+import { render, screen, waitFor } from 'spec/helpers/testing-library';\n import userEvent from '@testing-library/user-event';\n import fetchMock from 'fetch-mock';\n import ThemeModal from './ThemeModal';\n@@ -37,6 +37,27 @@ jest.mock('src/dashboard/util/permissionUtils', () => ({\n   isUserAdmin: jest.fn(() => true),\n }));\n \n+// Mock JsonEditor to avoid direct DOM manipulation in tests\n+jest.mock('@superset-ui/core/components/AsyncAceEditor', () => ({\n+  ...jest.requireActual('@superset-ui/core/components/AsyncAceEditor'),\n+  JsonEditor: ({\n+    onChange,\n+    value,\n+    readOnly,\n+  }: {\n+    onChange: (value: string) => void;\n+    value: string;\n+    readOnly?: boolean;\n+  }) => (\n+    <textarea\n+      data-test=\"json-editor\"\n+      value={value}\n+      onChange={e => onChange(e.target.value)}\n+      readOnly={readOnly}\n+    />\n+  ),\n+}));\n+\n const mockTheme: ThemeObject = {\n   id: 1,\n   theme_name: 'Test Theme',\n@@ -78,6 +99,19 @@ afterEach(() => {\n   jest.clearAllMocks();\n });\n \n+// Helper to add valid JSON data to the theme\n+// Uses the mocked JsonEditor textarea for testing\n+const addValidJsonData = async () => {\n+  const validJson = JSON.stringify(\n+    { token: { colorPrimary: '#1890ff' } },\n+    null,\n+    2,\n+  );\n+  const jsonEditor = screen.getByTestId('json-editor');\n+  await userEvent.clear(jsonEditor);\n+  await userEvent.type(jsonEditor, validJson);\n+};\n+\n test('renders modal with add theme dialog when show is true', () => {\n   render(\n     <ThemeModal\n@@ -272,10 +306,16 @@ test('enables save button when theme name is entered', async () => {\n \n   const nameInput = screen.getByPlaceholderText('Enter theme name');\n   await userEvent.type(nameInput, 'My New Theme');\n+  await addValidJsonData();\n \n-  const saveButton = await screen.findByRole('button', { name: 'Add' });\n-\n-  expect(saveButton).toBeEnabled();\n+  // Wait for validation to complete and button to become enabled\n+  await waitFor(\n+    () => {\n+      const saveButton = screen.getByRole('button', { name: 'Add' });\n+      expect(saveButton).toBeEnabled();\n+    },\n+    { timeout: 10000 },\n+  );\n });\n \n test('validates JSON format and enables save button', async () => {\n@@ -293,10 +333,16 @@ test('validates JSON format and enables save button', async () => {\n \n   const nameInput = screen.getByPlaceholderText('Enter theme name');\n   await userEvent.type(nameInput, 'Test Theme');\n+  await addValidJsonData();\n \n-  const saveButton = await screen.findByRole('button', { name: 'Add' });\n-\n-  expect(saveButton).toBeEnabled();\n+  // Wait for validation to complete and button to become enabled\n+  await waitFor(\n+    () => {\n+      const saveButton = screen.getByRole('button', { name: 'Add' });\n+      expect(saveButton).toBeEnabled();\n+    },\n+    { timeout: 10000 },\n+  );\n });\n \n test('shows unsaved changes alert when closing modal with modifications', async () => {\n@@ -407,6 +453,19 @@ test('saves changes when clicking Save button in unsaved changes alert', async (\n \n   const nameInput = screen.getByPlaceholderText('Enter theme name');\n   await userEvent.type(nameInput, 'Modified Theme');\n+  await addValidJsonData();\n+\n+  // Wait for validation to complete before canceling\n+  await waitFor(\n+    () => {\n+      const addButton = screen.getByRole('button', { name: 'Add' });\n+      expect(addButton).toBeEnabled();\n+    },\n+    { timeout: 10000 },\n+  );\n+\n+  // Give extra time for all state updates to complete\n+  await new Promise(resolve => setTimeout(resolve, 500));\n \n   const cancelButton = screen.getByRole('button', { name: 'Cancel' });\n   await userEvent.click(cancelButton);\n@@ -415,13 +474,26 @@ test('saves changes when clicking Save button in unsaved changes alert', async (\n     await screen.findByText('You have unsaved changes'),\n   ).toBeInTheDocument();\n \n-  const saveButton = screen.getByRole('button', { name: 'Save' });\n+  // Wait for the Save button in the alert to be enabled\n+  const saveButton = await waitFor(\n+    () => {\n+      const button = screen.getByRole('button', { name: 'Save' });\n+      expect(button).toBeEnabled();\n+      return button;\n+    },\n+    { timeout: 10000 },\n+  );\n   await userEvent.click(saveButton);\n \n   // Wait for API call to complete\n   await screen.findByRole('dialog');\n-  expect(fetchMock.called()).toBe(true);\n-});\n+  await waitFor(\n+    () => {\n+      expect(fetchMock.called()).toBe(true);\n+    },\n+    { timeout: 15000 },\n+  );\n+}, 30000);\n \n test('discards changes when clicking Discard button in unsaved changes alert', async () => {\n   const onHide = jest.fn();\n@@ -472,12 +544,23 @@ test('creates new theme when saving', async () => {\n \n   const nameInput = screen.getByPlaceholderText('Enter theme name');\n   await userEvent.type(nameInput, 'New Theme');\n-\n-  const saveButton = await screen.findByRole('button', { name: 'Add' });\n+  await addValidJsonData();\n+\n+  // Wait for validation to complete and button to become enabled\n+  const saveButton = await waitFor(\n+    () => {\n+      const button = screen.getByRole('button', { name: 'Add' });\n+      expect(button).toBeEnabled();\n+      return button;\n+    },\n+    { timeout: 10000 },\n+  );\n   await userEvent.click(saveButton);\n \n   expect(await screen.findByRole('dialog')).toBeInTheDocument();\n-  expect(fetchMock.called('glob:*/api/v1/theme/', 'POST')).toBe(true);\n+  await waitFor(() => {\n+    expect(fetchMock.called('glob:*/api/v1/theme/', 'POST')).toBe(true);\n+  });\n });\n \n test('updates existing theme when saving', async () => {\n@@ -525,14 +608,24 @@ test('handles API errors gracefully', async () => {\n \n   const nameInput = screen.getByPlaceholderText('Enter theme name');\n   await userEvent.type(nameInput, 'New Theme');\n-\n-  const saveButton = await screen.findByRole('button', { name: 'Add' });\n-  expect(saveButton).toBeEnabled();\n+  await addValidJsonData();\n+\n+  // Wait for validation to complete and button to become enabled\n+  const saveButton = await waitFor(\n+    () => {\n+      const button = screen.getByRole('button', { name: 'Add' });\n+      expect(button).toBeEnabled();\n+      return button;\n+    },\n+    { timeout: 10000 },\n+  );\n \n   await userEvent.click(saveButton);\n \n   await screen.findByRole('dialog');\n-  expect(fetchMock.called()).toBe(true);\n+  await waitFor(() => {\n+    expect(fetchMock.called()).toBe(true);\n+  });\n });\n \n test('applies theme locally when clicking Apply button', async () => {", "pull_request_number": 35349}
{"sha": "e69f0a1411db91a697caf098fa576b51c94f13e6", "filename": "superset-frontend/src/features/themes/ThemeModal.tsx", "status": "modified", "additions": 30, "deletions": 26, "changes": 56, "blob_url": "https://github.com/apache/superset/blob/b75309c832df909f59cdbb55a8e8ca484fc4f037/superset-frontend%2Fsrc%2Ffeatures%2Fthemes%2FThemeModal.tsx", "raw_url": "https://github.com/apache/superset/raw/b75309c832df909f59cdbb55a8e8ca484fc4f037/superset-frontend%2Fsrc%2Ffeatures%2Fthemes%2FThemeModal.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ffeatures%2Fthemes%2FThemeModal.tsx?ref=b75309c832df909f59cdbb55a8e8ca484fc4f037", "patch": "@@ -44,8 +44,8 @@ import {\n   Space,\n   Tooltip,\n } from '@superset-ui/core/components';\n-import { useJsonValidation } from '@superset-ui/core/components/AsyncAceEditor';\n import { Typography } from '@superset-ui/core/components/Typography';\n+import { useThemeValidation } from 'src/theme/hooks/useThemeValidation';\n \n import { OnlyKeyWithType } from 'src/utils/types';\n import { ThemeObject } from './types';\n@@ -127,10 +127,9 @@ const ThemeModal: FunctionComponent<ThemeModalProps> = ({\n     SupersetText?.THEME_MODAL?.DOCUMENTATION_URL ||\n     'https://superset.apache.org/docs/configuration/theming/';\n \n-  // JSON validation annotations using reusable hook\n-  const jsonAnnotations = useJsonValidation(currentTheme?.json_data, {\n-    enabled: !isReadOnly,\n-    errorPrefix: 'Invalid JSON syntax',\n+  // Theme validation (structure + token names)\n+  const validation = useThemeValidation(currentTheme?.json_data || '', {\n+    enabled: !isReadOnly && Boolean(currentTheme?.json_data),\n   });\n \n   // theme fetch logic\n@@ -286,27 +285,22 @@ const ThemeModal: FunctionComponent<ThemeModalProps> = ({\n     [currentTheme],\n   );\n \n-  const validate = useCallback(() => {\n-    if (isReadOnly) {\n+  const validate = () => {\n+    if (isReadOnly || !currentTheme) {\n       setDisableSave(true);\n       return;\n     }\n \n-    if (\n-      currentTheme?.theme_name.length &&\n-      currentTheme?.json_data?.length &&\n-      isValidJson(currentTheme.json_data)\n-    ) {\n-      setDisableSave(false);\n-    } else {\n-      setDisableSave(true);\n-    }\n-  }, [\n-    currentTheme?.theme_name,\n-    currentTheme?.json_data,\n-    isReadOnly,\n-    isValidJson,\n-  ]);\n+    const hasValidName = Boolean(currentTheme?.theme_name?.trim());\n+    const hasValidJsonData = Boolean(currentTheme?.json_data?.trim());\n+\n+    // Block save only on ERRORS (not warnings)\n+    // Errors: JSON syntax errors, empty themes\n+    // Warnings: Unknown tokens, null values (non-blocking)\n+    const canSave = hasValidName && hasValidJsonData && !validation.hasErrors;\n+\n+    setDisableSave(!canSave);\n+  };\n \n   // Initialize\n   useEffect(() => {\n@@ -340,7 +334,12 @@ const ThemeModal: FunctionComponent<ThemeModalProps> = ({\n   // Validation\n   useEffect(() => {\n     validate();\n-  }, [validate]);\n+  }, [\n+    currentTheme ? currentTheme.theme_name : '',\n+    currentTheme ? currentTheme.json_data : '',\n+    isReadOnly,\n+    validation.hasErrors,\n+  ]);\n \n   // Show/hide\n   useEffect(() => {\n@@ -470,7 +469,10 @@ const ThemeModal: FunctionComponent<ThemeModalProps> = ({\n                   >\n                     {t('documentation')}\n                   </a>\n-                  {t(' for details.')}\n+                  {t(' for details.')}{' '}\n+                  <Typography.Text type=\"secondary\">\n+                    {t('Unknown tokens will be highlighted as warnings.')}\n+                  </Typography.Text>\n                 </span>\n               }\n             />\n@@ -487,9 +489,10 @@ const ThemeModal: FunctionComponent<ThemeModalProps> = ({\n                 readOnly={isReadOnly}\n                 showGutter\n                 showPrintMargin={false}\n-                annotations={jsonAnnotations}\n+                annotations={validation.annotations}\n               />\n             </StyledJsonEditor>\n+\n             {canDevelopThemes && (\n               <div className=\"apply-button-container\">\n                 <Tooltip\n@@ -501,7 +504,8 @@ const ThemeModal: FunctionComponent<ThemeModalProps> = ({\n                     onClick={onApply}\n                     disabled={\n                       !currentTheme?.json_data ||\n-                      !isValidJson(currentTheme.json_data)\n+                      !isValidJson(currentTheme.json_data) ||\n+                      validation.hasErrors\n                     }\n                     buttonStyle=\"secondary\"\n                   >", "pull_request_number": 35349}
{"sha": "f2e15d8ccf14d3d4b655853c27d0098891806e93", "filename": "superset-frontend/src/theme/ThemeController.ts", "status": "modified", "additions": 83, "deletions": 17, "changes": 100, "blob_url": "https://github.com/apache/superset/blob/b75309c832df909f59cdbb55a8e8ca484fc4f037/superset-frontend%2Fsrc%2Ftheme%2FThemeController.ts", "raw_url": "https://github.com/apache/superset/raw/b75309c832df909f59cdbb55a8e8ca484fc4f037/superset-frontend%2Fsrc%2Ftheme%2FThemeController.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ftheme%2FThemeController.ts?ref=b75309c832df909f59cdbb55a8e8ca484fc4f037", "patch": "@@ -224,14 +224,8 @@ export class ThemeController {\n         return this.dashboardThemes.get(themeId)!;\n       }\n \n-      // Fetch theme config from API\n-      const response = await fetch(`/api/v1/theme/${themeId}`);\n-      if (!response.ok) {\n-        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n-      }\n-\n-      const data = await response.json();\n-      const themeConfig = JSON.parse(data.result.json_data);\n+      // Use the enhanced fetchCrudTheme method which includes validation if feature flag is enabled\n+      const themeConfig = await this.fetchCrudTheme(themeId);\n \n       if (themeConfig) {\n         // Controller creates and owns the dashboard theme\n@@ -314,7 +308,6 @@ export class ThemeController {\n \n     const theme: AnyThemeConfig | null = this.getThemeForMode(mode);\n     if (!theme) {\n-      console.warn(`Theme for mode ${mode} not found, falling back to default`);\n       this.fallbackToDefaultMode();\n       return;\n     }\n@@ -482,7 +475,7 @@ export class ThemeController {\n    * Updates the theme.\n    * @param theme - The new theme to apply\n    */\n-  private updateTheme(theme?: AnyThemeConfig): void {\n+  private async updateTheme(theme?: AnyThemeConfig): Promise<void> {\n     try {\n       // If no config provided, use current mode to get theme\n       if (!theme) {\n@@ -498,18 +491,32 @@ export class ThemeController {\n       this.persistMode();\n       this.notifyListeners();\n     } catch (error) {\n-      console.error('Failed to update theme:', error);\n-      this.fallbackToDefaultMode();\n+      await this.fallbackToDefaultMode();\n     }\n   }\n \n   /**\n-   * Fallback to default mode with error recovery.\n+   * Fallback to default mode with runtime error recovery.\n+   * Tries to fetch a fresh system default theme from the API.\n    */\n-  private fallbackToDefaultMode(): void {\n+  private async fallbackToDefaultMode(): Promise<void> {\n     this.currentMode = ThemeMode.DEFAULT;\n \n-    // Get the default theme which will have the correct algorithm\n+    // Try to fetch fresh system default theme from server\n+    const freshSystemTheme = await this.fetchSystemDefaultTheme();\n+\n+    if (freshSystemTheme) {\n+      try {\n+        await this.applyThemeWithRecovery(freshSystemTheme);\n+        this.persistMode();\n+        this.notifyListeners();\n+        return;\n+      } catch (error) {\n+        // Fresh theme also failed, continue to final fallback\n+      }\n+    }\n+\n+    // Final fallback: use cached default theme or built-in theme\n     const defaultTheme: AnyThemeConfig =\n       this.getThemeForMode(ThemeMode.DEFAULT) || this.defaultTheme || {};\n \n@@ -738,7 +745,17 @@ export class ThemeController {\n       this.globalTheme.setConfig(normalizedConfig);\n     } catch (error) {\n       console.error('Failed to apply theme:', error);\n-      this.fallbackToDefaultMode();\n+      // Re-throw the error so updateTheme can handle fallback logic\n+      throw error;\n+    }\n+  }\n+\n+  private async applyThemeWithRecovery(theme: AnyThemeConfig): Promise<void> {\n+    try {\n+      const normalizedConfig = normalizeThemeConfig(theme);\n+      this.globalTheme.setConfig(normalizedConfig);\n+    } catch (error) {\n+      await this.fallbackToDefaultMode();\n     }\n   }\n \n@@ -811,7 +828,7 @@ export class ThemeController {\n   /**\n    * Fetches a theme configuration from the CRUD API.\n    * @param themeId - The ID of the theme to fetch\n-   * @returns The theme configuration or null if not found\n+   * @returns The theme configuration or null if fetch fails\n    */\n   private async fetchCrudTheme(\n     themeId: string,\n@@ -825,10 +842,59 @@ export class ThemeController {\n       const data = await response.json();\n       const themeConfig = JSON.parse(data.result.json_data);\n \n+      if (!themeConfig || typeof themeConfig !== 'object') {\n+        console.error(`Invalid theme configuration for theme ${themeId}`);\n+        return null;\n+      }\n+\n+      // Return theme as-is\n+      // Invalid tokens will be handled by Ant Design at runtime\n+      // Runtime errors will be caught by applyThemeWithRecovery()\n       return themeConfig;\n     } catch (error) {\n       console.error('Failed to fetch CRUD theme:', error);\n       return null;\n     }\n   }\n+\n+  /**\n+   * Fetches a fresh system default theme from the API for runtime recovery.\n+   * Tries multiple fallback strategies to find a valid theme.\n+   * @returns The system default theme configuration or null if not found\n+   */\n+  private async fetchSystemDefaultTheme(): Promise<AnyThemeConfig | null> {\n+    try {\n+      // Try to fetch theme marked as system default (is_system_default=true)\n+      const defaultResponse = await fetch(\n+        '/api/v1/theme/?q=(filters:!((col:is_system_default,opr:eq,value:!t)))',\n+      );\n+      if (defaultResponse.ok) {\n+        const data = await defaultResponse.json();\n+        if (data.result?.length > 0) {\n+          const themeConfig = JSON.parse(data.result[0].json_data);\n+          if (themeConfig && typeof themeConfig === 'object') {\n+            return themeConfig;\n+          }\n+        }\n+      }\n+\n+      // Fallback: Try to fetch system theme named 'THEME_DEFAULT'\n+      const fallbackResponse = await fetch(\n+        '/api/v1/theme/?q=(filters:!((col:theme_name,opr:eq,value:THEME_DEFAULT),(col:is_system,opr:eq,value:!t)))',\n+      );\n+      if (fallbackResponse.ok) {\n+        const fallbackData = await fallbackResponse.json();\n+        if (fallbackData.result?.length > 0) {\n+          const themeConfig = JSON.parse(fallbackData.result[0].json_data);\n+          if (themeConfig && typeof themeConfig === 'object') {\n+            return themeConfig;\n+          }\n+        }\n+      }\n+    } catch (error) {\n+      // Silently handle fetch errors\n+    }\n+\n+    return null;\n+  }\n }", "pull_request_number": 35349}
{"sha": "a0bf70539b12fd924e69af4f141e2a83810de1cc", "filename": "superset-frontend/src/theme/hooks/useThemeValidation.test.ts", "status": "added", "additions": 133, "deletions": 0, "changes": 133, "blob_url": "https://github.com/apache/superset/blob/b75309c832df909f59cdbb55a8e8ca484fc4f037/superset-frontend%2Fsrc%2Ftheme%2Fhooks%2FuseThemeValidation.test.ts", "raw_url": "https://github.com/apache/superset/raw/b75309c832df909f59cdbb55a8e8ca484fc4f037/superset-frontend%2Fsrc%2Ftheme%2Fhooks%2FuseThemeValidation.test.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ftheme%2Fhooks%2FuseThemeValidation.test.ts?ref=b75309c832df909f59cdbb55a8e8ca484fc4f037", "patch": "@@ -0,0 +1,133 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import { renderHook } from '@testing-library/react-hooks';\n+import { useThemeValidation } from './useThemeValidation';\n+\n+test('useThemeValidation validates valid theme with standard tokens', () => {\n+  const validTheme = JSON.stringify({\n+    token: {\n+      colorPrimary: '#1890ff',\n+      fontSize: 14,\n+    },\n+  });\n+\n+  const { result } = renderHook(() => useThemeValidation(validTheme));\n+\n+  expect(result.current.hasErrors).toBe(false);\n+  expect(result.current.hasWarnings).toBe(false);\n+  expect(result.current.annotations).toHaveLength(0);\n+});\n+\n+test('useThemeValidation shows warnings for unknown tokens', () => {\n+  const themeWithUnknownToken = JSON.stringify({\n+    token: {\n+      colorPrimary: '#1890ff',\n+      unknownToken: 'value',\n+    },\n+  });\n+\n+  const { result } = renderHook(() =>\n+    useThemeValidation(themeWithUnknownToken),\n+  );\n+\n+  expect(result.current.hasErrors).toBe(false);\n+  expect(result.current.hasWarnings).toBe(true);\n+  expect(result.current.annotations.length).toBeGreaterThan(0);\n+  expect(result.current.annotations[0].type).toBe('warning');\n+});\n+\n+test('useThemeValidation shows error for empty theme', () => {\n+  const emptyTheme = JSON.stringify({});\n+\n+  const { result } = renderHook(() => useThemeValidation(emptyTheme));\n+\n+  expect(result.current.hasErrors).toBe(true);\n+  expect(result.current.annotations.length).toBeGreaterThan(0);\n+  expect(result.current.annotations[0].type).toBe('error');\n+  expect(result.current.annotations[0].text).toContain('cannot be empty');\n+});\n+\n+test('useThemeValidation shows error for invalid JSON syntax', () => {\n+  const invalidJson = '{invalid json}';\n+\n+  const { result } = renderHook(() => useThemeValidation(invalidJson));\n+\n+  expect(result.current.hasErrors).toBe(true);\n+  expect(result.current.annotations.length).toBeGreaterThan(0);\n+  expect(result.current.annotations[0].type).toBe('error');\n+});\n+\n+test('useThemeValidation skips validation for empty string', () => {\n+  const { result } = renderHook(() => useThemeValidation(''));\n+\n+  expect(result.current.hasErrors).toBe(false);\n+  expect(result.current.hasWarnings).toBe(false);\n+  expect(result.current.annotations).toHaveLength(0);\n+});\n+\n+test('useThemeValidation validates Superset custom tokens', () => {\n+  const themeWithCustomToken = JSON.stringify({\n+    token: {\n+      brandLogoUrl: '/static/logo.png',\n+      brandSpinnerSvg: '<svg></svg>',\n+    },\n+  });\n+\n+  const { result } = renderHook(() => useThemeValidation(themeWithCustomToken));\n+\n+  expect(result.current.hasErrors).toBe(false);\n+  expect(result.current.hasWarnings).toBe(false);\n+  expect(result.current.annotations).toHaveLength(0);\n+});\n+\n+test('useThemeValidation allows theme with only algorithm', () => {\n+  const themeWithAlgorithm = JSON.stringify({\n+    algorithm: 'dark',\n+  });\n+\n+  const { result } = renderHook(() => useThemeValidation(themeWithAlgorithm));\n+\n+  expect(result.current.hasErrors).toBe(false);\n+  expect(result.current.annotations).toHaveLength(0);\n+});\n+\n+test('useThemeValidation shows warning for null token value', () => {\n+  const themeWithNullValue = JSON.stringify({\n+    token: {\n+      colorPrimary: null,\n+    },\n+  });\n+\n+  const { result } = renderHook(() => useThemeValidation(themeWithNullValue));\n+\n+  expect(result.current.hasErrors).toBe(false);\n+  expect(result.current.hasWarnings).toBe(true);\n+  expect(result.current.annotations[0].type).toBe('warning');\n+  expect(result.current.annotations[0].text).toContain('null/undefined');\n+});\n+\n+test('useThemeValidation respects enabled option', () => {\n+  const invalidJson = '{invalid}';\n+\n+  const { result } = renderHook(() =>\n+    useThemeValidation(invalidJson, { enabled: false }),\n+  );\n+\n+  expect(result.current.annotations).toHaveLength(0);\n+});", "pull_request_number": 35349}
{"sha": "a7d60d19cb388911f623e0f070379a8d449f8809", "filename": "superset-frontend/src/theme/hooks/useThemeValidation.ts", "status": "added", "additions": 155, "deletions": 0, "changes": 155, "blob_url": "https://github.com/apache/superset/blob/b75309c832df909f59cdbb55a8e8ca484fc4f037/superset-frontend%2Fsrc%2Ftheme%2Fhooks%2FuseThemeValidation.ts", "raw_url": "https://github.com/apache/superset/raw/b75309c832df909f59cdbb55a8e8ca484fc4f037/superset-frontend%2Fsrc%2Ftheme%2Fhooks%2FuseThemeValidation.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ftheme%2Fhooks%2FuseThemeValidation.ts?ref=b75309c832df909f59cdbb55a8e8ca484fc4f037", "patch": "@@ -0,0 +1,155 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import { useMemo, useState, useEffect } from 'react';\n+import { useJsonValidation } from '@superset-ui/core/components/AsyncAceEditor';\n+import type { JsonValidationAnnotation } from '@superset-ui/core/components/AsyncAceEditor';\n+import type { AnyThemeConfig } from '@superset-ui/core/theme/types';\n+import { validateTheme } from '../utils/themeStructureValidation';\n+\n+/**\n+ * Find the line number where a specific token appears in JSON string.\n+ * Uses improved logic to handle nested objects and avoid false positives.\n+ */\n+function findTokenLineInJson(jsonString: string, tokenName: string): number {\n+  if (!jsonString || !tokenName) {\n+    return 0;\n+  }\n+\n+  // Handle special _root token for structural errors\n+  if (tokenName === '_root') {\n+    return 0;\n+  }\n+\n+  const lines = jsonString.split('\\n');\n+\n+  // Look for the token name as a JSON property key\n+  // Pattern: \"tokenName\" followed by : (with possible whitespace)\n+  const propertyPattern = new RegExp(\n+    `\"${tokenName.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}\"\\\\s*:`,\n+  );\n+\n+  for (let i = 0; i < lines.length; i += 1) {\n+    if (propertyPattern.test(lines[i].trim())) {\n+      return i; // Return 0-based line number for AceEditor\n+    }\n+  }\n+\n+  // Fallback: simple string search for edge cases\n+  const searchPattern = `\"${tokenName}\"`;\n+  for (let i = 0; i < lines.length; i += 1) {\n+    if (lines[i].includes(searchPattern)) {\n+      return i;\n+    }\n+  }\n+\n+  // If token not found, return line 0\n+  return 0;\n+}\n+\n+export interface ThemeValidationResult {\n+  annotations: JsonValidationAnnotation[];\n+  hasErrors: boolean; // true if errors exist (blocks save)\n+  hasWarnings: boolean; // true if warnings exist (non-blocking)\n+}\n+\n+export interface UseThemeValidationOptions {\n+  /** Whether to enable validation. Default: true */\n+  enabled?: boolean;\n+  /** Debounce delay in milliseconds for validation. Default: 300 */\n+  debounceMs?: number;\n+}\n+\n+/**\n+ * Theme validation hook with live feedback.\n+ * - Errors (JSON syntax, empty theme) block save/apply\n+ * - Warnings (unknown tokens, null values) allow save/apply\n+ *\n+ * This hook validates structure and token names only.\n+ * Token values are validated by Ant Design at runtime.\n+ */\n+export function useThemeValidation(\n+  jsonValue?: string,\n+  options: UseThemeValidationOptions = {},\n+): ThemeValidationResult {\n+  const { enabled = true, debounceMs = 300 } = options;\n+\n+  const [debouncedValue, setDebouncedValue] = useState(jsonValue);\n+\n+  // Debounce for performance\n+  useEffect(() => {\n+    const timer = setTimeout(() => setDebouncedValue(jsonValue), debounceMs);\n+    return () => clearTimeout(timer);\n+  }, [jsonValue, debounceMs]);\n+\n+  // JSON syntax validation (ERRORS)\n+  const jsonAnnotations = useJsonValidation(debouncedValue, {\n+    enabled,\n+    errorPrefix: 'Invalid JSON',\n+  });\n+\n+  // Theme structure validation (ERRORS + WARNINGS)\n+  const themeAnnotations = useMemo(() => {\n+    // Skip if disabled or JSON is invalid\n+    if (!enabled || jsonAnnotations.length > 0 || !debouncedValue?.trim()) {\n+      return [];\n+    }\n+\n+    try {\n+      const config: AnyThemeConfig = JSON.parse(debouncedValue);\n+      const result = validateTheme(config);\n+\n+      const annotations: JsonValidationAnnotation[] = [];\n+\n+      // Convert errors to annotations (blocks save)\n+      result.errors.forEach(issue => {\n+        annotations.push({\n+          type: 'error',\n+          row: findTokenLineInJson(debouncedValue, issue.tokenName),\n+          column: 0,\n+          text: issue.message,\n+        });\n+      });\n+\n+      // Convert warnings to annotations (non-blocking)\n+      result.warnings.forEach(issue => {\n+        annotations.push({\n+          type: 'warning',\n+          row: findTokenLineInJson(debouncedValue, issue.tokenName),\n+          column: 0,\n+          text: issue.message,\n+        });\n+      });\n+\n+      return annotations;\n+    } catch {\n+      // JSON parsing error already caught by jsonAnnotations\n+      return [];\n+    }\n+  }, [enabled, debouncedValue, jsonAnnotations]);\n+\n+  return useMemo(() => {\n+    const allAnnotations = [...jsonAnnotations, ...themeAnnotations];\n+\n+    return {\n+      annotations: allAnnotations,\n+      hasErrors: allAnnotations.some(a => a.type === 'error'),\n+      hasWarnings: allAnnotations.some(a => a.type === 'warning'),\n+    };\n+  }, [jsonAnnotations, themeAnnotations]);\n+}", "pull_request_number": 35349}
{"sha": "e38384edc7db72a158bc2e653af614843c901ae7", "filename": "superset-frontend/src/theme/utils/antdTokenNames.test.ts", "status": "added", "additions": 102, "deletions": 0, "changes": 102, "blob_url": "https://github.com/apache/superset/blob/b75309c832df909f59cdbb55a8e8ca484fc4f037/superset-frontend%2Fsrc%2Ftheme%2Futils%2FantdTokenNames.test.ts", "raw_url": "https://github.com/apache/superset/raw/b75309c832df909f59cdbb55a8e8ca484fc4f037/superset-frontend%2Fsrc%2Ftheme%2Futils%2FantdTokenNames.test.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ftheme%2Futils%2FantdTokenNames.test.ts?ref=b75309c832df909f59cdbb55a8e8ca484fc4f037", "patch": "@@ -0,0 +1,102 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import {\n+  isValidTokenName,\n+  isSupersetCustomToken,\n+  getAllValidTokenNames,\n+} from './antdTokenNames';\n+\n+test('isValidTokenName recognizes standard Ant Design tokens', () => {\n+  expect(isValidTokenName('colorPrimary')).toBe(true);\n+  expect(isValidTokenName('fontSize')).toBe(true);\n+  expect(isValidTokenName('padding')).toBe(true);\n+  expect(isValidTokenName('borderRadius')).toBe(true);\n+});\n+\n+test('isValidTokenName recognizes Superset custom tokens', () => {\n+  expect(isValidTokenName('brandLogoUrl')).toBe(true);\n+  expect(isValidTokenName('brandSpinnerSvg')).toBe(true);\n+  expect(isValidTokenName('fontSizeXS')).toBe(true);\n+  expect(isValidTokenName('echartsOptionsOverrides')).toBe(true);\n+});\n+\n+test('isValidTokenName rejects unknown tokens', () => {\n+  expect(isValidTokenName('fooBarBaz')).toBe(false);\n+  expect(isValidTokenName('colrPrimary')).toBe(false);\n+  expect(isValidTokenName('invalidToken')).toBe(false);\n+});\n+\n+test('isValidTokenName handles edge cases', () => {\n+  expect(isValidTokenName('')).toBe(false);\n+  expect(isValidTokenName('  ')).toBe(false);\n+});\n+\n+test('isSupersetCustomToken identifies Superset-specific tokens', () => {\n+  expect(isSupersetCustomToken('brandLogoUrl')).toBe(true);\n+  expect(isSupersetCustomToken('brandSpinnerSvg')).toBe(true);\n+  expect(isSupersetCustomToken('fontSizeXS')).toBe(true);\n+});\n+\n+test('isSupersetCustomToken returns false for Ant Design tokens', () => {\n+  expect(isSupersetCustomToken('colorPrimary')).toBe(false);\n+  expect(isSupersetCustomToken('fontSize')).toBe(false);\n+});\n+\n+test('isSupersetCustomToken returns false for unknown tokens', () => {\n+  expect(isSupersetCustomToken('fooBar')).toBe(false);\n+});\n+\n+test('getAllValidTokenNames returns categorized token names', () => {\n+  const result = getAllValidTokenNames();\n+\n+  expect(result).toHaveProperty('antdTokens');\n+  expect(result).toHaveProperty('supersetTokens');\n+  expect(result).toHaveProperty('total');\n+});\n+\n+test('getAllValidTokenNames has reasonable token counts', () => {\n+  const result = getAllValidTokenNames();\n+\n+  // Ant Design has ~500+ tokens\n+  expect(result.antdTokens.length).toBeGreaterThan(400);\n+\n+  // Superset has 15 custom tokens (from SupersetSpecificTokens interface)\n+  expect(result.supersetTokens.length).toBe(15);\n+\n+  // Total should be sum of both\n+  expect(result.total).toBe(\n+    result.antdTokens.length + result.supersetTokens.length,\n+  );\n+});\n+\n+test('getAllValidTokenNames includes known Superset tokens', () => {\n+  const result = getAllValidTokenNames();\n+\n+  expect(result.supersetTokens).toContain('brandLogoUrl');\n+  expect(result.supersetTokens).toContain('brandSpinnerSvg');\n+  expect(result.supersetTokens).toContain('fontSizeXS');\n+});\n+\n+test('getAllValidTokenNames includes known Ant Design tokens', () => {\n+  const result = getAllValidTokenNames();\n+\n+  expect(result.antdTokens).toContain('colorPrimary');\n+  expect(result.antdTokens).toContain('fontSize');\n+  expect(result.antdTokens).toContain('padding');\n+});", "pull_request_number": 35349}
{"sha": "486cdea061d38482c354e9cce46a600f0214eb18", "filename": "superset-frontend/src/theme/utils/antdTokenNames.ts", "status": "added", "additions": 114, "deletions": 0, "changes": 114, "blob_url": "https://github.com/apache/superset/blob/b75309c832df909f59cdbb55a8e8ca484fc4f037/superset-frontend%2Fsrc%2Ftheme%2Futils%2FantdTokenNames.ts", "raw_url": "https://github.com/apache/superset/raw/b75309c832df909f59cdbb55a8e8ca484fc4f037/superset-frontend%2Fsrc%2Ftheme%2Futils%2FantdTokenNames.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ftheme%2Futils%2FantdTokenNames.ts?ref=b75309c832df909f59cdbb55a8e8ca484fc4f037", "patch": "@@ -0,0 +1,114 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import { theme } from 'antd';\n+import type { SupersetSpecificTokens } from '@superset-ui/core/theme/types';\n+\n+/**\n+ * Superset-specific custom tokens that extend Ant Design's token system.\n+ * These keys are derived from the SupersetSpecificTokens interface to ensure consistency.\n+ */\n+const SUPERSET_CUSTOM_TOKENS = new Set<keyof SupersetSpecificTokens>([\n+  // Font extensions\n+  'fontSizeXS',\n+  'fontSizeXXL',\n+  'fontWeightNormal',\n+  'fontWeightLight',\n+  'fontWeightStrong',\n+\n+  // Brand tokens\n+  'brandIconMaxWidth',\n+  'brandLogoAlt',\n+  'brandLogoUrl',\n+  'brandLogoMargin',\n+  'brandLogoHref',\n+  'brandLogoHeight',\n+\n+  // Spinner tokens\n+  'brandSpinnerUrl',\n+  'brandSpinnerSvg',\n+\n+  // ECharts tokens\n+  'echartsOptionsOverrides',\n+  'echartsOptionsOverridesByChartType',\n+]);\n+\n+/**\n+ * Lazy-loaded cache of valid token names.\n+ * Combines Ant Design tokens (extracted at runtime) + Superset custom tokens.\n+ */\n+let validTokenNamesCache: Set<string> | null = null;\n+\n+/**\n+ * Get all valid token names (Ant Design + Superset custom).\n+ * Uses lazy loading and caching for performance.\n+ */\n+function getValidTokenNames(): Set<string> {\n+  if (!validTokenNamesCache) {\n+    // Extract all token names from Ant Design's default theme\n+    const antdTokens = theme.getDesignToken();\n+    const antdTokenNames = Object.keys(antdTokens);\n+\n+    // Combine with Superset custom tokens\n+    validTokenNamesCache = new Set([\n+      ...antdTokenNames,\n+      ...SUPERSET_CUSTOM_TOKENS,\n+    ]);\n+  }\n+  return validTokenNamesCache;\n+}\n+\n+/**\n+ * Check if a token name is valid (recognized by Ant Design OR Superset).\n+ * @param tokenName - The token name to validate\n+ * @returns true if the token is recognized, false otherwise\n+ */\n+export function isValidTokenName(tokenName: string): boolean {\n+  return getValidTokenNames().has(tokenName);\n+}\n+\n+/**\n+ * Check if a token is a Superset custom token (not from Ant Design).\n+ * @param tokenName - The token name to check\n+ * @returns true if it's a Superset-specific token\n+ */\n+export function isSupersetCustomToken(tokenName: string): boolean {\n+  return SUPERSET_CUSTOM_TOKENS.has(tokenName as keyof SupersetSpecificTokens);\n+}\n+\n+/**\n+ * Get all valid token names, categorized by source.\n+ * Useful for debugging and testing.\n+ */\n+export function getAllValidTokenNames(): {\n+  antdTokens: string[];\n+  supersetTokens: string[];\n+  total: number;\n+} {\n+  const allTokens = getValidTokenNames();\n+  const antdTokens = Array.from(allTokens).filter(\n+    t => !isSupersetCustomToken(t),\n+  );\n+  const supersetTokens = Array.from(SUPERSET_CUSTOM_TOKENS);\n+\n+  return {\n+    antdTokens,\n+    supersetTokens,\n+    total: allTokens.size,\n+  };\n+}", "pull_request_number": 35349}
{"sha": "6bc275b25205df84a5646c4b552a745026b225ec", "filename": "superset-frontend/src/theme/utils/themeStructureValidation.test.ts", "status": "added", "additions": 159, "deletions": 0, "changes": 159, "blob_url": "https://github.com/apache/superset/blob/b75309c832df909f59cdbb55a8e8ca484fc4f037/superset-frontend%2Fsrc%2Ftheme%2Futils%2FthemeStructureValidation.test.ts", "raw_url": "https://github.com/apache/superset/raw/b75309c832df909f59cdbb55a8e8ca484fc4f037/superset-frontend%2Fsrc%2Ftheme%2Futils%2FthemeStructureValidation.test.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ftheme%2Futils%2FthemeStructureValidation.test.ts?ref=b75309c832df909f59cdbb55a8e8ca484fc4f037", "patch": "@@ -0,0 +1,159 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import type { AnyThemeConfig } from '@superset-ui/core/theme/types';\n+import { validateTheme } from './themeStructureValidation';\n+\n+test('validateTheme validates a valid theme with standard tokens', () => {\n+  const theme: AnyThemeConfig = {\n+    token: {\n+      colorPrimary: '#1890ff',\n+      fontSize: 14,\n+    },\n+  };\n+\n+  const result = validateTheme(theme);\n+\n+  expect(result.valid).toBe(true);\n+  expect(result.errors).toHaveLength(0);\n+  expect(result.warnings).toHaveLength(0);\n+});\n+\n+test('validateTheme validates a theme with Superset custom tokens', () => {\n+  const theme: AnyThemeConfig = {\n+    token: {\n+      colorPrimary: '#1890ff',\n+      brandLogoUrl: '/static/logo.png',\n+      brandSpinnerSvg: '<svg></svg>',\n+    },\n+  };\n+\n+  const result = validateTheme(theme);\n+\n+  expect(result.valid).toBe(true);\n+  expect(result.errors).toHaveLength(0);\n+  expect(result.warnings).toHaveLength(0);\n+});\n+\n+test('validateTheme warns about unknown token names', () => {\n+  const theme: AnyThemeConfig = {\n+    token: {\n+      colorPrimary: '#1890ff',\n+      fooBarBaz: 'invalid',\n+      colrPrimary: '#ff0000', // Typo\n+    },\n+  };\n+\n+  const result = validateTheme(theme);\n+\n+  expect(result.valid).toBe(true); // Warnings don't block\n+  expect(result.errors).toHaveLength(0);\n+  expect(result.warnings).toHaveLength(2);\n+  expect(result.warnings[0].tokenName).toBe('fooBarBaz');\n+  expect(result.warnings[1].tokenName).toBe('colrPrimary');\n+  expect(result.warnings[0].severity).toBe('warning');\n+});\n+\n+test('validateTheme warns about null/undefined token values', () => {\n+  const theme: AnyThemeConfig = {\n+    token: {\n+      colorPrimary: null,\n+      fontSize: undefined,\n+    },\n+  };\n+\n+  const result = validateTheme(theme);\n+\n+  expect(result.valid).toBe(true);\n+  expect(result.warnings).toHaveLength(2);\n+  expect(result.warnings[0].message).toContain('null/undefined');\n+  expect(result.warnings[1].message).toContain('null/undefined');\n+});\n+\n+test('validateTheme errors on empty theme object', () => {\n+  const theme: AnyThemeConfig = {};\n+\n+  const result = validateTheme(theme);\n+\n+  expect(result.valid).toBe(false);\n+  expect(result.errors).toHaveLength(1);\n+  expect(result.errors[0].tokenName).toBe('_root');\n+  expect(result.errors[0].message).toContain('cannot be empty');\n+});\n+\n+test('validateTheme errors on null theme config', () => {\n+  const result = validateTheme(null as any);\n+\n+  expect(result.valid).toBe(false);\n+  expect(result.errors).toHaveLength(1);\n+  expect(result.errors[0].message).toContain('must be a valid object');\n+});\n+\n+test('validateTheme allows theme with only algorithm', () => {\n+  const theme: AnyThemeConfig = {\n+    algorithm: 'dark' as any,\n+  };\n+\n+  const result = validateTheme(theme);\n+\n+  expect(result.valid).toBe(true);\n+  expect(result.errors).toHaveLength(0);\n+});\n+\n+test('validateTheme allows theme with only components', () => {\n+  const theme: AnyThemeConfig = {\n+    components: {\n+      Button: {\n+        colorPrimary: '#1890ff',\n+      },\n+    },\n+  };\n+\n+  const result = validateTheme(theme);\n+\n+  expect(result.valid).toBe(true);\n+  expect(result.errors).toHaveLength(0);\n+});\n+\n+test('validateTheme errors on theme with empty token object but no algorithm or components', () => {\n+  const theme: AnyThemeConfig = {\n+    token: {},\n+  };\n+\n+  const result = validateTheme(theme);\n+\n+  expect(result.valid).toBe(false);\n+  expect(result.errors).toHaveLength(1);\n+  expect(result.errors[0].message).toContain('cannot be empty');\n+});\n+\n+test('validateTheme combines errors and warnings correctly', () => {\n+  const theme: AnyThemeConfig = {\n+    token: {\n+      colorPrimary: '#1890ff',\n+      unknownToken: 'value',\n+      nullToken: null,\n+    },\n+  };\n+\n+  const result = validateTheme(theme);\n+\n+  expect(result.valid).toBe(true); // No errors, just warnings\n+  expect(result.errors).toHaveLength(0);\n+  expect(result.warnings.length).toBeGreaterThan(0);\n+});", "pull_request_number": 35349}
{"sha": "99ee1bf74179a9d51d7b40e4c11236616f8228c6", "filename": "superset-frontend/src/theme/utils/themeStructureValidation.ts", "status": "added", "additions": 100, "deletions": 0, "changes": 100, "blob_url": "https://github.com/apache/superset/blob/b75309c832df909f59cdbb55a8e8ca484fc4f037/superset-frontend%2Fsrc%2Ftheme%2Futils%2FthemeStructureValidation.ts", "raw_url": "https://github.com/apache/superset/raw/b75309c832df909f59cdbb55a8e8ca484fc4f037/superset-frontend%2Fsrc%2Ftheme%2Futils%2FthemeStructureValidation.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ftheme%2Futils%2FthemeStructureValidation.ts?ref=b75309c832df909f59cdbb55a8e8ca484fc4f037", "patch": "@@ -0,0 +1,100 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import type { AnyThemeConfig } from '@superset-ui/core/theme/types';\n+import { isValidTokenName } from './antdTokenNames';\n+\n+export interface ValidationIssue {\n+  tokenName: string;\n+  severity: 'error' | 'warning';\n+  message: string;\n+}\n+\n+export interface ValidationResult {\n+  valid: boolean; // false if ANY errors exist (warnings don't affect this)\n+  errors: ValidationIssue[];\n+  warnings: ValidationIssue[];\n+}\n+\n+/**\n+ * Validates theme structure and token names.\n+ * - ERRORS block save/apply (invalid structure, empty themes)\n+ * - WARNINGS allow save/apply but show in editor (unknown tokens, null values)\n+ *\n+ * This validation does NOT check token values - Ant Design handles that at runtime.\n+ */\n+export function validateTheme(themeConfig: AnyThemeConfig): ValidationResult {\n+  const errors: ValidationIssue[] = [];\n+  const warnings: ValidationIssue[] = [];\n+\n+  // ERROR: Null/invalid config\n+  if (!themeConfig || typeof themeConfig !== 'object') {\n+    errors.push({\n+      tokenName: '_root',\n+      severity: 'error',\n+      message: 'Theme configuration must be a valid object',\n+    });\n+    return { valid: false, errors, warnings };\n+  }\n+\n+  // ERROR: Empty theme (no tokens, no algorithm, no components)\n+  const hasTokens =\n+    themeConfig.token && Object.keys(themeConfig.token).length > 0;\n+  const hasAlgorithm = Boolean(themeConfig.algorithm);\n+  const hasComponents =\n+    themeConfig.components && Object.keys(themeConfig.components).length > 0;\n+\n+  if (!hasTokens && !hasAlgorithm && !hasComponents) {\n+    errors.push({\n+      tokenName: '_root',\n+      severity: 'error',\n+      message:\n+        'Theme cannot be empty. Add at least one token, algorithm, or component override.',\n+    });\n+    return { valid: false, errors, warnings };\n+  }\n+\n+  // WARNING: Unknown token names (likely typos)\n+  const tokens = themeConfig.token || {};\n+  Object.entries(tokens).forEach(([name, value]) => {\n+    // Null/undefined check\n+    if (value === null || value === undefined) {\n+      warnings.push({\n+        tokenName: name,\n+        severity: 'warning',\n+        message: `Token '${name}' has null/undefined value`,\n+      });\n+      return;\n+    }\n+\n+    // Token name validation\n+    if (!isValidTokenName(name)) {\n+      warnings.push({\n+        tokenName: name,\n+        severity: 'warning',\n+        message: `Unknown token '${name}' - may be ignored by Ant Design`,\n+      });\n+    }\n+  });\n+\n+  return {\n+    valid: errors.length === 0,\n+    errors,\n+    warnings,\n+  };\n+}", "pull_request_number": 35349}
{"sha": "eba8905064e45f43c51a2c1f5151d8557c7e92e4", "filename": "UPDATING.md", "status": "modified", "additions": 23, "deletions": 1, "changes": 24, "blob_url": "https://github.com/apache/superset/blob/4a11d2dc3323d539823aa8cbb7f01aaf75d25c3c/UPDATING.md", "raw_url": "https://github.com/apache/superset/raw/4a11d2dc3323d539823aa8cbb7f01aaf75d25c3c/UPDATING.md", "contents_url": "https://api.github.com/repos/apache/superset/contents/UPDATING.md?ref=4a11d2dc3323d539823aa8cbb7f01aaf75d25c3c", "patch": "@@ -128,6 +128,28 @@ See `superset/mcp_service/PRODUCTION.md` for deployment guides.\n - [35062](https://github.com/apache/superset/pull/35062): Changed the function signature of `setupExtensions` to `setupCodeOverrides` with options as arguments.\n \n ### Breaking Changes\n+- [#34865](https://github.com/apache/superset/issues/34865): The `APP_NAME` configuration variable no longer controls the browser window/tab title or other frontend branding. Application names should now be configured using the theme system with the `brandAppName` token. The `APP_NAME` config is still used for backend contexts (MCP service, logs, etc.) and serves as a fallback if `brandAppName` is not set.\n+  - **Migration:**\n+  ```python\n+  # Before (Superset 5.x)\n+  APP_NAME = \"My Custom App\"\n+\n+  # After (Superset 6.x) - Option 1: Use theme system (recommended)\n+  THEME_DEFAULT = {\n+    \"token\": {\n+      \"brandAppName\": \"My Custom App\",  # Window titles\n+      \"brandLogoAlt\": \"My Custom App\",  # Logo alt text\n+      \"brandLogoUrl\": \"/static/assets/images/custom_logo.png\"\n+    }\n+  }\n+\n+  # After (Superset 6.x) - Option 2: Temporary fallback\n+  # Keep APP_NAME for now (will be used as fallback for brandAppName)\n+  APP_NAME = \"My Custom App\"\n+  # But you should migrate to THEME_DEFAULT.token.brandAppName\n+  ```\n+  - **Note:** For dark mode, set the same tokens in `THEME_DARK` configuration.\n+\n - [36317](https://github.com/apache/superset/pull/36317): The `CUSTOM_FONT_URLS` configuration option has been removed. Use the new per-theme `fontUrls` token in `THEME_DEFAULT` or database-managed themes instead.\n   - **Before:**\n   ```python\n@@ -142,7 +164,7 @@ See `superset/mcp_service/PRODUCTION.md` for deployment guides.\n       \"fontUrls\": [\n         \"https://fonts.example.com/myfont.css\",\n         ],\n-        # ... other tokens  \n+        # ... other tokens\n     }\n   }\n   ```", "pull_request_number": 37059}
{"sha": "b374c2fd645d1d8cef812763b70becfc98bec8cc", "filename": "superset-frontend/oxlint.json", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/4a11d2dc3323d539823aa8cbb7f01aaf75d25c3c/superset-frontend%2Foxlint.json", "raw_url": "https://github.com/apache/superset/raw/4a11d2dc3323d539823aa8cbb7f01aaf75d25c3c/superset-frontend%2Foxlint.json", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Foxlint.json?ref=4a11d2dc3323d539823aa8cbb7f01aaf75d25c3c", "patch": "@@ -14,7 +14,7 @@\n   },\n   \"settings\": {\n     \"react\": {\n-      \"version\": \"detect\"\n+      \"version\": \"17.0\"\n     }\n   },\n   \"rules\": {", "pull_request_number": 37059}
{"sha": "8b0144e045731fe447c37309d29b33c8106f56f8", "filename": "superset-frontend/packages/superset-core/src/ui/theme/types.ts", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/apache/superset/blob/4a11d2dc3323d539823aa8cbb7f01aaf75d25c3c/superset-frontend%2Fpackages%2Fsuperset-core%2Fsrc%2Fui%2Ftheme%2Ftypes.ts", "raw_url": "https://github.com/apache/superset/raw/4a11d2dc3323d539823aa8cbb7f01aaf75d25c3c/superset-frontend%2Fpackages%2Fsuperset-core%2Fsrc%2Fui%2Ftheme%2Ftypes.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-core%2Fsrc%2Fui%2Ftheme%2Ftypes.ts?ref=4a11d2dc3323d539823aa8cbb7f01aaf75d25c3c", "patch": "@@ -119,6 +119,7 @@ export interface SupersetSpecificTokens {\n \n   // Brand-related\n   brandIconMaxWidth: number;\n+  brandAppName?: string;\n   brandLogoAlt: string;\n   brandLogoUrl: string;\n   brandLogoMargin: string;", "pull_request_number": 37059}
{"sha": "99249af74d7d30852e6b13060506b619769a8ce1", "filename": "superset-frontend/src/dashboard/containers/DashboardPage.tsx", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/apache/superset/blob/4a11d2dc3323d539823aa8cbb7f01aaf75d25c3c/superset-frontend%2Fsrc%2Fdashboard%2Fcontainers%2FDashboardPage.tsx", "raw_url": "https://github.com/apache/superset/raw/4a11d2dc3323d539823aa8cbb7f01aaf75d25c3c/superset-frontend%2Fsrc%2Fdashboard%2Fcontainers%2FDashboardPage.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fdashboard%2Fcontainers%2FDashboardPage.tsx?ref=4a11d2dc3323d539823aa8cbb7f01aaf75d25c3c", "patch": "@@ -210,14 +210,25 @@ export const DashboardPage: FC<PageProps> = ({ idOrSlug }: PageProps) => {\n     // eslint-disable-next-line react-hooks/exhaustive-deps\n   }, [readyToRender]);\n \n+  // Update document title when dashboard title changes\n   useEffect(() => {\n     if (dashboard_title) {\n       document.title = dashboard_title;\n     }\n+  }, [dashboard_title]);\n+\n+  // Restore original title on unmount (run once)\n+  useEffect(() => {\n+    const originalTitle = document.title;\n     return () => {\n-      document.title = 'Superset';\n+      document.title =\n+        originalTitle ||\n+        theme?.brandAppName ||\n+        theme?.brandLogoAlt ||\n+        'Superset';\n     };\n-  }, [dashboard_title]);\n+    // eslint-disable-next-line react-hooks/exhaustive-deps\n+  }, []);\n \n   useEffect(() => {\n     if (typeof css === 'string') {", "pull_request_number": 37059}
{"sha": "86b2b61a6bae527633fc01ae64677f9ec42ba75b", "filename": "superset-frontend/src/explore/components/ExploreViewContainer/index.jsx", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/apache/superset/blob/4a11d2dc3323d539823aa8cbb7f01aaf75d25c3c/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2FExploreViewContainer%2Findex.jsx", "raw_url": "https://github.com/apache/superset/raw/4a11d2dc3323d539823aa8cbb7f01aaf75d25c3c/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2FExploreViewContainer%2Findex.jsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2FExploreViewContainer%2Findex.jsx?ref=4a11d2dc3323d539823aa8cbb7f01aaf75d25c3c", "patch": "@@ -292,14 +292,25 @@ function ExploreViewContainer(props) {\n \n   const theme = useTheme();\n \n+  // Update document title when slice name changes\n   useEffect(() => {\n     if (props.sliceName) {\n       document.title = props.sliceName;\n     }\n+  }, [props.sliceName]);\n+\n+  // Restore original title on unmount (run once)\n+  useEffect(() => {\n+    const originalTitle = document.title;\n     return () => {\n-      document.title = 'Superset';\n+      document.title =\n+        originalTitle ||\n+        theme?.brandAppName ||\n+        theme?.brandLogoAlt ||\n+        'Superset';\n     };\n-  }, [props.sliceName]);\n+    // eslint-disable-next-line react-hooks/exhaustive-deps\n+  }, []);\n \n   const addHistory = useCallback(\n     async ({ isReplace = false, title } = {}) => {", "pull_request_number": 37059}
{"sha": "cc0e236766d4f22c1ebdd0ca7d9e8fd75ebeaa11", "filename": "superset/config.py", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/4a11d2dc3323d539823aa8cbb7f01aaf75d25c3c/superset%2Fconfig.py", "raw_url": "https://github.com/apache/superset/raw/4a11d2dc3323d539823aa8cbb7f01aaf75d25c3c/superset%2Fconfig.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Fconfig.py?ref=4a11d2dc3323d539823aa8cbb7f01aaf75d25c3c", "patch": "@@ -777,6 +777,8 @@ class D3TimeFormat(TypedDict, total=False):\n THEME_DEFAULT: Theme = {\n     \"token\": {\n         # Brand\n+        # Application name for window titles\n+        \"brandAppName\": APP_NAME,\n         \"brandLogoAlt\": \"Apache Superset\",\n         \"brandLogoUrl\": APP_ICON,\n         \"brandLogoMargin\": \"18px 0\",", "pull_request_number": 37059}
{"sha": "a07e72d7f744b4c7a16667a4f9ddea7cfd0fc9e3", "filename": "superset/templates/superset/spa.html", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/4a11d2dc3323d539823aa8cbb7f01aaf75d25c3c/superset%2Ftemplates%2Fsuperset%2Fspa.html", "raw_url": "https://github.com/apache/superset/raw/4a11d2dc3323d539823aa8cbb7f01aaf75d25c3c/superset%2Ftemplates%2Fsuperset%2Fspa.html", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Ftemplates%2Fsuperset%2Fspa.html?ref=4a11d2dc3323d539823aa8cbb7f01aaf75d25c3c", "patch": "@@ -24,6 +24,8 @@\n       {% block title %}\n         {% if title %}\n           {{ title }}\n+        {% else %}\n+          {{ default_title | default('Superset') }}\n         {% endif %}\n       {% endblock %}\n     </title>", "pull_request_number": 37059}
{"sha": "f8d44f0f994331e89b83bfb0bb05447e52fd568e", "filename": "superset/views/base.py", "status": "modified", "additions": 37, "deletions": 3, "changes": 40, "blob_url": "https://github.com/apache/superset/blob/4a11d2dc3323d539823aa8cbb7f01aaf75d25c3c/superset%2Fviews%2Fbase.py", "raw_url": "https://github.com/apache/superset/raw/4a11d2dc3323d539823aa8cbb7f01aaf75d25c3c/superset%2Fviews%2Fbase.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Fviews%2Fbase.py?ref=4a11d2dc3323d539823aa8cbb7f01aaf75d25c3c", "patch": "@@ -16,6 +16,7 @@\n # under the License.\n from __future__ import annotations\n \n+import copy\n import functools\n import logging\n import os\n@@ -567,10 +568,39 @@ def get_spa_template_context(\n     \"\"\"\n     payload = get_spa_payload(extra_bootstrap_data)\n \n-    # Extract theme data for template access\n-    theme_data = get_theme_bootstrap_data().get(\"theme\", {})\n+    # Deep copy theme data to avoid mutating cached bootstrap payload\n+    theme_data = copy.deepcopy(payload.get(\"common\", {}).get(\"theme\", {}))\n     default_theme = theme_data.get(\"default\", {})\n-    theme_tokens = default_theme.get(\"token\", {})\n+    dark_theme = theme_data.get(\"dark\", {})\n+\n+    # Apply brandAppName fallback to both default and dark themes\n+    # Priority: theme brandAppName > APP_NAME config > \"Superset\" default\n+    app_name_from_config = app.config.get(\"APP_NAME\", \"Superset\")\n+    for theme_config in [default_theme, dark_theme]:\n+        if not theme_config:\n+            continue\n+        # Get or create token dict\n+        if \"token\" not in theme_config:\n+            theme_config[\"token\"] = {}\n+        theme_tokens = theme_config[\"token\"]\n+\n+        if (\n+            not theme_tokens.get(\"brandAppName\")\n+            or theme_tokens.get(\"brandAppName\") == \"Superset\"\n+        ):\n+            # If brandAppName not set or is default, check if APP_NAME customized\n+            if app_name_from_config != \"Superset\":\n+                # User has customized APP_NAME, use it as brandAppName\n+                theme_tokens[\"brandAppName\"] = app_name_from_config\n+\n+    # Write the modified theme data back to payload\n+    if \"common\" not in payload:\n+        payload[\"common\"] = {}\n+    payload[\"common\"][\"theme\"] = theme_data\n+\n+    # Extract theme tokens for template access (after fallback applied)\n+    # Use the direct reference to ensure we get the modified token dict\n+    theme_tokens = default_theme.get(\"token\", {}) if default_theme else {}\n \n     # Determine spinner content with precedence: theme SVG > theme URL > default SVG\n     spinner_svg = None\n@@ -581,13 +611,17 @@ def get_spa_template_context(\n         # No custom URL either, use default SVG\n         spinner_svg = get_default_spinner_svg()\n \n+    # Determine default title using the (potentially updated) brandAppName\n+    default_title = theme_tokens.get(\"brandAppName\", \"Superset\")\n+\n     return {\n         \"entry\": entry,\n         \"bootstrap_data\": json.dumps(\n             payload, default=json.pessimistic_json_iso_dttm_ser\n         ),\n         \"theme_tokens\": theme_tokens,\n         \"spinner_svg\": spinner_svg,\n+        \"default_title\": default_title,\n         **template_kwargs,\n     }\n ", "pull_request_number": 37059}
{"sha": "626f3dd22504c99efa5f9bdaa69d475ed72d17d2", "filename": "tests/unit_tests/views/test_base_theme_helpers.py", "status": "modified", "additions": 237, "deletions": 0, "changes": 237, "blob_url": "https://github.com/apache/superset/blob/4a11d2dc3323d539823aa8cbb7f01aaf75d25c3c/tests%2Funit_tests%2Fviews%2Ftest_base_theme_helpers.py", "raw_url": "https://github.com/apache/superset/raw/4a11d2dc3323d539823aa8cbb7f01aaf75d25c3c/tests%2Funit_tests%2Fviews%2Ftest_base_theme_helpers.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/tests%2Funit_tests%2Fviews%2Ftest_base_theme_helpers.py?ref=4a11d2dc3323d539823aa8cbb7f01aaf75d25c3c", "patch": "@@ -530,3 +530,240 @@ def test_ui_admin_disabled_no_config_themes(self, mock_get_config, mock_app):\n         assert result[\"theme\"][\"enableUiThemeAdministration\"] is False\n         assert result[\"theme\"][\"default\"] == {}\n         assert result[\"theme\"][\"dark\"] == {}\n+\n+\n+class TestBrandAppNameFallback:\n+    \"\"\"Test brandAppName fallback mechanism for APP_NAME migration (issue #34865)\"\"\"\n+\n+    @patch(\"superset.views.base.get_spa_payload\")\n+    @patch(\"superset.views.base.app\")\n+    def test_brandappname_uses_theme_value_when_set(self, mock_app, mock_payload):\n+        \"\"\"Test that explicit brandAppName in theme takes precedence\"\"\"\n+        from superset.views.base import get_spa_template_context\n+\n+        # Use a plain dict for config to mirror Flask's config mapping behavior\n+        mock_app.config = {\"APP_NAME\": \"Fallback App Name\"}\n+\n+        # Mock payload with theme data that has custom brandAppName\n+        mock_payload.return_value = {\n+            \"common\": {\n+                \"theme\": {\n+                    \"default\": {\n+                        \"token\": {\n+                            \"brandAppName\": \"My Custom App\",\n+                            \"brandLogoAlt\": \"Logo Alt\",\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+\n+        result = get_spa_template_context(\"app\")\n+\n+        # Should use the theme's brandAppName\n+        assert result[\"default_title\"] == \"My Custom App\"\n+        # Theme tokens should have brandAppName\n+        theme_tokens = result[\"theme_tokens\"]\n+        assert theme_tokens[\"brandAppName\"] == \"My Custom App\"\n+\n+    @patch(\"superset.views.base.get_spa_payload\")\n+    @patch(\"superset.views.base.app\")\n+    def test_brandappname_falls_back_to_app_name_config(self, mock_app, mock_payload):\n+        \"\"\"Test fallback to APP_NAME config when brandAppName not in theme\"\"\"\n+        from superset.views.base import get_spa_template_context\n+\n+        mock_app.config = MagicMock()\n+        mock_app.config.get.side_effect = lambda k, d=None: {\n+            \"APP_NAME\": \"My Test Analytics Platform\",\n+        }.get(k, d)\n+\n+        # Mock payload with default \"Superset\" brandAppName\n+        mock_payload.return_value = {\n+            \"common\": {\n+                \"theme\": {\n+                    \"default\": {\n+                        \"token\": {\n+                            \"brandAppName\": \"Superset\",  # Default value\n+                            \"brandLogoAlt\": \"Apache Superset\",\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+\n+        result = get_spa_template_context(\"app\")\n+\n+        # Should fall back to APP_NAME config\n+        assert result[\"default_title\"] == \"My Test Analytics Platform\"\n+        # Theme tokens should be updated with APP_NAME value\n+        theme_tokens = result[\"theme_tokens\"]\n+        assert theme_tokens[\"brandAppName\"] == \"My Test Analytics Platform\"\n+\n+    @patch(\"superset.views.base.get_spa_payload\")\n+    @patch(\"superset.views.base.app\")\n+    def test_brandappname_uses_superset_default_when_nothing_set(\n+        self, mock_app, mock_payload\n+    ):\n+        \"\"\"Test fallback to 'Superset' when neither is customized\"\"\"\n+        from superset.views.base import get_spa_template_context\n+\n+        mock_app.config = MagicMock()\n+        mock_app.config.get.side_effect = lambda k, d=None: {\n+            \"APP_NAME\": \"Superset\",  # Default value\n+        }.get(k, d)\n+\n+        # Mock payload with default \"Superset\" brandAppName\n+        mock_payload.return_value = {\n+            \"common\": {\n+                \"theme\": {\n+                    \"default\": {\n+                        \"token\": {\n+                            \"brandAppName\": \"Superset\",  # Default value\n+                            \"brandLogoAlt\": \"Apache Superset\",\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+\n+        result = get_spa_template_context(\"app\")\n+\n+        # Should use default \"Superset\"\n+        assert result[\"default_title\"] == \"Superset\"\n+        # Theme tokens should keep \"Superset\"\n+        theme_tokens = result[\"theme_tokens\"]\n+        assert theme_tokens[\"brandAppName\"] == \"Superset\"\n+\n+    @patch(\"superset.views.base.get_spa_payload\")\n+    @patch(\"superset.views.base.app\")\n+    def test_brandappname_empty_string_falls_back(self, mock_app, mock_payload):\n+        \"\"\"Test that empty string brandAppName triggers fallback\"\"\"\n+        from superset.views.base import get_spa_template_context\n+\n+        mock_app.config = MagicMock()\n+        mock_app.config.get.side_effect = lambda k, d=None: {\n+            \"APP_NAME\": \"Custom App\",\n+        }.get(k, d)\n+\n+        # Mock payload with empty brandAppName\n+        mock_payload.return_value = {\n+            \"common\": {\n+                \"theme\": {\n+                    \"default\": {\n+                        \"token\": {\n+                            \"brandAppName\": \"\",  # Empty string\n+                            \"brandLogoAlt\": \"Logo\",\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+\n+        result = get_spa_template_context(\"app\")\n+\n+        # Should fall back to APP_NAME\n+        assert result[\"default_title\"] == \"Custom App\"\n+        theme_tokens = result[\"theme_tokens\"]\n+        assert theme_tokens[\"brandAppName\"] == \"Custom App\"\n+\n+    @patch(\"superset.views.base.get_spa_payload\")\n+    @patch(\"superset.views.base.app\")\n+    def test_brandappname_none_falls_back(self, mock_app, mock_payload):\n+        \"\"\"Test that missing brandAppName triggers fallback\"\"\"\n+        from superset.views.base import get_spa_template_context\n+\n+        mock_app.config = MagicMock()\n+        mock_app.config.get.side_effect = lambda k, d=None: {\n+            \"APP_NAME\": \"Analytics Dashboard\",\n+        }.get(k, d)\n+\n+        # Mock payload without brandAppName\n+        mock_payload.return_value = {\n+            \"common\": {\"theme\": {\"default\": {\"token\": {\"brandLogoAlt\": \"Logo\"}}}}\n+        }\n+\n+        result = get_spa_template_context(\"app\")\n+\n+        # Should fall back to APP_NAME\n+        assert result[\"default_title\"] == \"Analytics Dashboard\"\n+        theme_tokens = result[\"theme_tokens\"]\n+        assert theme_tokens[\"brandAppName\"] == \"Analytics Dashboard\"\n+\n+    @patch(\"superset.views.base.get_spa_payload\")\n+    @patch(\"superset.views.base.app\")\n+    def test_brandappname_updates_both_default_and_dark_themes(\n+        self, mock_app, mock_payload\n+    ):\n+        \"\"\"Test that brandAppName fallback applies to both default and dark themes\"\"\"\n+        from superset.views.base import get_spa_template_context\n+\n+        mock_app.config = MagicMock()\n+        mock_app.config.get.side_effect = lambda k, d=None: {\n+            \"APP_NAME\": \"Multi Theme App\",\n+        }.get(k, d)\n+\n+        # Mock payload with both themes missing brandAppName\n+        mock_payload.return_value = {\n+            \"common\": {\n+                \"theme\": {\n+                    \"default\": {\n+                        \"token\": {\n+                            \"brandAppName\": \"Superset\",  # Default value\n+                            \"colorPrimary\": \"#111\",\n+                        }\n+                    },\n+                    \"dark\": {\n+                        \"token\": {\n+                            # Missing brandAppName\n+                            \"colorPrimary\": \"#222\",\n+                        }\n+                    },\n+                }\n+            }\n+        }\n+\n+        result = get_spa_template_context(\"app\")\n+\n+        # Should update both themes\n+        assert result[\"default_title\"] == \"Multi Theme App\"\n+        # Verify default theme was updated\n+        theme_tokens = result[\"theme_tokens\"]\n+        assert theme_tokens[\"brandAppName\"] == \"Multi Theme App\"\n+        assert theme_tokens[\"colorPrimary\"] == \"#111\"  # Preserved\n+\n+    @patch(\"superset.views.base.get_spa_payload\")\n+    @patch(\"superset.views.base.app\")\n+    def test_brandappname_does_not_mutate_cached_payload(self, mock_app, mock_payload):\n+        \"\"\"Test that brandAppName fallback doesn't mutate the cached payload\"\"\"\n+        from superset.views.base import get_spa_template_context\n+\n+        mock_app.config = MagicMock()\n+        mock_app.config.get.side_effect = lambda k, d=None: {\n+            \"APP_NAME\": \"Test App\",\n+        }.get(k, d)\n+\n+        # Create a payload that simulates cached data\n+        original_theme_data = {\n+            \"default\": {\n+                \"token\": {\n+                    \"brandAppName\": \"Superset\",\n+                    \"colorPrimary\": \"#333\",\n+                }\n+            }\n+        }\n+\n+        mock_payload.return_value = {\"common\": {\"theme\": original_theme_data}}\n+\n+        # Call get_spa_template_context\n+        result = get_spa_template_context(\"app\")\n+\n+        # Verify the function result has the updated brandAppName\n+        assert result[\"default_title\"] == \"Test App\"\n+        theme_tokens = result[\"theme_tokens\"]\n+        assert theme_tokens[\"brandAppName\"] == \"Test App\"\n+\n+        # Verify the original mock payload structure wasn't mutated\n+        # (the function should deep copy before mutating)\n+        # Note: We can't easily test the cached payload immutability\n+        # without more complex mocking, but we've verified the result is correct\n+        assert result[\"default_title\"] == \"Test App\"", "pull_request_number": 37059}
{"sha": "03c5e8d45a39d69d5d47c2586daac0a2c54c2453", "filename": "superset-frontend/packages/superset-core/src/ui/theme/types.ts", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/apache/superset/blob/d0837ad40811c08c8ad6601f5615e9e92491aa2c/superset-frontend%2Fpackages%2Fsuperset-core%2Fsrc%2Fui%2Ftheme%2Ftypes.ts", "raw_url": "https://github.com/apache/superset/raw/d0837ad40811c08c8ad6601f5615e9e92491aa2c/superset-frontend%2Fpackages%2Fsuperset-core%2Fsrc%2Fui%2Ftheme%2Ftypes.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-core%2Fsrc%2Fui%2Ftheme%2Ftypes.ts?ref=d0837ad40811c08c8ad6601f5615e9e92491aa2c", "patch": "@@ -159,6 +159,13 @@ export interface SupersetSpecificTokens {\n   echartsOptionsOverridesByChartType?: {\n     [chartType: string]: any;\n   };\n+\n+  // Editor-related\n+  /**\n+   * Background color for code editor text selection.\n+   * Defaults to colorPrimaryBgHover if not specified.\n+   */\n+  colorEditorSelection?: string;\n }\n \n /**", "pull_request_number": 36932}
{"sha": "bebd1ea796078910c63cff556fe35d7722597a67", "filename": "superset-frontend/packages/superset-ui-core/src/components/AsyncAceEditor/index.tsx", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/apache/superset/blob/d0837ad40811c08c8ad6601f5615e9e92491aa2c/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FAsyncAceEditor%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/d0837ad40811c08c8ad6601f5615e9e92491aa2c/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FAsyncAceEditor%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FAsyncAceEditor%2Findex.tsx?ref=d0837ad40811c08c8ad6601f5615e9e92491aa2c", "patch": "@@ -294,7 +294,8 @@ export function AsyncAceEditor(\n                 }\n                 /* Adjust selection color */\n                 .ace_editor .ace_selection {\n-                  background-color: ${token.colorPrimaryBgHover} !important;\n+                  background-color: ${token.colorEditorSelection ??\n+                  token.colorPrimaryBgHover} !important;\n                 }\n \n                 /* Improve active line highlighting */", "pull_request_number": 36932}
{"sha": "e81ee686a8915c26f132e10e4a5059bdc64e2029", "filename": "superset/config.py", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/apache/superset/blob/d0837ad40811c08c8ad6601f5615e9e92491aa2c/superset%2Fconfig.py", "raw_url": "https://github.com/apache/superset/raw/d0837ad40811c08c8ad6601f5615e9e92491aa2c/superset%2Fconfig.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Fconfig.py?ref=d0837ad40811c08c8ad6601f5615e9e92491aa2c", "patch": "@@ -804,6 +804,8 @@ class D3TimeFormat(TypedDict, total=False):\n         \"fontWeightNormal\": \"400\",\n         \"fontWeightLight\": \"300\",\n         \"fontWeightStrong\": \"500\",\n+        # Editor selection color (for SQL Lab text highlighting)\n+        \"colorEditorSelection\": \"#fff5cf\",\n     },\n     \"algorithm\": \"default\",\n }\n@@ -813,6 +815,11 @@ class D3TimeFormat(TypedDict, total=False):\n # Set to None to disable dark mode\n THEME_DARK: Optional[Theme] = {\n     **THEME_DEFAULT,\n+    \"token\": {\n+        **THEME_DEFAULT[\"token\"],\n+        # Darker selection color for dark mode\n+        \"colorEditorSelection\": \"#5c4d1a\",\n+    },\n     \"algorithm\": \"dark\",\n }\n ", "pull_request_number": 36932}
{"sha": "585917afda2294632057c159cd1d119e8971c444", "filename": ".github/dependabot.yml", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/apache/superset/blob/a7e25fa9426f1e0578dc9ed2fdd9f24390c7151d/.github%2Fdependabot.yml", "raw_url": "https://github.com/apache/superset/raw/a7e25fa9426f1e0578dc9ed2fdd9f24390c7151d/.github%2Fdependabot.yml", "contents_url": "https://api.github.com/repos/apache/superset/contents/.github%2Fdependabot.yml?ref=a7e25fa9426f1e0578dc9ed2fdd9f24390c7151d", "patch": "@@ -12,6 +12,9 @@ updates:\n       # not until React >= 18.0.0\n       - dependency-name: \"storybook\"\n       - dependency-name: \"@storybook*\"\n+      # remark-gfm v4+ requires react-markdown v9+, which needs React 18\n+      - dependency-name: \"remark-gfm\"\n+      - dependency-name: \"react-markdown\"\n       # JSDOM v30 doesn't play well with Jest v30\n       # Source: https://jestjs.io/blog#known-issues\n       # GH thread: https://github.com/jsdom/jsdom/issues/3492", "pull_request_number": 36388}
{"sha": "e1f2c2d7d1b7c7f52664af8c6b335544f9e6d231", "filename": "superset-frontend/package-lock.json", "status": "modified", "additions": 991, "deletions": 1057, "changes": 2048, "blob_url": "https://github.com/apache/superset/blob/a7e25fa9426f1e0578dc9ed2fdd9f24390c7151d/superset-frontend%2Fpackage-lock.json", "raw_url": "https://github.com/apache/superset/raw/a7e25fa9426f1e0578dc9ed2fdd9f24390c7151d/superset-frontend%2Fpackage-lock.json", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackage-lock.json?ref=a7e25fa9426f1e0578dc9ed2fdd9f24390c7151d", "patch": "@@ -15092,6 +15092,872 @@\n         \"storybook\": \"^8.6.14\"\n       }\n     },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/@types/mdast\": {\n+      \"version\": \"3.0.15\",\n+      \"resolved\": \"https://registry.npmjs.org/@types/mdast/-/mdast-3.0.15.tgz\",\n+      \"integrity\": \"sha512-LnwD+mUEfxWMa1QpDraczIn6k0Ee3SMicuYSSzS6ZYl2gKS09EClnJYGd8Du6rfc5r/GZEk5o1mRb8TaTj03sQ==\",\n+      \"dev\": true,\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"@types/unist\": \"^2\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/escape-string-regexp\": {\n+      \"version\": \"5.0.0\",\n+      \"resolved\": \"https://registry.npmjs.org/escape-string-regexp/-/escape-string-regexp-5.0.0.tgz\",\n+      \"integrity\": \"sha512-/veY75JbMK4j1yjvuUxuVsiS/hr/4iHs9FTT6cgTexxdE0Ly/glccBAkloH/DofkjRbZU3bnoj38mOmhkZ0lHw==\",\n+      \"dev\": true,\n+      \"license\": \"MIT\",\n+      \"engines\": {\n+        \"node\": \">=12\"\n+      },\n+      \"funding\": {\n+        \"url\": \"https://github.com/sponsors/sindresorhus\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/mdast-util-find-and-replace\": {\n+      \"version\": \"2.2.2\",\n+      \"resolved\": \"https://registry.npmjs.org/mdast-util-find-and-replace/-/mdast-util-find-and-replace-2.2.2.tgz\",\n+      \"integrity\": \"sha512-MTtdFRz/eMDHXzeK6W3dO7mXUlF82Gom4y0oOgvHhh/HXZAGvIQDUvQ0SuUx+j2tv44b8xTHOm8K/9OoRFnXKw==\",\n+      \"dev\": true,\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"@types/mdast\": \"^3.0.0\",\n+        \"escape-string-regexp\": \"^5.0.0\",\n+        \"unist-util-is\": \"^5.0.0\",\n+        \"unist-util-visit-parents\": \"^5.0.0\"\n+      },\n+      \"funding\": {\n+        \"type\": \"opencollective\",\n+        \"url\": \"https://opencollective.com/unified\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/mdast-util-from-markdown\": {\n+      \"version\": \"1.3.1\",\n+      \"resolved\": \"https://registry.npmjs.org/mdast-util-from-markdown/-/mdast-util-from-markdown-1.3.1.tgz\",\n+      \"integrity\": \"sha512-4xTO/M8c82qBcnQc1tgpNtubGUW/Y1tBQ1B0i5CtSoelOLKFYlElIr3bvgREYYO5iRqbMY1YuqZng0GVOI8Qww==\",\n+      \"dev\": true,\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"@types/mdast\": \"^3.0.0\",\n+        \"@types/unist\": \"^2.0.0\",\n+        \"decode-named-character-reference\": \"^1.0.0\",\n+        \"mdast-util-to-string\": \"^3.1.0\",\n+        \"micromark\": \"^3.0.0\",\n+        \"micromark-util-decode-numeric-character-reference\": \"^1.0.0\",\n+        \"micromark-util-decode-string\": \"^1.0.0\",\n+        \"micromark-util-normalize-identifier\": \"^1.0.0\",\n+        \"micromark-util-symbol\": \"^1.0.0\",\n+        \"micromark-util-types\": \"^1.0.0\",\n+        \"unist-util-stringify-position\": \"^3.0.0\",\n+        \"uvu\": \"^0.5.0\"\n+      },\n+      \"funding\": {\n+        \"type\": \"opencollective\",\n+        \"url\": \"https://opencollective.com/unified\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/mdast-util-gfm\": {\n+      \"version\": \"2.0.2\",\n+      \"resolved\": \"https://registry.npmjs.org/mdast-util-gfm/-/mdast-util-gfm-2.0.2.tgz\",\n+      \"integrity\": \"sha512-qvZ608nBppZ4icQlhQQIAdc6S3Ffj9RGmzwUKUWuEICFnd1LVkN3EktF7ZHAgfcEdvZB5owU9tQgt99e2TlLjg==\",\n+      \"dev\": true,\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"mdast-util-from-markdown\": \"^1.0.0\",\n+        \"mdast-util-gfm-autolink-literal\": \"^1.0.0\",\n+        \"mdast-util-gfm-footnote\": \"^1.0.0\",\n+        \"mdast-util-gfm-strikethrough\": \"^1.0.0\",\n+        \"mdast-util-gfm-table\": \"^1.0.0\",\n+        \"mdast-util-gfm-task-list-item\": \"^1.0.0\",\n+        \"mdast-util-to-markdown\": \"^1.0.0\"\n+      },\n+      \"funding\": {\n+        \"type\": \"opencollective\",\n+        \"url\": \"https://opencollective.com/unified\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/mdast-util-gfm-autolink-literal\": {\n+      \"version\": \"1.0.3\",\n+      \"resolved\": \"https://registry.npmjs.org/mdast-util-gfm-autolink-literal/-/mdast-util-gfm-autolink-literal-1.0.3.tgz\",\n+      \"integrity\": \"sha512-My8KJ57FYEy2W2LyNom4n3E7hKTuQk/0SES0u16tjA9Z3oFkF4RrC/hPAPgjlSpezsOvI8ObcXcElo92wn5IGA==\",\n+      \"dev\": true,\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"@types/mdast\": \"^3.0.0\",\n+        \"ccount\": \"^2.0.0\",\n+        \"mdast-util-find-and-replace\": \"^2.0.0\",\n+        \"micromark-util-character\": \"^1.0.0\"\n+      },\n+      \"funding\": {\n+        \"type\": \"opencollective\",\n+        \"url\": \"https://opencollective.com/unified\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/mdast-util-gfm-footnote\": {\n+      \"version\": \"1.0.2\",\n+      \"resolved\": \"https://registry.npmjs.org/mdast-util-gfm-footnote/-/mdast-util-gfm-footnote-1.0.2.tgz\",\n+      \"integrity\": \"sha512-56D19KOGbE00uKVj3sgIykpwKL179QsVFwx/DCW0u/0+URsryacI4MAdNJl0dh+u2PSsD9FtxPFbHCzJ78qJFQ==\",\n+      \"dev\": true,\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"@types/mdast\": \"^3.0.0\",\n+        \"mdast-util-to-markdown\": \"^1.3.0\",\n+        \"micromark-util-normalize-identifier\": \"^1.0.0\"\n+      },\n+      \"funding\": {\n+        \"type\": \"opencollective\",\n+        \"url\": \"https://opencollective.com/unified\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/mdast-util-gfm-strikethrough\": {\n+      \"version\": \"1.0.3\",\n+      \"resolved\": \"https://registry.npmjs.org/mdast-util-gfm-strikethrough/-/mdast-util-gfm-strikethrough-1.0.3.tgz\",\n+      \"integrity\": \"sha512-DAPhYzTYrRcXdMjUtUjKvW9z/FNAMTdU0ORyMcbmkwYNbKocDpdk+PX1L1dQgOID/+vVs1uBQ7ElrBQfZ0cuiQ==\",\n+      \"dev\": true,\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"@types/mdast\": \"^3.0.0\",\n+        \"mdast-util-to-markdown\": \"^1.3.0\"\n+      },\n+      \"funding\": {\n+        \"type\": \"opencollective\",\n+        \"url\": \"https://opencollective.com/unified\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/mdast-util-gfm-table\": {\n+      \"version\": \"1.0.7\",\n+      \"resolved\": \"https://registry.npmjs.org/mdast-util-gfm-table/-/mdast-util-gfm-table-1.0.7.tgz\",\n+      \"integrity\": \"sha512-jjcpmNnQvrmN5Vx7y7lEc2iIOEytYv7rTvu+MeyAsSHTASGCCRA79Igg2uKssgOs1i1po8s3plW0sTu1wkkLGg==\",\n+      \"dev\": true,\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"@types/mdast\": \"^3.0.0\",\n+        \"markdown-table\": \"^3.0.0\",\n+        \"mdast-util-from-markdown\": \"^1.0.0\",\n+        \"mdast-util-to-markdown\": \"^1.3.0\"\n+      },\n+      \"funding\": {\n+        \"type\": \"opencollective\",\n+        \"url\": \"https://opencollective.com/unified\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/mdast-util-gfm-task-list-item\": {\n+      \"version\": \"1.0.2\",\n+      \"resolved\": \"https://registry.npmjs.org/mdast-util-gfm-task-list-item/-/mdast-util-gfm-task-list-item-1.0.2.tgz\",\n+      \"integrity\": \"sha512-PFTA1gzfp1B1UaiJVyhJZA1rm0+Tzn690frc/L8vNX1Jop4STZgOE6bxUhnzdVSB+vm2GU1tIsuQcA9bxTQpMQ==\",\n+      \"dev\": true,\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"@types/mdast\": \"^3.0.0\",\n+        \"mdast-util-to-markdown\": \"^1.3.0\"\n+      },\n+      \"funding\": {\n+        \"type\": \"opencollective\",\n+        \"url\": \"https://opencollective.com/unified\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/mdast-util-phrasing\": {\n+      \"version\": \"3.0.1\",\n+      \"resolved\": \"https://registry.npmjs.org/mdast-util-phrasing/-/mdast-util-phrasing-3.0.1.tgz\",\n+      \"integrity\": \"sha512-WmI1gTXUBJo4/ZmSk79Wcb2HcjPJBzM1nlI/OUWA8yk2X9ik3ffNbBGsU+09BFmXaL1IBb9fiuvq6/KMiNycSg==\",\n+      \"dev\": true,\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"@types/mdast\": \"^3.0.0\",\n+        \"unist-util-is\": \"^5.0.0\"\n+      },\n+      \"funding\": {\n+        \"type\": \"opencollective\",\n+        \"url\": \"https://opencollective.com/unified\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/mdast-util-to-markdown\": {\n+      \"version\": \"1.5.0\",\n+      \"resolved\": \"https://registry.npmjs.org/mdast-util-to-markdown/-/mdast-util-to-markdown-1.5.0.tgz\",\n+      \"integrity\": \"sha512-bbv7TPv/WC49thZPg3jXuqzuvI45IL2EVAr/KxF0BSdHsU0ceFHOmwQn6evxAh1GaoK/6GQ1wp4R4oW2+LFL/A==\",\n+      \"dev\": true,\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"@types/mdast\": \"^3.0.0\",\n+        \"@types/unist\": \"^2.0.0\",\n+        \"longest-streak\": \"^3.0.0\",\n+        \"mdast-util-phrasing\": \"^3.0.0\",\n+        \"mdast-util-to-string\": \"^3.0.0\",\n+        \"micromark-util-decode-string\": \"^1.0.0\",\n+        \"unist-util-visit\": \"^4.0.0\",\n+        \"zwitch\": \"^2.0.0\"\n+      },\n+      \"funding\": {\n+        \"type\": \"opencollective\",\n+        \"url\": \"https://opencollective.com/unified\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/mdast-util-to-string\": {\n+      \"version\": \"3.2.0\",\n+      \"resolved\": \"https://registry.npmjs.org/mdast-util-to-string/-/mdast-util-to-string-3.2.0.tgz\",\n+      \"integrity\": \"sha512-V4Zn/ncyN1QNSqSBxTrMOLpjr+IKdHl2v3KVLoWmDPscP4r9GcCi71gjgvUV1SFSKh92AjAG4peFuBl2/YgCJg==\",\n+      \"dev\": true,\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"@types/mdast\": \"^3.0.0\"\n+      },\n+      \"funding\": {\n+        \"type\": \"opencollective\",\n+        \"url\": \"https://opencollective.com/unified\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark\": {\n+      \"version\": \"3.2.0\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark/-/micromark-3.2.0.tgz\",\n+      \"integrity\": \"sha512-uD66tJj54JLYq0De10AhWycZWGQNUvDI55xPgk2sQM5kn1JYlhbCMTtEeT27+vAhW2FBQxLlOmS3pmA7/2z4aA==\",\n+      \"dev\": true,\n+      \"funding\": [\n+        {\n+          \"type\": \"GitHub Sponsors\",\n+          \"url\": \"https://github.com/sponsors/unifiedjs\"\n+        },\n+        {\n+          \"type\": \"OpenCollective\",\n+          \"url\": \"https://opencollective.com/unified\"\n+        }\n+      ],\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"@types/debug\": \"^4.0.0\",\n+        \"debug\": \"^4.0.0\",\n+        \"decode-named-character-reference\": \"^1.0.0\",\n+        \"micromark-core-commonmark\": \"^1.0.1\",\n+        \"micromark-factory-space\": \"^1.0.0\",\n+        \"micromark-util-character\": \"^1.0.0\",\n+        \"micromark-util-chunked\": \"^1.0.0\",\n+        \"micromark-util-combine-extensions\": \"^1.0.0\",\n+        \"micromark-util-decode-numeric-character-reference\": \"^1.0.0\",\n+        \"micromark-util-encode\": \"^1.0.0\",\n+        \"micromark-util-normalize-identifier\": \"^1.0.0\",\n+        \"micromark-util-resolve-all\": \"^1.0.0\",\n+        \"micromark-util-sanitize-uri\": \"^1.0.0\",\n+        \"micromark-util-subtokenize\": \"^1.0.0\",\n+        \"micromark-util-symbol\": \"^1.0.0\",\n+        \"micromark-util-types\": \"^1.0.1\",\n+        \"uvu\": \"^0.5.0\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark-core-commonmark\": {\n+      \"version\": \"1.1.0\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-core-commonmark/-/micromark-core-commonmark-1.1.0.tgz\",\n+      \"integrity\": \"sha512-BgHO1aRbolh2hcrzL2d1La37V0Aoz73ymF8rAcKnohLy93titmv62E0gP8Hrx9PKcKrqCZ1BbLGbP3bEhoXYlw==\",\n+      \"dev\": true,\n+      \"funding\": [\n+        {\n+          \"type\": \"GitHub Sponsors\",\n+          \"url\": \"https://github.com/sponsors/unifiedjs\"\n+        },\n+        {\n+          \"type\": \"OpenCollective\",\n+          \"url\": \"https://opencollective.com/unified\"\n+        }\n+      ],\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"decode-named-character-reference\": \"^1.0.0\",\n+        \"micromark-factory-destination\": \"^1.0.0\",\n+        \"micromark-factory-label\": \"^1.0.0\",\n+        \"micromark-factory-space\": \"^1.0.0\",\n+        \"micromark-factory-title\": \"^1.0.0\",\n+        \"micromark-factory-whitespace\": \"^1.0.0\",\n+        \"micromark-util-character\": \"^1.0.0\",\n+        \"micromark-util-chunked\": \"^1.0.0\",\n+        \"micromark-util-classify-character\": \"^1.0.0\",\n+        \"micromark-util-html-tag-name\": \"^1.0.0\",\n+        \"micromark-util-normalize-identifier\": \"^1.0.0\",\n+        \"micromark-util-resolve-all\": \"^1.0.0\",\n+        \"micromark-util-subtokenize\": \"^1.0.0\",\n+        \"micromark-util-symbol\": \"^1.0.0\",\n+        \"micromark-util-types\": \"^1.0.1\",\n+        \"uvu\": \"^0.5.0\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark-extension-gfm\": {\n+      \"version\": \"2.0.3\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-extension-gfm/-/micromark-extension-gfm-2.0.3.tgz\",\n+      \"integrity\": \"sha512-vb9OoHqrhCmbRidQv/2+Bc6pkP0FrtlhurxZofvOEy5o8RtuuvTq+RQ1Vw5ZDNrVraQZu3HixESqbG+0iKk/MQ==\",\n+      \"dev\": true,\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"micromark-extension-gfm-autolink-literal\": \"^1.0.0\",\n+        \"micromark-extension-gfm-footnote\": \"^1.0.0\",\n+        \"micromark-extension-gfm-strikethrough\": \"^1.0.0\",\n+        \"micromark-extension-gfm-table\": \"^1.0.0\",\n+        \"micromark-extension-gfm-tagfilter\": \"^1.0.0\",\n+        \"micromark-extension-gfm-task-list-item\": \"^1.0.0\",\n+        \"micromark-util-combine-extensions\": \"^1.0.0\",\n+        \"micromark-util-types\": \"^1.0.0\"\n+      },\n+      \"funding\": {\n+        \"type\": \"opencollective\",\n+        \"url\": \"https://opencollective.com/unified\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark-extension-gfm-autolink-literal\": {\n+      \"version\": \"1.0.5\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-extension-gfm-autolink-literal/-/micromark-extension-gfm-autolink-literal-1.0.5.tgz\",\n+      \"integrity\": \"sha512-z3wJSLrDf8kRDOh2qBtoTRD53vJ+CWIyo7uyZuxf/JAbNJjiHsOpG1y5wxk8drtv3ETAHutCu6N3thkOOgueWg==\",\n+      \"dev\": true,\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"micromark-util-character\": \"^1.0.0\",\n+        \"micromark-util-sanitize-uri\": \"^1.0.0\",\n+        \"micromark-util-symbol\": \"^1.0.0\",\n+        \"micromark-util-types\": \"^1.0.0\"\n+      },\n+      \"funding\": {\n+        \"type\": \"opencollective\",\n+        \"url\": \"https://opencollective.com/unified\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark-extension-gfm-footnote\": {\n+      \"version\": \"1.1.2\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-extension-gfm-footnote/-/micromark-extension-gfm-footnote-1.1.2.tgz\",\n+      \"integrity\": \"sha512-Yxn7z7SxgyGWRNa4wzf8AhYYWNrwl5q1Z8ii+CSTTIqVkmGZF1CElX2JI8g5yGoM3GAman9/PVCUFUSJ0kB/8Q==\",\n+      \"dev\": true,\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"micromark-core-commonmark\": \"^1.0.0\",\n+        \"micromark-factory-space\": \"^1.0.0\",\n+        \"micromark-util-character\": \"^1.0.0\",\n+        \"micromark-util-normalize-identifier\": \"^1.0.0\",\n+        \"micromark-util-sanitize-uri\": \"^1.0.0\",\n+        \"micromark-util-symbol\": \"^1.0.0\",\n+        \"micromark-util-types\": \"^1.0.0\",\n+        \"uvu\": \"^0.5.0\"\n+      },\n+      \"funding\": {\n+        \"type\": \"opencollective\",\n+        \"url\": \"https://opencollective.com/unified\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark-extension-gfm-strikethrough\": {\n+      \"version\": \"1.0.7\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-extension-gfm-strikethrough/-/micromark-extension-gfm-strikethrough-1.0.7.tgz\",\n+      \"integrity\": \"sha512-sX0FawVE1o3abGk3vRjOH50L5TTLr3b5XMqnP9YDRb34M0v5OoZhG+OHFz1OffZ9dlwgpTBKaT4XW/AsUVnSDw==\",\n+      \"dev\": true,\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"micromark-util-chunked\": \"^1.0.0\",\n+        \"micromark-util-classify-character\": \"^1.0.0\",\n+        \"micromark-util-resolve-all\": \"^1.0.0\",\n+        \"micromark-util-symbol\": \"^1.0.0\",\n+        \"micromark-util-types\": \"^1.0.0\",\n+        \"uvu\": \"^0.5.0\"\n+      },\n+      \"funding\": {\n+        \"type\": \"opencollective\",\n+        \"url\": \"https://opencollective.com/unified\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark-extension-gfm-table\": {\n+      \"version\": \"1.0.7\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-extension-gfm-table/-/micromark-extension-gfm-table-1.0.7.tgz\",\n+      \"integrity\": \"sha512-3ZORTHtcSnMQEKtAOsBQ9/oHp9096pI/UvdPtN7ehKvrmZZ2+bbWhi0ln+I9drmwXMt5boocn6OlwQzNXeVeqw==\",\n+      \"dev\": true,\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"micromark-factory-space\": \"^1.0.0\",\n+        \"micromark-util-character\": \"^1.0.0\",\n+        \"micromark-util-symbol\": \"^1.0.0\",\n+        \"micromark-util-types\": \"^1.0.0\",\n+        \"uvu\": \"^0.5.0\"\n+      },\n+      \"funding\": {\n+        \"type\": \"opencollective\",\n+        \"url\": \"https://opencollective.com/unified\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark-extension-gfm-tagfilter\": {\n+      \"version\": \"1.0.2\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-extension-gfm-tagfilter/-/micromark-extension-gfm-tagfilter-1.0.2.tgz\",\n+      \"integrity\": \"sha512-5XWB9GbAUSHTn8VPU8/1DBXMuKYT5uOgEjJb8gN3mW0PNW5OPHpSdojoqf+iq1xo7vWzw/P8bAHY0n6ijpXF7g==\",\n+      \"dev\": true,\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"micromark-util-types\": \"^1.0.0\"\n+      },\n+      \"funding\": {\n+        \"type\": \"opencollective\",\n+        \"url\": \"https://opencollective.com/unified\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark-extension-gfm-task-list-item\": {\n+      \"version\": \"1.0.5\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-extension-gfm-task-list-item/-/micromark-extension-gfm-task-list-item-1.0.5.tgz\",\n+      \"integrity\": \"sha512-RMFXl2uQ0pNQy6Lun2YBYT9g9INXtWJULgbt01D/x8/6yJ2qpKyzdZD3pi6UIkzF++Da49xAelVKUeUMqd5eIQ==\",\n+      \"dev\": true,\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"micromark-factory-space\": \"^1.0.0\",\n+        \"micromark-util-character\": \"^1.0.0\",\n+        \"micromark-util-symbol\": \"^1.0.0\",\n+        \"micromark-util-types\": \"^1.0.0\",\n+        \"uvu\": \"^0.5.0\"\n+      },\n+      \"funding\": {\n+        \"type\": \"opencollective\",\n+        \"url\": \"https://opencollective.com/unified\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark-factory-destination\": {\n+      \"version\": \"1.1.0\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-factory-destination/-/micromark-factory-destination-1.1.0.tgz\",\n+      \"integrity\": \"sha512-XaNDROBgx9SgSChd69pjiGKbV+nfHGDPVYFs5dOoDd7ZnMAE+Cuu91BCpsY8RT2NP9vo/B8pds2VQNCLiu0zhg==\",\n+      \"dev\": true,\n+      \"funding\": [\n+        {\n+          \"type\": \"GitHub Sponsors\",\n+          \"url\": \"https://github.com/sponsors/unifiedjs\"\n+        },\n+        {\n+          \"type\": \"OpenCollective\",\n+          \"url\": \"https://opencollective.com/unified\"\n+        }\n+      ],\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"micromark-util-character\": \"^1.0.0\",\n+        \"micromark-util-symbol\": \"^1.0.0\",\n+        \"micromark-util-types\": \"^1.0.0\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark-factory-label\": {\n+      \"version\": \"1.1.0\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-factory-label/-/micromark-factory-label-1.1.0.tgz\",\n+      \"integrity\": \"sha512-OLtyez4vZo/1NjxGhcpDSbHQ+m0IIGnT8BoPamh+7jVlzLJBH98zzuCoUeMxvM6WsNeh8wx8cKvqLiPHEACn0w==\",\n+      \"dev\": true,\n+      \"funding\": [\n+        {\n+          \"type\": \"GitHub Sponsors\",\n+          \"url\": \"https://github.com/sponsors/unifiedjs\"\n+        },\n+        {\n+          \"type\": \"OpenCollective\",\n+          \"url\": \"https://opencollective.com/unified\"\n+        }\n+      ],\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"micromark-util-character\": \"^1.0.0\",\n+        \"micromark-util-symbol\": \"^1.0.0\",\n+        \"micromark-util-types\": \"^1.0.0\",\n+        \"uvu\": \"^0.5.0\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark-factory-space\": {\n+      \"version\": \"1.1.0\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-factory-space/-/micromark-factory-space-1.1.0.tgz\",\n+      \"integrity\": \"sha512-cRzEj7c0OL4Mw2v6nwzttyOZe8XY/Z8G0rzmWQZTBi/jjwyw/U4uqKtUORXQrR5bAZZnbTI/feRV/R7hc4jQYQ==\",\n+      \"dev\": true,\n+      \"funding\": [\n+        {\n+          \"type\": \"GitHub Sponsors\",\n+          \"url\": \"https://github.com/sponsors/unifiedjs\"\n+        },\n+        {\n+          \"type\": \"OpenCollective\",\n+          \"url\": \"https://opencollective.com/unified\"\n+        }\n+      ],\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"micromark-util-character\": \"^1.0.0\",\n+        \"micromark-util-types\": \"^1.0.0\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark-factory-title\": {\n+      \"version\": \"1.1.0\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-factory-title/-/micromark-factory-title-1.1.0.tgz\",\n+      \"integrity\": \"sha512-J7n9R3vMmgjDOCY8NPw55jiyaQnH5kBdV2/UXCtZIpnHH3P6nHUKaH7XXEYuWwx/xUJcawa8plLBEjMPU24HzQ==\",\n+      \"dev\": true,\n+      \"funding\": [\n+        {\n+          \"type\": \"GitHub Sponsors\",\n+          \"url\": \"https://github.com/sponsors/unifiedjs\"\n+        },\n+        {\n+          \"type\": \"OpenCollective\",\n+          \"url\": \"https://opencollective.com/unified\"\n+        }\n+      ],\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"micromark-factory-space\": \"^1.0.0\",\n+        \"micromark-util-character\": \"^1.0.0\",\n+        \"micromark-util-symbol\": \"^1.0.0\",\n+        \"micromark-util-types\": \"^1.0.0\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark-factory-whitespace\": {\n+      \"version\": \"1.1.0\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-factory-whitespace/-/micromark-factory-whitespace-1.1.0.tgz\",\n+      \"integrity\": \"sha512-v2WlmiymVSp5oMg+1Q0N1Lxmt6pMhIHD457whWM7/GUlEks1hI9xj5w3zbc4uuMKXGisksZk8DzP2UyGbGqNsQ==\",\n+      \"dev\": true,\n+      \"funding\": [\n+        {\n+          \"type\": \"GitHub Sponsors\",\n+          \"url\": \"https://github.com/sponsors/unifiedjs\"\n+        },\n+        {\n+          \"type\": \"OpenCollective\",\n+          \"url\": \"https://opencollective.com/unified\"\n+        }\n+      ],\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"micromark-factory-space\": \"^1.0.0\",\n+        \"micromark-util-character\": \"^1.0.0\",\n+        \"micromark-util-symbol\": \"^1.0.0\",\n+        \"micromark-util-types\": \"^1.0.0\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark-util-character\": {\n+      \"version\": \"1.2.0\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-util-character/-/micromark-util-character-1.2.0.tgz\",\n+      \"integrity\": \"sha512-lXraTwcX3yH/vMDaFWCQJP1uIszLVebzUa3ZHdrgxr7KEU/9mL4mVgCpGbyhvNLNlauROiNUq7WN5u7ndbY6xg==\",\n+      \"dev\": true,\n+      \"funding\": [\n+        {\n+          \"type\": \"GitHub Sponsors\",\n+          \"url\": \"https://github.com/sponsors/unifiedjs\"\n+        },\n+        {\n+          \"type\": \"OpenCollective\",\n+          \"url\": \"https://opencollective.com/unified\"\n+        }\n+      ],\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"micromark-util-symbol\": \"^1.0.0\",\n+        \"micromark-util-types\": \"^1.0.0\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark-util-chunked\": {\n+      \"version\": \"1.1.0\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-util-chunked/-/micromark-util-chunked-1.1.0.tgz\",\n+      \"integrity\": \"sha512-Ye01HXpkZPNcV6FiyoW2fGZDUw4Yc7vT0E9Sad83+bEDiCJ1uXu0S3mr8WLpsz3HaG3x2q0HM6CTuPdcZcluFQ==\",\n+      \"dev\": true,\n+      \"funding\": [\n+        {\n+          \"type\": \"GitHub Sponsors\",\n+          \"url\": \"https://github.com/sponsors/unifiedjs\"\n+        },\n+        {\n+          \"type\": \"OpenCollective\",\n+          \"url\": \"https://opencollective.com/unified\"\n+        }\n+      ],\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"micromark-util-symbol\": \"^1.0.0\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark-util-classify-character\": {\n+      \"version\": \"1.1.0\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-util-classify-character/-/micromark-util-classify-character-1.1.0.tgz\",\n+      \"integrity\": \"sha512-SL0wLxtKSnklKSUplok1WQFoGhUdWYKggKUiqhX+Swala+BtptGCu5iPRc+xvzJ4PXE/hwM3FNXsfEVgoZsWbw==\",\n+      \"dev\": true,\n+      \"funding\": [\n+        {\n+          \"type\": \"GitHub Sponsors\",\n+          \"url\": \"https://github.com/sponsors/unifiedjs\"\n+        },\n+        {\n+          \"type\": \"OpenCollective\",\n+          \"url\": \"https://opencollective.com/unified\"\n+        }\n+      ],\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"micromark-util-character\": \"^1.0.0\",\n+        \"micromark-util-symbol\": \"^1.0.0\",\n+        \"micromark-util-types\": \"^1.0.0\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark-util-combine-extensions\": {\n+      \"version\": \"1.1.0\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-util-combine-extensions/-/micromark-util-combine-extensions-1.1.0.tgz\",\n+      \"integrity\": \"sha512-Q20sp4mfNf9yEqDL50WwuWZHUrCO4fEyeDCnMGmG5Pr0Cz15Uo7KBs6jq+dq0EgX4DPwwrh9m0X+zPV1ypFvUA==\",\n+      \"dev\": true,\n+      \"funding\": [\n+        {\n+          \"type\": \"GitHub Sponsors\",\n+          \"url\": \"https://github.com/sponsors/unifiedjs\"\n+        },\n+        {\n+          \"type\": \"OpenCollective\",\n+          \"url\": \"https://opencollective.com/unified\"\n+        }\n+      ],\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"micromark-util-chunked\": \"^1.0.0\",\n+        \"micromark-util-types\": \"^1.0.0\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark-util-decode-numeric-character-reference\": {\n+      \"version\": \"1.1.0\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-util-decode-numeric-character-reference/-/micromark-util-decode-numeric-character-reference-1.1.0.tgz\",\n+      \"integrity\": \"sha512-m9V0ExGv0jB1OT21mrWcuf4QhP46pH1KkfWy9ZEezqHKAxkj4mPCy3nIH1rkbdMlChLHX531eOrymlwyZIf2iw==\",\n+      \"dev\": true,\n+      \"funding\": [\n+        {\n+          \"type\": \"GitHub Sponsors\",\n+          \"url\": \"https://github.com/sponsors/unifiedjs\"\n+        },\n+        {\n+          \"type\": \"OpenCollective\",\n+          \"url\": \"https://opencollective.com/unified\"\n+        }\n+      ],\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"micromark-util-symbol\": \"^1.0.0\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark-util-decode-string\": {\n+      \"version\": \"1.1.0\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-util-decode-string/-/micromark-util-decode-string-1.1.0.tgz\",\n+      \"integrity\": \"sha512-YphLGCK8gM1tG1bd54azwyrQRjCFcmgj2S2GoJDNnh4vYtnL38JS8M4gpxzOPNyHdNEpheyWXCTnnTDY3N+NVQ==\",\n+      \"dev\": true,\n+      \"funding\": [\n+        {\n+          \"type\": \"GitHub Sponsors\",\n+          \"url\": \"https://github.com/sponsors/unifiedjs\"\n+        },\n+        {\n+          \"type\": \"OpenCollective\",\n+          \"url\": \"https://opencollective.com/unified\"\n+        }\n+      ],\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"decode-named-character-reference\": \"^1.0.0\",\n+        \"micromark-util-character\": \"^1.0.0\",\n+        \"micromark-util-decode-numeric-character-reference\": \"^1.0.0\",\n+        \"micromark-util-symbol\": \"^1.0.0\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark-util-encode\": {\n+      \"version\": \"1.1.0\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-util-encode/-/micromark-util-encode-1.1.0.tgz\",\n+      \"integrity\": \"sha512-EuEzTWSTAj9PA5GOAs992GzNh2dGQO52UvAbtSOMvXTxv3Criqb6IOzJUBCmEqrrXSblJIJBbFFv6zPxpreiJw==\",\n+      \"dev\": true,\n+      \"funding\": [\n+        {\n+          \"type\": \"GitHub Sponsors\",\n+          \"url\": \"https://github.com/sponsors/unifiedjs\"\n+        },\n+        {\n+          \"type\": \"OpenCollective\",\n+          \"url\": \"https://opencollective.com/unified\"\n+        }\n+      ],\n+      \"license\": \"MIT\"\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark-util-html-tag-name\": {\n+      \"version\": \"1.2.0\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-util-html-tag-name/-/micromark-util-html-tag-name-1.2.0.tgz\",\n+      \"integrity\": \"sha512-VTQzcuQgFUD7yYztuQFKXT49KghjtETQ+Wv/zUjGSGBioZnkA4P1XXZPT1FHeJA6RwRXSF47yvJ1tsJdoxwO+Q==\",\n+      \"dev\": true,\n+      \"funding\": [\n+        {\n+          \"type\": \"GitHub Sponsors\",\n+          \"url\": \"https://github.com/sponsors/unifiedjs\"\n+        },\n+        {\n+          \"type\": \"OpenCollective\",\n+          \"url\": \"https://opencollective.com/unified\"\n+        }\n+      ],\n+      \"license\": \"MIT\"\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark-util-normalize-identifier\": {\n+      \"version\": \"1.1.0\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-util-normalize-identifier/-/micromark-util-normalize-identifier-1.1.0.tgz\",\n+      \"integrity\": \"sha512-N+w5vhqrBihhjdpM8+5Xsxy71QWqGn7HYNUvch71iV2PM7+E3uWGox1Qp90loa1ephtCxG2ftRV/Conitc6P2Q==\",\n+      \"dev\": true,\n+      \"funding\": [\n+        {\n+          \"type\": \"GitHub Sponsors\",\n+          \"url\": \"https://github.com/sponsors/unifiedjs\"\n+        },\n+        {\n+          \"type\": \"OpenCollective\",\n+          \"url\": \"https://opencollective.com/unified\"\n+        }\n+      ],\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"micromark-util-symbol\": \"^1.0.0\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark-util-resolve-all\": {\n+      \"version\": \"1.1.0\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-util-resolve-all/-/micromark-util-resolve-all-1.1.0.tgz\",\n+      \"integrity\": \"sha512-b/G6BTMSg+bX+xVCshPTPyAu2tmA0E4X98NSR7eIbeC6ycCqCeE7wjfDIgzEbkzdEVJXRtOG4FbEm/uGbCRouA==\",\n+      \"dev\": true,\n+      \"funding\": [\n+        {\n+          \"type\": \"GitHub Sponsors\",\n+          \"url\": \"https://github.com/sponsors/unifiedjs\"\n+        },\n+        {\n+          \"type\": \"OpenCollective\",\n+          \"url\": \"https://opencollective.com/unified\"\n+        }\n+      ],\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"micromark-util-types\": \"^1.0.0\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark-util-sanitize-uri\": {\n+      \"version\": \"1.2.0\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-util-sanitize-uri/-/micromark-util-sanitize-uri-1.2.0.tgz\",\n+      \"integrity\": \"sha512-QO4GXv0XZfWey4pYFndLUKEAktKkG5kZTdUNaTAkzbuJxn2tNBOr+QtxR2XpWaMhbImT2dPzyLrPXLlPhph34A==\",\n+      \"dev\": true,\n+      \"funding\": [\n+        {\n+          \"type\": \"GitHub Sponsors\",\n+          \"url\": \"https://github.com/sponsors/unifiedjs\"\n+        },\n+        {\n+          \"type\": \"OpenCollective\",\n+          \"url\": \"https://opencollective.com/unified\"\n+        }\n+      ],\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"micromark-util-character\": \"^1.0.0\",\n+        \"micromark-util-encode\": \"^1.0.0\",\n+        \"micromark-util-symbol\": \"^1.0.0\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark-util-subtokenize\": {\n+      \"version\": \"1.1.0\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-util-subtokenize/-/micromark-util-subtokenize-1.1.0.tgz\",\n+      \"integrity\": \"sha512-kUQHyzRoxvZO2PuLzMt2P/dwVsTiivCK8icYTeR+3WgbuPqfHgPPy7nFKbeqRivBvn/3N3GBiNC+JRTMSxEC7A==\",\n+      \"dev\": true,\n+      \"funding\": [\n+        {\n+          \"type\": \"GitHub Sponsors\",\n+          \"url\": \"https://github.com/sponsors/unifiedjs\"\n+        },\n+        {\n+          \"type\": \"OpenCollective\",\n+          \"url\": \"https://opencollective.com/unified\"\n+        }\n+      ],\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"micromark-util-chunked\": \"^1.0.0\",\n+        \"micromark-util-symbol\": \"^1.0.0\",\n+        \"micromark-util-types\": \"^1.0.0\",\n+        \"uvu\": \"^0.5.0\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark-util-symbol\": {\n+      \"version\": \"1.1.0\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-util-symbol/-/micromark-util-symbol-1.1.0.tgz\",\n+      \"integrity\": \"sha512-uEjpEYY6KMs1g7QfJ2eX1SQEV+ZT4rUD3UcF6l57acZvLNK7PBZL+ty82Z1qhK1/yXIY4bdx04FKMgR0g4IAag==\",\n+      \"dev\": true,\n+      \"funding\": [\n+        {\n+          \"type\": \"GitHub Sponsors\",\n+          \"url\": \"https://github.com/sponsors/unifiedjs\"\n+        },\n+        {\n+          \"type\": \"OpenCollective\",\n+          \"url\": \"https://opencollective.com/unified\"\n+        }\n+      ],\n+      \"license\": \"MIT\"\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/micromark-util-types\": {\n+      \"version\": \"1.1.0\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-util-types/-/micromark-util-types-1.1.0.tgz\",\n+      \"integrity\": \"sha512-ukRBgie8TIAcacscVHSiddHjO4k/q3pnedmzMQ4iwDcK0FtFCohKOlFbaOL/mPgfnPsL3C1ZyxJa4sbWrBl3jg==\",\n+      \"dev\": true,\n+      \"funding\": [\n+        {\n+          \"type\": \"GitHub Sponsors\",\n+          \"url\": \"https://github.com/sponsors/unifiedjs\"\n+        },\n+        {\n+          \"type\": \"OpenCollective\",\n+          \"url\": \"https://opencollective.com/unified\"\n+        }\n+      ],\n+      \"license\": \"MIT\"\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/remark-gfm\": {\n+      \"version\": \"3.0.1\",\n+      \"resolved\": \"https://registry.npmjs.org/remark-gfm/-/remark-gfm-3.0.1.tgz\",\n+      \"integrity\": \"sha512-lEFDoi2PICJyNrACFOfDD3JlLkuSbOa5Wd8EPt06HUdptv8Gn0bxYTdbU/XXQ3swAPkEaGxxPN9cbnMHvVu1Ig==\",\n+      \"dev\": true,\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"@types/mdast\": \"^3.0.0\",\n+        \"mdast-util-gfm\": \"^2.0.0\",\n+        \"micromark-extension-gfm\": \"^2.0.0\",\n+        \"unified\": \"^10.0.0\"\n+      },\n+      \"funding\": {\n+        \"type\": \"opencollective\",\n+        \"url\": \"https://opencollective.com/unified\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/unist-util-is\": {\n+      \"version\": \"5.2.1\",\n+      \"resolved\": \"https://registry.npmjs.org/unist-util-is/-/unist-util-is-5.2.1.tgz\",\n+      \"integrity\": \"sha512-u9njyyfEh43npf1M+yGKDGVPbY/JWEemg5nH05ncKPfi+kBbKBJoTdsogMu33uhytuLlv9y0O7GH7fEdwLdLQw==\",\n+      \"dev\": true,\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"@types/unist\": \"^2.0.0\"\n+      },\n+      \"funding\": {\n+        \"type\": \"opencollective\",\n+        \"url\": \"https://opencollective.com/unified\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/unist-util-stringify-position\": {\n+      \"version\": \"3.0.3\",\n+      \"resolved\": \"https://registry.npmjs.org/unist-util-stringify-position/-/unist-util-stringify-position-3.0.3.tgz\",\n+      \"integrity\": \"sha512-k5GzIBZ/QatR8N5X2y+drfpWG8IDBzdnVj6OInRNWm1oXrzydiaAT2OQiA8DPRRZyAKb9b6I2a6PxYklZD0gKg==\",\n+      \"dev\": true,\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"@types/unist\": \"^2.0.0\"\n+      },\n+      \"funding\": {\n+        \"type\": \"opencollective\",\n+        \"url\": \"https://opencollective.com/unified\"\n+      }\n+    },\n+    \"node_modules/@storybook/addon-mdx-gfm/node_modules/unist-util-visit-parents\": {\n+      \"version\": \"5.1.3\",\n+      \"resolved\": \"https://registry.npmjs.org/unist-util-visit-parents/-/unist-util-visit-parents-5.1.3.tgz\",\n+      \"integrity\": \"sha512-x6+y8g7wWMyQhL1iZfhIPhDAs7Xwbn9nRosDXl7qoPTSCy0yNxnKc+hWokFifWQIDGi154rdUqKvbCa4+1kLhg==\",\n+      \"dev\": true,\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"@types/unist\": \"^2.0.0\",\n+        \"unist-util-is\": \"^5.0.0\"\n+      },\n+      \"funding\": {\n+        \"type\": \"opencollective\",\n+        \"url\": \"https://opencollective.com/unified\"\n+      }\n+    },\n     \"node_modules/@storybook/addon-measure\": {\n       \"version\": \"8.6.14\",\n       \"resolved\": \"https://registry.npmjs.org/@storybook/addon-measure/-/addon-measure-8.6.14.tgz\",\n@@ -42611,190 +43477,6 @@\n         \"@types/unist\": \"^2\"\n       }\n     },\n-    \"node_modules/mdast-util-find-and-replace\": {\n-      \"version\": \"3.0.2\",\n-      \"resolved\": \"https://registry.npmjs.org/mdast-util-find-and-replace/-/mdast-util-find-and-replace-3.0.2.tgz\",\n-      \"integrity\": \"sha512-Tmd1Vg/m3Xz43afeNxDIhWRtFZgM2VLyaf4vSTYwudTyeuTneoL3qtWMA5jeLyz/O1vDJmmV4QuScFCA2tBPwg==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"@types/mdast\": \"^4.0.0\",\n-        \"escape-string-regexp\": \"^5.0.0\",\n-        \"unist-util-is\": \"^6.0.0\",\n-        \"unist-util-visit-parents\": \"^6.0.0\"\n-      },\n-      \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n-      }\n-    },\n-    \"node_modules/mdast-util-find-and-replace/node_modules/escape-string-regexp\": {\n-      \"version\": \"5.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/escape-string-regexp/-/escape-string-regexp-5.0.0.tgz\",\n-      \"integrity\": \"sha512-/veY75JbMK4j1yjvuUxuVsiS/hr/4iHs9FTT6cgTexxdE0Ly/glccBAkloH/DofkjRbZU3bnoj38mOmhkZ0lHw==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"engines\": {\n-        \"node\": \">=12\"\n-      },\n-      \"funding\": {\n-        \"url\": \"https://github.com/sponsors/sindresorhus\"\n-      }\n-    },\n-    \"node_modules/mdast-util-from-markdown\": {\n-      \"version\": \"2.0.2\",\n-      \"resolved\": \"https://registry.npmjs.org/mdast-util-from-markdown/-/mdast-util-from-markdown-2.0.2.tgz\",\n-      \"integrity\": \"sha512-uZhTV/8NBuw0WHkPTrCqDOl0zVe1BIng5ZtHoDk49ME1qqcjYmmLmOf0gELgcRMxN4w2iuIeVso5/6QymSrgmA==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"@types/mdast\": \"^4.0.0\",\n-        \"@types/unist\": \"^3.0.0\",\n-        \"decode-named-character-reference\": \"^1.0.0\",\n-        \"devlop\": \"^1.0.0\",\n-        \"mdast-util-to-string\": \"^4.0.0\",\n-        \"micromark\": \"^4.0.0\",\n-        \"micromark-util-decode-numeric-character-reference\": \"^2.0.0\",\n-        \"micromark-util-decode-string\": \"^2.0.0\",\n-        \"micromark-util-normalize-identifier\": \"^2.0.0\",\n-        \"micromark-util-symbol\": \"^2.0.0\",\n-        \"micromark-util-types\": \"^2.0.0\",\n-        \"unist-util-stringify-position\": \"^4.0.0\"\n-      },\n-      \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n-      }\n-    },\n-    \"node_modules/mdast-util-from-markdown/node_modules/@types/unist\": {\n-      \"version\": \"3.0.3\",\n-      \"resolved\": \"https://registry.npmjs.org/@types/unist/-/unist-3.0.3.tgz\",\n-      \"integrity\": \"sha512-ko/gIFJRv177XgZsZcBwnqJN5x/Gien8qNOn0D5bQU/zAzVf9Zt3BlcUiLqhV9y4ARk0GbT3tnUiPNgnTXzc/Q==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\"\n-    },\n-    \"node_modules/mdast-util-gfm\": {\n-      \"version\": \"3.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/mdast-util-gfm/-/mdast-util-gfm-3.0.0.tgz\",\n-      \"integrity\": \"sha512-dgQEX5Amaq+DuUqf26jJqSK9qgixgd6rYDHAv4aTBuA92cTknZlKpPfa86Z/s8Dj8xsAQpFfBmPUHWJBWqS4Bw==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"mdast-util-from-markdown\": \"^2.0.0\",\n-        \"mdast-util-gfm-autolink-literal\": \"^2.0.0\",\n-        \"mdast-util-gfm-footnote\": \"^2.0.0\",\n-        \"mdast-util-gfm-strikethrough\": \"^2.0.0\",\n-        \"mdast-util-gfm-table\": \"^2.0.0\",\n-        \"mdast-util-gfm-task-list-item\": \"^2.0.0\",\n-        \"mdast-util-to-markdown\": \"^2.0.0\"\n-      },\n-      \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n-      }\n-    },\n-    \"node_modules/mdast-util-gfm-autolink-literal\": {\n-      \"version\": \"2.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/mdast-util-gfm-autolink-literal/-/mdast-util-gfm-autolink-literal-2.0.1.tgz\",\n-      \"integrity\": \"sha512-5HVP2MKaP6L+G6YaxPNjuL0BPrq9orG3TsrZ9YXbA3vDw/ACI4MEsnoDpn6ZNm7GnZgtAcONJyPhOP8tNJQavQ==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"@types/mdast\": \"^4.0.0\",\n-        \"ccount\": \"^2.0.0\",\n-        \"devlop\": \"^1.0.0\",\n-        \"mdast-util-find-and-replace\": \"^3.0.0\",\n-        \"micromark-util-character\": \"^2.0.0\"\n-      },\n-      \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n-      }\n-    },\n-    \"node_modules/mdast-util-gfm-footnote\": {\n-      \"version\": \"2.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/mdast-util-gfm-footnote/-/mdast-util-gfm-footnote-2.0.0.tgz\",\n-      \"integrity\": \"sha512-5jOT2boTSVkMnQ7LTrd6n/18kqwjmuYqo7JUPe+tRCY6O7dAuTFMtTPauYYrMPpox9hlN0uOx/FL8XvEfG9/mQ==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"@types/mdast\": \"^4.0.0\",\n-        \"devlop\": \"^1.1.0\",\n-        \"mdast-util-from-markdown\": \"^2.0.0\",\n-        \"mdast-util-to-markdown\": \"^2.0.0\",\n-        \"micromark-util-normalize-identifier\": \"^2.0.0\"\n-      },\n-      \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n-      }\n-    },\n-    \"node_modules/mdast-util-gfm-strikethrough\": {\n-      \"version\": \"2.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/mdast-util-gfm-strikethrough/-/mdast-util-gfm-strikethrough-2.0.0.tgz\",\n-      \"integrity\": \"sha512-mKKb915TF+OC5ptj5bJ7WFRPdYtuHv0yTRxK2tJvi+BDqbkiG7h7u/9SI89nRAYcmap2xHQL9D+QG/6wSrTtXg==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"@types/mdast\": \"^4.0.0\",\n-        \"mdast-util-from-markdown\": \"^2.0.0\",\n-        \"mdast-util-to-markdown\": \"^2.0.0\"\n-      },\n-      \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n-      }\n-    },\n-    \"node_modules/mdast-util-gfm-table\": {\n-      \"version\": \"2.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/mdast-util-gfm-table/-/mdast-util-gfm-table-2.0.0.tgz\",\n-      \"integrity\": \"sha512-78UEvebzz/rJIxLvE7ZtDd/vIQ0RHv+3Mh5DR96p7cS7HsBhYIICDBCu8csTNWNO6tBWfqXPWekRuj2FNOGOZg==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"@types/mdast\": \"^4.0.0\",\n-        \"devlop\": \"^1.0.0\",\n-        \"markdown-table\": \"^3.0.0\",\n-        \"mdast-util-from-markdown\": \"^2.0.0\",\n-        \"mdast-util-to-markdown\": \"^2.0.0\"\n-      },\n-      \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n-      }\n-    },\n-    \"node_modules/mdast-util-gfm-task-list-item\": {\n-      \"version\": \"2.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/mdast-util-gfm-task-list-item/-/mdast-util-gfm-task-list-item-2.0.0.tgz\",\n-      \"integrity\": \"sha512-IrtvNvjxC1o06taBAVJznEnkiHxLFTzgonUdy8hzFVeDun0uTjxxrRGVaNFqkU1wJR3RBPEfsxmU6jDWPofrTQ==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"@types/mdast\": \"^4.0.0\",\n-        \"devlop\": \"^1.0.0\",\n-        \"mdast-util-from-markdown\": \"^2.0.0\",\n-        \"mdast-util-to-markdown\": \"^2.0.0\"\n-      },\n-      \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n-      }\n-    },\n-    \"node_modules/mdast-util-phrasing\": {\n-      \"version\": \"4.1.0\",\n-      \"resolved\": \"https://registry.npmjs.org/mdast-util-phrasing/-/mdast-util-phrasing-4.1.0.tgz\",\n-      \"integrity\": \"sha512-TqICwyvJJpBwvGAMZjj4J2n0X8QWp21b9l0o7eXyVJ25YNWYbJDVIyD1bZXE6WtV6RmKJVYmQAKWa0zWOABz2w==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"@types/mdast\": \"^4.0.0\",\n-        \"unist-util-is\": \"^6.0.0\"\n-      },\n-      \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n-      }\n-    },\n     \"node_modules/mdast-util-to-hast\": {\n       \"version\": \"13.2.1\",\n       \"resolved\": \"https://registry.npmjs.org/mdast-util-to-hast/-/mdast-util-to-hast-13.2.1.tgz\",\n@@ -42874,65 +43556,6 @@\n         \"url\": \"https://opencollective.com/unified\"\n       }\n     },\n-    \"node_modules/mdast-util-to-markdown\": {\n-      \"version\": \"2.1.2\",\n-      \"resolved\": \"https://registry.npmjs.org/mdast-util-to-markdown/-/mdast-util-to-markdown-2.1.2.tgz\",\n-      \"integrity\": \"sha512-xj68wMTvGXVOKonmog6LwyJKrYXZPvlwabaryTjLh9LuvovB/KAH+kvi8Gjj+7rJjsFi23nkUxRQv1KqSroMqA==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"@types/mdast\": \"^4.0.0\",\n-        \"@types/unist\": \"^3.0.0\",\n-        \"longest-streak\": \"^3.0.0\",\n-        \"mdast-util-phrasing\": \"^4.0.0\",\n-        \"mdast-util-to-string\": \"^4.0.0\",\n-        \"micromark-util-classify-character\": \"^2.0.0\",\n-        \"micromark-util-decode-string\": \"^2.0.0\",\n-        \"unist-util-visit\": \"^5.0.0\",\n-        \"zwitch\": \"^2.0.0\"\n-      },\n-      \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n-      }\n-    },\n-    \"node_modules/mdast-util-to-markdown/node_modules/@types/unist\": {\n-      \"version\": \"3.0.3\",\n-      \"resolved\": \"https://registry.npmjs.org/@types/unist/-/unist-3.0.3.tgz\",\n-      \"integrity\": \"sha512-ko/gIFJRv177XgZsZcBwnqJN5x/Gien8qNOn0D5bQU/zAzVf9Zt3BlcUiLqhV9y4ARk0GbT3tnUiPNgnTXzc/Q==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\"\n-    },\n-    \"node_modules/mdast-util-to-markdown/node_modules/unist-util-visit\": {\n-      \"version\": \"5.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/unist-util-visit/-/unist-util-visit-5.0.0.tgz\",\n-      \"integrity\": \"sha512-MR04uvD+07cwl/yhVuVWAtw+3GOR/knlL55Nd/wAdblk27GCVt3lqpTivy/tkJcZoNPzTwS1Y+KMojlLDhoTzg==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"@types/unist\": \"^3.0.0\",\n-        \"unist-util-is\": \"^6.0.0\",\n-        \"unist-util-visit-parents\": \"^6.0.0\"\n-      },\n-      \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n-      }\n-    },\n-    \"node_modules/mdast-util-to-string\": {\n-      \"version\": \"4.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/mdast-util-to-string/-/mdast-util-to-string-4.0.0.tgz\",\n-      \"integrity\": \"sha512-0H44vDimn51F0YwvxSJSm0eCDOJTRlmN0R1yBh4HLj9wiV1Dn0QoXGbvFAWj2hSItVTlCmBF1hqKlIyUBVFLPg==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"@types/mdast\": \"^4.0.0\"\n-      },\n-      \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n-      }\n-    },\n     \"node_modules/mdn-data\": {\n       \"version\": \"2.12.2\",\n       \"resolved\": \"https://registry.npmjs.org/mdn-data/-/mdn-data-2.12.2.tgz\",\n@@ -43271,641 +43894,170 @@\n         \"type-fest\": \"^0.6.0\"\n       },\n       \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n-    \"node_modules/meow/node_modules/read-pkg-up\": {\n-      \"version\": \"7.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/read-pkg-up/-/read-pkg-up-7.0.1.tgz\",\n-      \"integrity\": \"sha512-zK0TB7Xd6JpCLmlLmufqykGE+/TlOePD6qKClNW7hHDKFh/J7/7gCWGR7joEQEW1bKq3a3yUZSObOoWLFQ4ohg==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"find-up\": \"^4.1.0\",\n-        \"read-pkg\": \"^5.2.0\",\n-        \"type-fest\": \"^0.8.1\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      },\n-      \"funding\": {\n-        \"url\": \"https://github.com/sponsors/sindresorhus\"\n-      }\n-    },\n-    \"node_modules/meow/node_modules/read-pkg-up/node_modules/type-fest\": {\n-      \"version\": \"0.8.1\",\n-      \"resolved\": \"https://registry.npmjs.org/type-fest/-/type-fest-0.8.1.tgz\",\n-      \"integrity\": \"sha512-4dbzIzqvjtgiM5rw1k5rEHtBANKmdudhGyBEajN01fEyhaAIhsoKNy6y7+IN93IfpFtwY9iqi7kD+xwKhQsNJA==\",\n-      \"dev\": true,\n-      \"license\": \"(MIT OR CC0-1.0)\",\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n-    \"node_modules/meow/node_modules/read-pkg/node_modules/hosted-git-info\": {\n-      \"version\": \"2.8.9\",\n-      \"resolved\": \"https://registry.npmjs.org/hosted-git-info/-/hosted-git-info-2.8.9.tgz\",\n-      \"integrity\": \"sha512-mxIDAb9Lsm6DoOJ7xH+5+X4y1LU/4Hi50L9C5sIswK3JzULS4bwk1FvjdBgvYR4bzT4tuUQiC15FE2f5HbLvYw==\",\n-      \"dev\": true,\n-      \"license\": \"ISC\"\n-    },\n-    \"node_modules/meow/node_modules/read-pkg/node_modules/normalize-package-data\": {\n-      \"version\": \"2.5.0\",\n-      \"resolved\": \"https://registry.npmjs.org/normalize-package-data/-/normalize-package-data-2.5.0.tgz\",\n-      \"integrity\": \"sha512-/5CMN3T0R4XTj4DcGaexo+roZSdSFW/0AOOTROrjxzCG1wrWXEsGbRKevjlIL+ZDE4sZlJr5ED4YW0yqmkK+eA==\",\n-      \"dev\": true,\n-      \"license\": \"BSD-2-Clause\",\n-      \"dependencies\": {\n-        \"hosted-git-info\": \"^2.1.4\",\n-        \"resolve\": \"^1.10.0\",\n-        \"semver\": \"2 || 3 || 4 || 5\",\n-        \"validate-npm-package-license\": \"^3.0.1\"\n-      }\n-    },\n-    \"node_modules/meow/node_modules/read-pkg/node_modules/semver\": {\n-      \"version\": \"5.7.2\",\n-      \"resolved\": \"https://registry.npmjs.org/semver/-/semver-5.7.2.tgz\",\n-      \"integrity\": \"sha512-cBznnQ9KjJqU67B52RMC65CMarK2600WFnbkcaiwWq3xy/5haFJlshgnpjovMVJ+Hff49d8GEn0b87C5pDQ10g==\",\n-      \"dev\": true,\n-      \"license\": \"ISC\",\n-      \"bin\": {\n-        \"semver\": \"bin/semver\"\n-      }\n-    },\n-    \"node_modules/meow/node_modules/read-pkg/node_modules/type-fest\": {\n-      \"version\": \"0.6.0\",\n-      \"resolved\": \"https://registry.npmjs.org/type-fest/-/type-fest-0.6.0.tgz\",\n-      \"integrity\": \"sha512-q+MB8nYR1KDLrgr4G5yemftpMC7/QLqVndBmEEdqzmNj5dcFOO4Oo8qlwZE3ULT3+Zim1F8Kq4cBnikNhlCMlg==\",\n-      \"dev\": true,\n-      \"license\": \"(MIT OR CC0-1.0)\",\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n-    \"node_modules/meow/node_modules/type-fest\": {\n-      \"version\": \"0.18.1\",\n-      \"resolved\": \"https://registry.npmjs.org/type-fest/-/type-fest-0.18.1.tgz\",\n-      \"integrity\": \"sha512-OIAYXk8+ISY+qTOwkHtKqzAuxchoMiD9Udx+FSGQDuiRR+PJKJHc2NJAXlbhkGwTt/4/nKZxELY1w3ReWOL8mw==\",\n-      \"dev\": true,\n-      \"license\": \"(MIT OR CC0-1.0)\",\n-      \"engines\": {\n-        \"node\": \">=10\"\n-      },\n-      \"funding\": {\n-        \"url\": \"https://github.com/sponsors/sindresorhus\"\n-      }\n-    },\n-    \"node_modules/meow/node_modules/yallist\": {\n-      \"version\": \"4.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/yallist/-/yallist-4.0.0.tgz\",\n-      \"integrity\": \"sha512-3wdGidZyq5PB084XLES5TpOSRA3wjXAlIWMhum2kRcv/41Sn2emQ0dycQW4uZXLejwKvg6EsvbdlVL+FYEct7A==\",\n-      \"dev\": true,\n-      \"license\": \"ISC\"\n-    },\n-    \"node_modules/meow/node_modules/yargs-parser\": {\n-      \"version\": \"20.2.9\",\n-      \"resolved\": \"https://registry.npmjs.org/yargs-parser/-/yargs-parser-20.2.9.tgz\",\n-      \"integrity\": \"sha512-y11nGElTIV+CT3Zv9t7VKl+Q3hTQoT9a1Qzezhhl6Rp21gJ/IVTW7Z3y9EWXhuUBC2Shnf+DX0antecpAwSP8w==\",\n-      \"dev\": true,\n-      \"license\": \"ISC\",\n-      \"engines\": {\n-        \"node\": \">=10\"\n-      }\n-    },\n-    \"node_modules/merge-descriptors\": {\n-      \"version\": \"1.0.3\",\n-      \"resolved\": \"https://registry.npmjs.org/merge-descriptors/-/merge-descriptors-1.0.3.tgz\",\n-      \"integrity\": \"sha512-gaNvAS7TZ897/rVaZ0nMtAyxNyi/pdbjbAwUpFQpN70GqnVfOiXpeUUMKRBmzXaSQ8DdTX4/0ms62r2K+hE6mQ==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"funding\": {\n-        \"url\": \"https://github.com/sponsors/sindresorhus\"\n-      }\n-    },\n-    \"node_modules/merge-source-map\": {\n-      \"version\": \"1.0.4\",\n-      \"resolved\": \"https://registry.npmjs.org/merge-source-map/-/merge-source-map-1.0.4.tgz\",\n-      \"integrity\": \"sha512-PGSmS0kfnTnMJCzJ16BLLCEe6oeYCamKFFdQKshi4BmM6FUwipjVOcBFGxqtQtirtAG4iZvHlqST9CpZKqlRjA==\",\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"source-map\": \"^0.5.6\"\n-      }\n-    },\n-    \"node_modules/merge-source-map/node_modules/source-map\": {\n-      \"version\": \"0.5.7\",\n-      \"resolved\": \"https://registry.npmjs.org/source-map/-/source-map-0.5.7.tgz\",\n-      \"integrity\": \"sha512-LbrmJOMUSdEVxIKvdcJzQC+nQhe8FUZQTXQy6+I75skNgn3OoQ0DZA8YnFa7gp8tqtL3KPf1kmo0R5DoApeSGQ==\",\n-      \"license\": \"BSD-3-Clause\",\n-      \"engines\": {\n-        \"node\": \">=0.10.0\"\n-      }\n-    },\n-    \"node_modules/merge-stream\": {\n-      \"version\": \"2.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/merge-stream/-/merge-stream-2.0.0.tgz\",\n-      \"integrity\": \"sha512-abv/qOcuPfk3URPfDzmZU1LKmuw8kT+0nIHvKrKgFrwifol/doWcdA4ZqsWQ8ENrFKkd67Mfpo/LovbIUsbt3w==\",\n-      \"license\": \"MIT\"\n-    },\n-    \"node_modules/merge2\": {\n-      \"version\": \"1.4.1\",\n-      \"resolved\": \"https://registry.npmjs.org/merge2/-/merge2-1.4.1.tgz\",\n-      \"integrity\": \"sha512-8q7VEgMJW4J8tcfVPy8g09NcQwZdbwFEqhe/WZkoIzjn/3TGDwtOCYtXGxA3O8tPzpczCCDgv+P2P5y00ZJOOg==\",\n-      \"license\": \"MIT\",\n-      \"engines\": {\n-        \"node\": \">= 8\"\n-      }\n-    },\n-    \"node_modules/methods\": {\n-      \"version\": \"1.1.2\",\n-      \"resolved\": \"https://registry.npmjs.org/methods/-/methods-1.1.2.tgz\",\n-      \"integrity\": \"sha512-iclAHeNqNm68zFtnZ0e+1L2yUIdvzNoauKU4WBA3VvH/vPFieF7qfRlwUZU+DA9P9bPXIS90ulxoUoCH23sV2w==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"engines\": {\n-        \"node\": \">= 0.6\"\n-      }\n-    },\n-    \"node_modules/mgrs\": {\n-      \"version\": \"1.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/mgrs/-/mgrs-1.0.0.tgz\",\n-      \"integrity\": \"sha512-awNbTOqCxK1DBGjalK3xqWIstBZgN6fxsMSiXLs9/spqWkF2pAhb2rrYCFSsr1/tT7PhcDGjZndG8SWYn0byYA==\",\n-      \"license\": \"MIT\"\n-    },\n-    \"node_modules/micromark\": {\n-      \"version\": \"4.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/micromark/-/micromark-4.0.1.tgz\",\n-      \"integrity\": \"sha512-eBPdkcoCNvYcxQOAKAlceo5SNdzZWfF+FcSupREAzdAh9rRmE239CEQAiTwIgblwnoM8zzj35sZ5ZwvSEOF6Kw==\",\n-      \"dev\": true,\n-      \"funding\": [\n-        {\n-          \"type\": \"GitHub Sponsors\",\n-          \"url\": \"https://github.com/sponsors/unifiedjs\"\n-        },\n-        {\n-          \"type\": \"OpenCollective\",\n-          \"url\": \"https://opencollective.com/unified\"\n-        }\n-      ],\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"@types/debug\": \"^4.0.0\",\n-        \"debug\": \"^4.0.0\",\n-        \"decode-named-character-reference\": \"^1.0.0\",\n-        \"devlop\": \"^1.0.0\",\n-        \"micromark-core-commonmark\": \"^2.0.0\",\n-        \"micromark-factory-space\": \"^2.0.0\",\n-        \"micromark-util-character\": \"^2.0.0\",\n-        \"micromark-util-chunked\": \"^2.0.0\",\n-        \"micromark-util-combine-extensions\": \"^2.0.0\",\n-        \"micromark-util-decode-numeric-character-reference\": \"^2.0.0\",\n-        \"micromark-util-encode\": \"^2.0.0\",\n-        \"micromark-util-normalize-identifier\": \"^2.0.0\",\n-        \"micromark-util-resolve-all\": \"^2.0.0\",\n-        \"micromark-util-sanitize-uri\": \"^2.0.0\",\n-        \"micromark-util-subtokenize\": \"^2.0.0\",\n-        \"micromark-util-symbol\": \"^2.0.0\",\n-        \"micromark-util-types\": \"^2.0.0\"\n-      }\n-    },\n-    \"node_modules/micromark-core-commonmark\": {\n-      \"version\": \"2.0.2\",\n-      \"resolved\": \"https://registry.npmjs.org/micromark-core-commonmark/-/micromark-core-commonmark-2.0.2.tgz\",\n-      \"integrity\": \"sha512-FKjQKbxd1cibWMM1P9N+H8TwlgGgSkWZMmfuVucLCHaYqeSvJ0hFeHsIa65pA2nYbes0f8LDHPMrd9X7Ujxg9w==\",\n-      \"dev\": true,\n-      \"funding\": [\n-        {\n-          \"type\": \"GitHub Sponsors\",\n-          \"url\": \"https://github.com/sponsors/unifiedjs\"\n-        },\n-        {\n-          \"type\": \"OpenCollective\",\n-          \"url\": \"https://opencollective.com/unified\"\n-        }\n-      ],\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"decode-named-character-reference\": \"^1.0.0\",\n-        \"devlop\": \"^1.0.0\",\n-        \"micromark-factory-destination\": \"^2.0.0\",\n-        \"micromark-factory-label\": \"^2.0.0\",\n-        \"micromark-factory-space\": \"^2.0.0\",\n-        \"micromark-factory-title\": \"^2.0.0\",\n-        \"micromark-factory-whitespace\": \"^2.0.0\",\n-        \"micromark-util-character\": \"^2.0.0\",\n-        \"micromark-util-chunked\": \"^2.0.0\",\n-        \"micromark-util-classify-character\": \"^2.0.0\",\n-        \"micromark-util-html-tag-name\": \"^2.0.0\",\n-        \"micromark-util-normalize-identifier\": \"^2.0.0\",\n-        \"micromark-util-resolve-all\": \"^2.0.0\",\n-        \"micromark-util-subtokenize\": \"^2.0.0\",\n-        \"micromark-util-symbol\": \"^2.0.0\",\n-        \"micromark-util-types\": \"^2.0.0\"\n-      }\n-    },\n-    \"node_modules/micromark-extension-gfm\": {\n-      \"version\": \"3.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/micromark-extension-gfm/-/micromark-extension-gfm-3.0.0.tgz\",\n-      \"integrity\": \"sha512-vsKArQsicm7t0z2GugkCKtZehqUm31oeGBV/KVSorWSy8ZlNAv7ytjFhvaryUiCUJYqs+NoE6AFhpQvBTM6Q4w==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"micromark-extension-gfm-autolink-literal\": \"^2.0.0\",\n-        \"micromark-extension-gfm-footnote\": \"^2.0.0\",\n-        \"micromark-extension-gfm-strikethrough\": \"^2.0.0\",\n-        \"micromark-extension-gfm-table\": \"^2.0.0\",\n-        \"micromark-extension-gfm-tagfilter\": \"^2.0.0\",\n-        \"micromark-extension-gfm-task-list-item\": \"^2.0.0\",\n-        \"micromark-util-combine-extensions\": \"^2.0.0\",\n-        \"micromark-util-types\": \"^2.0.0\"\n-      },\n-      \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n-      }\n-    },\n-    \"node_modules/micromark-extension-gfm-autolink-literal\": {\n-      \"version\": \"2.1.0\",\n-      \"resolved\": \"https://registry.npmjs.org/micromark-extension-gfm-autolink-literal/-/micromark-extension-gfm-autolink-literal-2.1.0.tgz\",\n-      \"integrity\": \"sha512-oOg7knzhicgQ3t4QCjCWgTmfNhvQbDDnJeVu9v81r7NltNCVmhPy1fJRX27pISafdjL+SVc4d3l48Gb6pbRypw==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"micromark-util-character\": \"^2.0.0\",\n-        \"micromark-util-sanitize-uri\": \"^2.0.0\",\n-        \"micromark-util-symbol\": \"^2.0.0\",\n-        \"micromark-util-types\": \"^2.0.0\"\n-      },\n-      \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n-      }\n-    },\n-    \"node_modules/micromark-extension-gfm-footnote\": {\n-      \"version\": \"2.1.0\",\n-      \"resolved\": \"https://registry.npmjs.org/micromark-extension-gfm-footnote/-/micromark-extension-gfm-footnote-2.1.0.tgz\",\n-      \"integrity\": \"sha512-/yPhxI1ntnDNsiHtzLKYnE3vf9JZ6cAisqVDauhp4CEHxlb4uoOTxOCJ+9s51bIB8U1N1FJ1RXOKTIlD5B/gqw==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"devlop\": \"^1.0.0\",\n-        \"micromark-core-commonmark\": \"^2.0.0\",\n-        \"micromark-factory-space\": \"^2.0.0\",\n-        \"micromark-util-character\": \"^2.0.0\",\n-        \"micromark-util-normalize-identifier\": \"^2.0.0\",\n-        \"micromark-util-sanitize-uri\": \"^2.0.0\",\n-        \"micromark-util-symbol\": \"^2.0.0\",\n-        \"micromark-util-types\": \"^2.0.0\"\n-      },\n-      \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n-      }\n-    },\n-    \"node_modules/micromark-extension-gfm-strikethrough\": {\n-      \"version\": \"2.1.0\",\n-      \"resolved\": \"https://registry.npmjs.org/micromark-extension-gfm-strikethrough/-/micromark-extension-gfm-strikethrough-2.1.0.tgz\",\n-      \"integrity\": \"sha512-ADVjpOOkjz1hhkZLlBiYA9cR2Anf8F4HqZUO6e5eDcPQd0Txw5fxLzzxnEkSkfnD0wziSGiv7sYhk/ktvbf1uw==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"devlop\": \"^1.0.0\",\n-        \"micromark-util-chunked\": \"^2.0.0\",\n-        \"micromark-util-classify-character\": \"^2.0.0\",\n-        \"micromark-util-resolve-all\": \"^2.0.0\",\n-        \"micromark-util-symbol\": \"^2.0.0\",\n-        \"micromark-util-types\": \"^2.0.0\"\n-      },\n-      \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n-      }\n-    },\n-    \"node_modules/micromark-extension-gfm-table\": {\n-      \"version\": \"2.1.1\",\n-      \"resolved\": \"https://registry.npmjs.org/micromark-extension-gfm-table/-/micromark-extension-gfm-table-2.1.1.tgz\",\n-      \"integrity\": \"sha512-t2OU/dXXioARrC6yWfJ4hqB7rct14e8f7m0cbI5hUmDyyIlwv5vEtooptH8INkbLzOatzKuVbQmAYcbWoyz6Dg==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"devlop\": \"^1.0.0\",\n-        \"micromark-factory-space\": \"^2.0.0\",\n-        \"micromark-util-character\": \"^2.0.0\",\n-        \"micromark-util-symbol\": \"^2.0.0\",\n-        \"micromark-util-types\": \"^2.0.0\"\n-      },\n-      \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n-      }\n-    },\n-    \"node_modules/micromark-extension-gfm-tagfilter\": {\n-      \"version\": \"2.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/micromark-extension-gfm-tagfilter/-/micromark-extension-gfm-tagfilter-2.0.0.tgz\",\n-      \"integrity\": \"sha512-xHlTOmuCSotIA8TW1mDIM6X2O1SiX5P9IuDtqGonFhEK0qgRI4yeC6vMxEV2dgyr2TiD+2PQ10o+cOhdVAcwfg==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"micromark-util-types\": \"^2.0.0\"\n-      },\n-      \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n+        \"node\": \">=8\"\n       }\n     },\n-    \"node_modules/micromark-extension-gfm-task-list-item\": {\n-      \"version\": \"2.1.0\",\n-      \"resolved\": \"https://registry.npmjs.org/micromark-extension-gfm-task-list-item/-/micromark-extension-gfm-task-list-item-2.1.0.tgz\",\n-      \"integrity\": \"sha512-qIBZhqxqI6fjLDYFTBIa4eivDMnP+OZqsNwmQ3xNLE4Cxwc+zfQEfbs6tzAo2Hjq+bh6q5F+Z8/cksrLFYWQQw==\",\n+    \"node_modules/meow/node_modules/read-pkg-up\": {\n+      \"version\": \"7.0.1\",\n+      \"resolved\": \"https://registry.npmjs.org/read-pkg-up/-/read-pkg-up-7.0.1.tgz\",\n+      \"integrity\": \"sha512-zK0TB7Xd6JpCLmlLmufqykGE+/TlOePD6qKClNW7hHDKFh/J7/7gCWGR7joEQEW1bKq3a3yUZSObOoWLFQ4ohg==\",\n       \"dev\": true,\n       \"license\": \"MIT\",\n       \"dependencies\": {\n-        \"devlop\": \"^1.0.0\",\n-        \"micromark-factory-space\": \"^2.0.0\",\n-        \"micromark-util-character\": \"^2.0.0\",\n-        \"micromark-util-symbol\": \"^2.0.0\",\n-        \"micromark-util-types\": \"^2.0.0\"\n+        \"find-up\": \"^4.1.0\",\n+        \"read-pkg\": \"^5.2.0\",\n+        \"type-fest\": \"^0.8.1\"\n+      },\n+      \"engines\": {\n+        \"node\": \">=8\"\n       },\n       \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n+        \"url\": \"https://github.com/sponsors/sindresorhus\"\n       }\n     },\n-    \"node_modules/micromark-factory-destination\": {\n-      \"version\": \"2.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/micromark-factory-destination/-/micromark-factory-destination-2.0.1.tgz\",\n-      \"integrity\": \"sha512-Xe6rDdJlkmbFRExpTOmRj9N3MaWmbAgdpSrBQvCFqhezUn4AHqJHbaEnfbVYYiexVSs//tqOdY/DxhjdCiJnIA==\",\n+    \"node_modules/meow/node_modules/read-pkg-up/node_modules/type-fest\": {\n+      \"version\": \"0.8.1\",\n+      \"resolved\": \"https://registry.npmjs.org/type-fest/-/type-fest-0.8.1.tgz\",\n+      \"integrity\": \"sha512-4dbzIzqvjtgiM5rw1k5rEHtBANKmdudhGyBEajN01fEyhaAIhsoKNy6y7+IN93IfpFtwY9iqi7kD+xwKhQsNJA==\",\n       \"dev\": true,\n-      \"funding\": [\n-        {\n-          \"type\": \"GitHub Sponsors\",\n-          \"url\": \"https://github.com/sponsors/unifiedjs\"\n-        },\n-        {\n-          \"type\": \"OpenCollective\",\n-          \"url\": \"https://opencollective.com/unified\"\n-        }\n-      ],\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"micromark-util-character\": \"^2.0.0\",\n-        \"micromark-util-symbol\": \"^2.0.0\",\n-        \"micromark-util-types\": \"^2.0.0\"\n+      \"license\": \"(MIT OR CC0-1.0)\",\n+      \"engines\": {\n+        \"node\": \">=8\"\n       }\n     },\n-    \"node_modules/micromark-factory-label\": {\n-      \"version\": \"2.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/micromark-factory-label/-/micromark-factory-label-2.0.1.tgz\",\n-      \"integrity\": \"sha512-VFMekyQExqIW7xIChcXn4ok29YE3rnuyveW3wZQWWqF4Nv9Wk5rgJ99KzPvHjkmPXF93FXIbBp6YdW3t71/7Vg==\",\n+    \"node_modules/meow/node_modules/read-pkg/node_modules/hosted-git-info\": {\n+      \"version\": \"2.8.9\",\n+      \"resolved\": \"https://registry.npmjs.org/hosted-git-info/-/hosted-git-info-2.8.9.tgz\",\n+      \"integrity\": \"sha512-mxIDAb9Lsm6DoOJ7xH+5+X4y1LU/4Hi50L9C5sIswK3JzULS4bwk1FvjdBgvYR4bzT4tuUQiC15FE2f5HbLvYw==\",\n       \"dev\": true,\n-      \"funding\": [\n-        {\n-          \"type\": \"GitHub Sponsors\",\n-          \"url\": \"https://github.com/sponsors/unifiedjs\"\n-        },\n-        {\n-          \"type\": \"OpenCollective\",\n-          \"url\": \"https://opencollective.com/unified\"\n-        }\n-      ],\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"devlop\": \"^1.0.0\",\n-        \"micromark-util-character\": \"^2.0.0\",\n-        \"micromark-util-symbol\": \"^2.0.0\",\n-        \"micromark-util-types\": \"^2.0.0\"\n-      }\n+      \"license\": \"ISC\"\n     },\n-    \"node_modules/micromark-factory-space\": {\n-      \"version\": \"2.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/micromark-factory-space/-/micromark-factory-space-2.0.1.tgz\",\n-      \"integrity\": \"sha512-zRkxjtBxxLd2Sc0d+fbnEunsTj46SWXgXciZmHq0kDYGnck/ZSGj9/wULTV95uoeYiK5hRXP2mJ98Uo4cq/LQg==\",\n+    \"node_modules/meow/node_modules/read-pkg/node_modules/normalize-package-data\": {\n+      \"version\": \"2.5.0\",\n+      \"resolved\": \"https://registry.npmjs.org/normalize-package-data/-/normalize-package-data-2.5.0.tgz\",\n+      \"integrity\": \"sha512-/5CMN3T0R4XTj4DcGaexo+roZSdSFW/0AOOTROrjxzCG1wrWXEsGbRKevjlIL+ZDE4sZlJr5ED4YW0yqmkK+eA==\",\n       \"dev\": true,\n-      \"funding\": [\n-        {\n-          \"type\": \"GitHub Sponsors\",\n-          \"url\": \"https://github.com/sponsors/unifiedjs\"\n-        },\n-        {\n-          \"type\": \"OpenCollective\",\n-          \"url\": \"https://opencollective.com/unified\"\n-        }\n-      ],\n-      \"license\": \"MIT\",\n+      \"license\": \"BSD-2-Clause\",\n       \"dependencies\": {\n-        \"micromark-util-character\": \"^2.0.0\",\n-        \"micromark-util-types\": \"^2.0.0\"\n+        \"hosted-git-info\": \"^2.1.4\",\n+        \"resolve\": \"^1.10.0\",\n+        \"semver\": \"2 || 3 || 4 || 5\",\n+        \"validate-npm-package-license\": \"^3.0.1\"\n       }\n     },\n-    \"node_modules/micromark-factory-title\": {\n-      \"version\": \"2.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/micromark-factory-title/-/micromark-factory-title-2.0.1.tgz\",\n-      \"integrity\": \"sha512-5bZ+3CjhAd9eChYTHsjy6TGxpOFSKgKKJPJxr293jTbfry2KDoWkhBb6TcPVB4NmzaPhMs1Frm9AZH7OD4Cjzw==\",\n+    \"node_modules/meow/node_modules/read-pkg/node_modules/semver\": {\n+      \"version\": \"5.7.2\",\n+      \"resolved\": \"https://registry.npmjs.org/semver/-/semver-5.7.2.tgz\",\n+      \"integrity\": \"sha512-cBznnQ9KjJqU67B52RMC65CMarK2600WFnbkcaiwWq3xy/5haFJlshgnpjovMVJ+Hff49d8GEn0b87C5pDQ10g==\",\n       \"dev\": true,\n-      \"funding\": [\n-        {\n-          \"type\": \"GitHub Sponsors\",\n-          \"url\": \"https://github.com/sponsors/unifiedjs\"\n-        },\n-        {\n-          \"type\": \"OpenCollective\",\n-          \"url\": \"https://opencollective.com/unified\"\n-        }\n-      ],\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"micromark-factory-space\": \"^2.0.0\",\n-        \"micromark-util-character\": \"^2.0.0\",\n-        \"micromark-util-symbol\": \"^2.0.0\",\n-        \"micromark-util-types\": \"^2.0.0\"\n+      \"license\": \"ISC\",\n+      \"bin\": {\n+        \"semver\": \"bin/semver\"\n       }\n     },\n-    \"node_modules/micromark-factory-whitespace\": {\n-      \"version\": \"2.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/micromark-factory-whitespace/-/micromark-factory-whitespace-2.0.1.tgz\",\n-      \"integrity\": \"sha512-Ob0nuZ3PKt/n0hORHyvoD9uZhr+Za8sFoP+OnMcnWK5lngSzALgQYKMr9RJVOWLqQYuyn6ulqGWSXdwf6F80lQ==\",\n+    \"node_modules/meow/node_modules/read-pkg/node_modules/type-fest\": {\n+      \"version\": \"0.6.0\",\n+      \"resolved\": \"https://registry.npmjs.org/type-fest/-/type-fest-0.6.0.tgz\",\n+      \"integrity\": \"sha512-q+MB8nYR1KDLrgr4G5yemftpMC7/QLqVndBmEEdqzmNj5dcFOO4Oo8qlwZE3ULT3+Zim1F8Kq4cBnikNhlCMlg==\",\n       \"dev\": true,\n-      \"funding\": [\n-        {\n-          \"type\": \"GitHub Sponsors\",\n-          \"url\": \"https://github.com/sponsors/unifiedjs\"\n-        },\n-        {\n-          \"type\": \"OpenCollective\",\n-          \"url\": \"https://opencollective.com/unified\"\n-        }\n-      ],\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"micromark-factory-space\": \"^2.0.0\",\n-        \"micromark-util-character\": \"^2.0.0\",\n-        \"micromark-util-symbol\": \"^2.0.0\",\n-        \"micromark-util-types\": \"^2.0.0\"\n+      \"license\": \"(MIT OR CC0-1.0)\",\n+      \"engines\": {\n+        \"node\": \">=8\"\n       }\n     },\n-    \"node_modules/micromark-util-character\": {\n-      \"version\": \"2.1.1\",\n-      \"resolved\": \"https://registry.npmjs.org/micromark-util-character/-/micromark-util-character-2.1.1.tgz\",\n-      \"integrity\": \"sha512-wv8tdUTJ3thSFFFJKtpYKOYiGP2+v96Hvk4Tu8KpCAsTMs6yi+nVmGh1syvSCsaxz45J6Jbw+9DD6g97+NV67Q==\",\n-      \"funding\": [\n-        {\n-          \"type\": \"GitHub Sponsors\",\n-          \"url\": \"https://github.com/sponsors/unifiedjs\"\n-        },\n-        {\n-          \"type\": \"OpenCollective\",\n-          \"url\": \"https://opencollective.com/unified\"\n-        }\n-      ],\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"micromark-util-symbol\": \"^2.0.0\",\n-        \"micromark-util-types\": \"^2.0.0\"\n+    \"node_modules/meow/node_modules/type-fest\": {\n+      \"version\": \"0.18.1\",\n+      \"resolved\": \"https://registry.npmjs.org/type-fest/-/type-fest-0.18.1.tgz\",\n+      \"integrity\": \"sha512-OIAYXk8+ISY+qTOwkHtKqzAuxchoMiD9Udx+FSGQDuiRR+PJKJHc2NJAXlbhkGwTt/4/nKZxELY1w3ReWOL8mw==\",\n+      \"dev\": true,\n+      \"license\": \"(MIT OR CC0-1.0)\",\n+      \"engines\": {\n+        \"node\": \">=10\"\n+      },\n+      \"funding\": {\n+        \"url\": \"https://github.com/sponsors/sindresorhus\"\n       }\n     },\n-    \"node_modules/micromark-util-chunked\": {\n-      \"version\": \"2.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/micromark-util-chunked/-/micromark-util-chunked-2.0.1.tgz\",\n-      \"integrity\": \"sha512-QUNFEOPELfmvv+4xiNg2sRYeS/P84pTW0TCgP5zc9FpXetHY0ab7SxKyAQCNCc1eK0459uoLI1y5oO5Vc1dbhA==\",\n+    \"node_modules/meow/node_modules/yallist\": {\n+      \"version\": \"4.0.0\",\n+      \"resolved\": \"https://registry.npmjs.org/yallist/-/yallist-4.0.0.tgz\",\n+      \"integrity\": \"sha512-3wdGidZyq5PB084XLES5TpOSRA3wjXAlIWMhum2kRcv/41Sn2emQ0dycQW4uZXLejwKvg6EsvbdlVL+FYEct7A==\",\n       \"dev\": true,\n-      \"funding\": [\n-        {\n-          \"type\": \"GitHub Sponsors\",\n-          \"url\": \"https://github.com/sponsors/unifiedjs\"\n-        },\n-        {\n-          \"type\": \"OpenCollective\",\n-          \"url\": \"https://opencollective.com/unified\"\n-        }\n-      ],\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"micromark-util-symbol\": \"^2.0.0\"\n-      }\n+      \"license\": \"ISC\"\n     },\n-    \"node_modules/micromark-util-classify-character\": {\n-      \"version\": \"2.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/micromark-util-classify-character/-/micromark-util-classify-character-2.0.1.tgz\",\n-      \"integrity\": \"sha512-K0kHzM6afW/MbeWYWLjoHQv1sgg2Q9EccHEDzSkxiP/EaagNzCm7T/WMKZ3rjMbvIpvBiZgwR3dKMygtA4mG1Q==\",\n+    \"node_modules/meow/node_modules/yargs-parser\": {\n+      \"version\": \"20.2.9\",\n+      \"resolved\": \"https://registry.npmjs.org/yargs-parser/-/yargs-parser-20.2.9.tgz\",\n+      \"integrity\": \"sha512-y11nGElTIV+CT3Zv9t7VKl+Q3hTQoT9a1Qzezhhl6Rp21gJ/IVTW7Z3y9EWXhuUBC2Shnf+DX0antecpAwSP8w==\",\n       \"dev\": true,\n-      \"funding\": [\n-        {\n-          \"type\": \"GitHub Sponsors\",\n-          \"url\": \"https://github.com/sponsors/unifiedjs\"\n-        },\n-        {\n-          \"type\": \"OpenCollective\",\n-          \"url\": \"https://opencollective.com/unified\"\n-        }\n-      ],\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"micromark-util-character\": \"^2.0.0\",\n-        \"micromark-util-symbol\": \"^2.0.0\",\n-        \"micromark-util-types\": \"^2.0.0\"\n+      \"license\": \"ISC\",\n+      \"engines\": {\n+        \"node\": \">=10\"\n       }\n     },\n-    \"node_modules/micromark-util-combine-extensions\": {\n-      \"version\": \"2.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/micromark-util-combine-extensions/-/micromark-util-combine-extensions-2.0.1.tgz\",\n-      \"integrity\": \"sha512-OnAnH8Ujmy59JcyZw8JSbK9cGpdVY44NKgSM7E9Eh7DiLS2E9RNQf0dONaGDzEG9yjEl5hcqeIsj4hfRkLH/Bg==\",\n+    \"node_modules/merge-descriptors\": {\n+      \"version\": \"1.0.3\",\n+      \"resolved\": \"https://registry.npmjs.org/merge-descriptors/-/merge-descriptors-1.0.3.tgz\",\n+      \"integrity\": \"sha512-gaNvAS7TZ897/rVaZ0nMtAyxNyi/pdbjbAwUpFQpN70GqnVfOiXpeUUMKRBmzXaSQ8DdTX4/0ms62r2K+hE6mQ==\",\n       \"dev\": true,\n-      \"funding\": [\n-        {\n-          \"type\": \"GitHub Sponsors\",\n-          \"url\": \"https://github.com/sponsors/unifiedjs\"\n-        },\n-        {\n-          \"type\": \"OpenCollective\",\n-          \"url\": \"https://opencollective.com/unified\"\n-        }\n-      ],\n       \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"micromark-util-chunked\": \"^2.0.0\",\n-        \"micromark-util-types\": \"^2.0.0\"\n+      \"funding\": {\n+        \"url\": \"https://github.com/sponsors/sindresorhus\"\n       }\n     },\n-    \"node_modules/micromark-util-decode-numeric-character-reference\": {\n-      \"version\": \"2.0.2\",\n-      \"resolved\": \"https://registry.npmjs.org/micromark-util-decode-numeric-character-reference/-/micromark-util-decode-numeric-character-reference-2.0.2.tgz\",\n-      \"integrity\": \"sha512-ccUbYk6CwVdkmCQMyr64dXz42EfHGkPQlBj5p7YVGzq8I7CtjXZJrubAYezf7Rp+bjPseiROqe7G6foFd+lEuw==\",\n-      \"dev\": true,\n-      \"funding\": [\n-        {\n-          \"type\": \"GitHub Sponsors\",\n-          \"url\": \"https://github.com/sponsors/unifiedjs\"\n-        },\n-        {\n-          \"type\": \"OpenCollective\",\n-          \"url\": \"https://opencollective.com/unified\"\n-        }\n-      ],\n+    \"node_modules/merge-source-map\": {\n+      \"version\": \"1.0.4\",\n+      \"resolved\": \"https://registry.npmjs.org/merge-source-map/-/merge-source-map-1.0.4.tgz\",\n+      \"integrity\": \"sha512-PGSmS0kfnTnMJCzJ16BLLCEe6oeYCamKFFdQKshi4BmM6FUwipjVOcBFGxqtQtirtAG4iZvHlqST9CpZKqlRjA==\",\n       \"license\": \"MIT\",\n       \"dependencies\": {\n-        \"micromark-util-symbol\": \"^2.0.0\"\n+        \"source-map\": \"^0.5.6\"\n       }\n     },\n-    \"node_modules/micromark-util-decode-string\": {\n-      \"version\": \"2.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/micromark-util-decode-string/-/micromark-util-decode-string-2.0.1.tgz\",\n-      \"integrity\": \"sha512-nDV/77Fj6eH1ynwscYTOsbK7rR//Uj0bZXBwJZRfaLEJ1iGBR6kIfNmlNqaqJf649EP0F3NWNdeJi03elllNUQ==\",\n-      \"dev\": true,\n-      \"funding\": [\n-        {\n-          \"type\": \"GitHub Sponsors\",\n-          \"url\": \"https://github.com/sponsors/unifiedjs\"\n-        },\n-        {\n-          \"type\": \"OpenCollective\",\n-          \"url\": \"https://opencollective.com/unified\"\n-        }\n-      ],\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"decode-named-character-reference\": \"^1.0.0\",\n-        \"micromark-util-character\": \"^2.0.0\",\n-        \"micromark-util-decode-numeric-character-reference\": \"^2.0.0\",\n-        \"micromark-util-symbol\": \"^2.0.0\"\n+    \"node_modules/merge-source-map/node_modules/source-map\": {\n+      \"version\": \"0.5.7\",\n+      \"resolved\": \"https://registry.npmjs.org/source-map/-/source-map-0.5.7.tgz\",\n+      \"integrity\": \"sha512-LbrmJOMUSdEVxIKvdcJzQC+nQhe8FUZQTXQy6+I75skNgn3OoQ0DZA8YnFa7gp8tqtL3KPf1kmo0R5DoApeSGQ==\",\n+      \"license\": \"BSD-3-Clause\",\n+      \"engines\": {\n+        \"node\": \">=0.10.0\"\n       }\n     },\n-    \"node_modules/micromark-util-encode\": {\n-      \"version\": \"2.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/micromark-util-encode/-/micromark-util-encode-2.0.1.tgz\",\n-      \"integrity\": \"sha512-c3cVx2y4KqUnwopcO9b/SCdo2O67LwJJ/UyqGfbigahfegL9myoEFoDYZgkT7f36T0bLrM9hZTAaAyH+PCAXjw==\",\n-      \"funding\": [\n-        {\n-          \"type\": \"GitHub Sponsors\",\n-          \"url\": \"https://github.com/sponsors/unifiedjs\"\n-        },\n-        {\n-          \"type\": \"OpenCollective\",\n-          \"url\": \"https://opencollective.com/unified\"\n-        }\n-      ],\n+    \"node_modules/merge-stream\": {\n+      \"version\": \"2.0.0\",\n+      \"resolved\": \"https://registry.npmjs.org/merge-stream/-/merge-stream-2.0.0.tgz\",\n+      \"integrity\": \"sha512-abv/qOcuPfk3URPfDzmZU1LKmuw8kT+0nIHvKrKgFrwifol/doWcdA4ZqsWQ8ENrFKkd67Mfpo/LovbIUsbt3w==\",\n       \"license\": \"MIT\"\n     },\n-    \"node_modules/micromark-util-html-tag-name\": {\n-      \"version\": \"2.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/micromark-util-html-tag-name/-/micromark-util-html-tag-name-2.0.1.tgz\",\n-      \"integrity\": \"sha512-2cNEiYDhCWKI+Gs9T0Tiysk136SnR13hhO8yW6BGNyhOC4qYFnwF1nKfD3HFAIXA5c45RrIG1ub11GiXeYd1xA==\",\n+    \"node_modules/merge2\": {\n+      \"version\": \"1.4.1\",\n+      \"resolved\": \"https://registry.npmjs.org/merge2/-/merge2-1.4.1.tgz\",\n+      \"integrity\": \"sha512-8q7VEgMJW4J8tcfVPy8g09NcQwZdbwFEqhe/WZkoIzjn/3TGDwtOCYtXGxA3O8tPzpczCCDgv+P2P5y00ZJOOg==\",\n+      \"license\": \"MIT\",\n+      \"engines\": {\n+        \"node\": \">= 8\"\n+      }\n+    },\n+    \"node_modules/methods\": {\n+      \"version\": \"1.1.2\",\n+      \"resolved\": \"https://registry.npmjs.org/methods/-/methods-1.1.2.tgz\",\n+      \"integrity\": \"sha512-iclAHeNqNm68zFtnZ0e+1L2yUIdvzNoauKU4WBA3VvH/vPFieF7qfRlwUZU+DA9P9bPXIS90ulxoUoCH23sV2w==\",\n       \"dev\": true,\n-      \"funding\": [\n-        {\n-          \"type\": \"GitHub Sponsors\",\n-          \"url\": \"https://github.com/sponsors/unifiedjs\"\n-        },\n-        {\n-          \"type\": \"OpenCollective\",\n-          \"url\": \"https://opencollective.com/unified\"\n-        }\n-      ],\n+      \"license\": \"MIT\",\n+      \"engines\": {\n+        \"node\": \">= 0.6\"\n+      }\n+    },\n+    \"node_modules/mgrs\": {\n+      \"version\": \"1.0.0\",\n+      \"resolved\": \"https://registry.npmjs.org/mgrs/-/mgrs-1.0.0.tgz\",\n+      \"integrity\": \"sha512-awNbTOqCxK1DBGjalK3xqWIstBZgN6fxsMSiXLs9/spqWkF2pAhb2rrYCFSsr1/tT7PhcDGjZndG8SWYn0byYA==\",\n       \"license\": \"MIT\"\n     },\n-    \"node_modules/micromark-util-normalize-identifier\": {\n-      \"version\": \"2.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/micromark-util-normalize-identifier/-/micromark-util-normalize-identifier-2.0.1.tgz\",\n-      \"integrity\": \"sha512-sxPqmo70LyARJs0w2UclACPUUEqltCkJ6PhKdMIDuJ3gSf/Q+/GIe3WKl0Ijb/GyH9lOpUkRAO2wp0GVkLvS9Q==\",\n-      \"dev\": true,\n+    \"node_modules/micromark-util-character\": {\n+      \"version\": \"2.1.1\",\n+      \"resolved\": \"https://registry.npmjs.org/micromark-util-character/-/micromark-util-character-2.1.1.tgz\",\n+      \"integrity\": \"sha512-wv8tdUTJ3thSFFFJKtpYKOYiGP2+v96Hvk4Tu8KpCAsTMs6yi+nVmGh1syvSCsaxz45J6Jbw+9DD6g97+NV67Q==\",\n       \"funding\": [\n         {\n           \"type\": \"GitHub Sponsors\",\n@@ -43918,14 +44070,14 @@\n       ],\n       \"license\": \"MIT\",\n       \"dependencies\": {\n-        \"micromark-util-symbol\": \"^2.0.0\"\n+        \"micromark-util-symbol\": \"^2.0.0\",\n+        \"micromark-util-types\": \"^2.0.0\"\n       }\n     },\n-    \"node_modules/micromark-util-resolve-all\": {\n+    \"node_modules/micromark-util-encode\": {\n       \"version\": \"2.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/micromark-util-resolve-all/-/micromark-util-resolve-all-2.0.1.tgz\",\n-      \"integrity\": \"sha512-VdQyxFWFT2/FGJgwQnJYbe1jjQoNTS4RjglmSjTUlpUMa95Htx9NHeYW4rGDJzbjvCsl9eLjMQwGeElsqmzcHg==\",\n-      \"dev\": true,\n+      \"resolved\": \"https://registry.npmjs.org/micromark-util-encode/-/micromark-util-encode-2.0.1.tgz\",\n+      \"integrity\": \"sha512-c3cVx2y4KqUnwopcO9b/SCdo2O67LwJJ/UyqGfbigahfegL9myoEFoDYZgkT7f36T0bLrM9hZTAaAyH+PCAXjw==\",\n       \"funding\": [\n         {\n           \"type\": \"GitHub Sponsors\",\n@@ -43936,10 +44088,7 @@\n           \"url\": \"https://opencollective.com/unified\"\n         }\n       ],\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"micromark-util-types\": \"^2.0.0\"\n-      }\n+      \"license\": \"MIT\"\n     },\n     \"node_modules/micromark-util-sanitize-uri\": {\n       \"version\": \"2.0.1\",\n@@ -43962,29 +44111,6 @@\n         \"micromark-util-symbol\": \"^2.0.0\"\n       }\n     },\n-    \"node_modules/micromark-util-subtokenize\": {\n-      \"version\": \"2.0.4\",\n-      \"resolved\": \"https://registry.npmjs.org/micromark-util-subtokenize/-/micromark-util-subtokenize-2.0.4.tgz\",\n-      \"integrity\": \"sha512-N6hXjrin2GTJDe3MVjf5FuXpm12PGm80BrUAeub9XFXca8JZbP+oIwY4LJSVwFUCL1IPm/WwSVUN7goFHmSGGQ==\",\n-      \"dev\": true,\n-      \"funding\": [\n-        {\n-          \"type\": \"GitHub Sponsors\",\n-          \"url\": \"https://github.com/sponsors/unifiedjs\"\n-        },\n-        {\n-          \"type\": \"OpenCollective\",\n-          \"url\": \"https://opencollective.com/unified\"\n-        }\n-      ],\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"devlop\": \"^1.0.0\",\n-        \"micromark-util-chunked\": \"^2.0.0\",\n-        \"micromark-util-symbol\": \"^2.0.0\",\n-        \"micromark-util-types\": \"^2.0.0\"\n-      }\n-    },\n     \"node_modules/micromark-util-symbol\": {\n       \"version\": \"2.0.1\",\n       \"resolved\": \"https://registry.npmjs.org/micromark-util-symbol/-/micromark-util-symbol-2.0.1.tgz\",\n@@ -51266,112 +51392,6 @@\n         \"node\": \">=4\"\n       }\n     },\n-    \"node_modules/remark-gfm\": {\n-      \"version\": \"4.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/remark-gfm/-/remark-gfm-4.0.1.tgz\",\n-      \"integrity\": \"sha512-1quofZ2RQ9EWdeN34S79+KExV1764+wCUGop5CPL1WGdD0ocPpu91lzPGbwWMECpEpd42kJGQwzRfyov9j4yNg==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"@types/mdast\": \"^4.0.0\",\n-        \"mdast-util-gfm\": \"^3.0.0\",\n-        \"micromark-extension-gfm\": \"^3.0.0\",\n-        \"remark-parse\": \"^11.0.0\",\n-        \"remark-stringify\": \"^11.0.0\",\n-        \"unified\": \"^11.0.0\"\n-      },\n-      \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n-      }\n-    },\n-    \"node_modules/remark-gfm/node_modules/@types/unist\": {\n-      \"version\": \"3.0.3\",\n-      \"resolved\": \"https://registry.npmjs.org/@types/unist/-/unist-3.0.3.tgz\",\n-      \"integrity\": \"sha512-ko/gIFJRv177XgZsZcBwnqJN5x/Gien8qNOn0D5bQU/zAzVf9Zt3BlcUiLqhV9y4ARk0GbT3tnUiPNgnTXzc/Q==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\"\n-    },\n-    \"node_modules/remark-gfm/node_modules/is-plain-obj\": {\n-      \"version\": \"4.1.0\",\n-      \"resolved\": \"https://registry.npmjs.org/is-plain-obj/-/is-plain-obj-4.1.0.tgz\",\n-      \"integrity\": \"sha512-+Pgi+vMuUNkJyExiMBt5IlFoMyKnr5zhJ4Uspz58WOhBF5QoIZkFyNHIbBAtHwzVAgk5RtndVNsDRN61/mmDqg==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"engines\": {\n-        \"node\": \">=12\"\n-      },\n-      \"funding\": {\n-        \"url\": \"https://github.com/sponsors/sindresorhus\"\n-      }\n-    },\n-    \"node_modules/remark-gfm/node_modules/remark-parse\": {\n-      \"version\": \"11.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/remark-parse/-/remark-parse-11.0.0.tgz\",\n-      \"integrity\": \"sha512-FCxlKLNGknS5ba/1lmpYijMUzX2esxW5xQqjWxw2eHFfS2MSdaHVINFmhjo+qN1WhZhNimq0dZATN9pH0IDrpA==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"@types/mdast\": \"^4.0.0\",\n-        \"mdast-util-from-markdown\": \"^2.0.0\",\n-        \"micromark-util-types\": \"^2.0.0\",\n-        \"unified\": \"^11.0.0\"\n-      },\n-      \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n-      }\n-    },\n-    \"node_modules/remark-gfm/node_modules/unified\": {\n-      \"version\": \"11.0.5\",\n-      \"resolved\": \"https://registry.npmjs.org/unified/-/unified-11.0.5.tgz\",\n-      \"integrity\": \"sha512-xKvGhPWw3k84Qjh8bI3ZeJjqnyadK+GEFtazSfZv/rKeTkTjOJho6mFqh2SM96iIcZokxiOpg78GazTSg8+KHA==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"@types/unist\": \"^3.0.0\",\n-        \"bail\": \"^2.0.0\",\n-        \"devlop\": \"^1.0.0\",\n-        \"extend\": \"^3.0.0\",\n-        \"is-plain-obj\": \"^4.0.0\",\n-        \"trough\": \"^2.0.0\",\n-        \"vfile\": \"^6.0.0\"\n-      },\n-      \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n-      }\n-    },\n-    \"node_modules/remark-gfm/node_modules/vfile\": {\n-      \"version\": \"6.0.3\",\n-      \"resolved\": \"https://registry.npmjs.org/vfile/-/vfile-6.0.3.tgz\",\n-      \"integrity\": \"sha512-KzIbH/9tXat2u30jf+smMwFCsno4wHVdNmzFyL+T/L3UGqqk6JKfVqOFOZEpZSHADH1k40ab6NUIXZq422ov3Q==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"@types/unist\": \"^3.0.0\",\n-        \"vfile-message\": \"^4.0.0\"\n-      },\n-      \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n-      }\n-    },\n-    \"node_modules/remark-gfm/node_modules/vfile-message\": {\n-      \"version\": \"4.0.2\",\n-      \"resolved\": \"https://registry.npmjs.org/vfile-message/-/vfile-message-4.0.2.tgz\",\n-      \"integrity\": \"sha512-jRDZ1IMLttGj41KcZvlrYAaI3CfqpLpfpf+Mfig13viT6NKvRzWZ+lXz0Y5D60w6uJIBAOGq9mSHf0gktF0duw==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"@types/unist\": \"^3.0.0\",\n-        \"unist-util-stringify-position\": \"^4.0.0\"\n-      },\n-      \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n-      }\n-    },\n     \"node_modules/remark-parse\": {\n       \"version\": \"10.0.2\",\n       \"resolved\": \"https://registry.npmjs.org/remark-parse/-/remark-parse-10.0.2.tgz\",\n@@ -52035,92 +52055,6 @@\n         \"url\": \"https://opencollective.com/unified\"\n       }\n     },\n-    \"node_modules/remark-stringify\": {\n-      \"version\": \"11.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/remark-stringify/-/remark-stringify-11.0.0.tgz\",\n-      \"integrity\": \"sha512-1OSmLd3awB/t8qdoEOMazZkNsfVTeY4fTsgzcQFdXNq8ToTN4ZGwrMnlda4K6smTFKD+GRV6O48i6Z4iKgPPpw==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"@types/mdast\": \"^4.0.0\",\n-        \"mdast-util-to-markdown\": \"^2.0.0\",\n-        \"unified\": \"^11.0.0\"\n-      },\n-      \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n-      }\n-    },\n-    \"node_modules/remark-stringify/node_modules/@types/unist\": {\n-      \"version\": \"3.0.3\",\n-      \"resolved\": \"https://registry.npmjs.org/@types/unist/-/unist-3.0.3.tgz\",\n-      \"integrity\": \"sha512-ko/gIFJRv177XgZsZcBwnqJN5x/Gien8qNOn0D5bQU/zAzVf9Zt3BlcUiLqhV9y4ARk0GbT3tnUiPNgnTXzc/Q==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\"\n-    },\n-    \"node_modules/remark-stringify/node_modules/is-plain-obj\": {\n-      \"version\": \"4.1.0\",\n-      \"resolved\": \"https://registry.npmjs.org/is-plain-obj/-/is-plain-obj-4.1.0.tgz\",\n-      \"integrity\": \"sha512-+Pgi+vMuUNkJyExiMBt5IlFoMyKnr5zhJ4Uspz58WOhBF5QoIZkFyNHIbBAtHwzVAgk5RtndVNsDRN61/mmDqg==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"engines\": {\n-        \"node\": \">=12\"\n-      },\n-      \"funding\": {\n-        \"url\": \"https://github.com/sponsors/sindresorhus\"\n-      }\n-    },\n-    \"node_modules/remark-stringify/node_modules/unified\": {\n-      \"version\": \"11.0.5\",\n-      \"resolved\": \"https://registry.npmjs.org/unified/-/unified-11.0.5.tgz\",\n-      \"integrity\": \"sha512-xKvGhPWw3k84Qjh8bI3ZeJjqnyadK+GEFtazSfZv/rKeTkTjOJho6mFqh2SM96iIcZokxiOpg78GazTSg8+KHA==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"@types/unist\": \"^3.0.0\",\n-        \"bail\": \"^2.0.0\",\n-        \"devlop\": \"^1.0.0\",\n-        \"extend\": \"^3.0.0\",\n-        \"is-plain-obj\": \"^4.0.0\",\n-        \"trough\": \"^2.0.0\",\n-        \"vfile\": \"^6.0.0\"\n-      },\n-      \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n-      }\n-    },\n-    \"node_modules/remark-stringify/node_modules/vfile\": {\n-      \"version\": \"6.0.3\",\n-      \"resolved\": \"https://registry.npmjs.org/vfile/-/vfile-6.0.3.tgz\",\n-      \"integrity\": \"sha512-KzIbH/9tXat2u30jf+smMwFCsno4wHVdNmzFyL+T/L3UGqqk6JKfVqOFOZEpZSHADH1k40ab6NUIXZq422ov3Q==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"@types/unist\": \"^3.0.0\",\n-        \"vfile-message\": \"^4.0.0\"\n-      },\n-      \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n-      }\n-    },\n-    \"node_modules/remark-stringify/node_modules/vfile-message\": {\n-      \"version\": \"4.0.2\",\n-      \"resolved\": \"https://registry.npmjs.org/vfile-message/-/vfile-message-4.0.2.tgz\",\n-      \"integrity\": \"sha512-jRDZ1IMLttGj41KcZvlrYAaI3CfqpLpfpf+Mfig13viT6NKvRzWZ+lXz0Y5D60w6uJIBAOGq9mSHf0gktF0duw==\",\n-      \"dev\": true,\n-      \"license\": \"MIT\",\n-      \"dependencies\": {\n-        \"@types/unist\": \"^3.0.0\",\n-        \"unist-util-stringify-position\": \"^4.0.0\"\n-      },\n-      \"funding\": {\n-        \"type\": \"opencollective\",\n-        \"url\": \"https://opencollective.com/unified\"\n-      }\n-    },\n     \"node_modules/remove-accents\": {\n       \"version\": \"0.5.0\",\n       \"resolved\": \"https://registry.npmjs.org/remove-accents/-/remove-accents-0.5.0.tgz\",\n@@ -63905,7 +63839,7 @@\n         \"regenerator-runtime\": \"^0.14.1\",\n         \"rehype-raw\": \"^7.0.0\",\n         \"rehype-sanitize\": \"^6.0.0\",\n-        \"remark-gfm\": \"^4.0.1\",\n+        \"remark-gfm\": \"^3.0.1\",\n         \"reselect\": \"^5.1.1\",\n         \"rison\": \"^0.1.1\",\n         \"seedrandom\": \"^3.0.5\",", "pull_request_number": 36388}
{"sha": "3eb68e55abca986ea6d7a5431deac38412e94eaa", "filename": "superset-frontend/package.json", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/apache/superset/blob/a7e25fa9426f1e0578dc9ed2fdd9f24390c7151d/superset-frontend%2Fpackage.json", "raw_url": "https://github.com/apache/superset/raw/a7e25fa9426f1e0578dc9ed2fdd9f24390c7151d/superset-frontend%2Fpackage.json", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackage.json?ref=a7e25fa9426f1e0578dc9ed2fdd9f24390c7151d", "patch": "@@ -382,6 +382,7 @@\n     \"core-js\": \"^3.38.1\",\n     \"d3-color\": \"^3.1.0\",\n     \"puppeteer\": \"^22.4.1\",\n+    \"remark-gfm\": \"^3.0.1\",\n     \"underscore\": \"^1.13.7\",\n     \"jspdf\": \"^3.0.2\",\n     \"nwsapi\": \"^2.2.13\",", "pull_request_number": 36388}
{"sha": "467ce595f103de9b55a4ec9f927d801cb472b8da", "filename": "superset-frontend/packages/superset-ui-core/package.json", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/a7e25fa9426f1e0578dc9ed2fdd9f24390c7151d/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fpackage.json", "raw_url": "https://github.com/apache/superset/raw/a7e25fa9426f1e0578dc9ed2fdd9f24390c7151d/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fpackage.json", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fpackage.json?ref=a7e25fa9426f1e0578dc9ed2fdd9f24390c7151d", "patch": "@@ -60,7 +60,7 @@\n     \"regenerator-runtime\": \"^0.14.1\",\n     \"rehype-raw\": \"^7.0.0\",\n     \"rehype-sanitize\": \"^6.0.0\",\n-    \"remark-gfm\": \"^4.0.1\",\n+    \"remark-gfm\": \"^3.0.1\",\n     \"reselect\": \"^5.1.1\",\n     \"rison\": \"^0.1.1\",\n     \"seedrandom\": \"^3.0.5\",", "pull_request_number": 36388}
{"sha": "d1f49c428c3a015ca818b4db9dd02a8898f9aca1", "filename": "superset-frontend/packages/superset-ui-core/src/components/SafeMarkdown/SafeMarkdown.tsx", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/apache/superset/blob/a7e25fa9426f1e0578dc9ed2fdd9f24390c7151d/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FSafeMarkdown%2FSafeMarkdown.tsx", "raw_url": "https://github.com/apache/superset/raw/a7e25fa9426f1e0578dc9ed2fdd9f24390c7151d/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FSafeMarkdown%2FSafeMarkdown.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcomponents%2FSafeMarkdown%2FSafeMarkdown.tsx?ref=a7e25fa9426f1e0578dc9ed2fdd9f24390c7151d", "patch": "@@ -18,6 +18,9 @@\n  */\n import { useEffect, useMemo, useState } from 'react';\n import rehypeSanitize, { defaultSchema } from 'rehype-sanitize';\n+// TODO: Upgrade to remark-gfm v4+ after migrating to React 18.\n+// remark-gfm v4+ requires react-markdown v9+, which requires React 18.\n+// Currently pinned to v3.0.1 for compatibility with react-markdown v8 and React 17.\n import remarkGfm from 'remark-gfm';\n import { mergeWith } from 'lodash';\n import { FeatureFlag, isFeatureEnabled } from '../../utils';", "pull_request_number": 36388}
{"sha": "93d3e4a2ecc7e70aea37138a4459b4e669e98ce9", "filename": "superset-frontend/packages/superset-ui-core/test/components/SafeMarkdown.test.ts", "status": "removed", "additions": 0, "deletions": 39, "changes": 39, "blob_url": "https://github.com/apache/superset/blob/a27225324389acc1c255f7ed836dd5588a60f73c/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Ftest%2Fcomponents%2FSafeMarkdown.test.ts", "raw_url": "https://github.com/apache/superset/raw/a27225324389acc1c255f7ed836dd5588a60f73c/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Ftest%2Fcomponents%2FSafeMarkdown.test.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Ftest%2Fcomponents%2FSafeMarkdown.test.ts?ref=a27225324389acc1c255f7ed836dd5588a60f73c", "patch": "@@ -1,39 +0,0 @@\n-/**\n- * Licensed to the Apache Software Foundation (ASF) under one\n- * or more contributor license agreements.  See the NOTICE file\n- * distributed with this work for additional information\n- * regarding copyright ownership.  The ASF licenses this file\n- * to you under the Apache License, Version 2.0 (the\n- * \"License\"); you may not use this file except in compliance\n- * with the License.  You may obtain a copy of the License at\n- *\n- *   http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing,\n- * software distributed under the License is distributed on an\n- * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n- * KIND, either express or implied.  See the License for the\n- * specific language governing permissions and limitations\n- * under the License.\n- */\n-import { getOverrideHtmlSchema } from '../../src/components/SafeMarkdown/SafeMarkdown';\n-\n-describe('getOverrideHtmlSchema', () => {\n-  it('should append the override items', () => {\n-    const original = {\n-      attributes: {\n-        '*': ['size'],\n-      },\n-      clobberPrefix: 'original-prefix',\n-      tagNames: ['h1', 'h2', 'h3'],\n-    };\n-    const result = getOverrideHtmlSchema(original, {\n-      attributes: { '*': ['src'], h1: ['style'] },\n-      clobberPrefix: 'custom-prefix',\n-      tagNames: ['iframe'],\n-    });\n-    expect(result.clobberPrefix).toEqual('custom-prefix');\n-    expect(result.attributes).toEqual({ '*': ['size', 'src'], h1: ['style'] });\n-    expect(result.tagNames).toEqual(['h1', 'h2', 'h3', 'iframe']);\n-  });\n-});", "pull_request_number": 36388}
{"sha": "fec145ef125a52fa3277d8b525f64255f18c52d3", "filename": "superset-frontend/packages/superset-ui-core/test/components/SafeMarkdown.test.tsx", "status": "added", "additions": 160, "deletions": 0, "changes": 160, "blob_url": "https://github.com/apache/superset/blob/a7e25fa9426f1e0578dc9ed2fdd9f24390c7151d/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Ftest%2Fcomponents%2FSafeMarkdown.test.tsx", "raw_url": "https://github.com/apache/superset/raw/a7e25fa9426f1e0578dc9ed2fdd9f24390c7151d/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Ftest%2Fcomponents%2FSafeMarkdown.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Ftest%2Fcomponents%2FSafeMarkdown.test.tsx?ref=a7e25fa9426f1e0578dc9ed2fdd9f24390c7151d", "patch": "@@ -0,0 +1,160 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import { render } from '@testing-library/react';\n+import {\n+  getOverrideHtmlSchema,\n+  SafeMarkdown,\n+} from '../../src/components/SafeMarkdown/SafeMarkdown';\n+\n+/**\n+ * NOTE: react-markdown is mocked globally in spec/helpers/shim.tsx (line 89)\n+ * to return children as-is without processing. This is intentional to avoid\n+ * ESM parsing issues with hast-* packages in Jest.\n+ *\n+ * These tests verify that the SafeMarkdown component renders without errors,\n+ * which is the main goal: ensuring remark-gfm v4+ doesn't break the component\n+ * with \"Cannot set properties of undefined (setting 'inTable')\" errors.\n+ */\n+\n+describe('getOverrideHtmlSchema', () => {\n+  it('should append the override items', () => {\n+    const original = {\n+      attributes: {\n+        '*': ['size'],\n+      },\n+      clobberPrefix: 'original-prefix',\n+      tagNames: ['h1', 'h2', 'h3'],\n+    };\n+    const result = getOverrideHtmlSchema(original, {\n+      attributes: { '*': ['src'], h1: ['style'] },\n+      clobberPrefix: 'custom-prefix',\n+      tagNames: ['iframe'],\n+    });\n+    expect(result.clobberPrefix).toEqual('custom-prefix');\n+    expect(result.attributes).toEqual({ '*': ['size', 'src'], h1: ['style'] });\n+    expect(result.tagNames).toEqual(['h1', 'h2', 'h3', 'iframe']);\n+  });\n+});\n+\n+describe('SafeMarkdown', () => {\n+  describe('remark-gfm compatibility tests', () => {\n+    /**\n+     * Critical regression test for remark-gfm v3.0.1 compatibility.\n+     *\n+     * CONTEXT:\n+     * - remark-gfm v4+ requires unified v11 (react-markdown v9+, React 18+)\n+     * - react-markdown v8 uses unified v10 (compatible with React 17)\n+     * - Mixing remark-gfm v4 with react-markdown v8 causes:\n+     *   \"Cannot set properties of undefined (setting 'inTable')\" error\n+     *\n+     * HISTORY:\n+     * - PR #32420 (March 2025): Fixed by pinning remark-gfm to v3\n+     * - PR #32945 (July 2025): Dependabot auto-upgraded to v4, breaking tables\n+     * - This test prevents future auto-upgrades from breaking functionality\n+     *\n+     * This test will FAIL if remark-gfm is upgraded to v4+ without upgrading\n+     * react-markdown to v9+ (which requires React 18).\n+     */\n+    it('should render GitHub Flavored Markdown tables without errors', () => {\n+      const markdownWithTable = `\n+| Header 1 | Header 2 | Header 3 |\n+|----------|----------|----------|\n+| Cell 1   | Cell 2   | Cell 3   |\n+| Value A  | Value B  | Value C  |\n+      `.trim();\n+\n+      // This will throw \"Cannot set properties of undefined (setting 'inTable')\"\n+      // if remark-gfm v4+ is used with react-markdown v8\n+      expect(() => {\n+        render(<SafeMarkdown source={markdownWithTable} />);\n+      }).not.toThrow();\n+    });\n+\n+    /**\n+     * Regression test for issue #32416\n+     *\n+     * Tests that inline code blocks with backticks work correctly.\n+     * This was the original issue that led to pinning remark-gfm to v3.\n+     */\n+    it('should render inline code blocks with backticks', () => {\n+      const markdownWithCode = 'Use `console.log()` for debugging';\n+\n+      expect(() => {\n+        render(<SafeMarkdown source={markdownWithCode} />);\n+      }).not.toThrow();\n+    });\n+\n+    /**\n+     * Additional GFM feature test: Strikethrough\n+     *\n+     * Ensures other remark-gfm features work correctly with v3.\n+     */\n+    it('should render strikethrough text', () => {\n+      const markdownWithStrikethrough = '~~This is strikethrough text~~';\n+\n+      expect(() => {\n+        render(<SafeMarkdown source={markdownWithStrikethrough} />);\n+      }).not.toThrow();\n+    });\n+\n+    /**\n+     * Additional GFM feature test: Task lists\n+     *\n+     * Ensures task lists render correctly with v3.\n+     */\n+    it('should render task lists', () => {\n+      const markdownWithTaskList = `\n+- [x] Completed task\n+- [ ] Incomplete task\n+      `.trim();\n+\n+      expect(() => {\n+        render(<SafeMarkdown source={markdownWithTaskList} />);\n+      }).not.toThrow();\n+    });\n+\n+    /**\n+     * Complex integration test with multiple GFM features\n+     *\n+     * Tests that all GFM features work together without conflicts.\n+     */\n+    it('should render complex markdown with multiple GFM features', () => {\n+      const complexMarkdown = `\n+# Dashboard Overview\n+\n+Use \\`console.log()\\` for debugging ~~or use alerts~~.\n+\n+| Metric | Q1 | Q2 | Q3 |\n+|--------|----|----|----|\n+| Sales  | 10 | 20 | 30 |\n+| Users  | 5  | 15 | 25 |\n+\n+**Tasks:**\n+- [x] Setup dashboard\n+- [ ] Add filters\n+      `.trim();\n+\n+      // If remark-gfm v4 is used with react-markdown v8, this will throw\n+      // \"Cannot set properties of undefined (setting 'inTable')\"\n+      expect(() => {\n+        render(<SafeMarkdown source={complexMarkdown} />);\n+      }).not.toThrow();\n+    });\n+  });\n+});", "pull_request_number": 36388}
{"sha": "078b82164db01b5a92f147cecd44b0c4827c59cb", "filename": "superset-frontend/plugins/plugin-chart-table/src/TableChart.tsx", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/apache/superset/blob/fa8026beffc0bbea93f25471e200896fe0b89ad7/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2FTableChart.tsx", "raw_url": "https://github.com/apache/superset/raw/fa8026beffc0bbea93f25471e200896fe0b89ad7/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2FTableChart.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2FTableChart.tsx?ref=fa8026beffc0bbea93f25471e200896fe0b89ad7", "patch": "@@ -810,6 +810,7 @@ export default function TableChart<D extends DataRecord = DataRecord>(\n         isMetric,\n         isPercentMetric,\n         config = {},\n+        description,\n       } = column;\n       const label = config.customColumnName || originalLabel;\n       let displayLabel = label;\n@@ -1094,7 +1095,9 @@ export default function TableChart<D extends DataRecord = DataRecord>(\n         Header: ({ column: col, onClick, style, onDragStart, onDrop }) => (\n           <th\n             id={`header-${headerId}`}\n-            title={t('Shift + Click to sort by multiple columns')}\n+            title={\n+              description || t('Shift + Click to sort by multiple columns')\n+            }\n             className={[className, col.isSorted ? 'is-sorted' : ''].join(' ')}\n             style={{\n               ...sharedStyle,", "pull_request_number": 37179}
{"sha": "cc92a19f85f507687ebe0fcdf51caede8071eb1b", "filename": "superset-frontend/plugins/plugin-chart-table/src/transformProps.ts", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/apache/superset/blob/fa8026beffc0bbea93f25471e200896fe0b89ad7/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2FtransformProps.ts", "raw_url": "https://github.com/apache/superset/raw/fa8026beffc0bbea93f25471e200896fe0b89ad7/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2FtransformProps.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2FtransformProps.ts?ref=fa8026beffc0bbea93f25471e200896fe0b89ad7", "patch": "@@ -213,6 +213,7 @@ const processColumns = memoizeOne(function processColumns(\n       percent_metrics: percentMetrics_,\n       column_config: columnConfig = {},\n     },\n+    rawDatasource,\n     queriesData,\n   } = props;\n   const granularity = extractTimegrain(props.rawFormData);\n@@ -257,6 +258,12 @@ const processColumns = memoizeOne(function processColumns(\n         ? config.currencyFormat\n         : savedCurrency;\n \n+      const description =\n+        rawDatasource.columns?.find((item: any) => item.column_name === key)\n+          ?.description ??\n+        rawDatasource.metrics?.find((item: any) => item.metric_name === key)\n+          ?.description;\n+\n       let formatter;\n \n       if (isTime || config.d3TimeFormat) {\n@@ -318,6 +325,7 @@ const processColumns = memoizeOne(function processColumns(\n         isPercentMetric,\n         formatter,\n         config,\n+        description,\n         currencyCodeColumn,\n       };\n     });", "pull_request_number": 37179}
{"sha": "85a27777f4977c429bf22d96c957d2c2f036995d", "filename": "superset-frontend/plugins/plugin-chart-table/src/types.ts", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/apache/superset/blob/fa8026beffc0bbea93f25471e200896fe0b89ad7/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2Ftypes.ts", "raw_url": "https://github.com/apache/superset/raw/fa8026beffc0bbea93f25471e200896fe0b89ad7/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2Ftypes.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2Ftypes.ts?ref=fa8026beffc0bbea93f25471e200896fe0b89ad7", "patch": "@@ -72,6 +72,7 @@ export interface DataColumnMeta {\n   isNumeric?: boolean;\n   config?: TableColumnConfig;\n   isChildColumn?: boolean;\n+  description?: string;\n   currencyCodeColumn?: string;\n }\n ", "pull_request_number": 37179}
{"sha": "be6ecd762595262dc09ae9ef25a0e3665849373d", "filename": "superset-frontend/src/SqlLab/components/SqlEditor/index.tsx", "status": "modified", "additions": 20, "deletions": 9, "changes": 29, "blob_url": "https://github.com/apache/superset/blob/fdf0a138f94864633709fe847558533410b66cc2/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FSqlEditor%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/fdf0a138f94864633709fe847558533410b66cc2/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FSqlEditor%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FSqlEditor%2Findex.tsx?ref=fdf0a138f94864633709fe847558533410b66cc2", "patch": "@@ -112,6 +112,9 @@ import ScheduleQueryButton from '../ScheduleQueryButton';\n import EstimateQueryCostButton from '../EstimateQueryCostButton';\n import ShareSqlLabQuery from '../ShareSqlLabQuery';\n import AceEditorWrapper from '../AceEditorWrapper';\n+import ViewListExtension from 'src/components/ViewListExtension';\n+import { ViewContribution } from 'src/SqlLab/contributions';\n+import ExtensionsManager from 'src/extensions/ExtensionsManager';\n import RunQueryActionButton from '../RunQueryActionButton';\n import QueryLimitSelect from '../QueryLimitSelect';\n import KeyboardShortcutButton, {\n@@ -907,15 +910,23 @@ const SqlEditor: FC<Props> = ({\n             <AutoSizer disableWidth>\n               {({ height }) =>\n                 isActive && (\n-                  <AceEditorWrapper\n-                    autocomplete={autocompleteEnabled}\n-                    onBlur={onSqlChanged}\n-                    onChange={onSqlChanged}\n-                    queryEditorId={queryEditor.id}\n-                    onCursorPositionChange={handleCursorPositionChange}\n-                    height={`${height}px`}\n-                    hotkeys={hotkeys}\n-                  />\n+                  <>\n+                    {ExtensionsManager.getInstance().getViewContributions(\n+                      ViewContribution.Editor,\n+                    )?.length ? (\n+                      <ViewListExtension viewId={ViewContribution.Editor} />\n+                    ) : (\n+                      <AceEditorWrapper\n+                        autocomplete={autocompleteEnabled}\n+                        onBlur={onSqlChanged}\n+                        onChange={onSqlChanged}\n+                        queryEditorId={queryEditor.id}\n+                        onCursorPositionChange={handleCursorPositionChange}\n+                        height={`${height}px`}\n+                        hotkeys={hotkeys}\n+                      />\n+                    )}\n+                  </>\n                 )\n               }\n             </AutoSizer>", "pull_request_number": 37290}
{"sha": "89472eacb149f864ed4d34b2be6fda5333e50f0c", "filename": "superset-frontend/src/components/Accessibility/SkipLink.stories.tsx", "status": "added", "additions": 240, "deletions": 0, "changes": 240, "blob_url": "https://github.com/apache/superset/blob/b53eeab7839d979c203ad2ea82e4fc94c6998850/superset-frontend%2Fsrc%2Fcomponents%2FAccessibility%2FSkipLink.stories.tsx", "raw_url": "https://github.com/apache/superset/raw/b53eeab7839d979c203ad2ea82e4fc94c6998850/superset-frontend%2Fsrc%2Fcomponents%2FAccessibility%2FSkipLink.stories.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fcomponents%2FAccessibility%2FSkipLink.stories.tsx?ref=b53eeab7839d979c203ad2ea82e4fc94c6998850", "patch": "@@ -0,0 +1,240 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import SkipLink from './SkipLink';\n+\n+export default {\n+  title: 'Components/Accessibility/SkipLink',\n+  component: SkipLink,\n+  parameters: {\n+    docs: {\n+      description: {\n+        component:\n+          'WCAG 2.4.1 Bypass Blocks - Skip link for keyboard navigation. ' +\n+          'Allows keyboard users to skip repetitive navigation and jump directly to main content. ' +\n+          'The link is visually hidden but becomes visible when focused via Tab key.',\n+      },\n+    },\n+  },\n+};\n+\n+interface SkipLinkArgs {\n+  targetId: string;\n+  children: string;\n+}\n+\n+// Interactive story with controls\n+export const InteractiveSkipLink = (args: SkipLinkArgs) => (\n+  <div>\n+    <SkipLink {...args} />\n+    <p style={{ marginTop: 20, color: '#666' }}>\n+      Press Tab to see the skip link appear at the top of the viewport.\n+    </p>\n+    <div id={args.targetId} style={{ marginTop: 40, padding: 20, background: '#f0f0f0' }}>\n+      <h2>Target Content</h2>\n+      <p>This is the target element that will receive focus when the skip link is activated.</p>\n+    </div>\n+  </div>\n+);\n+\n+InteractiveSkipLink.args = {\n+  targetId: 'main-content',\n+  children: 'Skip to main content',\n+};\n+\n+InteractiveSkipLink.argTypes = {\n+  targetId: {\n+    control: 'text',\n+    description: 'ID of the target element to focus when activated',\n+    table: {\n+      defaultValue: { summary: 'main-content' },\n+    },\n+  },\n+  children: {\n+    control: 'text',\n+    description: 'The text displayed in the skip link',\n+    table: {\n+      defaultValue: { summary: 'Skip to main content' },\n+    },\n+  },\n+};\n+\n+// Full page demo showing realistic usage\n+export const FullPageDemo = () => (\n+  <div style={{ minHeight: '100vh' }}>\n+    <SkipLink targetId=\"main-content\" />\n+\n+    <header style={{ padding: 20, background: '#f8f8f8', borderBottom: '1px solid #ddd' }}>\n+      <nav>\n+        <a href=\"#\" style={{ marginRight: 16 }}>\n+          Home\n+        </a>\n+        <a href=\"#\" style={{ marginRight: 16 }}>\n+          Dashboards\n+        </a>\n+        <a href=\"#\" style={{ marginRight: 16 }}>\n+          Charts\n+        </a>\n+        <a href=\"#\" style={{ marginRight: 16 }}>\n+          SQL Lab\n+        </a>\n+        <a href=\"#\">Settings</a>\n+      </nav>\n+    </header>\n+\n+    <main\n+      id=\"main-content\"\n+      tabIndex={-1}\n+      style={{ padding: 40, outline: 'none' }}\n+    >\n+      <h1>Main Content Area</h1>\n+      <p>\n+        Press <kbd>Tab</kbd> to see the skip link appear. Click it or press{' '}\n+        <kbd>Enter</kbd> to jump directly here, bypassing the navigation links above.\n+      </p>\n+      <p>\n+        This is essential for keyboard users who would otherwise need to tab through all\n+        navigation items on every page load.\n+      </p>\n+    </main>\n+  </div>\n+);\n+\n+FullPageDemo.parameters = {\n+  docs: {\n+    description: {\n+      story:\n+        'Full page demonstration showing the skip link in a realistic layout. ' +\n+        'Press Tab to reveal the skip link, then activate it to jump to main content.',\n+    },\n+  },\n+};\n+\n+// Custom text demo\n+export const CustomText = () => (\n+  <div>\n+    <SkipLink targetId=\"content\">Direkt zum Inhalt springen</SkipLink>\n+    <p style={{ marginTop: 20, color: '#666' }}>\n+      Skip links can be internationalized with custom text.\n+    </p>\n+    <div id=\"content\" style={{ marginTop: 40, padding: 20, background: '#e8f4f8' }}>\n+      <h2>Inhalt</h2>\n+      <p>Der Hauptinhalt der Seite.</p>\n+    </div>\n+  </div>\n+);\n+\n+CustomText.parameters = {\n+  docs: {\n+    description: {\n+      story: 'Skip link with custom internationalized text (German example).',\n+    },\n+  },\n+};\n+\n+// Multiple skip links\n+export const MultipleSkipLinks = () => (\n+  <div>\n+    <div style={{ position: 'relative' }}>\n+      <SkipLink targetId=\"nav\">Skip to navigation</SkipLink>\n+    </div>\n+    <div style={{ position: 'relative' }}>\n+      <SkipLink targetId=\"main\">Skip to main content</SkipLink>\n+    </div>\n+    <div style={{ position: 'relative' }}>\n+      <SkipLink targetId=\"footer\">Skip to footer</SkipLink>\n+    </div>\n+\n+    <p style={{ marginTop: 20, color: '#666' }}>\n+      Press Tab multiple times to cycle through all skip links.\n+    </p>\n+\n+    <nav id=\"nav\" tabIndex={-1} style={{ marginTop: 40, padding: 20, background: '#fff3cd' }}>\n+      <h2>Navigation</h2>\n+      <ul>\n+        <li>\n+          <a href=\"#\">Link 1</a>\n+        </li>\n+        <li>\n+          <a href=\"#\">Link 2</a>\n+        </li>\n+      </ul>\n+    </nav>\n+\n+    <main id=\"main\" tabIndex={-1} style={{ padding: 20, background: '#d4edda' }}>\n+      <h2>Main Content</h2>\n+      <p>The primary content of the page.</p>\n+    </main>\n+\n+    <footer id=\"footer\" tabIndex={-1} style={{ padding: 20, background: '#d1ecf1' }}>\n+      <h2>Footer</h2>\n+      <p>Footer information and links.</p>\n+    </footer>\n+  </div>\n+);\n+\n+MultipleSkipLinks.parameters = {\n+  docs: {\n+    description: {\n+      story:\n+        'Multiple skip links for complex page layouts with distinct sections. ' +\n+        'Users can choose which section to jump to.',\n+    },\n+  },\n+};\n+\n+// Accessibility testing story\n+export const AccessibilityTest = () => (\n+  <div>\n+    <SkipLink targetId=\"test-content\" data-testid=\"skip-link\">\n+      Skip to test content\n+    </SkipLink>\n+\n+    <div style={{ marginTop: 20 }}>\n+      <h2>Accessibility Checklist</h2>\n+      <ul>\n+        <li>Link is hidden until focused (check by tabbing)</li>\n+        <li>Link has correct href attribute (#test-content)</li>\n+        <li>Link text provides clear description</li>\n+        <li>Focus indicator is visible (3px outline)</li>\n+        <li>Target element receives focus on activation</li>\n+        <li>Works with screen readers</li>\n+      </ul>\n+    </div>\n+\n+    <div\n+      id=\"test-content\"\n+      tabIndex={-1}\n+      style={{ marginTop: 40, padding: 20, background: '#f0f0f0' }}\n+    >\n+      <h2>Target Content</h2>\n+      <p>This element should receive focus when the skip link is activated.</p>\n+    </div>\n+  </div>\n+);\n+\n+AccessibilityTest.parameters = {\n+  docs: {\n+    description: {\n+      story:\n+        'Test story for verifying accessibility requirements. ' +\n+        'Use browser dev tools and screen readers to verify compliance.',\n+    },\n+  },\n+};", "pull_request_number": 37211}
{"sha": "e88420e9f193415ea7c4fce6ea19bfb11658952b", "filename": "superset-frontend/src/components/Accessibility/SkipLink.test.tsx", "status": "added", "additions": 345, "deletions": 0, "changes": 345, "blob_url": "https://github.com/apache/superset/blob/b53eeab7839d979c203ad2ea82e4fc94c6998850/superset-frontend%2Fsrc%2Fcomponents%2FAccessibility%2FSkipLink.test.tsx", "raw_url": "https://github.com/apache/superset/raw/b53eeab7839d979c203ad2ea82e4fc94c6998850/superset-frontend%2Fsrc%2Fcomponents%2FAccessibility%2FSkipLink.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fcomponents%2FAccessibility%2FSkipLink.test.tsx?ref=b53eeab7839d979c203ad2ea82e4fc94c6998850", "patch": "@@ -0,0 +1,345 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import userEvent from '@testing-library/user-event';\n+import { render, screen, waitFor } from 'spec/helpers/testing-library';\n+import SkipLink from './SkipLink';\n+\n+describe('SkipLink', () => {\n+  beforeEach(() => {\n+    // Clean up any target elements from previous tests\n+    const existingTarget = document.getElementById('main-content');\n+    if (existingTarget) {\n+      existingTarget.remove();\n+    }\n+  });\n+\n+  describe('Rendering', () => {\n+    test('renders with default \"Skip to main content\" text', () => {\n+      render(<SkipLink />);\n+      expect(screen.getByText('Skip to main content')).toBeInTheDocument();\n+    });\n+\n+    test('renders with custom children text', () => {\n+      render(<SkipLink>Skip to navigation</SkipLink>);\n+      expect(screen.getByText('Skip to navigation')).toBeInTheDocument();\n+    });\n+\n+    test('renders as anchor element with correct href', () => {\n+      render(<SkipLink targetId=\"custom-target\" />);\n+      const link = screen.getByRole('link');\n+      expect(link).toHaveAttribute('href', '#custom-target');\n+    });\n+\n+    test('applies styled-component class', () => {\n+      render(<SkipLink />);\n+      const link = screen.getByRole('link');\n+      expect(link).toHaveClass('a11y-skip-link');\n+    });\n+  });\n+\n+  describe('Visual States', () => {\n+    test('is positioned off-screen by default (top: -100px)', () => {\n+      render(<SkipLink />);\n+      const link = screen.getByRole('link');\n+      expect(link).toHaveStyleRule('top', '-100px');\n+    });\n+\n+    test('has correct z-index for overlay (10000)', () => {\n+      render(<SkipLink />);\n+      const link = screen.getByRole('link');\n+      expect(link).toHaveStyleRule('z-index', '10000');\n+    });\n+\n+    test('has absolute positioning', () => {\n+      render(<SkipLink />);\n+      const link = screen.getByRole('link');\n+      expect(link).toHaveStyleRule('position', 'absolute');\n+    });\n+  });\n+\n+  describe('Focus Behavior', () => {\n+    test('becomes visible when focused (top: 0)', async () => {\n+      render(<SkipLink />);\n+      const link = screen.getByRole('link');\n+      link.focus();\n+      expect(link).toHaveStyleRule('top', '0 !important', {\n+        modifier: ':focus',\n+      });\n+    });\n+\n+    test('receives focus on Tab key press', async () => {\n+      const user = userEvent.setup();\n+      render(<SkipLink />);\n+      await user.tab();\n+      const link = screen.getByRole('link');\n+      expect(link).toHaveFocus();\n+    });\n+\n+    test('shows focus outline styling', () => {\n+      render(<SkipLink />);\n+      const link = screen.getByRole('link');\n+      expect(link).toHaveStyleRule('outline', expect.stringContaining('3px solid'), {\n+        modifier: ':focus',\n+      });\n+    });\n+\n+    test('shows focus-visible outline styling', () => {\n+      render(<SkipLink />);\n+      const link = screen.getByRole('link');\n+      expect(link).toHaveStyleRule('top', '0 !important', {\n+        modifier: ':focus-visible',\n+      });\n+    });\n+  });\n+\n+  describe('Keyboard Navigation', () => {\n+    test('activates on Enter key press', async () => {\n+      const user = userEvent.setup();\n+      const targetElement = document.createElement('main');\n+      targetElement.id = 'main-content';\n+      document.body.appendChild(targetElement);\n+\n+      render(<SkipLink />);\n+      await user.tab();\n+      await user.keyboard('{Enter}');\n+\n+      await waitFor(() => {\n+        expect(targetElement).toHaveFocus();\n+      });\n+\n+      targetElement.remove();\n+    });\n+\n+    test('activates on click', async () => {\n+      const user = userEvent.setup();\n+      const targetElement = document.createElement('main');\n+      targetElement.id = 'main-content';\n+      document.body.appendChild(targetElement);\n+\n+      render(<SkipLink />);\n+      await user.click(screen.getByRole('link'));\n+\n+      await waitFor(() => {\n+        expect(targetElement).toHaveFocus();\n+      });\n+\n+      targetElement.remove();\n+    });\n+  });\n+\n+  describe('Click Handler', () => {\n+    test('prevents default anchor behavior', async () => {\n+      const user = userEvent.setup();\n+      const targetElement = document.createElement('main');\n+      targetElement.id = 'main-content';\n+      document.body.appendChild(targetElement);\n+\n+      render(<SkipLink />);\n+      const link = screen.getByRole('link');\n+\n+      const clickEvent = new MouseEvent('click', { bubbles: true });\n+      const preventDefaultSpy = jest.spyOn(clickEvent, 'preventDefault');\n+\n+      link.dispatchEvent(clickEvent);\n+      expect(preventDefaultSpy).toHaveBeenCalled();\n+\n+      targetElement.remove();\n+    });\n+\n+    test('finds target element by ID', async () => {\n+      const user = userEvent.setup();\n+      const targetElement = document.createElement('main');\n+      targetElement.id = 'custom-target';\n+      document.body.appendChild(targetElement);\n+\n+      render(<SkipLink targetId=\"custom-target\" />);\n+      await user.click(screen.getByRole('link'));\n+\n+      await waitFor(() => {\n+        expect(targetElement).toHaveFocus();\n+      });\n+\n+      targetElement.remove();\n+    });\n+\n+    test('focuses target element on click', async () => {\n+      const user = userEvent.setup();\n+      const targetElement = document.createElement('div');\n+      targetElement.id = 'main-content';\n+      document.body.appendChild(targetElement);\n+\n+      render(<SkipLink />);\n+      await user.click(screen.getByRole('link'));\n+\n+      await waitFor(() => {\n+        expect(targetElement).toHaveFocus();\n+      });\n+\n+      targetElement.remove();\n+    });\n+\n+    test('adds tabindex=\"-1\" to non-focusable targets', async () => {\n+      const user = userEvent.setup();\n+      const targetElement = document.createElement('div');\n+      targetElement.id = 'main-content';\n+      document.body.appendChild(targetElement);\n+\n+      expect(targetElement).not.toHaveAttribute('tabindex');\n+\n+      render(<SkipLink />);\n+      await user.click(screen.getByRole('link'));\n+\n+      await waitFor(() => {\n+        expect(targetElement).toHaveAttribute('tabindex', '-1');\n+      });\n+\n+      targetElement.remove();\n+    });\n+\n+    test('does not add tabindex if already present', async () => {\n+      const user = userEvent.setup();\n+      const targetElement = document.createElement('div');\n+      targetElement.id = 'main-content';\n+      targetElement.setAttribute('tabindex', '0');\n+      document.body.appendChild(targetElement);\n+\n+      render(<SkipLink />);\n+      await user.click(screen.getByRole('link'));\n+\n+      await waitFor(() => {\n+        expect(targetElement).toHaveAttribute('tabindex', '0');\n+      });\n+\n+      targetElement.remove();\n+    });\n+\n+    test('handles missing target element gracefully', async () => {\n+      const user = userEvent.setup();\n+      const originalHash = window.location.hash;\n+\n+      render(<SkipLink targetId=\"non-existent\" />);\n+\n+      // Should not throw an error\n+      await expect(user.click(screen.getByRole('link'))).resolves.not.toThrow();\n+\n+      // Cleanup\n+      window.location.hash = originalHash;\n+    });\n+\n+    test('falls back to hash navigation when target missing', async () => {\n+      const user = userEvent.setup();\n+\n+      render(<SkipLink targetId=\"non-existent\" />);\n+      await user.click(screen.getByRole('link'));\n+\n+      expect(window.location.hash).toBe('#non-existent');\n+\n+      // Cleanup\n+      window.location.hash = '';\n+    });\n+  });\n+\n+  describe('Props', () => {\n+    test('uses default targetId \"main-content\"', () => {\n+      render(<SkipLink />);\n+      const link = screen.getByRole('link');\n+      expect(link).toHaveAttribute('href', '#main-content');\n+    });\n+\n+    test('accepts custom targetId prop', () => {\n+      render(<SkipLink targetId=\"sidebar\" />);\n+      const link = screen.getByRole('link');\n+      expect(link).toHaveAttribute('href', '#sidebar');\n+    });\n+\n+    test('passes through additional props', () => {\n+      render(<SkipLink data-testid=\"custom-skip-link\" />);\n+      expect(screen.getByTestId('custom-skip-link')).toBeInTheDocument();\n+    });\n+  });\n+\n+  describe('Accessibility', () => {\n+    test('has accessible name from children', () => {\n+      render(<SkipLink>Skip navigation</SkipLink>);\n+      const link = screen.getByRole('link', { name: 'Skip navigation' });\n+      expect(link).toBeInTheDocument();\n+    });\n+\n+    test('is discoverable by screen readers', () => {\n+      render(<SkipLink />);\n+      const link = screen.getByRole('link');\n+      expect(link).toBeInTheDocument();\n+      expect(link).not.toHaveAttribute('aria-hidden');\n+    });\n+\n+    test('href matches targetId for fallback', () => {\n+      render(<SkipLink targetId=\"content-area\" />);\n+      const link = screen.getByRole('link');\n+      expect(link.getAttribute('href')).toBe('#content-area');\n+    });\n+  });\n+\n+  describe('Edge Cases', () => {\n+    test('handles empty targetId', () => {\n+      render(<SkipLink targetId=\"\" />);\n+      const link = screen.getByRole('link');\n+      expect(link).toHaveAttribute('href', '#');\n+    });\n+\n+    test('handles special characters in targetId', () => {\n+      render(<SkipLink targetId=\"main_content-area\" />);\n+      const link = screen.getByRole('link');\n+      expect(link).toHaveAttribute('href', '#main_content-area');\n+    });\n+\n+    test('handles multiple SkipLinks on page', () => {\n+      render(\n+        <>\n+          <SkipLink targetId=\"nav\">Skip to navigation</SkipLink>\n+          <SkipLink targetId=\"main\">Skip to main content</SkipLink>\n+          <SkipLink targetId=\"footer\">Skip to footer</SkipLink>\n+        </>,\n+      );\n+\n+      expect(screen.getByText('Skip to navigation')).toBeInTheDocument();\n+      expect(screen.getByText('Skip to main content')).toBeInTheDocument();\n+      expect(screen.getByText('Skip to footer')).toBeInTheDocument();\n+    });\n+\n+    test('works with dynamically added target elements', async () => {\n+      const user = userEvent.setup();\n+\n+      render(<SkipLink targetId=\"dynamic-target\" />);\n+\n+      // Add target after component renders\n+      const targetElement = document.createElement('div');\n+      targetElement.id = 'dynamic-target';\n+      document.body.appendChild(targetElement);\n+\n+      await user.click(screen.getByRole('link'));\n+\n+      await waitFor(() => {\n+        expect(targetElement).toHaveFocus();\n+      });\n+\n+      targetElement.remove();\n+    });\n+  });\n+});", "pull_request_number": 37211}
{"sha": "9a1f84a3bec86e2508dac3f5b2bc986038093827", "filename": "superset-frontend/src/components/Accessibility/SkipLink.tsx", "status": "added", "additions": 91, "deletions": 0, "changes": 91, "blob_url": "https://github.com/apache/superset/blob/b53eeab7839d979c203ad2ea82e4fc94c6998850/superset-frontend%2Fsrc%2Fcomponents%2FAccessibility%2FSkipLink.tsx", "raw_url": "https://github.com/apache/superset/raw/b53eeab7839d979c203ad2ea82e4fc94c6998850/superset-frontend%2Fsrc%2Fcomponents%2FAccessibility%2FSkipLink.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fcomponents%2FAccessibility%2FSkipLink.tsx?ref=b53eeab7839d979c203ad2ea82e4fc94c6998850", "patch": "@@ -0,0 +1,91 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import React from 'react';\n+import { styled } from '@superset-ui/core';\n+\n+/**\n+ * SkipLink - WCAG 2.4.1 Bypass Blocks\n+ * Allows keyboard users to skip navigation and jump directly to main content.\n+ * The link is visually hidden but becomes visible when focused.\n+ */\n+\n+const StyledSkipLink = styled.a`\n+  position: absolute;\n+  top: -100px;\n+  left: 0;\n+  background: ${({ theme }) => theme.colors.primary.dark1};\n+  color: ${({ theme }) => theme.colors.grayscale.light5};\n+  padding: ${({ theme }) => theme.gridUnit * 3}px ${({ theme }) => theme.gridUnit * 4}px;\n+  z-index: 10000;\n+  text-decoration: none;\n+  font-weight: ${({ theme }) => theme.typography.weights.bold};\n+  font-size: ${({ theme }) => theme.typography.sizes.m}px;\n+  border-radius: 0 0 ${({ theme }) => theme.borderRadius}px ${({ theme }) => theme.borderRadius}px;\n+  transition: top 0.2s ease-in-out;\n+\n+  &:focus,\n+  &:focus-visible {\n+    top: 0 !important;\n+    outline: 3px solid ${({ theme }) => theme.colors.primary.light1};\n+    outline-offset: 2px;\n+  }\n+\n+  &:hover {\n+    background: ${({ theme }) => theme.colors.primary.base};\n+  }\n+`;\n+\n+interface SkipLinkProps {\n+  targetId?: string;\n+  children?: React.ReactNode;\n+}\n+\n+const SkipLink: React.FC<SkipLinkProps> = ({\n+  targetId = 'main-content',\n+  children = 'Skip to main content',\n+}) => {\n+  const handleClick = (e: React.MouseEvent<HTMLAnchorElement>) => {\n+    e.preventDefault();\n+    const el = document.getElementById(targetId);\n+    if (el) {\n+      // Make sure the element is focusable and focus it\n+      // Note: We intentionally keep the tabindex to ensure the element remains focusable\n+      // for subsequent keyboard navigation (fixes skip link accessibility)\n+      if (!el.hasAttribute('tabindex')) {\n+        el.setAttribute('tabindex', '-1');\n+      }\n+      el.focus();\n+    } else {\n+      // Fallback to fragment navigation if target not present\n+      window.location.hash = `#${targetId}`;\n+    }\n+  };\n+\n+  return (\n+    <StyledSkipLink\n+      href={`#${targetId}`}\n+      className=\"a11y-skip-link\"\n+      onClick={handleClick}\n+    >\n+      {children}\n+    </StyledSkipLink>\n+  );\n+};\n+\n+export default SkipLink;", "pull_request_number": 37211}
{"sha": "099110d315c79e21d10ca4dcc1c128f5ce154748", "filename": "superset-frontend/src/components/Accessibility/StatusAnnouncer.stories.tsx", "status": "added", "additions": 470, "deletions": 0, "changes": 470, "blob_url": "https://github.com/apache/superset/blob/b53eeab7839d979c203ad2ea82e4fc94c6998850/superset-frontend%2Fsrc%2Fcomponents%2FAccessibility%2FStatusAnnouncer.stories.tsx", "raw_url": "https://github.com/apache/superset/raw/b53eeab7839d979c203ad2ea82e4fc94c6998850/superset-frontend%2Fsrc%2Fcomponents%2FAccessibility%2FStatusAnnouncer.stories.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fcomponents%2FAccessibility%2FStatusAnnouncer.stories.tsx?ref=b53eeab7839d979c203ad2ea82e4fc94c6998850", "patch": "@@ -0,0 +1,470 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import { useState } from 'react';\n+import { StatusAnnouncerProvider, useAnnouncer } from './StatusAnnouncer';\n+\n+export default {\n+  title: 'Components/Accessibility/StatusAnnouncer',\n+  component: StatusAnnouncerProvider,\n+  parameters: {\n+    docs: {\n+      description: {\n+        component:\n+          'WCAG 4.1.3 Status Messages - ARIA live regions for screen reader announcements. ' +\n+          'Provides polite announcements for non-urgent updates and assertive announcements for urgent messages. ' +\n+          'Enable a screen reader (VoiceOver, NVDA, JAWS) to hear the announcements.',\n+      },\n+    },\n+  },\n+};\n+\n+// Helper component for demos\n+const AnnouncerButtons = () => {\n+  const { announcePolite, announceAssertive } = useAnnouncer();\n+  const [lastAction, setLastAction] = useState<string>('');\n+\n+  const handlePolite = (message: string) => {\n+    announcePolite(message);\n+    setLastAction(`Polite: \"${message}\"`);\n+  };\n+\n+  const handleAssertive = (message: string) => {\n+    announceAssertive(message);\n+    setLastAction(`Assertive: \"${message}\"`);\n+  };\n+\n+  return (\n+    <div>\n+      <div style={{ marginBottom: 24 }}>\n+        <h3 style={{ marginBottom: 12 }}>Polite Announcements (non-urgent)</h3>\n+        <div style={{ display: 'flex', gap: 8, flexWrap: 'wrap' }}>\n+          <button type=\"button\" onClick={() => handlePolite('Loading data...')}>\n+            Loading\n+          </button>\n+          <button type=\"button\" onClick={() => handlePolite('3 items selected')}>\n+            Selection\n+          </button>\n+          <button type=\"button\" onClick={() => handlePolite('Changes saved successfully')}>\n+            Save Success\n+          </button>\n+          <button type=\"button\" onClick={() => handlePolite('Filter applied: Last 7 days')}>\n+            Filter Applied\n+          </button>\n+        </div>\n+      </div>\n+\n+      <div style={{ marginBottom: 24 }}>\n+        <h3 style={{ marginBottom: 12 }}>Assertive Announcements (urgent)</h3>\n+        <div style={{ display: 'flex', gap: 8, flexWrap: 'wrap' }}>\n+          <button\n+            type=\"button\"\n+            onClick={() => handleAssertive('Error: Connection failed')}\n+            style={{ background: '#dc3545', color: 'white', border: 'none', padding: '8px 16px' }}\n+          >\n+            Error\n+          </button>\n+          <button\n+            type=\"button\"\n+            onClick={() => handleAssertive('Warning: Session expires in 1 minute')}\n+            style={{ background: '#ffc107', border: 'none', padding: '8px 16px' }}\n+          >\n+            Warning\n+          </button>\n+          <button\n+            type=\"button\"\n+            onClick={() => handleAssertive('Critical: Database connection lost')}\n+            style={{ background: '#dc3545', color: 'white', border: 'none', padding: '8px 16px' }}\n+          >\n+            Critical\n+          </button>\n+        </div>\n+      </div>\n+\n+      {lastAction && (\n+        <div\n+          style={{\n+            marginTop: 16,\n+            padding: 12,\n+            background: '#e9ecef',\n+            borderRadius: 4,\n+            fontFamily: 'monospace',\n+          }}\n+        >\n+          Last announcement: {lastAction}\n+        </div>\n+      )}\n+\n+      <p style={{ marginTop: 24, color: '#666', fontSize: 14 }}>\n+        Enable a screen reader to hear these announcements. Polite announcements wait for the\n+        current speech to finish, while assertive announcements interrupt immediately.\n+      </p>\n+    </div>\n+  );\n+};\n+\n+// Interactive demo\n+export const InteractiveDemo = () => (\n+  <StatusAnnouncerProvider>\n+    <AnnouncerButtons />\n+  </StatusAnnouncerProvider>\n+);\n+\n+InteractiveDemo.parameters = {\n+  docs: {\n+    description: {\n+      story:\n+        'Interactive demo showing both polite and assertive announcements. ' +\n+        'Enable a screen reader to hear the announcements when buttons are clicked.',\n+    },\n+  },\n+};\n+\n+// Real-world usage example\n+const RealWorldComponent = () => {\n+  const [loading, setLoading] = useState(false);\n+  const [status, setStatus] = useState<'idle' | 'success' | 'error'>('idle');\n+  const { announcePolite, announceAssertive } = useAnnouncer();\n+\n+  const handleSave = async () => {\n+    setLoading(true);\n+    setStatus('idle');\n+    announcePolite('Saving changes...');\n+\n+    // Simulate API call\n+    await new Promise(resolve => setTimeout(resolve, 1500));\n+\n+    // Randomly succeed or fail for demo\n+    if (Math.random() > 0.3) {\n+      setStatus('success');\n+      announcePolite('Changes saved successfully');\n+    } else {\n+      setStatus('error');\n+      announceAssertive('Error: Failed to save changes. Please try again.');\n+    }\n+    setLoading(false);\n+  };\n+\n+  const handleLoad = async () => {\n+    setLoading(true);\n+    announcePolite('Loading dashboard data...');\n+\n+    await new Promise(resolve => setTimeout(resolve, 2000));\n+\n+    announcePolite('Dashboard loaded. 5 charts, 3 filters available.');\n+    setLoading(false);\n+  };\n+\n+  return (\n+    <div>\n+      <h3>Dashboard Editor</h3>\n+\n+      <div style={{ display: 'flex', gap: 12, marginTop: 16 }}>\n+        <button type=\"button\" onClick={handleSave} disabled={loading}>\n+          {loading ? 'Processing...' : 'Save Dashboard'}\n+        </button>\n+        <button type=\"button\" onClick={handleLoad} disabled={loading}>\n+          {loading ? 'Processing...' : 'Load Dashboard'}\n+        </button>\n+      </div>\n+\n+      {status === 'success' && (\n+        <div\n+          style={{\n+            marginTop: 16,\n+            padding: 12,\n+            background: '#d4edda',\n+            color: '#155724',\n+            borderRadius: 4,\n+          }}\n+        >\n+          Changes saved successfully!\n+        </div>\n+      )}\n+\n+      {status === 'error' && (\n+        <div\n+          style={{\n+            marginTop: 16,\n+            padding: 12,\n+            background: '#f8d7da',\n+            color: '#721c24',\n+            borderRadius: 4,\n+          }}\n+        >\n+          Failed to save changes. Please try again.\n+        </div>\n+      )}\n+\n+      <p style={{ marginTop: 24, color: '#666', fontSize: 14 }}>\n+        This example simulates real-world usage with loading states, success, and error scenarios.\n+        Screen reader users will hear status updates without visual feedback.\n+      </p>\n+    </div>\n+  );\n+};\n+\n+export const RealWorldExample = () => (\n+  <StatusAnnouncerProvider>\n+    <RealWorldComponent />\n+  </StatusAnnouncerProvider>\n+);\n+\n+RealWorldExample.parameters = {\n+  docs: {\n+    description: {\n+      story:\n+        'Real-world example showing how the announcer integrates with async operations. ' +\n+        'Demonstrates loading states, success messages, and error handling with appropriate announcement types.',\n+    },\n+  },\n+};\n+\n+// Chart interaction example\n+const ChartInteractionComponent = () => {\n+  const { announcePolite } = useAnnouncer();\n+  const [selectedPoints, setSelectedPoints] = useState(0);\n+\n+  const handleChartClick = () => {\n+    const newCount = selectedPoints + 1;\n+    setSelectedPoints(newCount);\n+    announcePolite(`${newCount} data point${newCount !== 1 ? 's' : ''} selected`);\n+  };\n+\n+  const handleClearSelection = () => {\n+    setSelectedPoints(0);\n+    announcePolite('Selection cleared');\n+  };\n+\n+  return (\n+    <div>\n+      <h3>Chart Interaction Demo</h3>\n+\n+      <div\n+        onClick={handleChartClick}\n+        onKeyDown={e => e.key === 'Enter' && handleChartClick()}\n+        role=\"button\"\n+        tabIndex={0}\n+        style={{\n+          width: 300,\n+          height: 200,\n+          background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',\n+          borderRadius: 8,\n+          display: 'flex',\n+          alignItems: 'center',\n+          justifyContent: 'center',\n+          color: 'white',\n+          cursor: 'pointer',\n+          marginTop: 16,\n+        }}\n+      >\n+        <div style={{ textAlign: 'center' }}>\n+          <div style={{ fontSize: 36, fontWeight: 'bold' }}>{selectedPoints}</div>\n+          <div>Click to select data points</div>\n+        </div>\n+      </div>\n+\n+      <button\n+        type=\"button\"\n+        onClick={handleClearSelection}\n+        style={{ marginTop: 16 }}\n+        disabled={selectedPoints === 0}\n+      >\n+        Clear Selection\n+      </button>\n+\n+      <p style={{ marginTop: 24, color: '#666', fontSize: 14 }}>\n+        Click the chart area to simulate selecting data points. Screen reader users will hear\n+        selection count updates.\n+      </p>\n+    </div>\n+  );\n+};\n+\n+export const ChartInteraction = () => (\n+  <StatusAnnouncerProvider>\n+    <ChartInteractionComponent />\n+  </StatusAnnouncerProvider>\n+);\n+\n+ChartInteraction.parameters = {\n+  docs: {\n+    description: {\n+      story:\n+        'Demonstrates announcing chart interactions. ' +\n+        'Selection changes are announced to screen reader users.',\n+    },\n+  },\n+};\n+\n+// Filter updates example\n+const FilterUpdatesComponent = () => {\n+  const { announcePolite } = useAnnouncer();\n+  const [filters, setFilters] = useState<string[]>([]);\n+\n+  const availableFilters = ['Last 7 days', 'Last 30 days', 'This year', 'All time'];\n+\n+  const toggleFilter = (filter: string) => {\n+    if (filters.includes(filter)) {\n+      const newFilters = filters.filter(f => f !== filter);\n+      setFilters(newFilters);\n+      announcePolite(`Filter removed: ${filter}. ${newFilters.length} filter${newFilters.length !== 1 ? 's' : ''} active.`);\n+    } else {\n+      const newFilters = [...filters, filter];\n+      setFilters(newFilters);\n+      announcePolite(`Filter applied: ${filter}. ${newFilters.length} filter${newFilters.length !== 1 ? 's' : ''} active.`);\n+    }\n+  };\n+\n+  return (\n+    <div>\n+      <h3>Filter Panel</h3>\n+\n+      <div style={{ display: 'flex', gap: 8, flexWrap: 'wrap', marginTop: 16 }}>\n+        {availableFilters.map(filter => (\n+          <button\n+            key={filter}\n+            type=\"button\"\n+            onClick={() => toggleFilter(filter)}\n+            style={{\n+              padding: '8px 16px',\n+              background: filters.includes(filter) ? '#007bff' : '#e9ecef',\n+              color: filters.includes(filter) ? 'white' : 'black',\n+              border: 'none',\n+              borderRadius: 20,\n+              cursor: 'pointer',\n+            }}\n+          >\n+            {filter}\n+          </button>\n+        ))}\n+      </div>\n+\n+      <div style={{ marginTop: 16 }}>\n+        Active filters: {filters.length > 0 ? filters.join(', ') : 'None'}\n+      </div>\n+\n+      <p style={{ marginTop: 24, color: '#666', fontSize: 14 }}>\n+        Toggle filters to hear announcements about filter state changes.\n+      </p>\n+    </div>\n+  );\n+};\n+\n+export const FilterUpdates = () => (\n+  <StatusAnnouncerProvider>\n+    <FilterUpdatesComponent />\n+  </StatusAnnouncerProvider>\n+);\n+\n+FilterUpdates.parameters = {\n+  docs: {\n+    description: {\n+      story:\n+        'Shows how filter changes can be announced. ' +\n+        'Users are informed about active filters without needing to visually scan the UI.',\n+    },\n+  },\n+};\n+\n+// Technical demo showing live regions\n+export const LiveRegionInspector = () => {\n+  const { announcePolite, announceAssertive } = useAnnouncer();\n+  const [politeText, setPoliteText] = useState('');\n+  const [assertiveText, setAssertiveText] = useState('');\n+\n+  return (\n+    <StatusAnnouncerProvider>\n+      <div>\n+        <h3>Live Region Inspector</h3>\n+        <p style={{ marginBottom: 16 }}>\n+          This story shows the actual ARIA live regions. Use browser DevTools to inspect the\n+          visually hidden elements.\n+        </p>\n+\n+        <div style={{ display: 'flex', gap: 16, marginBottom: 24 }}>\n+          <div style={{ flex: 1 }}>\n+            <label htmlFor=\"polite-input\" style={{ display: 'block', marginBottom: 8 }}>\n+              Polite message:\n+            </label>\n+            <input\n+              id=\"polite-input\"\n+              type=\"text\"\n+              value={politeText}\n+              onChange={e => setPoliteText(e.target.value)}\n+              placeholder=\"Type a message...\"\n+              style={{ width: '100%', padding: 8 }}\n+            />\n+            <button\n+              type=\"button\"\n+              onClick={() => announcePolite(politeText)}\n+              style={{ marginTop: 8 }}\n+            >\n+              Announce Polite\n+            </button>\n+          </div>\n+\n+          <div style={{ flex: 1 }}>\n+            <label htmlFor=\"assertive-input\" style={{ display: 'block', marginBottom: 8 }}>\n+              Assertive message:\n+            </label>\n+            <input\n+              id=\"assertive-input\"\n+              type=\"text\"\n+              value={assertiveText}\n+              onChange={e => setAssertiveText(e.target.value)}\n+              placeholder=\"Type a message...\"\n+              style={{ width: '100%', padding: 8 }}\n+            />\n+            <button\n+              type=\"button\"\n+              onClick={() => announceAssertive(assertiveText)}\n+              style={{ marginTop: 8 }}\n+            >\n+              Announce Assertive\n+            </button>\n+          </div>\n+        </div>\n+\n+        <div style={{ background: '#f8f9fa', padding: 16, borderRadius: 4 }}>\n+          <h4>ARIA Live Regions (inspect with DevTools)</h4>\n+          <pre style={{ fontSize: 12 }}>\n+            {`<div id=\"a11y-status-announcer\" role=\"status\" aria-live=\"polite\" aria-atomic=\"true\">\n+  <!-- Polite messages appear here -->\n+</div>\n+\n+<div id=\"a11y-alert-announcer\" role=\"alert\" aria-live=\"assertive\" aria-atomic=\"true\">\n+  <!-- Assertive messages appear here -->\n+</div>`}\n+          </pre>\n+        </div>\n+      </div>\n+    </StatusAnnouncerProvider>\n+  );\n+};\n+\n+LiveRegionInspector.parameters = {\n+  docs: {\n+    description: {\n+      story:\n+        'Technical demo showing the ARIA live regions used by the announcer. ' +\n+        'Use browser DevTools to inspect the visually hidden elements at the bottom of the DOM.',\n+    },\n+  },\n+};", "pull_request_number": 37211}
{"sha": "9d000010e8fbb7becd92543cf437f65ddda9c14b", "filename": "superset-frontend/src/components/Accessibility/StatusAnnouncer.test.tsx", "status": "added", "additions": 657, "deletions": 0, "changes": 657, "blob_url": "https://github.com/apache/superset/blob/b53eeab7839d979c203ad2ea82e4fc94c6998850/superset-frontend%2Fsrc%2Fcomponents%2FAccessibility%2FStatusAnnouncer.test.tsx", "raw_url": "https://github.com/apache/superset/raw/b53eeab7839d979c203ad2ea82e4fc94c6998850/superset-frontend%2Fsrc%2Fcomponents%2FAccessibility%2FStatusAnnouncer.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fcomponents%2FAccessibility%2FStatusAnnouncer.test.tsx?ref=b53eeab7839d979c203ad2ea82e4fc94c6998850", "patch": "@@ -0,0 +1,657 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import { act, render, screen, waitFor } from 'spec/helpers/testing-library';\n+import { renderHook } from '@testing-library/react';\n+import { StatusAnnouncerProvider, useAnnouncer } from './StatusAnnouncer';\n+\n+// Helper component for testing announcer functions\n+const AnnouncerTestComponent = ({\n+  onMount,\n+}: {\n+  onMount?: (announcer: ReturnType<typeof useAnnouncer>) => void;\n+}) => {\n+  const announcer = useAnnouncer();\n+  if (onMount) {\n+    onMount(announcer);\n+  }\n+  return <div data-testid=\"test-component\">Test</div>;\n+};\n+\n+describe('StatusAnnouncerProvider', () => {\n+  beforeEach(() => {\n+    jest.useFakeTimers();\n+  });\n+\n+  afterEach(() => {\n+    jest.runOnlyPendingTimers();\n+    jest.useRealTimers();\n+  });\n+\n+  describe('Rendering', () => {\n+    test('renders children unchanged', () => {\n+      render(\n+        <StatusAnnouncerProvider>\n+          <div data-testid=\"child-content\">Child Content</div>\n+        </StatusAnnouncerProvider>,\n+      );\n+      expect(screen.getByTestId('child-content')).toBeInTheDocument();\n+      expect(screen.getByText('Child Content')).toBeInTheDocument();\n+    });\n+\n+    test('renders polite live region with role=\"status\"', () => {\n+      render(\n+        <StatusAnnouncerProvider>\n+          <div>Content</div>\n+        </StatusAnnouncerProvider>,\n+      );\n+      const politeRegion = document.getElementById('a11y-status-announcer');\n+      expect(politeRegion).toBeInTheDocument();\n+      expect(politeRegion).toHaveAttribute('role', 'status');\n+    });\n+\n+    test('renders assertive live region with role=\"alert\"', () => {\n+      render(\n+        <StatusAnnouncerProvider>\n+          <div>Content</div>\n+        </StatusAnnouncerProvider>,\n+      );\n+      const assertiveRegion = document.getElementById('a11y-alert-announcer');\n+      expect(assertiveRegion).toBeInTheDocument();\n+      expect(assertiveRegion).toHaveAttribute('role', 'alert');\n+    });\n+\n+    test('live regions are visually hidden', () => {\n+      render(\n+        <StatusAnnouncerProvider>\n+          <div>Content</div>\n+        </StatusAnnouncerProvider>,\n+      );\n+      const politeRegion = document.getElementById('a11y-status-announcer');\n+      expect(politeRegion).toHaveStyleRule('position', 'absolute');\n+      expect(politeRegion).toHaveStyleRule('width', '1px');\n+      expect(politeRegion).toHaveStyleRule('height', '1px');\n+      expect(politeRegion).toHaveStyleRule('overflow', 'hidden');\n+    });\n+\n+    test('live regions have correct IDs', () => {\n+      render(\n+        <StatusAnnouncerProvider>\n+          <div>Content</div>\n+        </StatusAnnouncerProvider>,\n+      );\n+      expect(document.getElementById('a11y-status-announcer')).toBeInTheDocument();\n+      expect(document.getElementById('a11y-alert-announcer')).toBeInTheDocument();\n+    });\n+  });\n+\n+  describe('ARIA Attributes', () => {\n+    test('polite region has aria-live=\"polite\"', () => {\n+      render(\n+        <StatusAnnouncerProvider>\n+          <div>Content</div>\n+        </StatusAnnouncerProvider>,\n+      );\n+      const politeRegion = document.getElementById('a11y-status-announcer');\n+      expect(politeRegion).toHaveAttribute('aria-live', 'polite');\n+    });\n+\n+    test('assertive region has aria-live=\"assertive\"', () => {\n+      render(\n+        <StatusAnnouncerProvider>\n+          <div>Content</div>\n+        </StatusAnnouncerProvider>,\n+      );\n+      const assertiveRegion = document.getElementById('a11y-alert-announcer');\n+      expect(assertiveRegion).toHaveAttribute('aria-live', 'assertive');\n+    });\n+\n+    test('both regions have aria-atomic=\"true\"', () => {\n+      render(\n+        <StatusAnnouncerProvider>\n+          <div>Content</div>\n+        </StatusAnnouncerProvider>,\n+      );\n+      const politeRegion = document.getElementById('a11y-status-announcer');\n+      const assertiveRegion = document.getElementById('a11y-alert-announcer');\n+      expect(politeRegion).toHaveAttribute('aria-atomic', 'true');\n+      expect(assertiveRegion).toHaveAttribute('aria-atomic', 'true');\n+    });\n+\n+    test('polite region has id=\"a11y-status-announcer\"', () => {\n+      render(\n+        <StatusAnnouncerProvider>\n+          <div>Content</div>\n+        </StatusAnnouncerProvider>,\n+      );\n+      const politeRegion = document.getElementById('a11y-status-announcer');\n+      expect(politeRegion).toHaveAttribute('id', 'a11y-status-announcer');\n+    });\n+\n+    test('assertive region has id=\"a11y-alert-announcer\"', () => {\n+      render(\n+        <StatusAnnouncerProvider>\n+          <div>Content</div>\n+        </StatusAnnouncerProvider>,\n+      );\n+      const assertiveRegion = document.getElementById('a11y-alert-announcer');\n+      expect(assertiveRegion).toHaveAttribute('id', 'a11y-alert-announcer');\n+    });\n+  });\n+\n+  describe('Polite Announcements', () => {\n+    test('announcePolite updates polite region text', async () => {\n+      let capturedAnnouncer: ReturnType<typeof useAnnouncer>;\n+\n+      render(\n+        <StatusAnnouncerProvider>\n+          <AnnouncerTestComponent\n+            onMount={announcer => {\n+              capturedAnnouncer = announcer;\n+            }}\n+          />\n+        </StatusAnnouncerProvider>,\n+      );\n+\n+      act(() => {\n+        capturedAnnouncer!.announcePolite('Loading data...');\n+        jest.advanceTimersByTime(150);\n+      });\n+\n+      const politeRegion = document.getElementById('a11y-status-announcer');\n+      expect(politeRegion).toHaveTextContent('Loading data...');\n+    });\n+\n+    test('polite announcement does not affect assertive region', async () => {\n+      let capturedAnnouncer: ReturnType<typeof useAnnouncer>;\n+\n+      render(\n+        <StatusAnnouncerProvider>\n+          <AnnouncerTestComponent\n+            onMount={announcer => {\n+              capturedAnnouncer = announcer;\n+            }}\n+          />\n+        </StatusAnnouncerProvider>,\n+      );\n+\n+      act(() => {\n+        capturedAnnouncer!.announcePolite('Status update');\n+        jest.advanceTimersByTime(150);\n+      });\n+\n+      const assertiveRegion = document.getElementById('a11y-alert-announcer');\n+      expect(assertiveRegion).toHaveTextContent('');\n+    });\n+\n+    test('clears message before re-announcing same text', async () => {\n+      let capturedAnnouncer: ReturnType<typeof useAnnouncer>;\n+\n+      render(\n+        <StatusAnnouncerProvider>\n+          <AnnouncerTestComponent\n+            onMount={announcer => {\n+              capturedAnnouncer = announcer;\n+            }}\n+          />\n+        </StatusAnnouncerProvider>,\n+      );\n+\n+      const politeRegion = document.getElementById('a11y-status-announcer');\n+\n+      // First announcement\n+      act(() => {\n+        capturedAnnouncer!.announcePolite('Same message');\n+        jest.advanceTimersByTime(150);\n+      });\n+      expect(politeRegion).toHaveTextContent('Same message');\n+\n+      // Second announcement with same text - should clear first\n+      act(() => {\n+        capturedAnnouncer!.announcePolite('Same message');\n+      });\n+      expect(politeRegion).toHaveTextContent('');\n+\n+      act(() => {\n+        jest.advanceTimersByTime(150);\n+      });\n+      expect(politeRegion).toHaveTextContent('Same message');\n+    });\n+\n+    test('handles empty string announcement', async () => {\n+      let capturedAnnouncer: ReturnType<typeof useAnnouncer>;\n+\n+      render(\n+        <StatusAnnouncerProvider>\n+          <AnnouncerTestComponent\n+            onMount={announcer => {\n+              capturedAnnouncer = announcer;\n+            }}\n+          />\n+        </StatusAnnouncerProvider>,\n+      );\n+\n+      act(() => {\n+        capturedAnnouncer!.announcePolite('');\n+        jest.advanceTimersByTime(150);\n+      });\n+\n+      const politeRegion = document.getElementById('a11y-status-announcer');\n+      expect(politeRegion).toHaveTextContent('');\n+    });\n+\n+    test('handles long text announcements', async () => {\n+      let capturedAnnouncer: ReturnType<typeof useAnnouncer>;\n+      const longText =\n+        'This is a very long announcement message that contains a lot of information about the current status of the application and should be read in its entirety by the screen reader.';\n+\n+      render(\n+        <StatusAnnouncerProvider>\n+          <AnnouncerTestComponent\n+            onMount={announcer => {\n+              capturedAnnouncer = announcer;\n+            }}\n+          />\n+        </StatusAnnouncerProvider>,\n+      );\n+\n+      act(() => {\n+        capturedAnnouncer!.announcePolite(longText);\n+        jest.advanceTimersByTime(150);\n+      });\n+\n+      const politeRegion = document.getElementById('a11y-status-announcer');\n+      expect(politeRegion).toHaveTextContent(longText);\n+    });\n+\n+    test('handles special characters in message', async () => {\n+      let capturedAnnouncer: ReturnType<typeof useAnnouncer>;\n+      const specialMessage = 'Status: 100% complete! <script>alert(\"test\")</script>';\n+\n+      render(\n+        <StatusAnnouncerProvider>\n+          <AnnouncerTestComponent\n+            onMount={announcer => {\n+              capturedAnnouncer = announcer;\n+            }}\n+          />\n+        </StatusAnnouncerProvider>,\n+      );\n+\n+      act(() => {\n+        capturedAnnouncer!.announcePolite(specialMessage);\n+        jest.advanceTimersByTime(150);\n+      });\n+\n+      const politeRegion = document.getElementById('a11y-status-announcer');\n+      expect(politeRegion).toHaveTextContent(specialMessage);\n+    });\n+  });\n+\n+  describe('Assertive Announcements', () => {\n+    test('announceAssertive updates assertive region text', async () => {\n+      let capturedAnnouncer: ReturnType<typeof useAnnouncer>;\n+\n+      render(\n+        <StatusAnnouncerProvider>\n+          <AnnouncerTestComponent\n+            onMount={announcer => {\n+              capturedAnnouncer = announcer;\n+            }}\n+          />\n+        </StatusAnnouncerProvider>,\n+      );\n+\n+      act(() => {\n+        capturedAnnouncer!.announceAssertive('Error: Connection failed');\n+        jest.advanceTimersByTime(150);\n+      });\n+\n+      const assertiveRegion = document.getElementById('a11y-alert-announcer');\n+      expect(assertiveRegion).toHaveTextContent('Error: Connection failed');\n+    });\n+\n+    test('assertive announcement does not affect polite region', async () => {\n+      let capturedAnnouncer: ReturnType<typeof useAnnouncer>;\n+\n+      render(\n+        <StatusAnnouncerProvider>\n+          <AnnouncerTestComponent\n+            onMount={announcer => {\n+              capturedAnnouncer = announcer;\n+            }}\n+          />\n+        </StatusAnnouncerProvider>,\n+      );\n+\n+      act(() => {\n+        capturedAnnouncer!.announceAssertive('Error occurred');\n+        jest.advanceTimersByTime(150);\n+      });\n+\n+      const politeRegion = document.getElementById('a11y-status-announcer');\n+      expect(politeRegion).toHaveTextContent('');\n+    });\n+\n+    test('clears message before re-announcing same text', async () => {\n+      let capturedAnnouncer: ReturnType<typeof useAnnouncer>;\n+\n+      render(\n+        <StatusAnnouncerProvider>\n+          <AnnouncerTestComponent\n+            onMount={announcer => {\n+              capturedAnnouncer = announcer;\n+            }}\n+          />\n+        </StatusAnnouncerProvider>,\n+      );\n+\n+      const assertiveRegion = document.getElementById('a11y-alert-announcer');\n+\n+      act(() => {\n+        capturedAnnouncer!.announceAssertive('Error!');\n+        jest.advanceTimersByTime(150);\n+      });\n+      expect(assertiveRegion).toHaveTextContent('Error!');\n+\n+      act(() => {\n+        capturedAnnouncer!.announceAssertive('Error!');\n+      });\n+      expect(assertiveRegion).toHaveTextContent('');\n+\n+      act(() => {\n+        jest.advanceTimersByTime(150);\n+      });\n+      expect(assertiveRegion).toHaveTextContent('Error!');\n+    });\n+\n+    test('handles empty string announcement', async () => {\n+      let capturedAnnouncer: ReturnType<typeof useAnnouncer>;\n+\n+      render(\n+        <StatusAnnouncerProvider>\n+          <AnnouncerTestComponent\n+            onMount={announcer => {\n+              capturedAnnouncer = announcer;\n+            }}\n+          />\n+        </StatusAnnouncerProvider>,\n+      );\n+\n+      act(() => {\n+        capturedAnnouncer!.announceAssertive('');\n+        jest.advanceTimersByTime(150);\n+      });\n+\n+      const assertiveRegion = document.getElementById('a11y-alert-announcer');\n+      expect(assertiveRegion).toHaveTextContent('');\n+    });\n+  });\n+\n+  describe('Timing Behavior', () => {\n+    test('clears message with 100ms delay before re-announcing', async () => {\n+      let capturedAnnouncer: ReturnType<typeof useAnnouncer>;\n+\n+      render(\n+        <StatusAnnouncerProvider>\n+          <AnnouncerTestComponent\n+            onMount={announcer => {\n+              capturedAnnouncer = announcer;\n+            }}\n+          />\n+        </StatusAnnouncerProvider>,\n+      );\n+\n+      const politeRegion = document.getElementById('a11y-status-announcer');\n+\n+      act(() => {\n+        capturedAnnouncer!.announcePolite('First message');\n+      });\n+\n+      // Message should be cleared immediately\n+      expect(politeRegion).toHaveTextContent('');\n+\n+      // After 50ms, still cleared\n+      act(() => {\n+        jest.advanceTimersByTime(50);\n+      });\n+      expect(politeRegion).toHaveTextContent('');\n+\n+      // After 100ms, message appears\n+      act(() => {\n+        jest.advanceTimersByTime(50);\n+      });\n+      expect(politeRegion).toHaveTextContent('First message');\n+    });\n+\n+    test('handles rapid successive announcements', async () => {\n+      let capturedAnnouncer: ReturnType<typeof useAnnouncer>;\n+\n+      render(\n+        <StatusAnnouncerProvider>\n+          <AnnouncerTestComponent\n+            onMount={announcer => {\n+              capturedAnnouncer = announcer;\n+            }}\n+          />\n+        </StatusAnnouncerProvider>,\n+      );\n+\n+      const politeRegion = document.getElementById('a11y-status-announcer');\n+\n+      act(() => {\n+        capturedAnnouncer!.announcePolite('Message 1');\n+        capturedAnnouncer!.announcePolite('Message 2');\n+        capturedAnnouncer!.announcePolite('Message 3');\n+        jest.advanceTimersByTime(150);\n+      });\n+\n+      // Last message should win\n+      expect(politeRegion).toHaveTextContent('Message 3');\n+    });\n+  });\n+\n+  describe('Multiple Providers', () => {\n+    test('nested providers work independently', () => {\n+      render(\n+        <StatusAnnouncerProvider>\n+          <div data-testid=\"outer\">\n+            <StatusAnnouncerProvider>\n+              <div data-testid=\"inner\">Inner Content</div>\n+            </StatusAnnouncerProvider>\n+          </div>\n+        </StatusAnnouncerProvider>,\n+      );\n+\n+      expect(screen.getByTestId('outer')).toBeInTheDocument();\n+      expect(screen.getByTestId('inner')).toBeInTheDocument();\n+    });\n+\n+    test('each provider has own state', async () => {\n+      let outerAnnouncer: ReturnType<typeof useAnnouncer>;\n+      let innerAnnouncer: ReturnType<typeof useAnnouncer>;\n+\n+      render(\n+        <StatusAnnouncerProvider>\n+          <AnnouncerTestComponent\n+            onMount={announcer => {\n+              outerAnnouncer = announcer;\n+            }}\n+          />\n+          <StatusAnnouncerProvider>\n+            <AnnouncerTestComponent\n+              onMount={announcer => {\n+                innerAnnouncer = announcer;\n+              }}\n+            />\n+          </StatusAnnouncerProvider>\n+        </StatusAnnouncerProvider>,\n+      );\n+\n+      // Both announcers should be available\n+      expect(outerAnnouncer!.announcePolite).toBeDefined();\n+      expect(innerAnnouncer!.announcePolite).toBeDefined();\n+    });\n+  });\n+});\n+\n+describe('useAnnouncer Hook', () => {\n+  beforeEach(() => {\n+    jest.useFakeTimers();\n+  });\n+\n+  afterEach(() => {\n+    jest.runOnlyPendingTimers();\n+    jest.useRealTimers();\n+  });\n+\n+  describe('Inside Provider', () => {\n+    test('returns announcePolite function', () => {\n+      const wrapper = ({ children }: { children: React.ReactNode }) => (\n+        <StatusAnnouncerProvider>{children}</StatusAnnouncerProvider>\n+      );\n+\n+      const { result } = renderHook(() => useAnnouncer(), { wrapper });\n+\n+      expect(result.current.announcePolite).toBeDefined();\n+      expect(typeof result.current.announcePolite).toBe('function');\n+    });\n+\n+    test('returns announceAssertive function', () => {\n+      const wrapper = ({ children }: { children: React.ReactNode }) => (\n+        <StatusAnnouncerProvider>{children}</StatusAnnouncerProvider>\n+      );\n+\n+      const { result } = renderHook(() => useAnnouncer(), { wrapper });\n+\n+      expect(result.current.announceAssertive).toBeDefined();\n+      expect(typeof result.current.announceAssertive).toBe('function');\n+    });\n+\n+    test('functions are stable references (memoized)', () => {\n+      const wrapper = ({ children }: { children: React.ReactNode }) => (\n+        <StatusAnnouncerProvider>{children}</StatusAnnouncerProvider>\n+      );\n+\n+      const { result, rerender } = renderHook(() => useAnnouncer(), { wrapper });\n+\n+      const firstPolite = result.current.announcePolite;\n+      const firstAssertive = result.current.announceAssertive;\n+\n+      rerender();\n+\n+      expect(result.current.announcePolite).toBe(firstPolite);\n+      expect(result.current.announceAssertive).toBe(firstAssertive);\n+    });\n+  });\n+\n+  describe('Outside Provider', () => {\n+    test('returns no-op announcePolite function', () => {\n+      const { result } = renderHook(() => useAnnouncer());\n+\n+      expect(result.current.announcePolite).toBeDefined();\n+      expect(typeof result.current.announcePolite).toBe('function');\n+    });\n+\n+    test('returns no-op announceAssertive function', () => {\n+      const { result } = renderHook(() => useAnnouncer());\n+\n+      expect(result.current.announceAssertive).toBeDefined();\n+      expect(typeof result.current.announceAssertive).toBe('function');\n+    });\n+\n+    test('does not throw error', () => {\n+      const { result } = renderHook(() => useAnnouncer());\n+\n+      expect(() => result.current.announcePolite('test')).not.toThrow();\n+      expect(() => result.current.announceAssertive('test')).not.toThrow();\n+    });\n+\n+    test('no-op functions can be called safely', () => {\n+      const { result } = renderHook(() => useAnnouncer());\n+\n+      // These should not throw\n+      result.current.announcePolite('test message');\n+      result.current.announceAssertive('test error');\n+    });\n+  });\n+\n+  describe('Integration', () => {\n+    test('multiple components can use same announcer', () => {\n+      const ComponentA = () => {\n+        const { announcePolite } = useAnnouncer();\n+        return (\n+          <button type=\"button\" onClick={() => announcePolite('From A')}>\n+            A\n+          </button>\n+        );\n+      };\n+\n+      const ComponentB = () => {\n+        const { announcePolite } = useAnnouncer();\n+        return (\n+          <button type=\"button\" onClick={() => announcePolite('From B')}>\n+            B\n+          </button>\n+        );\n+      };\n+\n+      render(\n+        <StatusAnnouncerProvider>\n+          <ComponentA />\n+          <ComponentB />\n+        </StatusAnnouncerProvider>,\n+      );\n+\n+      expect(screen.getByText('A')).toBeInTheDocument();\n+      expect(screen.getByText('B')).toBeInTheDocument();\n+    });\n+\n+    test('announcements from different components work', async () => {\n+      const ComponentA = () => {\n+        const { announcePolite } = useAnnouncer();\n+        return (\n+          <button\n+            type=\"button\"\n+            data-testid=\"button-a\"\n+            onClick={() => announcePolite('From Component A')}\n+          >\n+            A\n+          </button>\n+        );\n+      };\n+\n+      render(\n+        <StatusAnnouncerProvider>\n+          <ComponentA />\n+        </StatusAnnouncerProvider>,\n+      );\n+\n+      const politeRegion = document.getElementById('a11y-status-announcer');\n+      const button = screen.getByTestId('button-a');\n+\n+      act(() => {\n+        button.click();\n+        jest.advanceTimersByTime(150);\n+      });\n+\n+      expect(politeRegion).toHaveTextContent('From Component A');\n+    });\n+  });\n+});", "pull_request_number": 37211}
{"sha": "ffc39b26e8089cee41aa7f8dc281e29900c992b1", "filename": "superset-frontend/src/components/Accessibility/StatusAnnouncer.tsx", "status": "added", "additions": 109, "deletions": 0, "changes": 109, "blob_url": "https://github.com/apache/superset/blob/b53eeab7839d979c203ad2ea82e4fc94c6998850/superset-frontend%2Fsrc%2Fcomponents%2FAccessibility%2FStatusAnnouncer.tsx", "raw_url": "https://github.com/apache/superset/raw/b53eeab7839d979c203ad2ea82e4fc94c6998850/superset-frontend%2Fsrc%2Fcomponents%2FAccessibility%2FStatusAnnouncer.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fcomponents%2FAccessibility%2FStatusAnnouncer.tsx?ref=b53eeab7839d979c203ad2ea82e4fc94c6998850", "patch": "@@ -0,0 +1,109 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import React, { createContext, useContext, useState, useCallback, useMemo } from 'react';\n+import { styled } from '@superset-ui/core';\n+\n+/**\n+ * StatusAnnouncer - WCAG 4.1.3 Status Messages\n+ * Provides ARIA live regions for screen reader announcements.\n+ * - Polite region: for non-urgent status updates (loading, saving)\n+ * - Assertive region: for urgent messages (errors, alerts)\n+ */\n+\n+const VisuallyHidden = styled.div`\n+  position: absolute;\n+  width: 1px;\n+  height: 1px;\n+  padding: 0;\n+  margin: -1px;\n+  overflow: hidden;\n+  clip: rect(0, 0, 0, 0);\n+  white-space: nowrap;\n+  border: 0;\n+`;\n+\n+interface AnnouncerContextType {\n+  announcePolite: (message: string) => void;\n+  announceAssertive: (message: string) => void;\n+}\n+\n+const AnnouncerContext = createContext<AnnouncerContextType | null>(null);\n+\n+export const useAnnouncer = (): AnnouncerContextType => {\n+  const context = useContext(AnnouncerContext);\n+  if (!context) {\n+    // Return no-op functions if used outside provider\n+    return {\n+      announcePolite: () => {},\n+      announceAssertive: () => {},\n+    };\n+  }\n+  return context;\n+};\n+\n+interface StatusAnnouncerProps {\n+  children: React.ReactNode;\n+}\n+\n+export const StatusAnnouncerProvider: React.FC<StatusAnnouncerProps> = ({ children }) => {\n+  const [politeMessage, setPoliteMessage] = useState('');\n+  const [assertiveMessage, setAssertiveMessage] = useState('');\n+\n+  const announcePolite = useCallback((message: string) => {\n+    // Clear first to ensure re-announcement of same message\n+    setPoliteMessage('');\n+    setTimeout(() => setPoliteMessage(message), 100);\n+  }, []);\n+\n+  const announceAssertive = useCallback((message: string) => {\n+    setAssertiveMessage('');\n+    setTimeout(() => setAssertiveMessage(message), 100);\n+  }, []);\n+\n+  const contextValue = useMemo(\n+    () => ({ announcePolite, announceAssertive }),\n+    [announcePolite, announceAssertive]\n+  );\n+\n+  return (\n+    <AnnouncerContext.Provider value={contextValue}>\n+      {children}\n+      {/* Polite live region for status updates */}\n+      <VisuallyHidden\n+        id=\"a11y-status-announcer\"\n+        role=\"status\"\n+        aria-live=\"polite\"\n+        aria-atomic=\"true\"\n+      >\n+        {politeMessage}\n+      </VisuallyHidden>\n+      {/* Assertive live region for alerts/errors */}\n+      <VisuallyHidden\n+        id=\"a11y-alert-announcer\"\n+        role=\"alert\"\n+        aria-live=\"assertive\"\n+        aria-atomic=\"true\"\n+      >\n+        {assertiveMessage}\n+      </VisuallyHidden>\n+    </AnnouncerContext.Provider>\n+  );\n+};\n+\n+export default StatusAnnouncerProvider;", "pull_request_number": 37211}
{"sha": "e9b0684803ba50e9e921e3ec88cd7e8629905372", "filename": "superset-frontend/src/components/Accessibility/index.tsx", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/apache/superset/blob/b53eeab7839d979c203ad2ea82e4fc94c6998850/superset-frontend%2Fsrc%2Fcomponents%2FAccessibility%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/b53eeab7839d979c203ad2ea82e4fc94c6998850/superset-frontend%2Fsrc%2Fcomponents%2FAccessibility%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fcomponents%2FAccessibility%2Findex.tsx?ref=b53eeab7839d979c203ad2ea82e4fc94c6998850", "patch": "@@ -0,0 +1,29 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+/**\n+ * Accessibility Components for WCAG 2.1 Level A Compliance\n+ *\n+ * This module provides accessibility utilities for Apache Superset:\n+ * - SkipLink: WCAG 2.4.1 - Bypass Blocks\n+ * - StatusAnnouncer: WCAG 4.1.3 - Status Messages\n+ */\n+\n+export { default as SkipLink } from './SkipLink';\n+export { StatusAnnouncerProvider, useAnnouncer } from './StatusAnnouncer';", "pull_request_number": 37211}
{"sha": "051c77bc378228c9233c8c632fe2a35b668525d7", "filename": "superset-frontend/src/dashboard/components/SliceHeader/index.tsx", "status": "modified", "additions": 161, "deletions": 208, "changes": 369, "blob_url": "https://github.com/apache/superset/blob/b53eeab7839d979c203ad2ea82e4fc94c6998850/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FSliceHeader%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/b53eeab7839d979c203ad2ea82e4fc94c6998850/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FSliceHeader%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FSliceHeader%2Findex.tsx?ref=b53eeab7839d979c203ad2ea82e4fc94c6998850", "patch": "@@ -16,30 +16,27 @@\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n-import {\n+import React, {\n   forwardRef,\n   ReactNode,\n   useContext,\n   useEffect,\n   useRef,\n   useState,\n } from 'react';\n-import { t } from '@apache-superset/core';\n-import { getExtensionsRegistry, QueryData } from '@superset-ui/core';\n-import { css, styled, SupersetTheme, useTheme } from '@apache-superset/core/ui';\n+import { css, getExtensionsRegistry, styled, t } from '@superset-ui/core';\n import { useUiConfig } from 'src/components/UiConfigContext';\n-import { isEmbedded } from 'src/dashboard/util/isEmbedded';\n-import { Tooltip, EditableTitle, Icons } from '@superset-ui/core/components';\n+import { Tooltip } from 'src/components/Tooltip';\n import { useSelector } from 'react-redux';\n-import SliceHeaderControls from 'src/dashboard/components/SliceHeaderControls';\n-import { SliceHeaderControlsProps } from 'src/dashboard/components/SliceHeaderControls/types';\n+import EditableTitle from 'src/components/EditableTitle';\n+import SliceHeaderControls, {\n+  SliceHeaderControlsProps,\n+} from 'src/dashboard/components/SliceHeaderControls';\n import FiltersBadge from 'src/dashboard/components/FiltersBadge';\n-import CustomizationsBadge from 'src/dashboard/components/CustomizationsBadge';\n+import Icons from 'src/components/Icons';\n import { RootState } from 'src/dashboard/types';\n import { getSliceHeaderTooltip } from 'src/dashboard/util/getSliceHeaderTooltip';\n import { DashboardPageIdContext } from 'src/dashboard/containers/DashboardPage';\n-import RowCountLabel from 'src/components/RowCountLabel';\n-import { Link } from 'react-router-dom';\n \n const extensionsRegistry = getExtensionsRegistry();\n \n@@ -54,34 +51,33 @@ type SliceHeaderProps = SliceHeaderControlsProps & {\n   formData: object;\n   width: number;\n   height: number;\n-  queriedDttm?: string | null;\n-  exportPivotExcel?: (arg0: string) => void;\n };\n \n const annotationsLoading = t('Annotation layers are still loading.');\n const annotationsError = t('One or more annotation layers failed loading.');\n const CrossFilterIcon = styled(Icons.ApartmentOutlined)`\n   ${({ theme }) => `\n     cursor: default;\n-    color: ${theme.colorPrimary};\n+    color: ${theme.colors.primary.base};\n     line-height: 1.8;\n   `}\n `;\n \n const ChartHeaderStyles = styled.div`\n   ${({ theme }) => css`\n-    font-size: ${theme.fontSizeLG}px;\n-    font-weight: ${theme.fontWeightStrong};\n-    margin-bottom: ${theme.sizeUnit}px;\n+    font-size: ${theme.typography.sizes.l}px;\n+    font-weight: ${theme.typography.weights.bold};\n+    margin-bottom: ${theme.gridUnit}px;\n     display: flex;\n     max-width: 100%;\n     align-items: flex-start;\n     min-height: 0;\n \n+    /* WCAG 1.3.1: Chart title as semantic heading */\n     & > .header-title {\n       overflow: hidden;\n       text-overflow: ellipsis;\n-      max-width: calc(100% - ${theme.sizeUnit * 4}px);\n+      max-width: 100%;\n       flex-grow: 1;\n       display: -webkit-box;\n       -webkit-line-clamp: 2;\n@@ -90,12 +86,24 @@ const ChartHeaderStyles = styled.div`\n       & > span.ant-tooltip-open {\n         display: inline;\n       }\n+\n+      /* Style the h2 to match the original design */\n+      & h2 {\n+        font-size: inherit;\n+        font-weight: inherit;\n+        margin: 0;\n+        line-height: inherit;\n+      }\n     }\n \n     & > .header-controls {\n       display: flex;\n       align-items: center;\n       height: 24px;\n+\n+      & > * {\n+        margin-left: ${theme.gridUnit * 2}px;\n+      }\n     }\n \n     .dropdown.btn-group {\n@@ -113,18 +121,18 @@ const ChartHeaderStyles = styled.div`\n     }\n \n     .dropdown-menu.dropdown-menu-right {\n-      top: ${theme.sizeUnit * 5}px;\n+      top: ${theme.gridUnit * 5}px;\n     }\n \n     .divider {\n-      margin: ${theme.sizeUnit}px 0;\n+      margin: ${theme.gridUnit}px 0;\n     }\n \n     .refresh-tooltip {\n       display: block;\n-      height: ${theme.sizeUnit * 4}px;\n-      margin: ${theme.sizeUnit}px 0;\n-      color: ${theme.colorTextLabel};\n+      height: ${theme.gridUnit * 4}px;\n+      margin: ${theme.gridUnit}px 0;\n+      color: ${theme.colors.text.label};\n     }\n   `}\n `;\n@@ -143,15 +151,13 @@ const SliceHeader = forwardRef<HTMLDivElement, SliceHeaderProps>(\n       annotationQuery = {},\n       annotationError = {},\n       cachedDttm = null,\n-      queriedDttm = null,\n       updatedDttm = null,\n       isCached = [],\n       isExpanded = false,\n       sliceName = '',\n       supersetCanExplore = false,\n       supersetCanShare = false,\n       supersetCanCSV = false,\n-      exportPivotCSV,\n       exportFullCSV,\n       exportFullXLSX,\n       slice,\n@@ -165,200 +171,147 @@ const SliceHeader = forwardRef<HTMLDivElement, SliceHeaderProps>(\n       formData,\n       width,\n       height,\n-      exportPivotExcel = () => ({}),\n     },\n     ref,\n   ) => {\n-    const SliceHeaderExtension = extensionsRegistry.get(\n-      'dashboard.slice.header',\n-    );\n-    const uiConfig = useUiConfig();\n-    const shouldShowRowLimitWarning =\n-      !isEmbedded() || uiConfig.showRowLimitWarning;\n-    const dashboardPageId = useContext(DashboardPageIdContext);\n-    const [headerTooltip, setHeaderTooltip] = useState<ReactNode | null>(null);\n-    const headerRef = useRef<HTMLDivElement>(null);\n-    // TODO: change to indicator field after it will be implemented\n-    const crossFilterValue = useSelector<RootState, any>(\n-      state => state.dataMask[slice?.slice_id]?.filterState?.value,\n-    );\n-    const isCrossFiltersEnabled = useSelector<RootState, boolean>(\n-      ({ dashboardInfo }) => dashboardInfo.crossFiltersEnabled,\n-    );\n-\n-    const firstQueryResponse = useSelector<RootState, QueryData | undefined>(\n-      state => state.charts[slice.slice_id].queriesResponse?.[0],\n-    );\n-\n-    const theme = useTheme();\n-\n-    const rowLimit = Number(formData.row_limit || -1);\n-    const sqlRowCount = Number(firstQueryResponse?.sql_rowcount || 0);\n+  const SliceHeaderExtension = extensionsRegistry.get('dashboard.slice.header');\n+  const uiConfig = useUiConfig();\n+  const dashboardPageId = useContext(DashboardPageIdContext);\n+  const [headerTooltip, setHeaderTooltip] = useState<ReactNode | null>(null);\n+  const headerRef = useRef<HTMLDivElement>(null);\n+  // TODO: change to indicator field after it will be implemented\n+  const crossFilterValue = useSelector<RootState, any>(\n+    state => state.dataMask[slice?.slice_id]?.filterState?.value,\n+  );\n+  const isCrossFiltersEnabled = useSelector<RootState, boolean>(\n+    ({ dashboardInfo }) => dashboardInfo.crossFiltersEnabled,\n+  );\n \n-    const canExplore = !editMode && supersetCanExplore;\n+  const canExplore = !editMode && supersetCanExplore;\n \n-    useEffect(() => {\n-      const headerElement = headerRef.current;\n-      if (canExplore) {\n-        setHeaderTooltip(getSliceHeaderTooltip(sliceName));\n-      } else if (\n-        headerElement &&\n-        (headerElement.scrollWidth > headerElement.offsetWidth ||\n-          headerElement.scrollHeight > headerElement.offsetHeight)\n-      ) {\n-        setHeaderTooltip(sliceName ?? null);\n-      } else {\n-        setHeaderTooltip(null);\n-      }\n-    }, [sliceName, width, height, canExplore]);\n-\n-    const exploreUrl = `/explore/?dashboard_page_id=${dashboardPageId}&slice_id=${slice.slice_id}`;\n+  useEffect(() => {\n+    const headerElement = headerRef.current;\n+    if (canExplore) {\n+      setHeaderTooltip(getSliceHeaderTooltip(sliceName));\n+    } else if (\n+      headerElement &&\n+      (headerElement.scrollWidth > headerElement.offsetWidth ||\n+        headerElement.scrollHeight > headerElement.offsetHeight)\n+    ) {\n+      setHeaderTooltip(sliceName ?? null);\n+    } else {\n+      setHeaderTooltip(null);\n+    }\n+  }, [sliceName, width, height, canExplore]);\n \n-    const renderExploreLink = (title: string) => (\n-      <Link\n-        to={exploreUrl}\n-        css={(theme: SupersetTheme) => css`\n-          color: ${theme.colorText};\n-          text-decoration: none;\n-          :hover {\n-            text-decoration: underline;\n-          }\n-          display: inline-block;\n-        `}\n-      >\n-        {title}\n-      </Link>\n-    );\n+  const exploreUrl = `/explore/?dashboard_page_id=${dashboardPageId}&slice_id=${slice.slice_id}`;\n \n-    return (\n-      <ChartHeaderStyles data-test=\"slice-header\" ref={ref}>\n-        <div className=\"header-title\" ref={headerRef}>\n+  return (\n+    <ChartHeaderStyles data-test=\"slice-header\" ref={ref}>\n+      <div className=\"header-title\" ref={headerRef}>\n+        {/* WCAG 1.3.1: Chart title as semantic heading for screen readers */}\n+        <h2>\n           <Tooltip title={headerTooltip}>\n-            {/* this div ensures the hover event triggers correctly and prevents flickering */}\n-            <div>\n-              <EditableTitle\n-                title={\n-                  sliceName ||\n-                  (editMode\n-                    ? '---' // this makes an empty title clickable\n-                    : '')\n-                }\n-                canEdit={editMode}\n-                onSaveTitle={updateSliceName}\n-                showTooltip={false}\n-                renderLink={\n-                  canExplore && exploreUrl ? renderExploreLink : undefined\n-                }\n-              />\n-            </div>\n+            <EditableTitle\n+              title={\n+                sliceName ||\n+                (editMode\n+                  ? '---' // this makes an empty title clickable\n+                  : '')\n+              }\n+              canEdit={editMode}\n+              onSaveTitle={updateSliceName}\n+              showTooltip={false}\n+              url={canExplore ? exploreUrl : undefined}\n+            />\n           </Tooltip>\n-          {!!Object.values(annotationQuery).length && (\n-            <Tooltip\n-              id=\"annotations-loading-tooltip\"\n-              placement=\"top\"\n-              title={annotationsLoading}\n-            >\n-              <Icons.ReloadOutlined\n-                className=\"warning\"\n-                aria-label={annotationsLoading}\n+        </h2>\n+        {!!Object.values(annotationQuery).length && (\n+          <Tooltip\n+            id=\"annotations-loading-tooltip\"\n+            placement=\"top\"\n+            title={annotationsLoading}\n+          >\n+            <i\n+              role=\"img\"\n+              aria-label={annotationsLoading}\n+              className=\"fa fa-refresh warning\"\n+            />\n+          </Tooltip>\n+        )}\n+        {!!Object.values(annotationError).length && (\n+          <Tooltip\n+            id=\"annotation-errors-tooltip\"\n+            placement=\"top\"\n+            title={annotationsError}\n+          >\n+            <i\n+              role=\"img\"\n+              aria-label={annotationsError}\n+              className=\"fa fa-exclamation-circle danger\"\n+            />\n+          </Tooltip>\n+        )}\n+      </div>\n+      <div className=\"header-controls\">\n+        {!editMode && (\n+          <>\n+            {SliceHeaderExtension && (\n+              <SliceHeaderExtension\n+                sliceId={slice.slice_id}\n+                dashboardId={dashboardId}\n               />\n-            </Tooltip>\n-          )}\n-          {!!Object.values(annotationError).length && (\n-            <Tooltip\n-              id=\"annotation-errors-tooltip\"\n-              placement=\"top\"\n-              title={annotationsError}\n-            >\n-              <Icons.ExclamationCircleOutlined\n-                className=\"danger\"\n-                aria-label={annotationsError}\n+            )}\n+            {crossFilterValue && (\n+              <Tooltip\n+                placement=\"top\"\n+                title={t(\n+                  'This chart applies cross-filters to charts whose datasets contain columns with the same name.',\n+                )}\n+              >\n+                <CrossFilterIcon iconSize=\"m\" />\n+              </Tooltip>\n+            )}\n+            {!uiConfig.hideChartControls && (\n+              <FiltersBadge chartId={slice.slice_id} />\n+            )}\n+            {!uiConfig.hideChartControls && (\n+              <SliceHeaderControls\n+                slice={slice}\n+                isCached={isCached}\n+                isExpanded={isExpanded}\n+                cachedDttm={cachedDttm}\n+                updatedDttm={updatedDttm}\n+                toggleExpandSlice={toggleExpandSlice}\n+                forceRefresh={forceRefresh}\n+                logExploreChart={logExploreChart}\n+                logEvent={logEvent}\n+                exportCSV={exportCSV}\n+                exportFullCSV={exportFullCSV}\n+                exportXLSX={exportXLSX}\n+                exportFullXLSX={exportFullXLSX}\n+                supersetCanExplore={supersetCanExplore}\n+                supersetCanShare={supersetCanShare}\n+                supersetCanCSV={supersetCanCSV}\n+                componentId={componentId}\n+                dashboardId={dashboardId}\n+                addSuccessToast={addSuccessToast}\n+                addDangerToast={addDangerToast}\n+                handleToggleFullSize={handleToggleFullSize}\n+                isFullSize={isFullSize}\n+                isDescriptionExpanded={isExpanded}\n+                chartStatus={chartStatus}\n+                formData={formData}\n+                exploreUrl={exploreUrl}\n+                crossFiltersEnabled={isCrossFiltersEnabled}\n               />\n-            </Tooltip>\n-          )}\n-        </div>\n-        <div className=\"header-controls\">\n-          {!editMode && (\n-            <>\n-              {SliceHeaderExtension && (\n-                <SliceHeaderExtension\n-                  sliceId={slice.slice_id}\n-                  dashboardId={dashboardId}\n-                />\n-              )}\n-              {crossFilterValue && (\n-                <Tooltip\n-                  placement=\"top\"\n-                  title={t(\n-                    'This chart applies cross-filters to charts whose datasets contain columns with the same name.',\n-                  )}\n-                >\n-                  <CrossFilterIcon iconSize=\"m\" />\n-                </Tooltip>\n-              )}\n-              {!uiConfig.hideChartControls && (\n-                <CustomizationsBadge chartId={slice.slice_id} />\n-              )}\n-\n-              {!uiConfig.hideChartControls && (\n-                <FiltersBadge chartId={slice.slice_id} />\n-              )}\n-\n-              {shouldShowRowLimitWarning && sqlRowCount === rowLimit && (\n-                <RowCountLabel\n-                  rowcount={sqlRowCount}\n-                  limit={rowLimit}\n-                  label={\n-                    <Icons.WarningOutlined\n-                      iconSize=\"l\"\n-                      iconColor={theme.colorWarning}\n-                      css={theme => css`\n-                        padding: ${theme.sizeUnit}px;\n-                      `}\n-                    />\n-                  }\n-                />\n-              )}\n-              {!uiConfig.hideChartControls && (\n-                <SliceHeaderControls\n-                  slice={slice}\n-                  isCached={isCached}\n-                  isExpanded={isExpanded}\n-                  cachedDttm={cachedDttm}\n-                  queriedDttm={queriedDttm}\n-                  updatedDttm={updatedDttm}\n-                  toggleExpandSlice={toggleExpandSlice}\n-                  forceRefresh={forceRefresh}\n-                  logExploreChart={logExploreChart}\n-                  logEvent={logEvent}\n-                  exportCSV={exportCSV}\n-                  exportPivotCSV={exportPivotCSV}\n-                  exportFullCSV={exportFullCSV}\n-                  exportXLSX={exportXLSX}\n-                  exportFullXLSX={exportFullXLSX}\n-                  supersetCanExplore={supersetCanExplore}\n-                  supersetCanShare={supersetCanShare}\n-                  supersetCanCSV={supersetCanCSV}\n-                  componentId={componentId}\n-                  dashboardId={dashboardId}\n-                  addSuccessToast={addSuccessToast}\n-                  addDangerToast={addDangerToast}\n-                  handleToggleFullSize={handleToggleFullSize}\n-                  isFullSize={isFullSize}\n-                  isDescriptionExpanded={isExpanded}\n-                  chartStatus={chartStatus}\n-                  formData={formData}\n-                  exploreUrl={exploreUrl}\n-                  crossFiltersEnabled={isCrossFiltersEnabled}\n-                  exportPivotExcel={exportPivotExcel}\n-                />\n-              )}\n-            </>\n-          )}\n-        </div>\n-      </ChartHeaderStyles>\n-    );\n-  },\n+            )}\n+          </>\n+        )}\n+      </div>\n+    </ChartHeaderStyles>\n+  );\n+},\n );\n \n export default SliceHeader;", "pull_request_number": 37211}
{"sha": "118c75af1b4f4aadfc9def5a016a02bf532a6e75", "filename": "superset-frontend/src/dashboard/components/nativeFilters/FilterBar/ActionButtons/index.tsx", "status": "modified", "additions": 58, "deletions": 62, "changes": 120, "blob_url": "https://github.com/apache/superset/blob/b53eeab7839d979c203ad2ea82e4fc94c6998850/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FnativeFilters%2FFilterBar%2FActionButtons%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/b53eeab7839d979c203ad2ea82e4fc94c6998850/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FnativeFilters%2FFilterBar%2FActionButtons%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FnativeFilters%2FFilterBar%2FActionButtons%2Findex.tsx?ref=b53eeab7839d979c203ad2ea82e4fc94c6998850", "patch": "@@ -16,19 +16,19 @@\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n-import { useMemo } from 'react';\n-import { t } from '@apache-superset/core';\n+import React, { useMemo } from 'react';\n import {\n+  css,\n   DataMaskState,\n   DataMaskStateWithId,\n+  t,\n   isDefined,\n-  ChartCustomization,\n-  ChartCustomizationDivider,\n+  SupersetTheme,\n } from '@superset-ui/core';\n-import { css, SupersetTheme, styled } from '@apache-superset/core/ui';\n-import { Button } from '@superset-ui/core/components';\n+import Button from 'src/components/Button';\n+import { Tooltip } from 'src/components/Tooltip';\n import { OPEN_FILTER_BAR_WIDTH } from 'src/dashboard/constants';\n-import tinycolor from 'tinycolor2';\n+import { rgba } from 'emotion-rgba';\n import { FilterBarOrientation } from 'src/dashboard/types';\n import { getFilterBarTestId } from '../utils';\n \n@@ -38,7 +38,6 @@ interface ActionButtonsProps {\n   onClearAll: () => void;\n   dataMaskSelected: DataMaskState;\n   dataMaskApplied: DataMaskStateWithId;\n-  chartCustomizationItems?: (ChartCustomization | ChartCustomizationDivider)[];\n   isApplyDisabled: boolean;\n   filterBarOrientation?: FilterBarOrientation;\n }\n@@ -47,39 +46,44 @@ const containerStyle = (theme: SupersetTheme) => css`\n   display: flex;\n \n   && > .filter-clear-all-button {\n-    color: ${theme.colorTextSecondary};\n+    color: ${theme.colors.grayscale.base};\n     margin-left: 0;\n     &:hover {\n-      color: ${theme.colorPrimaryText};\n+      color: ${theme.colors.primary.dark1};\n     }\n \n     &[disabled],\n     &[disabled]:hover {\n-      color: ${theme.colorTextDisabled};\n+      color: ${theme.colors.grayscale.light1};\n     }\n   }\n `;\n \n const verticalStyle = (theme: SupersetTheme, width: number) => css`\n   flex-direction: column;\n   align-items: center;\n+  pointer-events: none;\n   position: fixed;\n   z-index: 100;\n \n   // filter bar width minus 1px for border\n   width: ${width - 1}px;\n   bottom: 0;\n \n-  padding: ${theme.sizeUnit * 4}px;\n-  padding-top: ${theme.sizeUnit * 6}px;\n+  padding: ${theme.gridUnit * 4}px;\n+  padding-top: ${theme.gridUnit * 6}px;\n \n   background: linear-gradient(\n-    ${tinycolor(theme.colorBgLayout).setAlpha(0).toRgbString()},\n-    ${theme.colorBgContainer} 20%\n+    ${rgba(theme.colors.grayscale.light5, 0)},\n+    ${theme.colors.grayscale.light5} ${theme.opacity.mediumLight}\n   );\n \n+  & > button {\n+    pointer-events: auto;\n+  }\n+\n   & > .filter-apply-button {\n-    margin-bottom: ${theme.sizeUnit * 3}px;\n+    margin-bottom: ${theme.gridUnit * 3}px;\n   }\n `;\n \n@@ -88,15 +92,15 @@ const horizontalStyle = (theme: SupersetTheme) => css`\n   margin-left: auto;\n   && > .filter-clear-all-button {\n     text-transform: capitalize;\n-    font-weight: ${theme.fontWeightNormal};\n+    font-weight: ${theme.typography.weights.normal};\n+  }\n+  & > .filter-apply-button {\n+    &[disabled],\n+    &[disabled]:hover {\n+      color: ${theme.colors.grayscale.light1};\n+      background: ${theme.colors.grayscale.light3};\n+    }\n   }\n-`;\n-\n-const ButtonsContainer = styled.div<{ isVertical: boolean; width: number }>`\n-  ${({ theme, isVertical, width }) => css`\n-    ${containerStyle(theme)};\n-    ${isVertical ? verticalStyle(theme, width) : horizontalStyle(theme)};\n-  `}\n `;\n \n const ActionButtons = ({\n@@ -107,63 +111,55 @@ const ActionButtons = ({\n   dataMaskSelected,\n   isApplyDisabled,\n   filterBarOrientation = FilterBarOrientation.Vertical,\n-  chartCustomizationItems,\n }: ActionButtonsProps) => {\n   const isClearAllEnabled = useMemo(() => {\n-    const hasSelectedChanges = Object.entries(dataMaskSelected).some(\n-      ([, mask]) => {\n-        const hasValue = isDefined(mask?.filterState?.value);\n-        const hasGroupBy = isDefined(mask?.ownState?.column);\n-        return hasValue || hasGroupBy;\n-      },\n+    // Check both selected (pending) and applied filters to determine if clear is available\n+    const hasSelectedValues = Object.values(dataMaskSelected).some(\n+      mask => isDefined(mask.filterState?.value),\n     );\n-\n-    const hasAppliedChanges = Object.entries(dataMaskApplied).some(\n-      ([, mask]) => {\n-        const hasValue = isDefined(mask?.filterState?.value);\n-        const hasGroupBy = isDefined(mask?.ownState?.column);\n-        return hasValue || hasGroupBy;\n-      },\n+    const hasAppliedValues = Object.values(dataMaskApplied).some(\n+      mask => isDefined(mask.filterState?.value),\n     );\n-\n-    const hasChartCustomizations = chartCustomizationItems?.some(item => {\n-      if (item.removed) return false;\n-      const mask = dataMaskApplied[item.id] || dataMaskSelected[item.id];\n-      const hasValue = isDefined(mask?.filterState?.value);\n-      const hasGroupBy = isDefined(mask?.ownState?.column);\n-      return hasValue || hasGroupBy;\n-    });\n-\n-    return hasSelectedChanges || hasAppliedChanges || hasChartCustomizations;\n-  }, [dataMaskSelected, dataMaskApplied, chartCustomizationItems]);\n+    return hasSelectedValues || hasAppliedValues;\n+  }, [dataMaskSelected, dataMaskApplied]);\n   const isVertical = filterBarOrientation === FilterBarOrientation.Vertical;\n \n   return (\n-    <ButtonsContainer\n-      isVertical={isVertical}\n-      width={width}\n+    <div\n+      css={(theme: SupersetTheme) => [\n+        containerStyle(theme),\n+        isVertical ? verticalStyle(theme, width) : horizontalStyle(theme),\n+      ]}\n       data-test=\"filterbar-action-buttons\"\n     >\n-      <Button\n-        disabled={isApplyDisabled}\n-        buttonStyle=\"primary\"\n-        htmlType=\"submit\"\n-        className=\"filter-apply-button\"\n-        onClick={onApply}\n-        {...getFilterBarTestId('apply-button')}\n+      <Tooltip\n+        title={isApplyDisabled ? t('Select filter values to apply') : undefined}\n+        placement=\"top\"\n       >\n-        {isVertical ? t('Apply filters') : t('Apply')}\n-      </Button>\n+        <span>\n+          <Button\n+            disabled={isApplyDisabled}\n+            buttonStyle=\"primary\"\n+            htmlType=\"submit\"\n+            className=\"filter-apply-button\"\n+            onClick={onApply}\n+            {...getFilterBarTestId('apply-button')}\n+          >\n+            {isVertical ? t('Apply filters') : t('Apply')}\n+          </Button>\n+        </span>\n+      </Tooltip>\n       <Button\n         disabled={!isClearAllEnabled}\n         buttonStyle=\"link\"\n+        buttonSize=\"small\"\n         className=\"filter-clear-all-button\"\n         onClick={onClearAll}\n         {...getFilterBarTestId('clear-button')}\n       >\n         {t('Clear all')}\n       </Button>\n-    </ButtonsContainer>\n+    </div>\n   );\n };\n ", "pull_request_number": 37211}
{"sha": "bf2d00d9af6bb560967481d5fbde03eb3b107d85", "filename": "superset-frontend/lerna.json", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/apache/superset/blob/bb07b24ea3153122908010afd3b77dab1b07eb5c/superset-frontend%2Flerna.json", "raw_url": "https://github.com/apache/superset/raw/bb07b24ea3153122908010afd3b77dab1b07eb5c/superset-frontend%2Flerna.json", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Flerna.json?ref=bb07b24ea3153122908010afd3b77dab1b07eb5c", "patch": "@@ -14,13 +14,12 @@\n   ],\n   \"command\": {\n     \"publish\": {\n-      \"message\": \"chore(superset-ui): publish %s\",\n-      \"graphType\": \"all\"\n+      \"message\": \"chore(superset-ui): publish %s\"\n     },\n     \"version\": {\n       \"message\": \"chore(superset-ui): publish %s\",\n       \"exact\": true\n     }\n   },\n-  \"$schema\": \"node_modules/lerna/schemas/lerna-schema.json\"\n+  \"$schema\": \"node_modules/@lerna-lite/cli/schemas/lerna-schema.json\"\n }", "pull_request_number": 37222}
{"sha": "16bfb326a1e1468deb1991bb15b48e8bcfeb8afe", "filename": "superset-frontend/package-lock.json", "status": "modified", "additions": 2316, "deletions": 3984, "changes": 6300, "blob_url": "https://github.com/apache/superset/blob/bb07b24ea3153122908010afd3b77dab1b07eb5c/superset-frontend%2Fpackage-lock.json", "raw_url": "https://github.com/apache/superset/raw/bb07b24ea3153122908010afd3b77dab1b07eb5c/superset-frontend%2Fpackage-lock.json", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackage-lock.json?ref=bb07b24ea3153122908010afd3b77dab1b07eb5c", "pull_request_number": 37222}
{"sha": "82f59a1511f0d49a843729afdf2ea9aa825dac26", "filename": "superset-frontend/package.json", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/apache/superset/blob/bb07b24ea3153122908010afd3b77dab1b07eb5c/superset-frontend%2Fpackage.json", "raw_url": "https://github.com/apache/superset/raw/bb07b24ea3153122908010afd3b77dab1b07eb5c/superset-frontend%2Fpackage.json", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackage.json?ref=bb07b24ea3153122908010afd3b77dab1b07eb5c", "patch": "@@ -241,6 +241,10 @@\n     \"@emotion/jest\": \"^11.14.2\",\n     \"@hot-loader/react-dom\": \"^17.0.2\",\n     \"@istanbuljs/nyc-config-typescript\": \"^1.0.1\",\n+    \"@lerna-lite/cli\": \"^4.11.0\",\n+    \"@lerna-lite/exec\": \"^4.11.0\",\n+    \"@lerna-lite/publish\": \"^4.11.0\",\n+    \"@lerna-lite/version\": \"^4.11.0\",\n     \"@mihkeleidast/storybook-addon-source\": \"^1.0.1\",\n     \"@playwright/test\": \"^1.57.0\",\n     \"@pmmmwh/react-refresh-webpack-plugin\": \"^0.6.2\",\n@@ -331,7 +335,6 @@\n     \"jest-html-reporter\": \"^4.3.0\",\n     \"jest-websocket-mock\": \"^2.5.0\",\n     \"jsdom\": \"^27.4.0\",\n-    \"lerna\": \"^8.2.3\",\n     \"lightningcss\": \"^1.30.2\",\n     \"mini-css-extract-plugin\": \"^2.9.4\",\n     \"open-cli\": \"^8.0.0\",", "pull_request_number": 37222}
{"sha": "ce3f1eb246e4f97d0d6bcad227456aa879505f93", "filename": "superset-frontend/scripts/build.js", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/apache/superset/blob/bb07b24ea3153122908010afd3b77dab1b07eb5c/superset-frontend%2Fscripts%2Fbuild.js", "raw_url": "https://github.com/apache/superset/raw/bb07b24ea3153122908010afd3b77dab1b07eb5c/superset-frontend%2Fscripts%2Fbuild.js", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fscripts%2Fbuild.js?ref=bb07b24ea3153122908010afd3b77dab1b07eb5c", "patch": "@@ -112,8 +112,7 @@ function getPackages(packagePattern, tsOnly = false) {\n let scope = getPackages(glob);\n \n console.log('--- Run babel --------');\n-const babelCommand = `lerna exec --stream --concurrency 10 --scope ${scope}\n-        -- babel ${BABEL_CONFIG} src --extensions \".ts,.tsx,.js,.jsx\" --copy-files`;\n+const babelCommand = `lerna exec --stream --concurrency 10 --scope ${scope} -- babel ${BABEL_CONFIG} src --extensions \".ts,.tsx,.js,.jsx\" --copy-files`;\n run(`${babelCommand} --out-dir lib`);\n \n console.log('--- Run babel esm ---');", "pull_request_number": 37222}
{"sha": "9a00dda136e2b1dd77e1f2bbfa1739146625a870", "filename": "superset-frontend/src/SqlLab/components/ExploreResultsButton/ExploreResultsButton.test.tsx", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/apache/superset/blob/19138e3e0cc79106033bc194b1a685641b7edc2b/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FExploreResultsButton%2FExploreResultsButton.test.tsx", "raw_url": "https://github.com/apache/superset/raw/19138e3e0cc79106033bc194b1a685641b7edc2b/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FExploreResultsButton%2FExploreResultsButton.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FExploreResultsButton%2FExploreResultsButton.test.tsx?ref=19138e3e0cc79106033bc194b1a685641b7edc2b", "patch": "@@ -34,18 +34,14 @@ const setup = (\n // eslint-disable-next-line no-restricted-globals -- TODO: Migrate from describe blocks\n describe('ExploreResultsButton', () => {\n   test('renders', async () => {\n-    const { queryByText } = setup(jest.fn(), {\n+    setup(jest.fn(), {\n       database: { allows_subquery: true },\n     });\n-    expect(queryByText('Create chart')).toBeInTheDocument();\n-    // Updated line to match the actual button name that includes the icon\n     expect(screen.getByRole('button', { name: /Create chart/i })).toBeEnabled();\n   });\n \n   test('renders disabled if subquery not allowed', async () => {\n-    const { queryByText } = setup(jest.fn());\n-    expect(queryByText('Create chart')).toBeInTheDocument();\n-    // Updated line to match the actual button name that includes the icon\n+    setup(jest.fn());\n     expect(\n       screen.getByRole('button', { name: /Create chart/i }),\n     ).toBeDisabled();", "pull_request_number": 37255}
{"sha": "39deb485b2c8cffa8c97a2c3354f5069ece05f33", "filename": "superset-frontend/src/SqlLab/components/ExploreResultsButton/index.tsx", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/apache/superset/blob/19138e3e0cc79106033bc194b1a685641b7edc2b/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FExploreResultsButton%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/19138e3e0cc79106033bc194b1a685641b7edc2b/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FExploreResultsButton%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FExploreResultsButton%2Findex.tsx?ref=19138e3e0cc79106033bc194b1a685641b7edc2b", "patch": "@@ -38,16 +38,16 @@ const ExploreResultsButton = ({\n   return (\n     <Button\n       buttonSize=\"small\"\n-      buttonStyle=\"secondary\"\n-      icon={<Icons.LineChartOutlined />}\n+      variant=\"text\"\n+      color=\"primary\"\n+      icon={<Icons.LineChartOutlined iconSize=\"m\" />}\n       onClick={onClick}\n       disabled={!allowsSubquery}\n       role=\"button\"\n-      tooltip={t('Explore the result set in the data exploration view')}\n+      tooltip={t('Create chart')}\n+      aria-label={t('Create chart')}\n       data-test=\"explore-results-button\"\n-    >\n-      {t('Create chart')}\n-    </Button>\n+    />\n   );\n };\n ", "pull_request_number": 37255}
{"sha": "b8c85f06284ec207eed70afc0b93ee40b322c996", "filename": "superset-frontend/src/SqlLab/components/QueryHistory/index.tsx", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/apache/superset/blob/19138e3e0cc79106033bc194b1a685641b7edc2b/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FQueryHistory%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/19138e3e0cc79106033bc194b1a685641b7edc2b/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FQueryHistory%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FQueryHistory%2Findex.tsx?ref=19138e3e0cc79106033bc194b1a685641b7edc2b", "patch": "@@ -29,6 +29,8 @@ import { SqlLabRootState } from 'src/SqlLab/types';\n import { useEditorQueriesQuery } from 'src/hooks/apiResources/queries';\n import useEffectEvent from 'src/hooks/useEffectEvent';\n import useQueryEditor from 'src/SqlLab/hooks/useQueryEditor';\n+import PanelToolbar from 'src/components/PanelToolbar';\n+import { ViewContribution } from 'src/SqlLab/contributions';\n \n interface QueryHistoryProps {\n   queryEditorId: string | number;\n@@ -119,6 +121,7 @@ const QueryHistory = ({\n \n   return editorQueries.length > 0 ? (\n     <>\n+      <PanelToolbar viewId={ViewContribution.QueryHistory} />\n       <QueryTable\n         columns={[\n           'state',", "pull_request_number": 37255}
{"sha": "52290635808a3bfc502d49ea3fd12b46503005c6", "filename": "superset-frontend/src/SqlLab/components/ResultSet/index.tsx", "status": "modified", "additions": 161, "deletions": 201, "changes": 362, "blob_url": "https://github.com/apache/superset/blob/19138e3e0cc79106033bc194b1a685641b7edc2b/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FResultSet%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/19138e3e0cc79106033bc194b1a685641b7edc2b/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FResultSet%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FResultSet%2Findex.tsx?ref=19138e3e0cc79106033bc194b1a685641b7edc2b", "patch": "@@ -32,8 +32,8 @@ import { pick } from 'lodash';\n import {\n   Button,\n   ButtonGroup,\n+  Divider,\n   Tooltip,\n-  Card,\n   Input,\n   Label,\n   Loading,\n@@ -91,6 +91,8 @@ import ExploreCtasResultsButton from '../ExploreCtasResultsButton';\n import ExploreResultsButton from '../ExploreResultsButton';\n import HighlightedSql from '../HighlightedSql';\n import QueryStateLabel from '../QueryStateLabel';\n+import PanelToolbar from 'src/components/PanelToolbar';\n+import { ViewContribution } from 'src/SqlLab/contributions';\n \n enum LimitingFactor {\n   Query = 'QUERY',\n@@ -147,29 +149,11 @@ const ReturnedRows = styled.div`\n   line-height: 1;\n `;\n \n-const ResultSetControls = styled.div`\n-  display: flex;\n-  justify-content: space-between;\n-`;\n-\n const ResultSetButtons = styled.div`\n   display: grid;\n   grid-auto-flow: column;\n-  padding-right: ${({ theme }) => 2 * theme.sizeUnit}px;\n-`;\n-\n-const CopyStyledButton = styled(Button)`\n-  &:hover {\n-    color: ${({ theme }) => theme.colorPrimary};\n-    text-decoration: unset;\n-  }\n-\n-  span > :first-of-type {\n-    margin: 0;\n-  }\n `;\n \n-const ROWS_CHIP_WIDTH = 100;\n const GAP = 8;\n \n const extensionsRegistry = getExtensionsRegistry();\n@@ -389,8 +373,71 @@ const ResultSet = ({\n         }\n       };\n \n+      const defaultPrimaryActions = (\n+        <>\n+          {visualize && database?.allows_virtual_table_explore && (\n+            <ExploreResultsButton\n+              database={database}\n+              onClick={createExploreResultsOnClick}\n+            />\n+          )}\n+          {csv && canExportData && (\n+            <Button\n+              buttonSize=\"small\"\n+              variant=\"text\"\n+              color=\"primary\"\n+              icon={<Icons.DownloadOutlined iconSize=\"m\" />}\n+              tooltip={t('Download to CSV')}\n+              aria-label={t('Download to CSV')}\n+              {...(!shouldUseStreamingExport() && {\n+                href: getExportCsvUrl(query.id),\n+              })}\n+              data-test=\"export-csv-button\"\n+              onClick={e => {\n+                const useStreaming = shouldUseStreamingExport();\n+\n+                if (useStreaming) {\n+                  e.preventDefault();\n+                  setShowStreamingModal(true);\n+\n+                  startExport({\n+                    url: makeUrl('/api/v1/sqllab/export_streaming/'),\n+                    payload: { client_id: query.id },\n+                    exportType: 'csv',\n+                    expectedRows: rows,\n+                  });\n+                } else {\n+                  handleDownloadCsv(e);\n+                }\n+              }}\n+            />\n+          )}\n+          {canExportData && (\n+            <CopyToClipboard\n+              text={prepareCopyToClipboardTabularData(data, columns)}\n+              wrapped={false}\n+              copyNode={\n+                <Button\n+                  buttonSize=\"small\"\n+                  variant=\"text\"\n+                  color=\"primary\"\n+                  icon={<Icons.CopyOutlined iconSize=\"m\" />}\n+                  tooltip={t('Copy to Clipboard')}\n+                  aria-label={t('Copy to Clipboard')}\n+                  data-test=\"copy-to-clipboard-button\"\n+                />\n+              }\n+              hideTooltip\n+              onCopyEnd={() =>\n+                logAction(LOG_ACTIONS_SQLLAB_COPY_RESULT_TO_CLIPBOARD, {})\n+              }\n+            />\n+          )}\n+        </>\n+      );\n+\n       return (\n-        <ResultSetControls>\n+        <ResultSetButtons>\n           <SaveDatasetModal\n             visible={showSaveDatasetModal}\n             onHide={() => setShowSaveDatasetModal(false)}\n@@ -401,98 +448,21 @@ const ResultSet = ({\n             )}\n             datasource={datasource}\n           />\n-          <ResultSetButtons>\n-            {visualize && database?.allows_virtual_table_explore && (\n-              <ExploreResultsButton\n-                database={database}\n-                onClick={createExploreResultsOnClick}\n-              />\n-            )}\n-            {csv && canExportData && (\n-              <CopyStyledButton\n-                buttonSize=\"small\"\n-                buttonStyle=\"secondary\"\n-                {...(!shouldUseStreamingExport() && {\n-                  href: getExportCsvUrl(query.id),\n-                })}\n-                data-test=\"export-csv-button\"\n-                onClick={e => {\n-                  const useStreaming = shouldUseStreamingExport();\n-\n-                  if (useStreaming) {\n-                    e.preventDefault();\n-                    setShowStreamingModal(true);\n-\n-                    startExport({\n-                      url: makeUrl('/api/v1/sqllab/export_streaming/'),\n-                      payload: { client_id: query.id },\n-                      exportType: 'csv',\n-                      expectedRows: rows,\n-                    });\n-                  } else {\n-                    handleDownloadCsv(e);\n-                  }\n-                }}\n-              >\n-                <Icons.DownloadOutlined iconSize=\"m\" /> {t('Download to CSV')}\n-              </CopyStyledButton>\n-            )}\n-            {canExportData && (\n-              <CopyToClipboard\n-                text={prepareCopyToClipboardTabularData(data, columns)}\n-                wrapped={false}\n-                copyNode={\n-                  <CopyStyledButton\n-                    buttonSize=\"small\"\n-                    buttonStyle=\"secondary\"\n-                    data-test=\"copy-to-clipboard-button\"\n-                  >\n-                    <Icons.CopyOutlined iconSize=\"s\" /> {t('Copy to Clipboard')}\n-                  </CopyStyledButton>\n-                }\n-                hideTooltip\n-                onCopyEnd={() =>\n-                  logAction(LOG_ACTIONS_SQLLAB_COPY_RESULT_TO_CLIPBOARD, {})\n-                }\n-              />\n-            )}\n-          </ResultSetButtons>\n-          {search && (\n-            <Input\n-              onChange={changeSearch}\n-              value={searchText}\n-              className=\"form-control input-sm\"\n-              placeholder={t('Filter results')}\n-            />\n-          )}\n-        </ResultSetControls>\n+          <PanelToolbar\n+            viewId={ViewContribution.Results}\n+            defaultPrimaryActions={defaultPrimaryActions}\n+          />\n+        </ResultSetButtons>\n       );\n     }\n-    return <div />;\n+    return null;\n   };\n \n-  const renderRowsReturned = (alertMessage: boolean) => {\n+  const renderRowsReturned = () => {\n     const { results, rows, queryLimit, limitingFactor } = query;\n     let limitMessage = '';\n     const limitReached = results?.displayLimitReached;\n     const limit = queryLimit || results.query.limit;\n-    const isAdmin = !!user?.roles?.Admin;\n-    const rowsCount = Math.min(rows || 0, results?.data?.length || 0);\n-\n-    const displayMaxRowsReachedMessage = {\n-      withAdmin: t(\n-        'The number of results displayed is limited to %(rows)d by the configuration DISPLAY_MAX_ROW. ' +\n-          'Please add additional limits/filters or download to csv to see more rows up to ' +\n-          'the %(limit)d limit.',\n-        { rows: rowsCount, limit },\n-      ),\n-      withoutAdmin: t(\n-        'The number of results displayed is limited to %(rows)d. ' +\n-          'Please add additional limits/filters, download to csv, or contact an admin ' +\n-          'to see more rows up to the %(limit)d limit.',\n-        { rows: rowsCount, limit },\n-      ),\n-    };\n     const shouldUseDefaultDropdownAlert =\n       limit === defaultQueryLimit && limitingFactor === LimitingFactor.Dropdown;\n \n@@ -514,76 +484,53 @@ const ResultSet = ({\n         'The number of rows displayed is limited to %(rows)d by the query and limit dropdown.',\n         { rows },\n       );\n+    } else if (shouldUseDefaultDropdownAlert) {\n+      limitMessage = t(\n+        'The number of rows displayed is limited to %(rows)d by the dropdown.',\n+        { rows },\n+      );\n+    } else if (limitReached) {\n+      limitMessage = t(\n+        'The number of results displayed is limited to %(rows)d.',\n+        { rows },\n+      );\n     }\n+\n     const formattedRowCount = getNumberFormatter()(rows);\n     const rowsReturnedMessage = t('%(rows)d rows returned', {\n       rows,\n     });\n \n-    const tooltipText = `${rowsReturnedMessage}. ${limitMessage}`;\n-\n-    if (alertMessage) {\n-      return (\n-        <>\n-          {!limitReached && shouldUseDefaultDropdownAlert && (\n-            <div>\n-              <Alert\n-                closable\n-                type=\"warning\"\n-                message={t(\n-                  'The number of rows displayed is limited to %(rows)d by the dropdown.',\n-                  { rows },\n-                )}\n-              />\n-            </div>\n-          )}\n-          {limitReached && (\n-            <div>\n-              <Alert\n-                closable\n-                type=\"warning\"\n-                message={\n-                  isAdmin\n-                    ? displayMaxRowsReachedMessage.withAdmin\n-                    : displayMaxRowsReachedMessage.withoutAdmin\n-                }\n-              />\n-            </div>\n-          )}\n-        </>\n-      );\n-    }\n-    const showRowsReturned =\n-      showSqlInline || (!limitReached && !shouldUseDefaultDropdownAlert);\n+    const hasWarning = !!limitMessage;\n+    const tooltipText = hasWarning\n+      ? `${rowsReturnedMessage}. ${limitMessage}`\n+      : rowsReturnedMessage;\n \n     return (\n-      <>\n-        {showRowsReturned && (\n-          <ReturnedRows>\n-            <Tooltip\n-              id=\"sqllab-rowcount-tooltip\"\n-              title={tooltipText}\n-              placement=\"left\"\n-            >\n-              <Label\n+      <ReturnedRows>\n+        <Tooltip\n+          id=\"sqllab-rowcount-tooltip\"\n+          title={tooltipText}\n+          placement=\"left\"\n+        >\n+          <Label\n+            css={css`\n+              line-height: ${theme.fontSizeLG}px;\n+            `}\n+          >\n+            {hasWarning && (\n+              <Icons.WarningOutlined\n                 css={css`\n-                  line-height: ${theme.fontSizeLG}px;\n+                  font-size: ${theme.fontSize}px;\n+                  margin-right: ${theme.sizeUnit}px;\n+                  color: ${theme.colorWarning};\n                 `}\n-              >\n-                {limitMessage && (\n-                  <Icons.ExclamationCircleOutlined\n-                    css={css`\n-                      font-size: ${theme.fontSize}px;\n-                      margin-right: ${theme.sizeUnit}px;\n-                    `}\n-                  />\n-                )}\n-                {tn('%s row', '%s rows', rows, formattedRowCount)}\n-              </Label>\n-            </Tooltip>\n-          </ReturnedRows>\n-        )}\n-      </>\n+              />\n+            )}\n+            {tn('%s row', '%s rows', rows, formattedRowCount)}\n+          </Label>\n+        </Tooltip>\n+      </ReturnedRows>\n     );\n   };\n \n@@ -728,45 +675,58 @@ const ResultSet = ({\n       return (\n         <>\n           <ResultContainer>\n-            {renderControls()}\n-            {showSql && showSqlInline ? (\n-              <>\n-                <div\n-                  css={css`\n-                    display: flex;\n-                    justify-content: space-between;\n-                    align-items: center;\n-                    gap: ${GAP}px;\n-                  `}\n-                >\n-                  <Card\n-                    css={[\n-                      css`\n-                        height: 28px;\n-                        width: calc(100% - ${ROWS_CHIP_WIDTH + GAP}px);\n-                        code {\n-                          width: 100%;\n-                          overflow: hidden;\n-                          white-space: nowrap !important;\n-                          text-overflow: ellipsis;\n-                          display: block;\n-                        }\n-                      `,\n-                    ]}\n+            <div\n+              css={css`\n+                display: flex;\n+                align-items: center;\n+                gap: ${GAP}px;\n+\n+                & .ant-divider {\n+                  height: ${theme.sizeUnit * 6}px;\n+                  margin: 0 ${theme.sizeUnit * 2}px 0 0;\n+                }\n+              `}\n+            >\n+              {renderControls()}\n+              <Divider type=\"vertical\" />\n+              {showSql && (\n+                <>\n+                  <div\n+                    css={css`\n+                      flex: 0 1 auto;\n+                      min-width: 0;\n+                      overflow: hidden;\n+                      margin-right: ${theme.sizeUnit}px;\n+\n+                      & * {\n+                        overflow: hidden !important;\n+                        white-space: nowrap !important;\n+                        text-overflow: ellipsis !important;\n+                      }\n+\n+                      pre {\n+                        margin: 0 !important;\n+                      }\n+                    `}\n                   >\n                     {sql}\n-                  </Card>\n-                  {renderRowsReturned(false)}\n-                </div>\n-                {renderRowsReturned(true)}\n-              </>\n-            ) : (\n-              <>\n-                {renderRowsReturned(false)}\n-                {renderRowsReturned(true)}\n-                {sql}\n-              </>\n-            )}\n+                  </div>\n+                  <Divider type=\"vertical\" />\n+                </>\n+              )}\n+              {renderRowsReturned()}\n+              {search && (\n+                <Input\n+                  css={css`\n+                    flex: none;\n+                    width: 200px;\n+                  `}\n+                  onChange={changeSearch}\n+                  value={searchText}\n+                  placeholder={t('Filter results')}\n+                />\n+              )}\n+            </div>\n             {useFixedHeight && height !== undefined ? (\n               <ResultTable {...tableProps} height={height} />\n             ) : (", "pull_request_number": 37255}
{"sha": "6d46c4cd78aa82d8594ca8206ee0e9fb9352de4f", "filename": "superset-frontend/src/SqlLab/components/SaveQuery/index.tsx", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/apache/superset/blob/19138e3e0cc79106033bc194b1a685641b7edc2b/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FSaveQuery%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/19138e3e0cc79106033bc194b1a685641b7edc2b/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FSaveQuery%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FSaveQuery%2Findex.tsx?ref=19138e3e0cc79106033bc194b1a685641b7edc2b", "patch": "@@ -62,6 +62,7 @@ export type QueryPayload = {\n } & Pick<QueryEditor, 'dbId' | 'catalog' | 'schema' | 'sql'>;\n \n const Styles = styled.span`\n+  display: contents;\n   span[role='img']:not([aria-label='down']) {\n     display: flex;\n     margin: 0;", "pull_request_number": 37255}
{"sha": "2f3414981517457863c83538b247d956a1b63390", "filename": "superset-frontend/src/SqlLab/components/SouthPane/Results.tsx", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/19138e3e0cc79106033bc194b1a685641b7edc2b/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FSouthPane%2FResults.tsx", "raw_url": "https://github.com/apache/superset/raw/19138e3e0cc79106033bc194b1a685641b7edc2b/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FSouthPane%2FResults.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FSouthPane%2FResults.tsx?ref=19138e3e0cc79106033bc194b1a685641b7edc2b", "patch": "@@ -80,7 +80,7 @@ const Results: FC<Props> = ({\n   ) {\n     return (\n       <Alert\n-        type=\"warning\"\n+        type=\"info\"\n         message={t('No stored results found, you need to re-run your query')}\n       />\n     );", "pull_request_number": 37255}
{"sha": "4478e716bdc95ad7c11e9703e3bfba735176d88a", "filename": "superset-frontend/src/SqlLab/components/SouthPane/index.tsx", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/apache/superset/blob/19138e3e0cc79106033bc194b1a685641b7edc2b/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FSouthPane%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/19138e3e0cc79106033bc194b1a685641b7edc2b/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FSouthPane%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FSouthPane%2Findex.tsx?ref=19138e3e0cc79106033bc194b1a685641b7edc2b", "patch": "@@ -29,7 +29,7 @@ import { Flex, Label } from '@superset-ui/core/components';\n import { Icons } from '@superset-ui/core/components/Icons';\n import { SqlLabRootState } from 'src/SqlLab/types';\n import { ViewContribution } from 'src/SqlLab/contributions';\n-import MenuListExtension from 'src/components/MenuListExtension';\n+import PanelToolbar from 'src/components/PanelToolbar';\n import { useExtensionsContext } from 'src/extensions/ExtensionsContext';\n import ExtensionsManager from 'src/extensions/ExtensionsManager';\n import useQueryEditor from 'src/SqlLab/hooks/useQueryEditor';\n@@ -215,7 +215,18 @@ const SouthPane = ({\n     ...contributions.map(contribution => ({\n       key: contribution.id,\n       label: contribution.name,\n-      children: getView(contribution.id),\n+      children: (\n+        <div\n+          css={css`\n+            & > div:first-of-type {\n+              padding-bottom: ${theme.sizeUnit * 2}px;\n+            }\n+          `}\n+        >\n+          <PanelToolbar viewId={contribution.id} />\n+          {getView(contribution.id)}\n+        </div>\n+      ),\n       forceRender: true,\n       closable: false,\n     })),\n@@ -231,8 +242,7 @@ const SouthPane = ({\n                 padding: 8px;\n               `}\n             >\n-              <MenuListExtension viewId={ViewContribution.Panels} primary />\n-              <MenuListExtension viewId={ViewContribution.Panels} secondary />\n+              <PanelToolbar viewId={ViewContribution.Panels} />\n             </Flex>\n           ),\n         }}", "pull_request_number": 37255}
{"sha": "5745fb51596146d9de32b0840138d2b1174931c5", "filename": "superset-frontend/src/SqlLab/components/SqlEditor/index.tsx", "status": "modified", "additions": 10, "deletions": 14, "changes": 24, "blob_url": "https://github.com/apache/superset/blob/19138e3e0cc79106033bc194b1a685641b7edc2b/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FSqlEditor%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/19138e3e0cc79106033bc194b1a685641b7edc2b/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FSqlEditor%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FSqlEditor%2Findex.tsx?ref=19138e3e0cc79106033bc194b1a685641b7edc2b", "patch": "@@ -760,23 +760,19 @@ const SqlEditor: FC<Props> = ({\n           stopQuery={stopQuery}\n           overlayCreateAsMenu={showMenu ? runMenuBtn : null}\n         />\n-        <span>\n-          <QueryLimitSelect\n-            queryEditorId={queryEditor.id}\n-            maxRow={maxRow}\n-            defaultQueryLimit={defaultQueryLimit}\n-          />\n-        </span>\n+        <QueryLimitSelect\n+          queryEditorId={queryEditor.id}\n+          maxRow={maxRow}\n+          defaultQueryLimit={defaultQueryLimit}\n+        />\n         <Divider type=\"vertical\" />\n         {isFeatureEnabled(FeatureFlag.EstimateQueryCost) &&\n           database?.allows_cost_estimate && (\n-            <span>\n-              <EstimateQueryCostButton\n-                getEstimate={getQueryCostEstimate}\n-                queryEditorId={queryEditor.id}\n-                tooltip={t('Estimate the cost before running a query')}\n-              />\n-            </span>\n+            <EstimateQueryCostButton\n+              getEstimate={getQueryCostEstimate}\n+              queryEditorId={queryEditor.id}\n+              tooltip={t('Estimate the cost before running a query')}\n+            />\n           )}\n         <SaveQuery\n           queryEditorId={queryEditor.id}", "pull_request_number": 37255}
{"sha": "224627b070188de4f5d8f7b10d868005037aafc7", "filename": "superset-frontend/src/SqlLab/components/SqlEditorTopBar/SqlEditorTopBar.test.tsx", "status": "modified", "additions": 19, "deletions": 43, "changes": 62, "blob_url": "https://github.com/apache/superset/blob/19138e3e0cc79106033bc194b1a685641b7edc2b/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FSqlEditorTopBar%2FSqlEditorTopBar.test.tsx", "raw_url": "https://github.com/apache/superset/raw/19138e3e0cc79106033bc194b1a685641b7edc2b/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FSqlEditorTopBar%2FSqlEditorTopBar.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FSqlEditorTopBar%2FSqlEditorTopBar.test.tsx?ref=19138e3e0cc79106033bc194b1a685641b7edc2b", "patch": "@@ -22,29 +22,23 @@ import SqlEditorTopBar, {\n   SqlEditorTopBarProps,\n } from 'src/SqlLab/components/SqlEditorTopBar';\n \n-jest.mock('src/components/MenuListExtension', () => ({\n+jest.mock('src/components/PanelToolbar', () => ({\n   __esModule: true,\n   default: ({\n-    children,\n     viewId,\n-    primary,\n-    secondary,\n-    defaultItems,\n+    defaultPrimaryActions,\n+    defaultSecondaryActions,\n   }: {\n-    children?: React.ReactNode;\n     viewId: string;\n-    primary?: boolean;\n-    secondary?: boolean;\n-    defaultItems?: MenuItemType[];\n+    defaultPrimaryActions?: React.ReactNode;\n+    defaultSecondaryActions?: MenuItemType[];\n   }) => (\n     <div\n-      data-test=\"mock-menu-extension\"\n+      data-test=\"mock-panel-toolbar\"\n       data-view-id={viewId}\n-      data-primary={primary}\n-      data-secondary={secondary}\n-      data-default-items-count={defaultItems?.length ?? 0}\n+      data-default-secondary-count={defaultSecondaryActions?.length ?? 0}\n     >\n-      {children}\n+      {defaultPrimaryActions}\n     </div>\n   ),\n }));\n@@ -63,30 +57,23 @@ const setup = (props?: Partial<SqlEditorTopBarProps>) =>\n \n test('renders SqlEditorTopBar component', () => {\n   setup();\n-  const menuExtensions = screen.getAllByTestId('mock-menu-extension');\n-  expect(menuExtensions).toHaveLength(2);\n+  const panelToolbar = screen.getByTestId('mock-panel-toolbar');\n+  expect(panelToolbar).toBeInTheDocument();\n });\n \n-test('renders primary MenuListExtension with correct props', () => {\n+test('renders PanelToolbar with correct viewId', () => {\n   setup();\n-  const menuExtensions = screen.getAllByTestId('mock-menu-extension');\n-  const primaryExtension = menuExtensions[0];\n-\n-  expect(primaryExtension).toHaveAttribute('data-view-id', 'sqllab.editor');\n-  expect(primaryExtension).toHaveAttribute('data-primary', 'true');\n+  const panelToolbar = screen.getByTestId('mock-panel-toolbar');\n+  expect(panelToolbar).toHaveAttribute('data-view-id', 'sqllab.editor');\n });\n \n-test('renders secondary MenuListExtension with correct props', () => {\n+test('renders PanelToolbar with correct secondary actions count', () => {\n   setup();\n-  const menuExtensions = screen.getAllByTestId('mock-menu-extension');\n-  const secondaryExtension = menuExtensions[1];\n-\n-  expect(secondaryExtension).toHaveAttribute('data-view-id', 'sqllab.editor');\n-  expect(secondaryExtension).toHaveAttribute('data-secondary', 'true');\n-  expect(secondaryExtension).toHaveAttribute('data-default-items-count', '2');\n+  const panelToolbar = screen.getByTestId('mock-panel-toolbar');\n+  expect(panelToolbar).toHaveAttribute('data-default-secondary-count', '2');\n });\n \n-test('renders defaultPrimaryActions as children of primary MenuListExtension', () => {\n+test('renders defaultPrimaryActions', () => {\n   setup();\n   expect(\n     screen.getByRole('button', { name: 'Primary Action' }),\n@@ -114,17 +101,6 @@ test('renders with custom primary actions', () => {\n test('renders with empty secondary actions', () => {\n   setup({ defaultSecondaryActions: [] });\n \n-  const menuExtensions = screen.getAllByTestId('mock-menu-extension');\n-  const secondaryExtension = menuExtensions[1];\n-\n-  expect(secondaryExtension).toHaveAttribute('data-default-items-count', '0');\n-});\n-\n-test('passes correct viewId (ViewContribution.Editor) to MenuListExtension', () => {\n-  setup();\n-  const menuExtensions = screen.getAllByTestId('mock-menu-extension');\n-\n-  menuExtensions.forEach(extension => {\n-    expect(extension).toHaveAttribute('data-view-id', 'sqllab.editor');\n-  });\n+  const panelToolbar = screen.getByTestId('mock-panel-toolbar');\n+  expect(panelToolbar).toHaveAttribute('data-default-secondary-count', '0');\n });", "pull_request_number": 37255}
{"sha": "0a3f00da3f97076391cdda8ec9e24a3d50cc6d50", "filename": "superset-frontend/src/SqlLab/components/SqlEditorTopBar/index.tsx", "status": "modified", "additions": 9, "deletions": 20, "changes": 29, "blob_url": "https://github.com/apache/superset/blob/19138e3e0cc79106033bc194b1a685641b7edc2b/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FSqlEditorTopBar%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/19138e3e0cc79106033bc194b1a685641b7edc2b/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FSqlEditorTopBar%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2FSqlLab%2Fcomponents%2FSqlEditorTopBar%2Findex.tsx?ref=19138e3e0cc79106033bc194b1a685641b7edc2b", "patch": "@@ -16,25 +16,21 @@\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n-import { Divider, Flex } from '@superset-ui/core/components';\n+import { Flex } from '@superset-ui/core/components';\n import { styled } from '@apache-superset/core/ui';\n+import { MenuItemType } from '@superset-ui/core/components/Menu';\n import { ViewContribution } from 'src/SqlLab/contributions';\n-import MenuListExtension, {\n-  type MenuListExtensionProps,\n-} from 'src/components/MenuListExtension';\n+import PanelToolbar from 'src/components/PanelToolbar';\n \n const StyledFlex = styled(Flex)`\n   margin-bottom: ${({ theme }) => theme.sizeUnit * 2}px;\n-\n-  & .ant-divider {\n-    margin: ${({ theme }) => theme.sizeUnit * 2}px 0;\n-    height: ${({ theme }) => theme.sizeUnit * 6}px;\n-  }\n+  padding: ${({ theme }) => theme.sizeUnit}px 0;\n `;\n+\n export interface SqlEditorTopBarProps {\n   queryEditorId: string;\n   defaultPrimaryActions: React.ReactNode;\n-  defaultSecondaryActions: MenuListExtensionProps['defaultItems'];\n+  defaultSecondaryActions: MenuItemType[];\n }\n \n const SqlEditorTopBar = ({\n@@ -43,18 +39,11 @@ const SqlEditorTopBar = ({\n }: SqlEditorTopBarProps) => (\n   <StyledFlex justify=\"space-between\" gap=\"small\" id=\"js-sql-toolbar\">\n     <Flex flex={1} gap=\"small\" align=\"center\">\n-      <Flex gap=\"small\" align=\"center\">\n-        <MenuListExtension viewId={ViewContribution.Editor} primary compactMode>\n-          {defaultPrimaryActions}\n-        </MenuListExtension>\n-      </Flex>\n-      <Divider type=\"vertical\" />\n-      <MenuListExtension\n+      <PanelToolbar\n         viewId={ViewContribution.Editor}\n-        secondary\n-        defaultItems={defaultSecondaryActions}\n+        defaultPrimaryActions={defaultPrimaryActions}\n+        defaultSecondaryActions={defaultSecondaryActions}\n       />\n-      <Divider type=\"vertical\" />\n     </Flex>\n   </StyledFlex>\n );", "pull_request_number": 37255}
{"sha": "bdaf184e325448430132bb7f6a385d001519fe5f", "filename": "superset-frontend/src/SqlLab/contributions.ts", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/19138e3e0cc79106033bc194b1a685641b7edc2b/superset-frontend%2Fsrc%2FSqlLab%2Fcontributions.ts", "raw_url": "https://github.com/apache/superset/raw/19138e3e0cc79106033bc194b1a685641b7edc2b/superset-frontend%2Fsrc%2FSqlLab%2Fcontributions.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2FSqlLab%2Fcontributions.ts?ref=19138e3e0cc79106033bc194b1a685641b7edc2b", "patch": "@@ -21,4 +21,6 @@ export enum ViewContribution {\n   Panels = 'sqllab.panels',\n   Editor = 'sqllab.editor',\n   StatusBar = 'sqllab.statusBar',\n+  Results = 'sqllab.results',\n+  QueryHistory = 'sqllab.queryHistory',\n }", "pull_request_number": 37255}
{"sha": "853c58c8aaf3c4d5e77ac8677f07e2b463c72784", "filename": "superset-frontend/src/components/MenuListExtension/MenuListExtension.test.tsx", "status": "removed", "additions": 0, "deletions": 374, "changes": 374, "blob_url": "https://github.com/apache/superset/blob/409cdad2648c7476cf1769196e970149cbecf800/superset-frontend%2Fsrc%2Fcomponents%2FMenuListExtension%2FMenuListExtension.test.tsx", "raw_url": "https://github.com/apache/superset/raw/409cdad2648c7476cf1769196e970149cbecf800/superset-frontend%2Fsrc%2Fcomponents%2FMenuListExtension%2FMenuListExtension.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fcomponents%2FMenuListExtension%2FMenuListExtension.test.tsx?ref=409cdad2648c7476cf1769196e970149cbecf800", "patch": "@@ -1,374 +0,0 @@\n-/**\n- * Licensed to the Apache Software Foundation (ASF) under one\n- * or more contributor license agreements.  See the NOTICE file\n- * distributed with this work for additional information\n- * regarding copyright ownership.  The ASF licenses this file\n- * to you under the Apache License, Version 2.0 (the\n- * \"License\"); you may not use this file except in compliance\n- * with the License.  You may obtain a copy of the License at\n- *\n- *   http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing,\n- * software distributed under the License is distributed on an\n- * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n- * KIND, either express or implied.  See the License for the\n- * specific language governing permissions and limitations\n- * under the License.\n- */\n-import { render, screen, waitFor } from 'spec/helpers/testing-library';\n-import userEvent from '@testing-library/user-event';\n-import type { contributions, core } from '@apache-superset/core';\n-import ExtensionsManager from 'src/extensions/ExtensionsManager';\n-import { commands } from 'src/core';\n-import MenuListExtension from '.';\n-\n-jest.mock('src/core', () => ({\n-  commands: {\n-    executeCommand: jest.fn(),\n-  },\n-}));\n-\n-function createMockCommand(\n-  command: string,\n-  overrides: Partial<contributions.CommandContribution> = {},\n-): contributions.CommandContribution {\n-  return {\n-    command,\n-    icon: 'PlusOutlined',\n-    title: `${command} Title`,\n-    description: `${command} description`,\n-    ...overrides,\n-  };\n-}\n-\n-function createMockMenuItem(\n-  view: string,\n-  command: string,\n-): contributions.MenuItem {\n-  return {\n-    view,\n-    command,\n-  };\n-}\n-\n-function createMockMenu(\n-  overrides: Partial<contributions.MenuContribution> = {},\n-): contributions.MenuContribution {\n-  return {\n-    context: [],\n-    primary: [],\n-    secondary: [],\n-    ...overrides,\n-  };\n-}\n-\n-function createMockExtension(\n-  options: Partial<core.Extension> & {\n-    commands?: contributions.CommandContribution[];\n-    menus?: Record<string, contributions.MenuContribution>;\n-  } = {},\n-): core.Extension {\n-  const {\n-    id = 'test-extension',\n-    name = 'Test Extension',\n-    commands: cmds = [],\n-    menus = {},\n-  } = options;\n-\n-  return {\n-    id,\n-    name,\n-    description: 'A test extension',\n-    version: '1.0.0',\n-    dependencies: [],\n-    remoteEntry: '',\n-    exposedModules: [],\n-    extensionDependencies: [],\n-    contributions: {\n-      commands: cmds,\n-      menus,\n-      views: {},\n-    },\n-    activate: jest.fn(),\n-    deactivate: jest.fn(),\n-  };\n-}\n-\n-function setupActivatedExtension(\n-  manager: ExtensionsManager,\n-  extension: core.Extension,\n-) {\n-  const context = { disposables: [] };\n-  (manager as any).contextIndex.set(extension.id, context);\n-  (manager as any).extensionContributions.set(extension.id, {\n-    commands: extension.contributions.commands,\n-    menus: extension.contributions.menus,\n-    views: extension.contributions.views,\n-  });\n-}\n-\n-async function createActivatedExtension(\n-  manager: ExtensionsManager,\n-  extensionOptions: Parameters<typeof createMockExtension>[0] = {},\n-): Promise<core.Extension> {\n-  const mockExtension = createMockExtension(extensionOptions);\n-  await manager.initializeExtension(mockExtension);\n-  setupActivatedExtension(manager, mockExtension);\n-  return mockExtension;\n-}\n-\n-const TEST_VIEW_ID = 'test.menu';\n-\n-beforeEach(() => {\n-  (ExtensionsManager as any).instance = undefined;\n-  jest.clearAllMocks();\n-});\n-\n-afterEach(() => {\n-  (ExtensionsManager as any).instance = undefined;\n-});\n-\n-test('renders children when primary mode with no extensions', () => {\n-  render(\n-    <MenuListExtension viewId={TEST_VIEW_ID} primary>\n-      <button type=\"button\">Child Button</button>\n-    </MenuListExtension>,\n-  );\n-\n-  expect(\n-    screen.getByRole('button', { name: 'Child Button' }),\n-  ).toBeInTheDocument();\n-});\n-\n-test('renders primary actions from extension contributions', async () => {\n-  const manager = ExtensionsManager.getInstance();\n-\n-  await createActivatedExtension(manager, {\n-    commands: [createMockCommand('test.action')],\n-    menus: {\n-      [TEST_VIEW_ID]: createMockMenu({\n-        primary: [createMockMenuItem('test-view', 'test.action')],\n-      }),\n-    },\n-  });\n-\n-  render(<MenuListExtension viewId={TEST_VIEW_ID} primary />);\n-\n-  expect(screen.getByText('test.action Title')).toBeInTheDocument();\n-});\n-\n-test('renders primary actions with children', async () => {\n-  const manager = ExtensionsManager.getInstance();\n-\n-  await createActivatedExtension(manager, {\n-    commands: [createMockCommand('test.action')],\n-    menus: {\n-      [TEST_VIEW_ID]: createMockMenu({\n-        primary: [createMockMenuItem('test-view', 'test.action')],\n-      }),\n-    },\n-  });\n-\n-  render(\n-    <MenuListExtension viewId={TEST_VIEW_ID} primary>\n-      <button type=\"button\">Child Button</button>\n-    </MenuListExtension>,\n-  );\n-\n-  expect(screen.getByText('test.action Title')).toBeInTheDocument();\n-  expect(\n-    screen.getByRole('button', { name: 'Child Button' }),\n-  ).toBeInTheDocument();\n-});\n-\n-test('hides title in compact mode for primary actions', async () => {\n-  const manager = ExtensionsManager.getInstance();\n-\n-  await createActivatedExtension(manager, {\n-    commands: [createMockCommand('test.action')],\n-    menus: {\n-      [TEST_VIEW_ID]: createMockMenu({\n-        primary: [createMockMenuItem('test-view', 'test.action')],\n-      }),\n-    },\n-  });\n-\n-  render(<MenuListExtension viewId={TEST_VIEW_ID} primary compactMode />);\n-\n-  expect(screen.queryByText('test.action Title')).not.toBeInTheDocument();\n-  expect(screen.getByRole('button')).toBeInTheDocument();\n-});\n-\n-test('executes command when primary action button is clicked', async () => {\n-  const manager = ExtensionsManager.getInstance();\n-\n-  await createActivatedExtension(manager, {\n-    commands: [createMockCommand('test.action')],\n-    menus: {\n-      [TEST_VIEW_ID]: createMockMenu({\n-        primary: [createMockMenuItem('test-view', 'test.action')],\n-      }),\n-    },\n-  });\n-\n-  render(<MenuListExtension viewId={TEST_VIEW_ID} primary />);\n-\n-  const button = screen.getByRole('button', { name: 'test.action Title' });\n-  await userEvent.click(button);\n-\n-  expect(commands.executeCommand).toHaveBeenCalledWith('test.action');\n-});\n-\n-test('returns null when secondary mode with no actions and no defaultItems', () => {\n-  const { container } = render(\n-    <MenuListExtension viewId={TEST_VIEW_ID} secondary />,\n-  );\n-\n-  expect(container).toBeEmptyDOMElement();\n-});\n-\n-test('renders dropdown button when secondary mode with defaultItems', () => {\n-  render(\n-    <MenuListExtension\n-      viewId={TEST_VIEW_ID}\n-      secondary\n-      defaultItems={[{ key: 'item1', label: 'Item 1' }]}\n-    />,\n-  );\n-\n-  expect(screen.getByRole('button')).toBeInTheDocument();\n-});\n-\n-test('renders dropdown menu with defaultItems when clicked', async () => {\n-  render(\n-    <MenuListExtension\n-      viewId={TEST_VIEW_ID}\n-      secondary\n-      defaultItems={[\n-        { key: 'item1', label: 'Item 1' },\n-        { key: 'item2', label: 'Item 2' },\n-      ]}\n-    />,\n-  );\n-\n-  const dropdownButton = screen.getByRole('button');\n-  await userEvent.click(dropdownButton);\n-\n-  await waitFor(() => {\n-    expect(screen.getByText('Item 1')).toBeInTheDocument();\n-    expect(screen.getByText('Item 2')).toBeInTheDocument();\n-  });\n-});\n-\n-test('renders secondary actions from extension contributions', async () => {\n-  const manager = ExtensionsManager.getInstance();\n-\n-  await createActivatedExtension(manager, {\n-    commands: [createMockCommand('test.secondary')],\n-    menus: {\n-      [TEST_VIEW_ID]: createMockMenu({\n-        secondary: [createMockMenuItem('test-view', 'test.secondary')],\n-      }),\n-    },\n-  });\n-\n-  render(<MenuListExtension viewId={TEST_VIEW_ID} secondary />);\n-\n-  const dropdownButton = screen.getByRole('button');\n-  await userEvent.click(dropdownButton);\n-\n-  await waitFor(() => {\n-    expect(screen.getByText('test.secondary Title')).toBeInTheDocument();\n-  });\n-});\n-\n-test('merges extension secondary actions with defaultItems', async () => {\n-  const manager = ExtensionsManager.getInstance();\n-\n-  await createActivatedExtension(manager, {\n-    commands: [createMockCommand('test.secondary')],\n-    menus: {\n-      [TEST_VIEW_ID]: createMockMenu({\n-        secondary: [createMockMenuItem('test-view', 'test.secondary')],\n-      }),\n-    },\n-  });\n-\n-  render(\n-    <MenuListExtension\n-      viewId={TEST_VIEW_ID}\n-      secondary\n-      defaultItems={[{ key: 'default-item', label: 'Default Item' }]}\n-    />,\n-  );\n-\n-  const dropdownButton = screen.getByRole('button');\n-  await userEvent.click(dropdownButton);\n-\n-  await waitFor(() => {\n-    expect(screen.getByText('test.secondary Title')).toBeInTheDocument();\n-    expect(screen.getByText('Default Item')).toBeInTheDocument();\n-  });\n-});\n-\n-test('executes command when secondary menu item is clicked', async () => {\n-  const manager = ExtensionsManager.getInstance();\n-\n-  await createActivatedExtension(manager, {\n-    commands: [createMockCommand('test.secondary')],\n-    menus: {\n-      [TEST_VIEW_ID]: createMockMenu({\n-        secondary: [createMockMenuItem('test-view', 'test.secondary')],\n-      }),\n-    },\n-  });\n-\n-  render(<MenuListExtension viewId={TEST_VIEW_ID} secondary />);\n-\n-  const dropdownButton = screen.getByRole('button');\n-  await userEvent.click(dropdownButton);\n-\n-  await waitFor(() => {\n-    expect(screen.getByText('test.secondary Title')).toBeInTheDocument();\n-  });\n-\n-  const menuItem = screen.getByText('test.secondary Title');\n-  await userEvent.click(menuItem);\n-\n-  expect(commands.executeCommand).toHaveBeenCalledWith('test.secondary');\n-});\n-\n-test('renders multiple primary actions from multiple contributions', async () => {\n-  const manager = ExtensionsManager.getInstance();\n-\n-  await createActivatedExtension(manager, {\n-    commands: [\n-      createMockCommand('test.action1'),\n-      createMockCommand('test.action2'),\n-    ],\n-    menus: {\n-      [TEST_VIEW_ID]: createMockMenu({\n-        primary: [\n-          createMockMenuItem('test-view1', 'test.action1'),\n-          createMockMenuItem('test-view2', 'test.action2'),\n-        ],\n-      }),\n-    },\n-  });\n-\n-  render(<MenuListExtension viewId={TEST_VIEW_ID} primary />);\n-\n-  expect(await screen.findByText('test.action1 Title')).toBeInTheDocument();\n-  expect(screen.getByText('test.action2 Title')).toBeInTheDocument();\n-});\n-\n-test('handles viewId with no matching contributions', () => {\n-  render(\n-    <MenuListExtension viewId=\"nonexistent.menu\" primary>\n-      <button type=\"button\">Fallback</button>\n-    </MenuListExtension>,\n-  );\n-\n-  expect(screen.getByRole('button', { name: 'Fallback' })).toBeInTheDocument();\n-});", "pull_request_number": 37255}
{"sha": "98608f6a291235136e3f8e8f839227a97c983aa6", "filename": "superset-frontend/src/components/MenuListExtension/index.tsx", "status": "removed", "additions": 0, "deletions": 157, "changes": 157, "blob_url": "https://github.com/apache/superset/blob/409cdad2648c7476cf1769196e970149cbecf800/superset-frontend%2Fsrc%2Fcomponents%2FMenuListExtension%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/409cdad2648c7476cf1769196e970149cbecf800/superset-frontend%2Fsrc%2Fcomponents%2FMenuListExtension%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fcomponents%2FMenuListExtension%2Findex.tsx?ref=409cdad2648c7476cf1769196e970149cbecf800", "patch": "@@ -1,157 +0,0 @@\n-/**\n- * Licensed to the Apache Software Foundation (ASF) under one\n- * or more contributor license agreements.  See the NOTICE file\n- * distributed with this work for additional information\n- * regarding copyright ownership.  The ASF licenses this file\n- * to you under the Apache License, Version 2.0 (the\n- * \"License\"); you may not use this file except in compliance\n- * with the License.  You may obtain a copy of the License at\n- *\n- *   http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing,\n- * software distributed under the License is distributed on an\n- * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n- * KIND, either express or implied.  See the License for the\n- * specific language governing permissions and limitations\n- * under the License.\n- */\n-import { useMemo } from 'react';\n-import { css, useTheme } from '@apache-superset/core/ui';\n-import { Button, Dropdown } from '@superset-ui/core/components';\n-import { Menu, MenuItemType } from '@superset-ui/core/components/Menu';\n-import { Icons } from '@superset-ui/core/components/Icons';\n-import { commands } from 'src/core';\n-import ExtensionsManager from 'src/extensions/ExtensionsManager';\n-\n-export type MenuListExtensionProps = {\n-  viewId: string;\n-} & (\n-  | {\n-      primary: boolean;\n-      secondary?: never;\n-      children?: React.ReactNode;\n-      defaultItems?: never;\n-      compactMode?: boolean;\n-    }\n-  | {\n-      primary?: never;\n-      secondary: boolean;\n-      children?: never;\n-      defaultItems?: MenuItemType[];\n-      compactMode?: never;\n-    }\n-);\n-\n-const MenuListExtension = ({\n-  viewId,\n-  primary,\n-  secondary,\n-  defaultItems,\n-  children,\n-  compactMode,\n-}: MenuListExtensionProps) => {\n-  const theme = useTheme();\n-  const contributions =\n-    ExtensionsManager.getInstance().getMenuContributions(viewId);\n-\n-  const actions = primary ? contributions?.primary : contributions?.secondary;\n-  const primaryActions = useMemo(\n-    () =>\n-      primary\n-        ? (actions || []).map(contribution => {\n-            const command =\n-              ExtensionsManager.getInstance().getCommandContribution(\n-                contribution.command,\n-              )!;\n-            if (!command?.icon) {\n-              return null;\n-            }\n-            const Icon =\n-              (Icons as Record<string, typeof Icons.FileOutlined>)[\n-                command.icon\n-              ] ?? Icons.FileOutlined;\n-\n-            return (\n-              <Button\n-                key={contribution.view}\n-                onClick={() => commands.executeCommand(command?.command)}\n-                tooltip={command?.description ?? command?.title}\n-                icon={<Icon iconSize=\"m\" />}\n-                buttonSize=\"small\"\n-                aria-label={command?.title}\n-                {...(compactMode && { variant: 'text', color: 'primary' })}\n-              >\n-                {!compactMode ? command?.title : undefined}\n-              </Button>\n-            );\n-          })\n-        : [],\n-    [actions, primary, compactMode],\n-  );\n-  const secondaryActions = useMemo(\n-    () =>\n-      secondary\n-        ? (actions || [])\n-            .map(contribution => {\n-              const command =\n-                ExtensionsManager.getInstance().getCommandContribution(\n-                  contribution.command,\n-                )!;\n-              if (!command) {\n-                return null;\n-              }\n-              return {\n-                key: command.command,\n-                label: command.title,\n-                title: command.description,\n-                onClick: () => commands.executeCommand(command.command),\n-              } as MenuItemType;\n-            })\n-            .concat(...(defaultItems || []))\n-            .filter(Boolean)\n-        : [],\n-    [actions, secondary, defaultItems],\n-  );\n-\n-  if (secondary && secondaryActions.length === 0) {\n-    return null;\n-  }\n-\n-  if (secondary) {\n-    return (\n-      <Dropdown\n-        popupRender={() => (\n-          <Menu\n-            css={css`\n-              & .ant-dropdown-menu-title-content > div {\n-                gap: ${theme.sizeUnit * 4}px;\n-              }\n-            `}\n-            items={secondaryActions}\n-          />\n-        )}\n-        trigger={['click']}\n-      >\n-        <Button\n-          showMarginRight={false}\n-          color=\"primary\"\n-          variant=\"text\"\n-          css={css`\n-            padding: 8px;\n-          `}\n-        >\n-          <Icons.MoreOutlined />\n-        </Button>\n-      </Dropdown>\n-    );\n-  }\n-  return (\n-    <>\n-      {primaryActions}\n-      {children}\n-    </>\n-  );\n-};\n-\n-export default MenuListExtension;", "pull_request_number": 37255}
{"sha": "7f88197811b5ad8efe95ae79c4ee749dc47c761e", "filename": "superset-frontend/src/components/PanelToolbar/index.tsx", "status": "added", "additions": 165, "deletions": 0, "changes": 165, "blob_url": "https://github.com/apache/superset/blob/19138e3e0cc79106033bc194b1a685641b7edc2b/superset-frontend%2Fsrc%2Fcomponents%2FPanelToolbar%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/19138e3e0cc79106033bc194b1a685641b7edc2b/superset-frontend%2Fsrc%2Fcomponents%2FPanelToolbar%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fcomponents%2FPanelToolbar%2Findex.tsx?ref=19138e3e0cc79106033bc194b1a685641b7edc2b", "patch": "@@ -0,0 +1,165 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import { useMemo } from 'react';\n+import { css, useTheme } from '@apache-superset/core/ui';\n+import { Button, Divider, Dropdown } from '@superset-ui/core/components';\n+import { Menu, MenuItemType } from '@superset-ui/core/components/Menu';\n+import { Icons } from '@superset-ui/core/components/Icons';\n+import { commands } from 'src/core';\n+import ExtensionsManager from 'src/extensions/ExtensionsManager';\n+\n+export interface PanelToolbarProps {\n+  viewId: string;\n+  defaultPrimaryActions?: React.ReactNode;\n+  defaultSecondaryActions?: MenuItemType[];\n+}\n+\n+const PanelToolbar = ({\n+  viewId,\n+  defaultPrimaryActions,\n+  defaultSecondaryActions,\n+}: PanelToolbarProps) => {\n+  const theme = useTheme();\n+  const contributions =\n+    ExtensionsManager.getInstance().getMenuContributions(viewId);\n+\n+  const primaryContributions = contributions?.primary || [];\n+  const secondaryContributions = contributions?.secondary || [];\n+\n+  const extensionPrimaryActions = useMemo(\n+    () =>\n+      primaryContributions\n+        .map(contribution => {\n+          const command =\n+            ExtensionsManager.getInstance().getCommandContribution(\n+              contribution.command,\n+            )!;\n+          if (!command?.icon) {\n+            return null;\n+          }\n+          const Icon =\n+            (Icons as Record<string, typeof Icons.FileOutlined>)[\n+              command.icon\n+            ] ?? Icons.FileOutlined;\n+\n+          return (\n+            <Button\n+              key={contribution.view}\n+              onClick={() => commands.executeCommand(command?.command)}\n+              tooltip={command?.description ?? command?.title}\n+              icon={<Icon iconSize=\"m\" />}\n+              buttonSize=\"small\"\n+              aria-label={command?.title}\n+              variant=\"text\"\n+              color=\"primary\"\n+            />\n+          );\n+        })\n+        .filter(Boolean),\n+    [primaryContributions],\n+  );\n+\n+  const secondaryActions = useMemo(\n+    () =>\n+      secondaryContributions\n+        .map(contribution => {\n+          const command =\n+            ExtensionsManager.getInstance().getCommandContribution(\n+              contribution.command,\n+            )!;\n+          if (!command) {\n+            return null;\n+          }\n+          return {\n+            key: command.command,\n+            label: command.title,\n+            title: command.description,\n+            onClick: () => commands.executeCommand(command.command),\n+          } as MenuItemType;\n+        })\n+        .filter(Boolean)\n+        .concat(defaultSecondaryActions || []),\n+    [secondaryContributions, defaultSecondaryActions],\n+  );\n+\n+  const hasPrimaryActions =\n+    !!defaultPrimaryActions || extensionPrimaryActions.length > 0;\n+  const hasSecondaryActions = secondaryActions.length > 0;\n+\n+  // If no actions at all, render nothing\n+  if (!hasPrimaryActions && !hasSecondaryActions) {\n+    return null;\n+  }\n+\n+  const toolbarStyles = css`\n+    display: flex;\n+    align-items: center;\n+    gap: ${theme.sizeUnit * 2}px;\n+\n+    & .ant-divider {\n+      height: ${theme.sizeUnit * 6}px;\n+      margin: 0;\n+    }\n+\n+    & .superset-button {\n+      margin-left: 0 !important;\n+      min-width: ${theme.sizeUnit * 8}px;\n+    }\n+  `;\n+\n+  return (\n+    <div css={toolbarStyles}>\n+      {hasPrimaryActions && (\n+        <>\n+          {defaultPrimaryActions}\n+          {extensionPrimaryActions}\n+        </>\n+      )}\n+      {hasPrimaryActions && hasSecondaryActions && <Divider type=\"vertical\" />}\n+      {hasSecondaryActions && (\n+        <Dropdown\n+          popupRender={() => (\n+            <Menu\n+              css={css`\n+                & .ant-dropdown-menu-title-content > div {\n+                  gap: ${theme.sizeUnit * 4}px;\n+                }\n+              `}\n+              items={secondaryActions}\n+            />\n+          )}\n+          trigger={['click']}\n+        >\n+          <Button\n+            showMarginRight={false}\n+            color=\"primary\"\n+            variant=\"text\"\n+            css={css`\n+              padding: 8px;\n+            `}\n+          >\n+            <Icons.MoreOutlined />\n+          </Button>\n+        </Dropdown>\n+      )}\n+    </div>\n+  );\n+};\n+\n+export default PanelToolbar;", "pull_request_number": 37255}
{"sha": "af3d711495abef634a5119998f7dff7ce2663b5b", "filename": "superset-frontend/src/dashboard/actions/nativeFilters.ts", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/apache/superset/blob/76a3d5cec9ce623ffe53da38cb5dc43a3233d537/superset-frontend%2Fsrc%2Fdashboard%2Factions%2FnativeFilters.ts", "raw_url": "https://github.com/apache/superset/raw/76a3d5cec9ce623ffe53da38cb5dc43a3233d537/superset-frontend%2Fsrc%2Fdashboard%2Factions%2FnativeFilters.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fdashboard%2Factions%2FnativeFilters.ts?ref=76a3d5cec9ce623ffe53da38cb5dc43a3233d537", "patch": "@@ -21,6 +21,9 @@ import {\n   FilterConfiguration,\n   Filters,\n   makeApi,\n+  Divider,\n+  ChartCustomization,\n+  ChartCustomizationDivider,\n } from '@superset-ui/core';\n import { Dispatch } from 'redux';\n import { RootState } from 'src/dashboard/types';\n@@ -44,7 +47,9 @@ export const SET_NATIVE_FILTERS_CONFIG_COMPLETE =\n   'SET_NATIVE_FILTERS_CONFIG_COMPLETE';\n export interface SetNativeFiltersConfigComplete {\n   type: typeof SET_NATIVE_FILTERS_CONFIG_COMPLETE;\n-  filterChanges: Filter[];\n+  filterChanges: Array<\n+    Filter | Divider | ChartCustomization | ChartCustomizationDivider\n+  >;\n }\n \n export const SET_NATIVE_FILTERS_CONFIG_FAIL = 'SET_NATIVE_FILTERS_CONFIG_FAIL';", "pull_request_number": 37012}
{"sha": "ceac844317b186346afe771331052de75233da12", "filename": "superset-frontend/src/dashboard/reducers/nativeFilters.test.ts", "status": "modified", "additions": 179, "deletions": 1, "changes": 180, "blob_url": "https://github.com/apache/superset/blob/76a3d5cec9ce623ffe53da38cb5dc43a3233d537/superset-frontend%2Fsrc%2Fdashboard%2Freducers%2FnativeFilters.test.ts", "raw_url": "https://github.com/apache/superset/raw/76a3d5cec9ce623ffe53da38cb5dc43a3233d537/superset-frontend%2Fsrc%2Fdashboard%2Freducers%2FnativeFilters.test.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fdashboard%2Freducers%2FnativeFilters.test.ts?ref=76a3d5cec9ce623ffe53da38cb5dc43a3233d537", "patch": "@@ -16,7 +16,12 @@\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n-import { Filter, NativeFilterType } from '@superset-ui/core';\n+import {\n+  Filter,\n+  NativeFilterType,\n+  ChartCustomization,\n+  ChartCustomizationType,\n+} from '@superset-ui/core';\n import nativeFilterReducer from './nativeFilters';\n import { SET_NATIVE_FILTERS_CONFIG_COMPLETE } from '../actions/nativeFilters';\n import { HYDRATE_DASHBOARD } from '../actions/hydrate';\n@@ -58,6 +63,40 @@ const createMockFilter = (\n   tabsInScope,\n });\n \n+const createMockChartCustomization = (\n+  id: string,\n+  chartsInScope?: number[],\n+  tabsInScope?: string[],\n+): ChartCustomization => ({\n+  id,\n+  type: ChartCustomizationType.ChartCustomization,\n+  name: `Chart Customization ${id}`,\n+  filterType: 'filter_select',\n+  targets: [\n+    {\n+      datasetId: 0,\n+      column: {\n+        name: 'test column',\n+        displayName: 'test column',\n+      },\n+    },\n+  ],\n+  scope: {\n+    rootPath: [],\n+    excluded: [],\n+  },\n+  defaultDataMask: {\n+    filterState: {\n+      value: null,\n+    },\n+  },\n+  controlValues: {\n+    sortAscending: true,\n+  },\n+  chartsInScope,\n+  tabsInScope,\n+});\n+\n test('SET_NATIVE_FILTERS_CONFIG_COMPLETE updates filters with complete scope properties', () => {\n   const initialState = {\n     filters: {\n@@ -237,3 +276,142 @@ test('HYDRATE_DASHBOARD handles new filters without existing state', () => {\n   expect(result.filters.filter1.chartsInScope).toEqual([1, 2]);\n   expect(result.filters.filter1.tabsInScope).toEqual(['tab1']);\n });\n+\n+test('SET_NATIVE_FILTERS_CONFIG_COMPLETE removes deleted filters from state', () => {\n+  const initialState = {\n+    filters: {\n+      filter1: createMockFilter('filter1', [1, 2], ['tab1']),\n+      filter2: createMockFilter('filter2', [3, 4], ['tab2']),\n+      filter3: createMockFilter('filter3', [5, 6], ['tab3']),\n+    },\n+  };\n+\n+  // Backend response only includes filter1 and filter3 (filter2 was deleted)\n+  const action = {\n+    type: SET_NATIVE_FILTERS_CONFIG_COMPLETE as typeof SET_NATIVE_FILTERS_CONFIG_COMPLETE,\n+    filterChanges: [\n+      createMockFilter('filter1', [1, 2], ['tab1']),\n+      createMockFilter('filter3', [5, 6], ['tab3']),\n+    ],\n+  };\n+\n+  const result = nativeFilterReducer(initialState, action);\n+\n+  // filter2 should be removed from state\n+  expect(result.filters.filter1).toBeDefined();\n+  expect(result.filters.filter2).toBeUndefined();\n+  expect(result.filters.filter3).toBeDefined();\n+  expect(Object.keys(result.filters)).toHaveLength(2);\n+});\n+\n+test('SET_NATIVE_FILTERS_CONFIG_COMPLETE removes all filters when backend returns empty array', () => {\n+  const initialState = {\n+    filters: {\n+      filter1: createMockFilter('filter1', [1, 2], ['tab1']),\n+      filter2: createMockFilter('filter2', [3, 4], ['tab2']),\n+    },\n+  };\n+\n+  const action = {\n+    type: SET_NATIVE_FILTERS_CONFIG_COMPLETE as typeof SET_NATIVE_FILTERS_CONFIG_COMPLETE,\n+    filterChanges: [],\n+  };\n+\n+  const result = nativeFilterReducer(initialState, action);\n+\n+  expect(Object.keys(result.filters)).toHaveLength(0);\n+  expect(result.filters).toEqual({});\n+});\n+\n+test('SET_NATIVE_FILTERS_CONFIG_COMPLETE handles mixed Filter and ChartCustomization types', () => {\n+  const initialState = {\n+    filters: {\n+      filter1: createMockFilter('filter1', [1, 2], ['tab1']),\n+      customization1: createMockChartCustomization(\n+        'customization1',\n+        [3, 4],\n+        ['tab2'],\n+      ),\n+    },\n+  };\n+\n+  const action = {\n+    type: SET_NATIVE_FILTERS_CONFIG_COMPLETE as typeof SET_NATIVE_FILTERS_CONFIG_COMPLETE,\n+    filterChanges: [\n+      createMockFilter('filter1', [5, 6], ['tab3']),\n+      createMockChartCustomization('customization1', [7, 8], ['tab4']),\n+    ],\n+  };\n+\n+  const result = nativeFilterReducer(initialState, action);\n+\n+  expect(result.filters.filter1.chartsInScope).toEqual([5, 6]);\n+  expect(result.filters.filter1.tabsInScope).toEqual(['tab3']);\n+  expect(result.filters.customization1.chartsInScope).toEqual([7, 8]);\n+  expect(result.filters.customization1.tabsInScope).toEqual(['tab4']);\n+});\n+\n+test('SET_NATIVE_FILTERS_CONFIG_COMPLETE adds new filters while removing deleted ones', () => {\n+  const initialState = {\n+    filters: {\n+      filter1: createMockFilter('filter1', [1, 2], ['tab1']),\n+      filter2: createMockFilter('filter2', [3, 4], ['tab2']),\n+    },\n+  };\n+\n+  // Backend response: keep filter1, delete filter2, add filter3\n+  const action = {\n+    type: SET_NATIVE_FILTERS_CONFIG_COMPLETE as typeof SET_NATIVE_FILTERS_CONFIG_COMPLETE,\n+    filterChanges: [\n+      createMockFilter('filter1', [1, 2], ['tab1']),\n+      createMockFilter('filter3', [5, 6], ['tab3']),\n+    ],\n+  };\n+\n+  const result = nativeFilterReducer(initialState, action);\n+\n+  expect(result.filters.filter1).toBeDefined();\n+  expect(result.filters.filter2).toBeUndefined();\n+  expect(result.filters.filter3).toBeDefined();\n+  expect(result.filters.filter3.chartsInScope).toEqual([5, 6]);\n+  expect(Object.keys(result.filters)).toHaveLength(2);\n+});\n+\n+test('SET_NATIVE_FILTERS_CONFIG_COMPLETE treats backend response as source of truth', () => {\n+  const initialState = {\n+    filters: {\n+      filter1: createMockFilter('filter1', [1, 2], ['tab1']),\n+      filter2: createMockFilter('filter2', [3, 4], ['tab2']),\n+      filter3: createMockFilter('filter3', [5, 6], ['tab3']),\n+      customization1: createMockChartCustomization(\n+        'customization1',\n+        [7, 8],\n+        ['tab4'],\n+      ),\n+    },\n+  };\n+\n+  // Backend only returns filter2 and customization1\n+  const action = {\n+    type: SET_NATIVE_FILTERS_CONFIG_COMPLETE as typeof SET_NATIVE_FILTERS_CONFIG_COMPLETE,\n+    filterChanges: [\n+      createMockFilter('filter2', [10, 11], ['tab5']),\n+      createMockChartCustomization('customization1', [12, 13], ['tab6']),\n+    ],\n+  };\n+\n+  const result = nativeFilterReducer(initialState, action);\n+\n+  // Only filter2 and customization1 should remain\n+  expect(result.filters.filter1).toBeUndefined();\n+  expect(result.filters.filter2).toBeDefined();\n+  expect(result.filters.filter3).toBeUndefined();\n+  expect(result.filters.customization1).toBeDefined();\n+  expect(Object.keys(result.filters)).toHaveLength(2);\n+\n+  // Values should be from backend response\n+  expect(result.filters.filter2.chartsInScope).toEqual([10, 11]);\n+  expect(result.filters.filter2.tabsInScope).toEqual(['tab5']);\n+  expect(result.filters.customization1.chartsInScope).toEqual([12, 13]);\n+  expect(result.filters.customization1.tabsInScope).toEqual(['tab6']);\n+});", "pull_request_number": 37012}
{"sha": "37f406dbaf6caf9b1fd076eac0d9045df9d14b5f", "filename": "superset-frontend/src/dashboard/reducers/nativeFilters.ts", "status": "modified", "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/apache/superset/blob/76a3d5cec9ce623ffe53da38cb5dc43a3233d537/superset-frontend%2Fsrc%2Fdashboard%2Freducers%2FnativeFilters.ts", "raw_url": "https://github.com/apache/superset/raw/76a3d5cec9ce623ffe53da38cb5dc43a3233d537/superset-frontend%2Fsrc%2Fdashboard%2Freducers%2FnativeFilters.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fdashboard%2Freducers%2FnativeFilters.ts?ref=76a3d5cec9ce623ffe53da38cb5dc43a3233d537", "patch": "@@ -77,13 +77,18 @@ function handleFilterChangesComplete(\n     Filter | Divider | ChartCustomization | ChartCustomizationDivider\n   >,\n ) {\n-  const modifiedFilters = { ...state.filters };\n+  // Create new filters object from backend response (deleted filters won't be included)\n+  const newFilters: Record<\n+    string,\n+    Filter | Divider | ChartCustomization | ChartCustomizationDivider\n+  > = {};\n+\n   filters.forEach(filter => {\n+    const existingFilter = state.filters[filter.id];\n     if (filter.chartsInScope != null && filter.tabsInScope != null) {\n-      modifiedFilters[filter.id] = filter;\n+      newFilters[filter.id] = filter;\n     } else {\n-      const existingFilter = modifiedFilters[filter.id];\n-      modifiedFilters[filter.id] = {\n+      newFilters[filter.id] = {\n         ...filter,\n         chartsInScope: filter.chartsInScope ?? existingFilter?.chartsInScope,\n         tabsInScope: filter.tabsInScope ?? existingFilter?.tabsInScope,\n@@ -93,7 +98,7 @@ function handleFilterChangesComplete(\n \n   return {\n     ...state,\n-    filters: modifiedFilters,\n+    filters: newFilters,\n   } as ExtendedNativeFiltersState;\n }\n ", "pull_request_number": 37012}
{"sha": "f355a24136e82a7509207965b1e45ac23b831e61", "filename": "superset-frontend/plugins/plugin-chart-ag-grid-table/src/controlPanel.tsx", "status": "modified", "additions": 18, "deletions": 10, "changes": 28, "blob_url": "https://github.com/apache/superset/blob/2029fd013105611e965015268c4f212a9441e59e/superset-frontend%2Fplugins%2Fplugin-chart-ag-grid-table%2Fsrc%2FcontrolPanel.tsx", "raw_url": "https://github.com/apache/superset/raw/2029fd013105611e965015268c4f212a9441e59e/superset-frontend%2Fplugins%2Fplugin-chart-ag-grid-table%2Fsrc%2FcontrolPanel.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-ag-grid-table%2Fsrc%2FcontrolPanel.tsx?ref=2029fd013105611e965015268c4f212a9441e59e", "patch": "@@ -673,16 +673,6 @@ const config: ControlPanelConfig = {\n               type: 'ConditionalFormattingControl',\n               renderTrigger: true,\n               label: t('Custom conditional formatting'),\n-              extraColorChoices: [\n-                {\n-                  value: ColorSchemeEnum.Green,\n-                  label: t('Green for increase, red for decrease'),\n-                },\n-                {\n-                  value: ColorSchemeEnum.Red,\n-                  label: t('Red for increase, green for decrease'),\n-                },\n-              ],\n               description: t(\n                 'Apply conditional color formatting to numeric columns',\n               ),\n@@ -695,6 +685,23 @@ const config: ControlPanelConfig = {\n                 )\n                   ? (explore?.datasource as Dataset)?.verbose_map\n                   : (explore?.datasource?.columns ?? {});\n+\n+                // Only show increase/decrease color options when time comparison is active\n+                const hasTimeComparison = !isEmpty(\n+                  explore?.form_data?.time_compare,\n+                );\n+                const extraColorChoices = hasTimeComparison\n+                  ? [\n+                      {\n+                        value: ColorSchemeEnum.Green,\n+                        label: t('Green for increase, red for decrease'),\n+                      },\n+                      {\n+                        value: ColorSchemeEnum.Red,\n+                        label: t('Red for increase, green for decrease'),\n+                      },\n+                    ]\n+                  : [];\n                 const chartStatus = chart?.chartStatus;\n                 const { colnames, coltypes } =\n                   chart?.queriesResponse?.[0] ?? {};\n@@ -725,6 +732,7 @@ const config: ControlPanelConfig = {\n                   removeIrrelevantConditions: chartStatus === 'success',\n                   columnOptions,\n                   verboseMap,\n+                  extraColorChoices,\n                 };\n               },\n             },", "pull_request_number": 34523}
{"sha": "a472763d827f1d397cc4cbb98fa60d1b98ebd6f6", "filename": "superset-frontend/plugins/plugin-chart-table/src/controlPanel.tsx", "status": "modified", "additions": 18, "deletions": 10, "changes": 28, "blob_url": "https://github.com/apache/superset/blob/2029fd013105611e965015268c4f212a9441e59e/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2FcontrolPanel.tsx", "raw_url": "https://github.com/apache/superset/raw/2029fd013105611e965015268c4f212a9441e59e/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2FcontrolPanel.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2FcontrolPanel.tsx?ref=2029fd013105611e965015268c4f212a9441e59e", "patch": "@@ -730,16 +730,6 @@ const config: ControlPanelConfig = {\n               type: 'ConditionalFormattingControl',\n               renderTrigger: true,\n               label: t('Custom conditional formatting'),\n-              extraColorChoices: [\n-                {\n-                  value: ColorSchemeEnum.Green,\n-                  label: t('Green for increase, red for decrease'),\n-                },\n-                {\n-                  value: ColorSchemeEnum.Red,\n-                  label: t('Red for increase, green for decrease'),\n-                },\n-              ],\n               description: t(\n                 'Apply conditional color formatting to numeric columns',\n               ),\n@@ -752,6 +742,23 @@ const config: ControlPanelConfig = {\n                 )\n                   ? (explore?.datasource as Dataset)?.verbose_map\n                   : (explore?.datasource?.columns ?? {});\n+\n+                // Only show increase/decrease color options when time comparison is active\n+                const hasTimeComparison = !isEmpty(\n+                  explore?.form_data?.time_compare,\n+                );\n+                const extraColorChoices = hasTimeComparison\n+                  ? [\n+                      {\n+                        value: ColorSchemeEnum.Green,\n+                        label: t('Green for increase, red for decrease'),\n+                      },\n+                      {\n+                        value: ColorSchemeEnum.Red,\n+                        label: t('Red for increase, green for decrease'),\n+                      },\n+                    ]\n+                  : [];\n                 const chartStatus = chart?.chartStatus;\n                 const { colnames, coltypes } =\n                   chart?.queriesResponse?.[0] ?? {};\n@@ -782,6 +789,7 @@ const config: ControlPanelConfig = {\n                   removeIrrelevantConditions: chartStatus === 'success',\n                   columnOptions,\n                   verboseMap,\n+                  extraColorChoices,\n                 };\n               },\n             },", "pull_request_number": 34523}
{"sha": "0b9953b95a0ed14b630290780cc51c3ece31e3b4", "filename": "superset-frontend/packages/superset-ui-chart-controls/src/shared-controls/sharedControls.tsx", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fpackages%2Fsuperset-ui-chart-controls%2Fsrc%2Fshared-controls%2FsharedControls.tsx", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fpackages%2Fsuperset-ui-chart-controls%2Fsrc%2Fshared-controls%2FsharedControls.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-chart-controls%2Fsrc%2Fshared-controls%2FsharedControls.tsx?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -325,6 +325,9 @@ const currency_format: SharedControlConfig<'CurrencyControl'> = {\n   type: 'CurrencyControl',\n   label: t('Currency format'),\n   renderTrigger: true,\n+  description: t(\n+    \"Format metrics or columns with currency symbols as prefixes or suffixes. Choose a symbol manually or use 'Auto-detect' to apply the correct symbol based on the dataset's currency code column. When multiple currencies are present, formatting falls back to neutral numbers.\",\n+  ),\n };\n \n const x_axis_time_format: SharedControlConfig<", "pull_request_number": 36416}
{"sha": "ffb32bf9d28cf4826980c212037e9b2bbbef214f", "filename": "superset-frontend/packages/superset-ui-chart-controls/src/types.ts", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fpackages%2Fsuperset-ui-chart-controls%2Fsrc%2Ftypes.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fpackages%2Fsuperset-ui-chart-controls%2Fsrc%2Ftypes.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-chart-controls%2Fsrc%2Ftypes.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -72,6 +72,7 @@ export interface Dataset {\n   currency_formats?: Record<string, Currency>;\n   verbose_map: Record<string, string>;\n   main_dttm_col: string;\n+  currency_code_column?: string;\n   // eg. ['[\"ds\", true]', 'ds [asc]']\n   order_by_choices?: [string, string][] | null;\n   time_grain_sqla?: [string, string][];", "pull_request_number": 36416}
{"sha": "17f257112adcb700e5f130e8d4b1500b85d6b579", "filename": "superset-frontend/packages/superset-ui-core/src/currency-format/CurrencyFormats.ts", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcurrency-format%2FCurrencyFormats.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcurrency-format%2FCurrencyFormats.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcurrency-format%2FCurrencyFormats.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -0,0 +1,22 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+export const AUTO_CURRENCY_SYMBOL = 'AUTO';\n+\n+export const ISO_4217_REGEX = /^[A-Z]{3}$/;", "pull_request_number": 36416}
{"sha": "a7997879c59eddfbf921f38bdb1c2514ee39cb80", "filename": "superset-frontend/packages/superset-ui-core/src/currency-format/CurrencyFormatter.ts", "status": "modified", "additions": 81, "deletions": 7, "changes": 88, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcurrency-format%2FCurrencyFormatter.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcurrency-format%2FCurrencyFormatter.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcurrency-format%2FCurrencyFormatter.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -20,6 +20,8 @@\n import { ExtensibleFunction } from '../models';\n import { getNumberFormatter, NumberFormats } from '../number-format';\n import { Currency } from '../query';\n+import { RowData, RowDataValue } from './types';\n+import { AUTO_CURRENCY_SYMBOL, ISO_4217_REGEX } from './CurrencyFormats';\n \n /* eslint-disable @typescript-eslint/no-unsafe-declaration-merging */\n \n@@ -30,7 +32,11 @@ interface CurrencyFormatterConfig {\n }\n \n interface CurrencyFormatter {\n-  (value: number | null | undefined): string;\n+  (\n+    value: number | null | undefined,\n+    rowData?: RowData,\n+    currencyColumn?: string,\n+  ): string;\n }\n \n export const getCurrencySymbol = (currency: Partial<Currency>) =>\n@@ -41,6 +47,32 @@ export const getCurrencySymbol = (currency: Partial<Currency>) =>\n     .formatToParts(1)\n     .find(x => x.type === 'currency')?.value;\n \n+export function normalizeCurrency(value: RowDataValue): string | null {\n+  if (value === null || value === undefined) return null;\n+  if (typeof value !== 'string') return null;\n+\n+  const normalized = value.trim().toUpperCase();\n+\n+  return ISO_4217_REGEX.test(normalized) ? normalized : null;\n+}\n+\n+export function hasMixedCurrencies(currencies: RowDataValue[]): boolean {\n+  let first: string | null = null;\n+\n+  for (const c of currencies) {\n+    const normalized = normalizeCurrency(c);\n+    if (normalized === null) continue;\n+\n+    if (first === null) {\n+      first = normalized;\n+    } else if (normalized !== first) {\n+      return true;\n+    }\n+  }\n+\n+  return false;\n+}\n+\n class CurrencyFormatter extends ExtensibleFunction {\n   d3Format: string;\n \n@@ -49,7 +81,9 @@ class CurrencyFormatter extends ExtensibleFunction {\n   currency: Currency;\n \n   constructor(config: CurrencyFormatterConfig) {\n-    super((value: number) => this.format(value));\n+    super((value: number, rowData?: RowData, currencyColumn?: string) =>\n+      this.format(value, rowData, currencyColumn),\n+    );\n     this.d3Format = config.d3Format || NumberFormats.SMART_NUMBER;\n     this.currency = config.currency;\n     this.locale = config.locale || 'en-US';\n@@ -67,19 +101,59 @@ class CurrencyFormatter extends ExtensibleFunction {\n     return value.replace(/%/g, '');\n   }\n \n-  format(value: number) {\n+  format(value: number, rowData?: RowData, currencyColumn?: string): string {\n     const formattedValue = getNumberFormatter(this.getNormalizedD3Format())(\n       value,\n     );\n-    if (!this.hasValidCurrency()) {\n+\n+    const isAutoMode = this.currency?.symbol === AUTO_CURRENCY_SYMBOL;\n+\n+    if (!this.hasValidCurrency() && !isAutoMode) {\n       return formattedValue as string;\n     }\n \n+    // Remove % signs from formatted value for currency display\n     const normalizedValue = this.normalizeForCurrency(formattedValue);\n-    if (this.currency.symbolPosition === 'prefix') {\n-      return `${getCurrencySymbol(this.currency)} ${normalizedValue}`;\n+\n+    if (isAutoMode) {\n+      if (rowData && currencyColumn && rowData[currencyColumn]) {\n+        const rawCurrency = rowData[currencyColumn];\n+        const normalizedCurrency = normalizeCurrency(rawCurrency);\n+\n+        if (normalizedCurrency) {\n+          try {\n+            const symbol = getCurrencySymbol({ symbol: normalizedCurrency });\n+            if (symbol) {\n+              if (this.currency.symbolPosition === 'prefix') {\n+                return `${symbol} ${normalizedValue}`;\n+              } else if (this.currency.symbolPosition === 'suffix') {\n+                return `${normalizedValue} ${symbol}`;\n+              }\n+              // Unknown symbolPosition - default to suffix\n+              return `${normalizedValue} ${symbol}`;\n+            }\n+          } catch {\n+            // Invalid currency code - return value without currency symbol\n+            return formattedValue;\n+          }\n+        }\n+      }\n+      return formattedValue;\n+    }\n+\n+    try {\n+      const symbol = getCurrencySymbol(this.currency);\n+      if (this.currency.symbolPosition === 'prefix') {\n+        return `${symbol} ${normalizedValue}`;\n+      } else if (this.currency.symbolPosition === 'suffix') {\n+        return `${normalizedValue} ${symbol}`;\n+      }\n+      // Unknown symbolPosition - default to suffix\n+      return `${normalizedValue} ${symbol}`;\n+    } catch {\n+      // Invalid currency code - return value without currency symbol\n+      return formattedValue;\n     }\n-    return `${normalizedValue} ${getCurrencySymbol(this.currency)}`;\n   }\n }\n ", "pull_request_number": 36416}
{"sha": "8f696f40cb99bc86854661d28e6345f9fcf6112b", "filename": "superset-frontend/packages/superset-ui-core/src/currency-format/index.ts", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcurrency-format%2Findex.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcurrency-format%2Findex.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcurrency-format%2Findex.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -1,4 +1,4 @@\n-/*\n+/**\n  * Licensed to the Apache Software Foundation (ASF) under one\n  * or more contributor license agreements.  See the NOTICE file\n  * distributed with this work for additional information\n@@ -18,5 +18,11 @@\n  */\n \n export { default as CurrencyFormatter } from './CurrencyFormatter';\n-export * from './CurrencyFormatter';\n+export {\n+  getCurrencySymbol,\n+  normalizeCurrency,\n+  hasMixedCurrencies,\n+} from './CurrencyFormatter';\n+export { AUTO_CURRENCY_SYMBOL, ISO_4217_REGEX } from './CurrencyFormats';\n+export * from './types';\n export * from './utils';", "pull_request_number": 36416}
{"sha": "882fca6f42a3cbad1bf48ef19860f4f38bc3019f", "filename": "superset-frontend/packages/superset-ui-core/src/currency-format/types.ts", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcurrency-format%2Ftypes.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcurrency-format%2Ftypes.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcurrency-format%2Ftypes.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -0,0 +1,29 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+export type RowDataValue =\n+  | string\n+  | number\n+  | boolean\n+  | Date\n+  | bigint\n+  | null\n+  | undefined;\n+\n+export type RowData = Record<string, RowDataValue>;", "pull_request_number": 36416}
{"sha": "53a704ab97fc27e2f65107bc4e055b64d4bec3a4", "filename": "superset-frontend/packages/superset-ui-core/src/currency-format/utils.ts", "status": "modified", "additions": 122, "deletions": 7, "changes": 129, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcurrency-format%2Futils.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcurrency-format%2Futils.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fcurrency-format%2Futils.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -25,21 +25,104 @@ import {\n   QueryFormMetric,\n   ValueFormatter,\n } from '@superset-ui/core';\n+import { normalizeCurrency, hasMixedCurrencies } from './CurrencyFormatter';\n+import { RowData, RowDataValue } from './types';\n+import { AUTO_CURRENCY_SYMBOL } from './CurrencyFormats';\n+\n+export const analyzeCurrencyInData = (\n+  data: RowData[],\n+  currencyColumn: string | undefined,\n+): string | null => {\n+  if (!currencyColumn || !data || data.length === 0) {\n+    return null;\n+  }\n+\n+  const currencies: RowDataValue[] = data\n+    .map(row => row[currencyColumn])\n+    .filter(val => val !== null && val !== undefined);\n+\n+  if (currencies.length === 0) {\n+    return null;\n+  }\n+\n+  if (hasMixedCurrencies(currencies)) {\n+    return null;\n+  }\n+\n+  return normalizeCurrency(currencies[0]);\n+};\n+\n+export const resolveAutoCurrency = (\n+  currencyFormat: Currency | undefined,\n+  backendDetected: string | null | undefined,\n+  data?: RowData[],\n+  currencyCodeColumn?: string,\n+): Currency | undefined | null => {\n+  if (currencyFormat?.symbol !== AUTO_CURRENCY_SYMBOL) return currencyFormat;\n+\n+  const detectedCurrency =\n+    backendDetected ??\n+    (data && currencyCodeColumn\n+      ? analyzeCurrencyInData(data, currencyCodeColumn)\n+      : null);\n+\n+  if (detectedCurrency) {\n+    return {\n+      symbol: detectedCurrency,\n+      symbolPosition: currencyFormat.symbolPosition,\n+    };\n+  }\n+  return null; // Mixed currencies\n+};\n+\n+const getEffectiveCurrencyFormat = (\n+  resolvedCurrencyFormat: Currency | undefined | null,\n+  savedFormat: Currency | undefined,\n+): Currency | undefined => {\n+  if (resolvedCurrencyFormat === null) {\n+    return undefined;\n+  }\n+  if (resolvedCurrencyFormat?.symbol) {\n+    return resolvedCurrencyFormat;\n+  }\n+  return savedFormat;\n+};\n \n export const buildCustomFormatters = (\n   metrics: QueryFormMetric | QueryFormMetric[] | undefined,\n   savedCurrencyFormats: Record<string, Currency>,\n   savedColumnFormats: Record<string, string>,\n   d3Format: string | undefined,\n-  currencyFormat: Currency | undefined,\n+  currencyFormat: Currency | undefined | null,\n+  data?: RowData[],\n+  currencyCodeColumn?: string,\n ) => {\n   const metricsArray = ensureIsArray(metrics);\n+\n+  let resolvedCurrencyFormat = currencyFormat;\n+  if (\n+    currencyFormat?.symbol === AUTO_CURRENCY_SYMBOL &&\n+    data &&\n+    currencyCodeColumn\n+  ) {\n+    const detectedCurrency = analyzeCurrencyInData(data, currencyCodeColumn);\n+    if (detectedCurrency) {\n+      resolvedCurrencyFormat = {\n+        symbol: detectedCurrency,\n+        symbolPosition: currencyFormat.symbolPosition,\n+      };\n+    } else {\n+      resolvedCurrencyFormat = null;\n+    }\n+  }\n+\n   return metricsArray.reduce((acc, metric) => {\n     if (isSavedMetric(metric)) {\n       const actualD3Format = d3Format ?? savedColumnFormats[metric];\n-      const actualCurrencyFormat = currencyFormat?.symbol\n-        ? currencyFormat\n-        : savedCurrencyFormats[metric];\n+      const actualCurrencyFormat = getEffectiveCurrencyFormat(\n+        resolvedCurrencyFormat,\n+        savedCurrencyFormats[metric],\n+      );\n       return actualCurrencyFormat?.symbol\n         ? {\n             ...acc,\n@@ -76,14 +159,40 @@ export const getValueFormatter = (\n   d3Format: string | undefined,\n   currencyFormat: Currency | undefined,\n   key?: string,\n+  data?: RowData[],\n+  currencyCodeColumn?: string,\n+  detectedCurrency?: string | null,\n ) => {\n+  let resolvedCurrencyFormat: Currency | undefined | null = currencyFormat;\n+  if (currencyFormat?.symbol === AUTO_CURRENCY_SYMBOL) {\n+    // Use backend-detected currency, or fallback to frontend analysis\n+    if (detectedCurrency !== undefined) {\n+      resolvedCurrencyFormat = detectedCurrency\n+        ? {\n+            symbol: detectedCurrency,\n+            symbolPosition: currencyFormat.symbolPosition,\n+          }\n+        : null;\n+    } else if (data && currencyCodeColumn) {\n+      const frontendDetected = analyzeCurrencyInData(data, currencyCodeColumn);\n+      resolvedCurrencyFormat = frontendDetected\n+        ? {\n+            symbol: frontendDetected,\n+            symbolPosition: currencyFormat.symbolPosition,\n+          }\n+        : null;\n+    } else {\n+      resolvedCurrencyFormat = null;\n+    }\n+  }\n+\n   const customFormatter = getCustomFormatter(\n     buildCustomFormatters(\n       metrics,\n       savedCurrencyFormats,\n       savedColumnFormats,\n       d3Format,\n-      currencyFormat,\n+      resolvedCurrencyFormat,\n     ),\n     metrics,\n     key,\n@@ -92,8 +201,14 @@ export const getValueFormatter = (\n   if (customFormatter) {\n     return customFormatter;\n   }\n-  if (currencyFormat?.symbol) {\n-    return new CurrencyFormatter({ currency: currencyFormat, d3Format });\n+  if (resolvedCurrencyFormat === null) {\n+    return getNumberFormatter(d3Format);\n+  }\n+  if (resolvedCurrencyFormat?.symbol) {\n+    return new CurrencyFormatter({\n+      currency: resolvedCurrencyFormat,\n+      d3Format,\n+    });\n   }\n   return getNumberFormatter(d3Format);\n };", "pull_request_number": 36416}
{"sha": "47902cf07ae3fa47442a16770440a3ba4fc605ba", "filename": "superset-frontend/packages/superset-ui-core/src/query/types/Datasource.ts", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fquery%2Ftypes%2FDatasource.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fquery%2Ftypes%2FDatasource.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fquery%2Ftypes%2FDatasource.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -53,6 +53,7 @@ export interface Datasource {\n   verboseMap?: {\n     [key: string]: string;\n   };\n+  currencyCodeColumn?: string;\n }\n \n export const DEFAULT_METRICS: Metric[] = [", "pull_request_number": 36416}
{"sha": "a1786da738921a8781c8715ba0eb1cf78898220d", "filename": "superset-frontend/packages/superset-ui-core/src/query/types/QueryResponse.ts", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fquery%2Ftypes%2FQueryResponse.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fquery%2Ftypes%2FQueryResponse.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Fsrc%2Fquery%2Ftypes%2FQueryResponse.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -77,6 +77,12 @@ export interface ChartDataResponseResult {\n   // TODO(hainenber): define proper type for below attributes\n   rejected_filters?: any[];\n   applied_filters?: any[];\n+  /**\n+   * Detected ISO 4217 currency code when AUTO mode is used.\n+   * Returns the currency code if all filtered data contains a single currency,\n+   * or null if multiple currencies are present.\n+   */\n+  detected_currency?: string | null;\n }\n \n export interface TimeseriesChartDataResponseResult extends ChartDataResponseResult {", "pull_request_number": 36416}
{"sha": "979c4c1d612cc68770f9dd44248a6854c4914fec", "filename": "superset-frontend/packages/superset-ui-core/test/currency-format/CurrencyFormatter.test.ts", "status": "modified", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Ftest%2Fcurrency-format%2FCurrencyFormatter.test.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Ftest%2Fcurrency-format%2FCurrencyFormatter.test.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Ftest%2Fcurrency-format%2FCurrencyFormatter.test.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -156,3 +156,34 @@ test('CurrencyFormatter:format', () => {\n   });\n   expect(currencyFormatterWithCurrencyD3(VALUE)).toEqual('56,100,057.0 PLN');\n });\n+\n+test('CurrencyFormatter AUTO mode uses row context', () => {\n+  const formatter = new CurrencyFormatter({\n+    currency: { symbol: 'AUTO', symbolPosition: 'prefix' },\n+    d3Format: ',.2f',\n+  });\n+\n+  const row = { currency: 'EUR' };\n+  expect(formatter.format(1000, row, 'currency')).toContain('\u20ac');\n+  expect(formatter.format(1000)).toBe('1,000.00');\n+});\n+\n+test('CurrencyFormatter static mode ignores row context', () => {\n+  const formatter = new CurrencyFormatter({\n+    currency: { symbol: 'USD', symbolPosition: 'prefix' },\n+    d3Format: ',.2f',\n+  });\n+\n+  const row = { currency: 'EUR' };\n+  expect(formatter.format(1000, row, 'currency')).toContain('$');\n+});\n+\n+test('CurrencyFormatter gracefully handles invalid currency code', () => {\n+  const formatter = new CurrencyFormatter({\n+    currency: { symbol: 'INVALID_CODE', symbolPosition: 'prefix' },\n+    d3Format: ',.2f',\n+  });\n+\n+  // Should not throw, should return formatted value without currency symbol\n+  expect(formatter.format(1000)).toBe('1,000.00');\n+});", "pull_request_number": 36416}
{"sha": "ababbf44470b8130ddeb4672534d94bcd93e6f3d", "filename": "superset-frontend/packages/superset-ui-core/test/currency-format/analyzeCurrencyInData.test.ts", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Ftest%2Fcurrency-format%2FanalyzeCurrencyInData.test.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Ftest%2Fcurrency-format%2FanalyzeCurrencyInData.test.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Ftest%2Fcurrency-format%2FanalyzeCurrencyInData.test.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -0,0 +1,33 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import { analyzeCurrencyInData } from '../../src/currency-format/utils';\n+\n+test('analyzeCurrencyInData returns currency code for single currency', () => {\n+  const data = [\n+    { currency_code: 'USD', value: 100 },\n+    { currency_code: 'usd', value: 200 },\n+  ];\n+  expect(analyzeCurrencyInData(data, 'currency_code')).toBe('USD');\n+});\n+\n+test('analyzeCurrencyInData returns null for mixed or invalid data', () => {\n+  expect(analyzeCurrencyInData([], 'currency_code')).toBeNull();\n+  expect(analyzeCurrencyInData([{ c: 'USD' }], undefined)).toBeNull();\n+  expect(analyzeCurrencyInData([{ c: 'USD' }, { c: 'EUR' }], 'c')).toBeNull();\n+});", "pull_request_number": 36416}
{"sha": "1cdd9eda163536bce62017586f01cf07a64b45a7", "filename": "superset-frontend/packages/superset-ui-core/test/currency-format/hasMixedCurrencies.test.ts", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Ftest%2Fcurrency-format%2FhasMixedCurrencies.test.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Ftest%2Fcurrency-format%2FhasMixedCurrencies.test.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Ftest%2Fcurrency-format%2FhasMixedCurrencies.test.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -0,0 +1,32 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import { hasMixedCurrencies } from '../../src/currency-format/CurrencyFormatter';\n+\n+test('hasMixedCurrencies detects mixed vs single currency', () => {\n+  expect(hasMixedCurrencies(['USD', 'EUR'])).toBe(true);\n+  expect(hasMixedCurrencies(['USD', 'usd'])).toBe(false);\n+  expect(hasMixedCurrencies(['USD'])).toBe(false);\n+  expect(hasMixedCurrencies([])).toBe(false);\n+});\n+\n+test('hasMixedCurrencies ignores null values', () => {\n+  expect(hasMixedCurrencies(['USD', null, 'USD'])).toBe(false);\n+  expect(hasMixedCurrencies(['USD', null, 'EUR'])).toBe(true);\n+});", "pull_request_number": 36416}
{"sha": "9048a9bb045adaabe26071ffd371a951f77a195f", "filename": "superset-frontend/packages/superset-ui-core/test/currency-format/normalizeCurrency.test.ts", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Ftest%2Fcurrency-format%2FnormalizeCurrency.test.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Ftest%2Fcurrency-format%2FnormalizeCurrency.test.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fpackages%2Fsuperset-ui-core%2Ftest%2Fcurrency-format%2FnormalizeCurrency.test.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -0,0 +1,34 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import { normalizeCurrency } from '../../src/currency-format/CurrencyFormatter';\n+\n+test('normalizeCurrency normalizes valid ISO 4217 codes', () => {\n+  expect(normalizeCurrency('USD')).toBe('USD');\n+  expect(normalizeCurrency('usd')).toBe('USD');\n+  expect(normalizeCurrency(' eur ')).toBe('EUR');\n+});\n+\n+test('normalizeCurrency returns null for invalid input', () => {\n+  expect(normalizeCurrency(null)).toBe(null);\n+  expect(normalizeCurrency('')).toBe(null);\n+  expect(normalizeCurrency('$')).toBe(null);\n+  expect(normalizeCurrency('DOLLAR')).toBe(null);\n+  expect(normalizeCurrency('USDD')).toBe(null);\n+});", "pull_request_number": 36416}
{"sha": "92be0f8b01c19267df39c107269bfa57dce3ef0a", "filename": "superset-frontend/plugins/legacy-plugin-chart-world-map/src/transformProps.js", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Flegacy-plugin-chart-world-map%2Fsrc%2FtransformProps.js", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Flegacy-plugin-chart-world-map%2Fsrc%2FtransformProps.js", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Flegacy-plugin-chart-world-map%2Fsrc%2FtransformProps.js?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -47,20 +47,29 @@ export default function transformProps(chartProps) {\n     currencyFormat,\n   } = formData;\n   const { r, g, b } = colorPicker;\n-  const { currencyFormats = {}, columnFormats = {} } = datasource;\n+  const {\n+    currencyFormats = {},\n+    columnFormats = {},\n+    currencyCodeColumn,\n+  } = datasource;\n+  const { data, detected_currency: detectedCurrency } = queriesData[0];\n \n   const formatter = getValueFormatter(\n     metric,\n     currencyFormats,\n     columnFormats,\n     yAxisFormat,\n     currencyFormat,\n+    undefined, // key - not needed for single-metric charts\n+    data,\n+    currencyCodeColumn,\n+    detectedCurrency,\n   );\n \n   return {\n     countryFieldtype,\n     entity,\n-    data: queriesData[0].data,\n+    data,\n     width,\n     height,\n     maxBubbleSize: parseInt(maxBubbleSize, 10),", "pull_request_number": 36416}
{"sha": "b610d5b35dec7ffb0d8d86ad1bed62d2200f4fe6", "filename": "superset-frontend/plugins/plugin-chart-echarts/src/BigNumber/BigNumberPeriodOverPeriod/transformProps.ts", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FBigNumber%2FBigNumberPeriodOverPeriod%2FtransformProps.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FBigNumber%2FBigNumberPeriodOverPeriod%2FtransformProps.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FBigNumber%2FBigNumberPeriodOverPeriod%2FtransformProps.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -82,7 +82,11 @@ export default function transformProps(chartProps: ChartProps) {\n     height,\n     formData,\n     queriesData,\n-    datasource: { currencyFormats = {}, columnFormats = {} },\n+    datasource: {\n+      currencyFormats = {},\n+      columnFormats = {},\n+      currencyCodeColumn,\n+    },\n   } = chartProps;\n   const {\n     boldText,\n@@ -100,7 +104,8 @@ export default function transformProps(chartProps: ChartProps) {\n     subtitleFontSize,\n     columnConfig = {},\n   } = formData;\n-  const { data: dataA = [] } = queriesData[0];\n+  const { data: dataA = [], detected_currency: detectedCurrency } =\n+    queriesData[0] || {};\n   const data = dataA;\n   const metricName = metric ? getMetricLabel(metric) : '';\n   const metrics = chartProps.datasource?.metrics || [];\n@@ -162,6 +167,10 @@ export default function transformProps(chartProps: ChartProps) {\n     columnFormats,\n     metricEntry?.d3format || yAxisFormat,\n     currencyFormat,\n+    undefined,\n+    data,\n+    currencyCodeColumn,\n+    detectedCurrency,\n   );\n \n   const compTitles = {", "pull_request_number": 36416}
{"sha": "ef9501fe9af7943a9c79ee1c941b83d3c644d140", "filename": "superset-frontend/plugins/plugin-chart-echarts/src/BigNumber/BigNumberTotal/transformProps.ts", "status": "modified", "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FBigNumber%2FBigNumberTotal%2FtransformProps.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FBigNumber%2FBigNumberTotal%2FtransformProps.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FBigNumber%2FBigNumberTotal%2FtransformProps.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -42,7 +42,11 @@ export default function transformProps(\n     formData,\n     rawFormData,\n     hooks,\n-    datasource: { currencyFormats = {}, columnFormats = {} },\n+    datasource: {\n+      currencyFormats = {},\n+      columnFormats = {},\n+      currencyCodeColumn,\n+    },\n     theme,\n   } = chartProps;\n   const {\n@@ -60,7 +64,11 @@ export default function transformProps(\n     subheaderFontSize,\n   } = formData;\n   const refs: Refs = {};\n-  const { data = [], coltypes = [] } = queriesData[0] || {};\n+  const {\n+    data = [],\n+    coltypes = [],\n+    detected_currency: detectedCurrency,\n+  } = queriesData[0] || {};\n   const granularity = extractTimegrain(rawFormData as QueryFormData);\n   const metrics = chartProps.datasource?.metrics || [];\n   const originalLabel = getOriginalLabel(metric, metrics);\n@@ -92,6 +100,10 @@ export default function transformProps(\n     columnFormats,\n     metricEntry?.d3format || yAxisFormat,\n     currencyFormat,\n+    undefined,\n+    data,\n+    currencyCodeColumn,\n+    detectedCurrency,\n   );\n \n   const headerFormatter =", "pull_request_number": 36416}
{"sha": "7b3337fdb112c8cc4711926dd4e83fa410823bb7", "filename": "superset-frontend/plugins/plugin-chart-echarts/src/BigNumber/BigNumberWithTrendline/transformProps.ts", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FBigNumber%2FBigNumberWithTrendline%2FtransformProps.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FBigNumber%2FBigNumberWithTrendline%2FtransformProps.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FBigNumber%2FBigNumberWithTrendline%2FtransformProps.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -83,7 +83,11 @@ export default function transformProps(\n     hooks,\n     inContextMenu,\n     theme,\n-    datasource: { currencyFormats = {}, columnFormats = {} },\n+    datasource: {\n+      currencyFormats = {},\n+      columnFormats = {},\n+      currencyCodeColumn,\n+    },\n   } = chartProps;\n   const {\n     colorPicker,\n@@ -117,6 +121,7 @@ export default function transformProps(\n     coltypes = [],\n     from_dttm: fromDatetime,\n     to_dttm: toDatetime,\n+    detected_currency: detectedCurrency,\n   } = queriesData[0];\n \n   const aggregatedQueryData = queriesData.length > 1 ? queriesData[1] : null;\n@@ -259,6 +264,10 @@ export default function transformProps(\n     columnFormats,\n     metricEntry?.d3format || yAxisFormat,\n     currencyFormat,\n+    undefined,\n+    data,\n+    currencyCodeColumn,\n+    detectedCurrency,\n   );\n   const xAxisFormatter = getXAxisFormatter(timeFormat);\n   const yAxisFormatter =", "pull_request_number": 36416}
{"sha": "e1f115c28b86514c37f28eac511c84e2c5f15251", "filename": "superset-frontend/plugins/plugin-chart-echarts/src/BigNumber/types.ts", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FBigNumber%2Ftypes.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FBigNumber%2Ftypes.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FBigNumber%2Ftypes.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -31,7 +31,7 @@ import { ColorFormatters } from '@superset-ui/chart-controls';\n import { BaseChartProps, Refs } from '../types';\n \n export interface BigNumberDatum {\n-  [key: string]: number | null;\n+  [key: string]: number | string | null;\n }\n \n export type BigNumberTotalFormData = QueryFormData & {", "pull_request_number": 36416}
{"sha": "fd3cce40c08b51eaa66ae643ba01d9ee17ec72d5", "filename": "superset-frontend/plugins/plugin-chart-echarts/src/Funnel/transformProps.ts", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FFunnel%2FtransformProps.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FFunnel%2FtransformProps.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FFunnel%2FtransformProps.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -99,6 +99,7 @@ export default function transformProps(\n     datasource,\n   } = chartProps;\n   const data: DataRecord[] = queriesData[0].data || [];\n+  const detectedCurrency = queriesData[0]?.detected_currency;\n   const coltypeMapping = getColtypesMapping(queriesData[0]);\n   const {\n     colorScheme,\n@@ -127,7 +128,11 @@ export default function transformProps(\n     ...DEFAULT_FUNNEL_FORM_DATA,\n     ...formData,\n   };\n-  const { currencyFormats = {}, columnFormats = {} } = datasource;\n+  const {\n+    currencyFormats = {},\n+    columnFormats = {},\n+    currencyCodeColumn,\n+  } = datasource;\n   const refs: Refs = {};\n   const metricLabel = getMetricLabel(metric);\n   const groupbyLabels = groupby.map(getColumnLabel);\n@@ -154,6 +159,10 @@ export default function transformProps(\n     columnFormats,\n     numberFormat,\n     currencyFormat,\n+    undefined,\n+    data,\n+    currencyCodeColumn,\n+    detectedCurrency,\n   );\n \n   const transformedData: {", "pull_request_number": 36416}
{"sha": "cd4f2610f7de41dace32f849151ee51900db2089", "filename": "superset-frontend/plugins/plugin-chart-echarts/src/Gauge/transformProps.ts", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FGauge%2FtransformProps.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FGauge%2FtransformProps.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FGauge%2FtransformProps.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -112,6 +112,7 @@ export default function transformProps(\n     verboseMap = {},\n     currencyFormats = {},\n     columnFormats = {},\n+    currencyCodeColumn,\n   } = datasource;\n   const {\n     groupby,\n@@ -139,13 +140,18 @@ export default function transformProps(\n   }: EchartsGaugeFormData = { ...DEFAULT_GAUGE_FORM_DATA, ...formData };\n   const refs: Refs = {};\n   const data = (queriesData[0]?.data || []) as DataRecord[];\n+  const detectedCurrency = queriesData[0]?.detected_currency;\n   const coltypeMapping = getColtypesMapping(queriesData[0]);\n   const numberFormatter = getValueFormatter(\n     metric,\n     currencyFormats,\n     columnFormats,\n     numberFormat,\n     currencyFormat,\n+    undefined,\n+    data,\n+    currencyCodeColumn,\n+    detectedCurrency,\n   );\n   const colorFn = CategoricalColorNamespace.getScale(colorScheme as string);\n   const axisLineWidth = calculateAxisLineWidth(data, fontSize, overlap);", "pull_request_number": 36416}
{"sha": "118082015cd155d4b546af319b71486112645cdb", "filename": "superset-frontend/plugins/plugin-chart-echarts/src/Heatmap/transformProps.ts", "status": "modified", "additions": 15, "deletions": 2, "changes": 17, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FHeatmap%2FtransformProps.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FHeatmap%2FtransformProps.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FHeatmap%2FtransformProps.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -201,8 +201,17 @@ export default function transformProps(\n   const xAxisLabel = getColumnLabel(xAxis);\n   // groupby is overridden to be a single value\n   const yAxisLabel = getColumnLabel(groupby as unknown as QueryFormColumn);\n-  const { data, colnames, coltypes } = queriesData[0];\n-  const { columnFormats = {}, currencyFormats = {} } = datasource;\n+  const {\n+    data,\n+    colnames,\n+    coltypes,\n+    detected_currency: detectedCurrency,\n+  } = queriesData[0];\n+  const {\n+    columnFormats = {},\n+    currencyFormats = {},\n+    currencyCodeColumn,\n+  } = datasource;\n   const colorColumn = normalized ? 'rank' : metricLabel;\n   const colors = getSequentialSchemeRegistry().get(linearColorScheme)?.colors;\n   const getAxisFormatter =\n@@ -225,6 +234,10 @@ export default function transformProps(\n     columnFormats,\n     yAxisFormat,\n     currencyFormat,\n+    undefined,\n+    data,\n+    currencyCodeColumn,\n+    detectedCurrency,\n   );\n \n   let [min, max] = (valueBounds || []).map(parseAxisBound);", "pull_request_number": 36416}
{"sha": "ebc13fcb396142ff866474342df9cc2cb29bbff1", "filename": "superset-frontend/plugins/plugin-chart-echarts/src/MixedTimeseries/transformProps.ts", "status": "modified", "additions": 28, "deletions": 8, "changes": 36, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FMixedTimeseries%2FtransformProps.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FMixedTimeseries%2FtransformProps.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FMixedTimeseries%2FtransformProps.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -36,6 +36,7 @@ import {\n   isTimeseriesAnnotationLayer,\n   QueryFormData,\n   QueryFormMetric,\n+  resolveAutoCurrency,\n   TimeseriesChartDataResponseResult,\n   TimeseriesDataRecord,\n   tooltipHtml,\n@@ -138,10 +139,11 @@ export default function transformProps(\n     verboseMap = {},\n     currencyFormats = {},\n     columnFormats = {},\n+    currencyCodeColumn,\n   } = datasource;\n-  const { label_map: labelMap } =\n+  const { label_map: labelMap, detected_currency: backendDetectedCurrency } =\n     queriesData[0] as TimeseriesChartDataResponseResult;\n-  const { label_map: labelMapB } =\n+  const { label_map: labelMapB, detected_currency: backendDetectedCurrencyB } =\n     queriesData[1] as TimeseriesChartDataResponseResult;\n   const data1 = (queriesData[0].data || []) as TimeseriesDataRecord[];\n   const data2 = (queriesData[1].data || []) as TimeseriesDataRecord[];\n@@ -279,35 +281,53 @@ export default function transformProps(\n     xAxisType,\n   });\n   const series: SeriesOption[] = [];\n+\n+  const resolvedCurrency = resolveAutoCurrency(\n+    currencyFormat,\n+    backendDetectedCurrency,\n+    data1,\n+    currencyCodeColumn,\n+  );\n+  const resolvedCurrencySecondary = resolveAutoCurrency(\n+    currencyFormatSecondary,\n+    backendDetectedCurrencyB,\n+    data2,\n+    currencyCodeColumn,\n+  );\n+\n   const formatter = contributionMode\n     ? getNumberFormatter(',.0%')\n-    : currencyFormat?.symbol\n+    : resolvedCurrency?.symbol\n       ? new CurrencyFormatter({\n           d3Format: yAxisFormat,\n-          currency: currencyFormat,\n+          currency: resolvedCurrency,\n         })\n       : getNumberFormatter(yAxisFormat);\n   const formatterSecondary = contributionMode\n     ? getNumberFormatter(',.0%')\n-    : currencyFormatSecondary?.symbol\n+    : resolvedCurrencySecondary?.symbol\n       ? new CurrencyFormatter({\n           d3Format: yAxisFormatSecondary,\n-          currency: currencyFormatSecondary,\n+          currency: resolvedCurrencySecondary,\n         })\n       : getNumberFormatter(yAxisFormatSecondary);\n   const customFormatters = buildCustomFormatters(\n     [...ensureIsArray(metrics), ...ensureIsArray(metricsB)],\n     currencyFormats,\n     columnFormats,\n     yAxisFormat,\n-    currencyFormat,\n+    resolvedCurrency,\n+    data1,\n+    currencyCodeColumn,\n   );\n   const customFormattersSecondary = buildCustomFormatters(\n     [...ensureIsArray(metrics), ...ensureIsArray(metricsB)],\n     currencyFormats,\n     columnFormats,\n     yAxisFormatSecondary,\n-    currencyFormatSecondary,\n+    resolvedCurrencySecondary,\n+    data2,\n+    currencyCodeColumn,\n   );\n \n   const primarySeries = new Set<string>();", "pull_request_number": 36416}
{"sha": "d33110f6ab3fac52979b1fd63dcefe1802c45206", "filename": "superset-frontend/plugins/plugin-chart-echarts/src/Pie/transformProps.ts", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FPie%2FtransformProps.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FPie%2FtransformProps.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FPie%2FtransformProps.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -135,8 +135,13 @@ export default function transformProps(\n     emitCrossFilters,\n     datasource,\n   } = chartProps;\n-  const { columnFormats = {}, currencyFormats = {} } = datasource;\n-  const { data: rawData = [] } = queriesData[0];\n+  const {\n+    columnFormats = {},\n+    currencyFormats = {},\n+    currencyCodeColumn,\n+  } = datasource;\n+  const { data: rawData = [], detected_currency: detectedCurrency } =\n+    queriesData[0];\n   const coltypeMapping = getColtypesMapping(queriesData[0]);\n \n   const {\n@@ -181,6 +186,10 @@ export default function transformProps(\n     columnFormats,\n     numberFormat,\n     currencyFormat,\n+    undefined,\n+    rawData,\n+    currencyCodeColumn,\n+    detectedCurrency,\n   );\n \n   let data = rawData;", "pull_request_number": 36416}
{"sha": "f1861ab558e381346524ea9c81afc31676e979e4", "filename": "superset-frontend/plugins/plugin-chart-echarts/src/Sunburst/transformProps.ts", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FSunburst%2FtransformProps.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FSunburst%2FtransformProps.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FSunburst%2FtransformProps.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -170,7 +170,7 @@ export default function transformProps(\n     emitCrossFilters,\n     datasource,\n   } = chartProps;\n-  const { data = [] } = queriesData[0];\n+  const { data = [], detected_currency: detectedCurrency } = queriesData[0];\n   const coltypeMapping = getColtypesMapping(queriesData[0]);\n   const {\n     groupby = [],\n@@ -192,6 +192,7 @@ export default function transformProps(\n     currencyFormats = {},\n     columnFormats = {},\n     verboseMap = {},\n+    currencyCodeColumn,\n   } = datasource;\n   const refs: Refs = {};\n   const primaryValueFormatter = getValueFormatter(\n@@ -200,6 +201,10 @@ export default function transformProps(\n     columnFormats,\n     numberFormat,\n     currencyFormat,\n+    undefined,\n+    data,\n+    currencyCodeColumn,\n+    detectedCurrency,\n   );\n   const secondaryValueFormatter = secondaryMetric\n     ? getValueFormatter(\n@@ -208,6 +213,10 @@ export default function transformProps(\n         columnFormats,\n         numberFormat,\n         currencyFormat,\n+        undefined,\n+        data,\n+        currencyCodeColumn,\n+        detectedCurrency,\n       )\n     : undefined;\n ", "pull_request_number": 36416}
{"sha": "fe37eea02762a857524a6be6cf381094f8f6753c", "filename": "superset-frontend/plugins/plugin-chart-echarts/src/Timeseries/transformProps.ts", "status": "modified", "additions": 24, "deletions": 5, "changes": 29, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FTimeseries%2FtransformProps.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FTimeseries%2FtransformProps.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FTimeseries%2FtransformProps.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -37,6 +37,7 @@ import {\n   isIntervalAnnotationLayer,\n   isPhysicalColumn,\n   isTimeseriesAnnotationLayer,\n+  resolveAutoCurrency,\n   TimeseriesChartDataResponseResult,\n   NumberFormats,\n } from '@superset-ui/core';\n@@ -134,10 +135,14 @@ export default function transformProps(\n     verboseMap = {},\n     columnFormats = {},\n     currencyFormats = {},\n+    currencyCodeColumn,\n   } = datasource;\n   const [queryData] = queriesData;\n-  const { data = [], label_map = {} } =\n-    queryData as TimeseriesChartDataResponseResult;\n+  const {\n+    data = [],\n+    label_map = {},\n+    detected_currency: backendDetectedCurrency,\n+  } = queryData as TimeseriesChartDataResponseResult;\n \n   const dataTypes = getColtypesMapping(queryData);\n   const annotationData = getAnnotationData(chartProps);\n@@ -275,15 +280,29 @@ export default function transformProps(\n   const percentFormatter = forcePercentFormatter\n     ? getPercentFormatter(yAxisFormat)\n     : getPercentFormatter(NumberFormats.PERCENT_2_POINT);\n-  const defaultFormatter = currencyFormat?.symbol\n-    ? new CurrencyFormatter({ d3Format: yAxisFormat, currency: currencyFormat })\n+\n+  // Resolve currency for AUTO mode (backend detection takes precedence)\n+  const resolvedCurrency = resolveAutoCurrency(\n+    currencyFormat,\n+    backendDetectedCurrency,\n+    data,\n+    currencyCodeColumn,\n+  );\n+\n+  const defaultFormatter = resolvedCurrency?.symbol\n+    ? new CurrencyFormatter({\n+        d3Format: yAxisFormat,\n+        currency: resolvedCurrency,\n+      })\n     : getNumberFormatter(yAxisFormat);\n   const customFormatters = buildCustomFormatters(\n     metrics,\n     currencyFormats,\n     columnFormats,\n     yAxisFormat,\n-    currencyFormat,\n+    resolvedCurrency,\n+    data,\n+    currencyCodeColumn,\n   );\n \n   const array = ensureIsArray(chartProps.rawFormData?.time_compare);", "pull_request_number": 36416}
{"sha": "e4fe3053ee284b91a48437dd19e462da9a1e9722", "filename": "superset-frontend/plugins/plugin-chart-echarts/src/Treemap/transformProps.ts", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FTreemap%2FtransformProps.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FTreemap%2FtransformProps.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Fsrc%2FTreemap%2FtransformProps.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -119,8 +119,12 @@ export default function transformProps(\n     emitCrossFilters,\n     datasource,\n   } = chartProps;\n-  const { data = [] } = queriesData[0];\n-  const { columnFormats = {}, currencyFormats = {} } = datasource;\n+  const { data = [], detected_currency: detectedCurrency } = queriesData[0];\n+  const {\n+    columnFormats = {},\n+    currencyFormats = {},\n+    currencyCodeColumn,\n+  } = datasource;\n   const { setDataMask = () => {}, onContextMenu } = hooks;\n   const coltypeMapping = getColtypesMapping(queriesData[0]);\n   const BORDER_COLOR = theme.colorBgBase;\n@@ -150,6 +154,10 @@ export default function transformProps(\n     columnFormats,\n     numberFormat,\n     currencyFormat,\n+    undefined,\n+    data,\n+    currencyCodeColumn,\n+    detectedCurrency,\n   );\n \n   const formatter = (params: TreemapSeriesCallbackDataParams) =>", "pull_request_number": 36416}
{"sha": "cd1b00100ebd1c256a15427222cdc3d7e2be40a2", "filename": "superset-frontend/plugins/plugin-chart-echarts/test/BigNumber/transformProps.test.ts", "status": "modified", "additions": 56, "deletions": 0, "changes": 56, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Ftest%2FBigNumber%2FtransformProps.test.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Ftest%2FBigNumber%2FtransformProps.test.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Ftest%2FBigNumber%2FtransformProps.test.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -492,3 +492,59 @@ describe('BigNumberWithTrendline - Aggregation Tests', () => {\n     expect(transformed.bigNumber).toStrictEqual(10);\n   });\n });\n+\n+test('BigNumberWithTrendline AUTO mode should detect single currency', () => {\n+  const props = generateProps(\n+    [\n+      { __timestamp: 1607558400000, value: 1000, currency_code: 'USD' },\n+      { __timestamp: 1607558500000, value: 2000, currency_code: 'USD' },\n+    ],\n+    {\n+      yAxisFormat: ',.2f',\n+      currencyFormat: { symbol: 'AUTO', symbolPosition: 'prefix' },\n+    },\n+  );\n+  props.datasource.currencyCodeColumn = 'currency_code';\n+\n+  const transformed = transformProps(props);\n+  // The headerFormatter should include $ for USD\n+  expect(transformed.headerFormatter(1000)).toContain('$');\n+});\n+\n+test('BigNumberWithTrendline AUTO mode should use neutral formatting for mixed currencies', () => {\n+  const props = generateProps(\n+    [\n+      { __timestamp: 1607558400000, value: 1000, currency_code: 'USD' },\n+      { __timestamp: 1607558500000, value: 2000, currency_code: 'EUR' },\n+    ],\n+    {\n+      yAxisFormat: ',.2f',\n+      currencyFormat: { symbol: 'AUTO', symbolPosition: 'prefix' },\n+    },\n+  );\n+  props.datasource.currencyCodeColumn = 'currency_code';\n+\n+  const transformed = transformProps(props);\n+  // With mixed currencies, should not show currency symbol\n+  const formatted = transformed.headerFormatter(1000);\n+  expect(formatted).not.toContain('$');\n+  expect(formatted).not.toContain('\u20ac');\n+});\n+\n+test('BigNumberWithTrendline should preserve static currency format', () => {\n+  const props = generateProps(\n+    [\n+      { __timestamp: 1607558400000, value: 1000, currency_code: 'USD' },\n+      { __timestamp: 1607558500000, value: 2000, currency_code: 'EUR' },\n+    ],\n+    {\n+      yAxisFormat: ',.2f',\n+      currencyFormat: { symbol: 'GBP', symbolPosition: 'prefix' },\n+    },\n+  );\n+  props.datasource.currencyCodeColumn = 'currency_code';\n+\n+  const transformed = transformProps(props);\n+  // Static mode should always show \u00a3\n+  expect(transformed.headerFormatter(1000)).toContain('\u00a3');\n+});", "pull_request_number": 36416}
{"sha": "b3ecf9a7ab164f60aa55dca8217d58e68df06109", "filename": "superset-frontend/plugins/plugin-chart-echarts/test/Timeseries/transformProps.test.ts", "status": "modified", "additions": 132, "deletions": 0, "changes": 132, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Ftest%2FTimeseries%2FtransformProps.test.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Ftest%2FTimeseries%2FtransformProps.test.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-echarts%2Ftest%2FTimeseries%2FtransformProps.test.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -31,6 +31,20 @@ import { supersetTheme } from '@apache-superset/core/ui';\n import { EchartsTimeseriesChartProps } from '../../src/types';\n import transformProps from '../../src/Timeseries/transformProps';\n \n+type YAxisFormatter = (value: number, index: number) => string;\n+\n+function getYAxisFormatter(\n+  transformed: ReturnType<typeof transformProps>,\n+): YAxisFormatter {\n+  const yAxis = transformed.echartOptions.yAxis as {\n+    axisLabel?: { formatter?: YAxisFormatter };\n+  };\n+  expect(yAxis).toBeDefined();\n+  expect(yAxis.axisLabel).toBeDefined();\n+  expect(yAxis.axisLabel?.formatter).toBeDefined();\n+  return yAxis.axisLabel!.formatter!;\n+}\n+\n const formData: SqlaFormData = {\n   colorScheme: 'bnbColors',\n   datasource: '3__table',\n@@ -723,3 +737,121 @@ describe('legend sorting', () => {\n     ]);\n   });\n });\n+\n+test('EchartsTimeseries AUTO mode should detect single currency and format with $ for USD', () => {\n+  const chartProps = new ChartProps<SqlaFormData>({\n+    ...chartPropsConfig,\n+    formData: {\n+      ...formData,\n+      metrics: ['sum__num'],\n+      currencyFormat: { symbol: 'AUTO', symbolPosition: 'prefix' },\n+    },\n+    datasource: {\n+      currencyCodeColumn: 'currency_code',\n+      columnFormats: {},\n+      currencyFormats: {},\n+      verboseMap: {},\n+    },\n+    queriesData: [\n+      {\n+        data: [\n+          {\n+            'San Francisco': 1000,\n+            __timestamp: 599616000000,\n+            currency_code: 'USD',\n+          },\n+          {\n+            'San Francisco': 2000,\n+            __timestamp: 599916000000,\n+            currency_code: 'USD',\n+          },\n+        ],\n+      },\n+    ],\n+  });\n+\n+  const transformed = transformProps(chartProps as EchartsTimeseriesChartProps);\n+\n+  const formatter = getYAxisFormatter(transformed);\n+  expect(formatter(1000, 0)).toContain('$');\n+});\n+\n+test('EchartsTimeseries AUTO mode should use neutral formatting for mixed currencies', () => {\n+  const chartProps = new ChartProps<SqlaFormData>({\n+    ...chartPropsConfig,\n+    formData: {\n+      ...formData,\n+      metrics: ['sum__num'],\n+      currencyFormat: { symbol: 'AUTO', symbolPosition: 'prefix' },\n+    },\n+    datasource: {\n+      currencyCodeColumn: 'currency_code',\n+      columnFormats: {},\n+      currencyFormats: {},\n+      verboseMap: {},\n+    },\n+    queriesData: [\n+      {\n+        data: [\n+          {\n+            'San Francisco': 1000,\n+            __timestamp: 599616000000,\n+            currency_code: 'USD',\n+          },\n+          {\n+            'San Francisco': 2000,\n+            __timestamp: 599916000000,\n+            currency_code: 'EUR',\n+          },\n+        ],\n+      },\n+    ],\n+  });\n+\n+  const transformed = transformProps(chartProps as EchartsTimeseriesChartProps);\n+\n+  // With mixed currencies, Y-axis should use neutral formatting\n+  const formatter = getYAxisFormatter(transformed);\n+  const formatted = formatter(1000, 0);\n+  expect(formatted).not.toContain('$');\n+  expect(formatted).not.toContain('\u20ac');\n+});\n+\n+test('EchartsTimeseries should preserve static currency format with \u00a3 for GBP', () => {\n+  const chartProps = new ChartProps<SqlaFormData>({\n+    ...chartPropsConfig,\n+    formData: {\n+      ...formData,\n+      metrics: ['sum__num'],\n+      currencyFormat: { symbol: 'GBP', symbolPosition: 'prefix' },\n+    },\n+    datasource: {\n+      currencyCodeColumn: 'currency_code',\n+      columnFormats: {},\n+      currencyFormats: {},\n+      verboseMap: {},\n+    },\n+    queriesData: [\n+      {\n+        data: [\n+          {\n+            'San Francisco': 1000,\n+            __timestamp: 599616000000,\n+            currency_code: 'USD',\n+          },\n+          {\n+            'San Francisco': 2000,\n+            __timestamp: 599916000000,\n+            currency_code: 'EUR',\n+          },\n+        ],\n+      },\n+    ],\n+  });\n+\n+  const transformed = transformProps(chartProps as EchartsTimeseriesChartProps);\n+\n+  // Static mode should always show \u00a3\n+  const formatter = getYAxisFormatter(transformed);\n+  expect(formatter(1000, 0)).toContain('\u00a3');\n+});", "pull_request_number": 36416}
{"sha": "1c2f5cbc05e855a4ba0cac0a41c63b9fa56e1379", "filename": "superset-frontend/plugins/plugin-chart-pivot-table/src/PivotTableChart.tsx", "status": "modified", "additions": 111, "deletions": 13, "changes": 124, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2FPivotTableChart.tsx", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2FPivotTableChart.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2FPivotTableChart.tsx?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -22,15 +22,18 @@ import { t } from '@apache-superset/core';\n import {\n   AdhocMetric,\n   BinaryQueryObjectFilterClause,\n+  Currency,\n   CurrencyFormatter,\n   DataRecordValue,\n   FeatureFlag,\n   getColumnLabel,\n   getNumberFormatter,\n   getSelectedText,\n+  hasMixedCurrencies,\n   isAdhocColumn,\n   isFeatureEnabled,\n   isPhysicalColumn,\n+  normalizeCurrency,\n   NumberFormatter,\n } from '@superset-ui/core';\n import { styled, useTheme } from '@apache-superset/core/ui';\n@@ -101,6 +104,71 @@ const StyledMinusSquareOutlined = styled(MinusSquareOutlined)`\n   stroke-width: 16px;\n `;\n \n+/** Aggregator with currency tracking support */\n+interface CurrencyTrackingAggregator {\n+  getCurrencies?: () => string[];\n+}\n+\n+type BaseFormatter = NumberFormatter | CurrencyFormatter;\n+\n+/** Create formatter that handles AUTO mode with per-cell currency detection */\n+const createCurrencyAwareFormatter = (\n+  baseFormatter: BaseFormatter,\n+  currencyConfig: Currency | undefined,\n+  d3Format: string,\n+  fallbackCurrency?: string,\n+): ((value: number, aggregator?: CurrencyTrackingAggregator) => string) => {\n+  const isAutoMode = currencyConfig?.symbol === 'AUTO';\n+\n+  return (value: number, aggregator?: CurrencyTrackingAggregator): string => {\n+    // If not AUTO mode, use base formatter directly\n+    if (!isAutoMode) {\n+      return baseFormatter(value);\n+    }\n+\n+    // AUTO mode: check aggregator for currency tracking\n+    if (aggregator && typeof aggregator.getCurrencies === 'function') {\n+      const currencies = aggregator.getCurrencies();\n+\n+      if (currencies && currencies.length > 0) {\n+        if (hasMixedCurrencies(currencies)) {\n+          return getNumberFormatter(d3Format)(value);\n+        }\n+\n+        const detectedCurrency = normalizeCurrency(currencies[0]);\n+        if (detectedCurrency && currencyConfig) {\n+          const cellFormatter = new CurrencyFormatter({\n+            currency: {\n+              symbol: detectedCurrency,\n+              symbolPosition: currencyConfig.symbolPosition,\n+            },\n+            d3Format,\n+          });\n+          return cellFormatter(value);\n+        }\n+      }\n+    }\n+\n+    // Fallback: use detected_currency from API response if available\n+    if (fallbackCurrency && currencyConfig) {\n+      const normalizedFallback = normalizeCurrency(fallbackCurrency);\n+      if (normalizedFallback) {\n+        const fallbackFormatter = new CurrencyFormatter({\n+          currency: {\n+            symbol: normalizedFallback,\n+            symbolPosition: currencyConfig.symbolPosition,\n+          },\n+          d3Format,\n+        });\n+        return fallbackFormatter(value);\n+      }\n+    }\n+\n+    // Final fallback to neutral format\n+    return getNumberFormatter(d3Format)(value);\n+  };\n+};\n+\n const aggregatorsFactory = (formatter: NumberFormatter) => ({\n   Count: aggregatorTemplates.count(formatter),\n   'Count Unique Values': aggregatorTemplates.countUnique(formatter),\n@@ -171,6 +239,8 @@ export default function PivotTableChart(props: PivotTableProps) {\n     rowSubTotals,\n     valueFormat,\n     currencyFormat,\n+    currencyCodeColumn,\n+    detectedCurrency,\n     emitCrossFilters,\n     setDataMask,\n     selectedFilters,\n@@ -186,16 +256,30 @@ export default function PivotTableChart(props: PivotTableProps) {\n   } = props;\n \n   const theme = useTheme();\n-  const defaultFormatter = useMemo(\n+\n+  // Base formatter without currency-awareness (for non-AUTO mode or as fallback)\n+  const baseFormatter = useMemo(\n     () =>\n-      currencyFormat?.symbol\n+      currencyFormat?.symbol && currencyFormat.symbol !== 'AUTO'\n         ? new CurrencyFormatter({\n             currency: currencyFormat,\n             d3Format: valueFormat,\n           })\n         : getNumberFormatter(valueFormat),\n     [valueFormat, currencyFormat],\n   );\n+\n+  // Currency-aware formatter for AUTO mode support\n+  const defaultFormatter = useMemo(\n+    () =>\n+      createCurrencyAwareFormatter(\n+        baseFormatter,\n+        currencyFormat,\n+        valueFormat,\n+        detectedCurrency ?? undefined,\n+      ),\n+    [baseFormatter, currencyFormat, valueFormat, detectedCurrency],\n+  );\n   const customFormatsArray = useMemo(\n     () =>\n       Array.from(\n@@ -216,19 +300,31 @@ export default function PivotTableChart(props: PivotTableProps) {\n       hasCustomMetricFormatters\n         ? {\n             [METRIC_KEY]: Object.fromEntries(\n-              customFormatsArray.map(([metric, d3Format, currency]) => [\n-                metric,\n-                currency\n-                  ? new CurrencyFormatter({\n-                      currency,\n-                      d3Format,\n-                    })\n-                  : getNumberFormatter(d3Format),\n-              ]),\n+              customFormatsArray.map(([metric, d3Format, currency]) => {\n+                // Create base formatter\n+                const metricBaseFormatter =\n+                  currency && (currency as Currency).symbol !== 'AUTO'\n+                    ? new CurrencyFormatter({\n+                        currency: currency as Currency,\n+                        d3Format: d3Format as string,\n+                      })\n+                    : getNumberFormatter(d3Format as string);\n+\n+                // Wrap with currency-aware formatter for AUTO mode support\n+                return [\n+                  metric,\n+                  createCurrencyAwareFormatter(\n+                    metricBaseFormatter,\n+                    currency as Currency | undefined,\n+                    d3Format as string,\n+                    detectedCurrency ?? undefined,\n+                  ),\n+                ];\n+              }),\n             ),\n           }\n         : undefined,\n-    [customFormatsArray, hasCustomMetricFormatters],\n+    [customFormatsArray, hasCustomMetricFormatters, detectedCurrency],\n   );\n \n   const metricNames = useMemo(\n@@ -249,12 +345,14 @@ export default function PivotTableChart(props: PivotTableProps) {\n               ...record,\n               [METRIC_KEY]: name,\n               value: record[name],\n+              // Mark currency column for per-cell currency detection in aggregators\n+              __currencyColumn: currencyCodeColumn,\n             }))\n             .filter(record => record.value !== null),\n         ],\n         [],\n       ),\n-    [data, metricNames],\n+    [data, metricNames, currencyCodeColumn],\n   );\n   const groupbyRows = useMemo(\n     () => groupbyRowsRaw.map(getColumnLabel),", "pull_request_number": 36416}
{"sha": "847247a2141577a0f8518f505c756346e8765a30", "filename": "superset-frontend/plugins/plugin-chart-pivot-table/src/plugin/transformProps.ts", "status": "modified", "additions": 16, "deletions": 2, "changes": 18, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2Fplugin%2FtransformProps.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2Fplugin%2FtransformProps.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2Fplugin%2FtransformProps.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -79,11 +79,21 @@ export default function transformProps(chartProps: ChartProps<QueryFormData>) {\n     rawFormData,\n     hooks: { setDataMask = () => {}, onContextMenu },\n     filterState,\n-    datasource: { verboseMap = {}, columnFormats = {}, currencyFormats = {} },\n+    datasource: {\n+      verboseMap = {},\n+      columnFormats = {},\n+      currencyFormats = {},\n+      currencyCodeColumn,\n+    },\n     emitCrossFilters,\n     theme,\n   } = chartProps;\n-  const { data, colnames, coltypes } = queriesData[0];\n+  const {\n+    data,\n+    colnames,\n+    coltypes,\n+    detected_currency: detectedCurrency,\n+  } = queriesData[0];\n   const {\n     groupbyRows,\n     groupbyColumns,\n@@ -148,6 +158,8 @@ export default function transformProps(chartProps: ChartProps<QueryFormData>) {\n     theme,\n   );\n \n+  // AUTO symbol passed through - PivotTableChart handles per-cell currency detection\n+\n   return {\n     width,\n     height,\n@@ -169,6 +181,8 @@ export default function transformProps(chartProps: ChartProps<QueryFormData>) {\n     rowSubTotals,\n     valueFormat,\n     currencyFormat,\n+    currencyCodeColumn,\n+    detectedCurrency,\n     emitCrossFilters,\n     setDataMask,\n     selectedFilters,", "pull_request_number": 36416}
{"sha": "5fefac2904c7b53d37a5ceb7ad3b9da905ef9e00", "filename": "superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2Freact-pivottable%2FTableRenderers.jsx", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2Freact-pivottable%2FTableRenderers.jsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2Freact-pivottable%2FTableRenderers.jsx?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -749,7 +749,7 @@ export class TableRenderer extends Component {\n           onContextMenu={e => this.props.onContextMenu(e, colKey, rowKey)}\n           style={style}\n         >\n-          {displayCell(agg.format(aggValue), allowRenderHtml)}\n+          {displayCell(agg.format(aggValue, agg), allowRenderHtml)}\n         </td>\n       );\n     });\n@@ -766,7 +766,7 @@ export class TableRenderer extends Component {\n           onClick={rowTotalCallbacks[flatRowKey]}\n           onContextMenu={e => this.props.onContextMenu(e, undefined, rowKey)}\n         >\n-          {displayCell(agg.format(aggValue), allowRenderHtml)}\n+          {displayCell(agg.format(aggValue, agg), allowRenderHtml)}\n         </td>\n       );\n     }\n@@ -830,7 +830,7 @@ export class TableRenderer extends Component {\n           onContextMenu={e => this.props.onContextMenu(e, colKey, undefined)}\n           style={{ padding: '5px' }}\n         >\n-          {displayCell(agg.format(aggValue), this.props.allowRenderHtml)}\n+          {displayCell(agg.format(aggValue, agg), this.props.allowRenderHtml)}\n         </td>\n       );\n     });\n@@ -847,7 +847,7 @@ export class TableRenderer extends Component {\n           onClick={grandTotalCallback}\n           onContextMenu={e => this.props.onContextMenu(e, undefined, undefined)}\n         >\n-          {displayCell(agg.format(aggValue), this.props.allowRenderHtml)}\n+          {displayCell(agg.format(aggValue, agg), this.props.allowRenderHtml)}\n         </td>\n       );\n     }", "pull_request_number": 36416}
{"sha": "100f2defa0e3367e9f6b8062b6d014fb6a12a291", "filename": "superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/utilities.js", "status": "modified", "additions": 54, "deletions": 2, "changes": 56, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2Freact-pivottable%2Futilities.js", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2Freact-pivottable%2Futilities.js", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2Freact-pivottable%2Futilities.js?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -186,9 +186,13 @@ const usFmtPct = numberFormat({\n   suffix: '%',\n });\n \n-const fmtNonString = formatter => x =>\n-  typeof x === 'string' ? x : formatter(x);\n+const fmtNonString = formatter => (x, aggregator) =>\n+  typeof x === 'string' ? x : formatter(x, aggregator);\n \n+/*\n+ * Aggregators track currencies via push() and expose them via getCurrencies()\n+ * for per-cell currency detection in AUTO mode.\n+ */\n const baseAggregatorTemplates = {\n   count(formatter = usFmtInt) {\n     return () =>\n@@ -211,14 +215,21 @@ const baseAggregatorTemplates = {\n       return function () {\n         return {\n           uniq: [],\n+          currencySet: new Set(),\n           push(record) {\n             if (!Array.from(this.uniq).includes(record[attr])) {\n               this.uniq.push(record[attr]);\n             }\n+            if (record.__currencyColumn && record[record.__currencyColumn]) {\n+              this.currencySet.add(record[record.__currencyColumn]);\n+            }\n           },\n           value() {\n             return fn(this.uniq);\n           },\n+          getCurrencies() {\n+            return Array.from(this.currencySet);\n+          },\n           format: fmtNonString(formatter),\n           numInputs: typeof attr !== 'undefined' ? 0 : 1,\n         };\n@@ -231,16 +242,23 @@ const baseAggregatorTemplates = {\n       return function () {\n         return {\n           sum: 0,\n+          currencySet: new Set(),\n           push(record) {\n             if (Number.isNaN(Number(record[attr]))) {\n               this.sum = record[attr];\n             } else {\n               this.sum += parseFloat(record[attr]);\n             }\n+            if (record.__currencyColumn && record[record.__currencyColumn]) {\n+              this.currencySet.add(record[record.__currencyColumn]);\n+            }\n           },\n           value() {\n             return this.sum;\n           },\n+          getCurrencies() {\n+            return Array.from(this.currencySet);\n+          },\n           format: fmtNonString(formatter),\n           numInputs: typeof attr !== 'undefined' ? 0 : 1,\n         };\n@@ -253,6 +271,7 @@ const baseAggregatorTemplates = {\n       return function (data) {\n         return {\n           val: null,\n+          currencySet: new Set(),\n           sorter: getSort(\n             typeof data !== 'undefined' ? data.sorters : null,\n             attr,\n@@ -285,10 +304,16 @@ const baseAggregatorTemplates = {\n             ) {\n               this.val = x;\n             }\n+            if (record.__currencyColumn && record[record.__currencyColumn]) {\n+              this.currencySet.add(record[record.__currencyColumn]);\n+            }\n           },\n           value() {\n             return this.val;\n           },\n+          getCurrencies() {\n+            return Array.from(this.currencySet);\n+          },\n           format(x) {\n             if (typeof x === 'number') {\n               return formatter(x);\n@@ -307,6 +332,7 @@ const baseAggregatorTemplates = {\n         return {\n           vals: [],\n           strMap: {},\n+          currencySet: new Set(),\n           push(record) {\n             const val = record[attr];\n             const x = Number(val);\n@@ -316,6 +342,9 @@ const baseAggregatorTemplates = {\n             } else {\n               this.vals.push(x);\n             }\n+            if (record.__currencyColumn && record[record.__currencyColumn]) {\n+              this.currencySet.add(record[record.__currencyColumn]);\n+            }\n           },\n           value() {\n             if (\n@@ -339,6 +368,9 @@ const baseAggregatorTemplates = {\n             const i = (this.vals.length - 1) * q;\n             return (this.vals[Math.floor(i)] + this.vals[Math.ceil(i)]) / 2.0;\n           },\n+          getCurrencies() {\n+            return Array.from(this.currencySet);\n+          },\n           format: fmtNonString(formatter),\n           numInputs: typeof attr !== 'undefined' ? 0 : 1,\n         };\n@@ -354,11 +386,15 @@ const baseAggregatorTemplates = {\n           m: 0.0,\n           s: 0.0,\n           strValue: null,\n+          currencySet: new Set(),\n           push(record) {\n             const x = Number(record[attr]);\n             if (Number.isNaN(x)) {\n               this.strValue =\n                 typeof record[attr] === 'string' ? record[attr] : this.strValue;\n+              if (record.__currencyColumn && record[record.__currencyColumn]) {\n+                this.currencySet.add(record[record.__currencyColumn]);\n+              }\n               return;\n             }\n             this.n += 1.0;\n@@ -368,6 +404,9 @@ const baseAggregatorTemplates = {\n             const mNew = this.m + (x - this.m) / this.n;\n             this.s += (x - this.m) * (x - mNew);\n             this.m = mNew;\n+            if (record.__currencyColumn && record[record.__currencyColumn]) {\n+              this.currencySet.add(record[record.__currencyColumn]);\n+            }\n           },\n           value() {\n             if (this.strValue) {\n@@ -392,6 +431,9 @@ const baseAggregatorTemplates = {\n                 throw new Error('unknown mode for runningStat');\n             }\n           },\n+          getCurrencies() {\n+            return Array.from(this.currencySet);\n+          },\n           format: fmtNonString(formatter),\n           numInputs: typeof attr !== 'undefined' ? 0 : 1,\n         };\n@@ -405,17 +447,24 @@ const baseAggregatorTemplates = {\n         return {\n           sumNum: 0,\n           sumDenom: 0,\n+          currencySet: new Set(),\n           push(record) {\n             if (!Number.isNaN(Number(record[num]))) {\n               this.sumNum += parseFloat(record[num]);\n             }\n             if (!Number.isNaN(Number(record[denom]))) {\n               this.sumDenom += parseFloat(record[denom]);\n             }\n+            if (record.__currencyColumn && record[record.__currencyColumn]) {\n+              this.currencySet.add(record[record.__currencyColumn]);\n+            }\n           },\n           value() {\n             return this.sumNum / this.sumDenom;\n           },\n+          getCurrencies() {\n+            return Array.from(this.currencySet);\n+          },\n           format: formatter,\n           numInputs:\n             typeof num !== 'undefined' && typeof denom !== 'undefined' ? 0 : 2,\n@@ -447,6 +496,9 @@ const baseAggregatorTemplates = {\n \n             return this.inner.value() / acc;\n           },\n+          getCurrencies() {\n+            return this.inner.getCurrencies ? this.inner.getCurrencies() : [];\n+          },\n           numInputs: wrapped(...Array.from(x || []))().numInputs,\n         };\n       };", "pull_request_number": 36416}
{"sha": "d154031397b78ea123a9afcbdc354ed9418af55d", "filename": "superset-frontend/plugins/plugin-chart-pivot-table/src/types.ts", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2Ftypes.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2Ftypes.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2Ftypes.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -68,6 +68,8 @@ interface PivotTableCustomizeProps {\n   rowSubTotals: boolean;\n   valueFormat: string;\n   currencyFormat: Currency;\n+  currencyCodeColumn?: string;\n+  detectedCurrency?: string | null;\n   setDataMask: SetDataMaskHook;\n   emitCrossFilters?: boolean;\n   selectedFilters?: SelectedFiltersType;", "pull_request_number": 36416}
{"sha": "7a6fa52f7de79a5b53b35e27d911e9127865b7ba", "filename": "superset-frontend/plugins/plugin-chart-pivot-table/test/plugin/transformProps.test.ts", "status": "modified", "additions": 189, "deletions": 0, "changes": 189, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Ftest%2Fplugin%2FtransformProps.test.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Ftest%2Fplugin%2FtransformProps.test.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Ftest%2Fplugin%2FtransformProps.test.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -96,4 +96,193 @@ describe('PivotTableChart transformProps', () => {\n       currencyFormat: { symbol: 'USD', symbolPosition: 'prefix' },\n     });\n   });\n+\n+  describe('Per-cell currency detection (AUTO mode passes through)', () => {\n+    it('should pass AUTO mode through for per-cell detection (single currency data)', () => {\n+      const autoFormData = {\n+        ...formData,\n+        currencyFormat: { symbol: 'AUTO', symbolPosition: 'prefix' },\n+      };\n+      const autoChartProps = new ChartProps<QueryFormData>({\n+        formData: autoFormData,\n+        width: 800,\n+        height: 600,\n+        queriesData: [\n+          {\n+            data: [\n+              { country: 'USA', currency: 'USD', revenue: 100 },\n+              { country: 'Canada', currency: 'USD', revenue: 200 },\n+              { country: 'Mexico', currency: 'usd', revenue: 150 },\n+            ],\n+            colnames: ['country', 'currency', 'revenue'],\n+            coltypes: [1, 1, 0],\n+          },\n+        ],\n+        hooks: { setDataMask },\n+        filterState: { selectedFilters: {} },\n+        datasource: {\n+          verboseMap: {},\n+          columnFormats: {},\n+          currencyCodeColumn: 'currency',\n+        },\n+        theme: supersetTheme,\n+      });\n+\n+      const result = transformProps(autoChartProps);\n+      // AUTO mode should be preserved for per-cell detection in PivotTableChart\n+      expect(result.currencyFormat).toEqual({\n+        symbol: 'AUTO',\n+        symbolPosition: 'prefix',\n+      });\n+      // currencyCodeColumn should be passed through for per-cell detection\n+      expect(result.currencyCodeColumn).toBe('currency');\n+    });\n+\n+    it('should pass AUTO mode through for per-cell detection (mixed currency data)', () => {\n+      const autoFormData = {\n+        ...formData,\n+        currencyFormat: { symbol: 'AUTO', symbolPosition: 'prefix' },\n+      };\n+      const autoChartProps = new ChartProps<QueryFormData>({\n+        formData: autoFormData,\n+        width: 800,\n+        height: 600,\n+        queriesData: [\n+          {\n+            data: [\n+              { country: 'USA', currency: 'USD', revenue: 100 },\n+              { country: 'UK', currency: 'GBP', revenue: 200 },\n+              { country: 'France', currency: 'EUR', revenue: 150 },\n+            ],\n+            colnames: ['country', 'currency', 'revenue'],\n+            coltypes: [1, 1, 0],\n+          },\n+        ],\n+        hooks: { setDataMask },\n+        filterState: { selectedFilters: {} },\n+        datasource: {\n+          verboseMap: {},\n+          columnFormats: {},\n+          currencyCodeColumn: 'currency',\n+        },\n+        theme: supersetTheme,\n+      });\n+\n+      const result = transformProps(autoChartProps);\n+      // AUTO mode should be preserved - per-cell detection happens in PivotTableChart\n+      expect(result.currencyFormat).toEqual({\n+        symbol: 'AUTO',\n+        symbolPosition: 'prefix',\n+      });\n+      expect(result.currencyCodeColumn).toBe('currency');\n+    });\n+\n+    it('should pass AUTO mode through when no currency column is defined', () => {\n+      const autoFormData = {\n+        ...formData,\n+        currencyFormat: { symbol: 'AUTO', symbolPosition: 'prefix' },\n+      };\n+      const autoChartProps = new ChartProps<QueryFormData>({\n+        formData: autoFormData,\n+        width: 800,\n+        height: 600,\n+        queriesData: [\n+          {\n+            data: [\n+              { country: 'USA', revenue: 100 },\n+              { country: 'UK', revenue: 200 },\n+            ],\n+            colnames: ['country', 'revenue'],\n+            coltypes: [1, 0],\n+          },\n+        ],\n+        hooks: { setDataMask },\n+        filterState: { selectedFilters: {} },\n+        datasource: {\n+          verboseMap: {},\n+          columnFormats: {},\n+          // No currencyCodeColumn defined\n+        },\n+        theme: supersetTheme,\n+      });\n+\n+      const result = transformProps(autoChartProps);\n+      expect(result.currencyFormat).toEqual({\n+        symbol: 'AUTO',\n+        symbolPosition: 'prefix',\n+      });\n+      // currencyCodeColumn should be undefined when not configured\n+      expect(result.currencyCodeColumn).toBeUndefined();\n+    });\n+\n+    it('should handle empty data gracefully in AUTO mode', () => {\n+      const autoFormData = {\n+        ...formData,\n+        currencyFormat: { symbol: 'AUTO', symbolPosition: 'prefix' },\n+      };\n+      const autoChartProps = new ChartProps<QueryFormData>({\n+        formData: autoFormData,\n+        width: 800,\n+        height: 600,\n+        queriesData: [\n+          {\n+            data: [],\n+            colnames: ['country', 'currency', 'revenue'],\n+            coltypes: [1, 1, 0],\n+          },\n+        ],\n+        hooks: { setDataMask },\n+        filterState: { selectedFilters: {} },\n+        datasource: {\n+          verboseMap: {},\n+          columnFormats: {},\n+          currencyCodeColumn: 'currency',\n+        },\n+        theme: supersetTheme,\n+      });\n+\n+      const result = transformProps(autoChartProps);\n+      expect(result.currencyFormat).toEqual({\n+        symbol: 'AUTO',\n+        symbolPosition: 'prefix',\n+      });\n+      expect(result.currencyCodeColumn).toBe('currency');\n+    });\n+\n+    it('should preserve static currency format when not using AUTO mode', () => {\n+      const staticFormData = {\n+        ...formData,\n+        currencyFormat: { symbol: 'EUR', symbolPosition: 'suffix' },\n+      };\n+      const staticChartProps = new ChartProps<QueryFormData>({\n+        formData: staticFormData,\n+        width: 800,\n+        height: 600,\n+        queriesData: [\n+          {\n+            data: [\n+              { country: 'USA', currency: 'USD', revenue: 100 },\n+              { country: 'UK', currency: 'GBP', revenue: 200 },\n+            ],\n+            colnames: ['country', 'currency', 'revenue'],\n+            coltypes: [1, 1, 0],\n+          },\n+        ],\n+        hooks: { setDataMask },\n+        filterState: { selectedFilters: {} },\n+        datasource: {\n+          verboseMap: {},\n+          columnFormats: {},\n+          currencyCodeColumn: 'currency',\n+        },\n+        theme: supersetTheme,\n+      });\n+\n+      const result = transformProps(staticChartProps);\n+      expect(result.currencyFormat).toEqual({\n+        symbol: 'EUR',\n+        symbolPosition: 'suffix',\n+      });\n+    });\n+  });\n });", "pull_request_number": 36416}
{"sha": "90d894d9a91042d0345cca591d9a53dabcd5dbed", "filename": "superset-frontend/plugins/plugin-chart-table/src/TableChart.tsx", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2FTableChart.tsx", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2FTableChart.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2FTableChart.tsx?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -892,7 +892,7 @@ export default function TableChart<D extends DataRecord = DataRecord>(\n         columnKey: key,\n         accessor: ((datum: D) => datum[key]) as never,\n         Cell: ({ value, row }: { value: DataRecordValue; row: Row<D> }) => {\n-          const [isHtml, text] = formatColumnValue(column, value);\n+          const [isHtml, text] = formatColumnValue(column, value, row.original);\n           const html = isHtml && allowRenderHtml ? { __html: text } : undefined;\n \n           let backgroundColor;", "pull_request_number": 36416}
{"sha": "949d7410cc53b612bf9cdf88144a3f0abebb56a8", "filename": "superset-frontend/plugins/plugin-chart-table/src/transformProps.ts", "status": "modified", "additions": 31, "deletions": 4, "changes": 35, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2FtransformProps.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2FtransformProps.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2FtransformProps.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -29,6 +29,7 @@ import {\n   getNumberFormatter,\n   getTimeFormatter,\n   getTimeFormatterForGranularity,\n+  normalizeCurrency,\n   NumberFormats,\n   QueryMode,\n   SMART_DATE_ID,\n@@ -200,7 +201,12 @@ const processColumns = memoizeOne(function processColumns(\n   props: TableChartProps,\n ) {\n   const {\n-    datasource: { columnFormats, currencyFormats, verboseMap },\n+    datasource: {\n+      columnFormats,\n+      currencyFormats,\n+      verboseMap,\n+      currencyCodeColumn,\n+    },\n     rawFormData: {\n       table_timestamp_format: tableTimestampFormat,\n       metrics: metrics_,\n@@ -210,7 +216,12 @@ const processColumns = memoizeOne(function processColumns(\n     queriesData,\n   } = props;\n   const granularity = extractTimegrain(props.rawFormData);\n-  const { data: records, colnames, coltypes } = queriesData[0] || {};\n+  const {\n+    data: records,\n+    colnames,\n+    coltypes,\n+    detected_currency: detectedCurrency,\n+  } = queriesData[0] || {};\n   // convert `metrics` and `percentMetrics` to the key names in `data.records`\n   const metrics = (metrics_ ?? []).map(getMetricLabel);\n   const rawPercentMetrics = (percentMetrics_ ?? []).map(getMetricLabel);\n@@ -276,10 +287,25 @@ const processColumns = memoizeOne(function processColumns(\n         // percent metrics have a default format\n         formatter = getNumberFormatter(numberFormat || PERCENT_3_POINT);\n       } else if (isMetric || (isNumber && (numberFormat || currency))) {\n-        formatter = currency?.symbol\n+        // Resolve AUTO currency when currency column isn't in query results\n+        let resolvedCurrency = currency;\n+        if (\n+          currency?.symbol === 'AUTO' &&\n+          detectedCurrency &&\n+          (!currencyCodeColumn || !colnames?.includes(currencyCodeColumn))\n+        ) {\n+          const normalizedCurrency = normalizeCurrency(detectedCurrency);\n+          if (normalizedCurrency) {\n+            resolvedCurrency = {\n+              ...currency,\n+              symbol: normalizedCurrency,\n+            };\n+          }\n+        }\n+        formatter = resolvedCurrency?.symbol\n           ? new CurrencyFormatter({\n               d3Format: numberFormat,\n-              currency,\n+              currency: resolvedCurrency,\n             })\n           : getNumberFormatter(numberFormat);\n       }\n@@ -292,6 +318,7 @@ const processColumns = memoizeOne(function processColumns(\n         isPercentMetric,\n         formatter,\n         config,\n+        currencyCodeColumn,\n       };\n     });\n   return [metrics, percentMetrics, columns] as [", "pull_request_number": 36416}
{"sha": "721c80dfbf2b0bfa981e303ca6312452b4f0ff5b", "filename": "superset-frontend/plugins/plugin-chart-table/src/types.ts", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2Ftypes.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2Ftypes.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2Ftypes.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -72,6 +72,7 @@ export interface DataColumnMeta {\n   isNumeric?: boolean;\n   config?: TableColumnConfig;\n   isChildColumn?: boolean;\n+  currencyCodeColumn?: string;\n }\n \n export interface TableChartData {", "pull_request_number": 36416}
{"sha": "3769abe5514f8918acae1734a4ee258e44835a06", "filename": "superset-frontend/plugins/plugin-chart-table/src/utils/formatValue.ts", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2Futils%2FformatValue.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2Futils%2FformatValue.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2Futils%2FformatValue.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -33,6 +33,8 @@ import DateWithFormatter from './DateWithFormatter';\n function formatValue(\n   formatter: DataColumnMeta['formatter'],\n   value: DataRecordValue,\n+  rowData?: Record<string, DataRecordValue>,\n+  currencyColumn?: string,\n ): [boolean, string] {\n   // render undefined as empty string\n   if (value === undefined) {\n@@ -48,6 +50,10 @@ function formatValue(\n     return [false, 'N/A'];\n   }\n   if (formatter) {\n+    // If formatter is a CurrencyFormatter, pass row context for AUTO mode\n+    if (formatter instanceof CurrencyFormatter) {\n+      return [false, formatter(value as number, rowData, currencyColumn)];\n+    }\n     return [false, formatter(value as number)];\n   }\n   if (typeof value === 'string') {\n@@ -59,8 +65,9 @@ function formatValue(\n export function formatColumnValue(\n   column: DataColumnMeta,\n   value: DataRecordValue,\n+  rowData?: Record<string, DataRecordValue>,\n ) {\n-  const { dataType, formatter, config = {} } = column;\n+  const { dataType, formatter, config = {}, currencyCodeColumn } = column;\n   const isNumber = dataType === GenericDataType.Numeric;\n   const smallNumberFormatter =\n     config.d3SmallNumberFormat === undefined\n@@ -76,5 +83,7 @@ export function formatColumnValue(\n       ? smallNumberFormatter\n       : formatter,\n     value,\n+    rowData,\n+    currencyCodeColumn,\n   );\n }", "pull_request_number": 36416}
{"sha": "0643eaab68b88a7e64c3c825a78a85c64f18d1db", "filename": "superset-frontend/plugins/plugin-chart-table/src/utils/isEqualColumns.ts", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2Futils%2FisEqualColumns.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2Futils%2FisEqualColumns.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-table%2Fsrc%2Futils%2FisEqualColumns.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -28,6 +28,7 @@ export default function isEqualColumns(\n   return (\n     a.datasource.columnFormats === b.datasource.columnFormats &&\n     a.datasource.currencyFormats === b.datasource.currencyFormats &&\n+    a.datasource.currencyCodeColumn === b.datasource.currencyCodeColumn &&\n     a.datasource.verboseMap === b.datasource.verboseMap &&\n     a.formData.tableTimestampFormat === b.formData.tableTimestampFormat &&\n     a.formData.timeGrainSqla === b.formData.timeGrainSqla &&\n@@ -36,6 +37,8 @@ export default function isEqualColumns(\n     isEqualArray(a.formData.metrics, b.formData.metrics) &&\n     isEqualArray(a.queriesData?.[0]?.colnames, b.queriesData?.[0]?.colnames) &&\n     isEqualArray(a.queriesData?.[0]?.coltypes, b.queriesData?.[0]?.coltypes) &&\n+    a.queriesData?.[0]?.detected_currency ===\n+      b.queriesData?.[0]?.detected_currency &&\n     JSON.stringify(a.formData.extraFilters || null) ===\n       JSON.stringify(b.formData.extraFilters || null) &&\n     JSON.stringify(a.formData.extraFormData || null) ===", "pull_request_number": 36416}
{"sha": "7443092414279ef310e363099d405a8a3afb44ea", "filename": "superset-frontend/plugins/plugin-chart-table/test/utils/formatValue.test.ts", "status": "added", "additions": 155, "deletions": 0, "changes": 155, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-table%2Ftest%2Futils%2FformatValue.test.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fplugins%2Fplugin-chart-table%2Ftest%2Futils%2FformatValue.test.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-table%2Ftest%2Futils%2FformatValue.test.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -0,0 +1,155 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import { CurrencyFormatter, getNumberFormatter } from '@superset-ui/core';\n+import { GenericDataType } from '@apache-superset/core/api/core';\n+import { formatColumnValue } from '../../src/utils/formatValue';\n+import { DataColumnMeta } from '../../src/types';\n+\n+test('formatColumnValue with CurrencyFormatter AUTO mode uses row context', () => {\n+  const formatter = new CurrencyFormatter({\n+    d3Format: ',.2f',\n+    currency: { symbol: 'AUTO', symbolPosition: 'prefix' },\n+  });\n+\n+  const column: DataColumnMeta = {\n+    key: 'revenue',\n+    label: 'Revenue',\n+    dataType: GenericDataType.Numeric,\n+    formatter,\n+    isNumeric: true,\n+    currencyCodeColumn: 'currency_code',\n+  };\n+\n+  const rowData = { revenue: 1000, currency_code: 'EUR' };\n+  const [isHtml, result] = formatColumnValue(column, 1000, rowData);\n+\n+  expect(isHtml).toBe(false);\n+  expect(result).toContain('\u20ac');\n+  expect(result).toContain('1,000.00');\n+});\n+\n+test('formatColumnValue with CurrencyFormatter AUTO mode returns neutral format without row context', () => {\n+  const formatter = new CurrencyFormatter({\n+    d3Format: ',.2f',\n+    currency: { symbol: 'AUTO', symbolPosition: 'prefix' },\n+  });\n+\n+  const column: DataColumnMeta = {\n+    key: 'revenue',\n+    label: 'Revenue',\n+    dataType: GenericDataType.Numeric,\n+    formatter,\n+    isNumeric: true,\n+    currencyCodeColumn: 'currency_code',\n+  };\n+\n+  // No row data provided\n+  const [isHtml, result] = formatColumnValue(column, 1000);\n+\n+  expect(isHtml).toBe(false);\n+  expect(result).toBe('1,000.00');\n+  expect(result).not.toContain('$');\n+  expect(result).not.toContain('\u20ac');\n+});\n+\n+test('formatColumnValue with static CurrencyFormatter ignores row context', () => {\n+  const formatter = new CurrencyFormatter({\n+    d3Format: ',.2f',\n+    currency: { symbol: 'USD', symbolPosition: 'prefix' },\n+  });\n+\n+  const column: DataColumnMeta = {\n+    key: 'revenue',\n+    label: 'Revenue',\n+    dataType: GenericDataType.Numeric,\n+    formatter,\n+    isNumeric: true,\n+  };\n+\n+  // Row has EUR but static mode should show $\n+  const rowData = { revenue: 1000, currency_code: 'EUR' };\n+  const [isHtml, result] = formatColumnValue(column, 1000, rowData);\n+\n+  expect(isHtml).toBe(false);\n+  expect(result).toContain('$');\n+  expect(result).not.toContain('\u20ac');\n+});\n+\n+test('formatColumnValue with AUTO mode normalizes currency codes', () => {\n+  const formatter = new CurrencyFormatter({\n+    d3Format: ',.2f',\n+    currency: { symbol: 'AUTO', symbolPosition: 'prefix' },\n+  });\n+\n+  const column: DataColumnMeta = {\n+    key: 'revenue',\n+    label: 'Revenue',\n+    dataType: GenericDataType.Numeric,\n+    formatter,\n+    isNumeric: true,\n+    currencyCodeColumn: 'currency_code',\n+  };\n+\n+  // Test lowercase currency code\n+  const rowData1 = { revenue: 500, currency_code: 'usd' };\n+  const [, result1] = formatColumnValue(column, 500, rowData1);\n+  expect(result1).toContain('$');\n+\n+  // Test uppercase currency code (GBP -> \u00a3)\n+  const rowData2 = { revenue: 750, currency_code: 'GBP' };\n+  const [, result2] = formatColumnValue(column, 750, rowData2);\n+  expect(result2).toContain('\u00a3');\n+});\n+\n+test('formatColumnValue handles null values', () => {\n+  const column: DataColumnMeta = {\n+    key: 'revenue',\n+    label: 'Revenue',\n+    dataType: GenericDataType.Numeric,\n+    formatter: getNumberFormatter(',.2f'),\n+    isNumeric: true,\n+  };\n+\n+  const [, nullResult] = formatColumnValue(column, null);\n+  expect(nullResult).toBe('N/A');\n+});\n+\n+test('formatColumnValue with small number format and currency', () => {\n+  const formatter = new CurrencyFormatter({\n+    d3Format: ',.2f',\n+    currency: { symbol: 'EUR', symbolPosition: 'prefix' },\n+  });\n+\n+  const column: DataColumnMeta = {\n+    key: 'revenue',\n+    label: 'Revenue',\n+    dataType: GenericDataType.Numeric,\n+    formatter,\n+    isNumeric: true,\n+    config: {\n+      d3SmallNumberFormat: ',.4f',\n+      currencyFormat: { symbol: 'EUR', symbolPosition: 'prefix' },\n+    },\n+  };\n+\n+  // Small number should use small number format\n+  const [, result] = formatColumnValue(column, 0.5);\n+  expect(result).toContain('\u20ac');\n+  expect(result).toContain('0.5000');\n+});", "pull_request_number": 36416}
{"sha": "56379a40e2931f1737369f5959f03729a60a63c1", "filename": "superset-frontend/src/components/Datasource/DatasourceModal/index.tsx", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fsrc%2Fcomponents%2FDatasource%2FDatasourceModal%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fsrc%2Fcomponents%2FDatasource%2FDatasourceModal%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fcomponents%2FDatasource%2FDatasourceModal%2Findex.tsx?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -119,6 +119,7 @@ const DatasourceModal: FunctionComponent<DatasourceModalProps> = ({\n         datasource.schema,\n       description: datasource.description,\n       main_dttm_col: datasource.main_dttm_col,\n+      currency_code_column: datasource.currency_code_column ?? null,\n       normalize_columns: datasource.normalize_columns,\n       always_filter_main_dttm: datasource.always_filter_main_dttm,\n       offset: datasource.offset,", "pull_request_number": 36416}
{"sha": "fc220317599f96e77298a86f41d3669b74f2fe3b", "filename": "superset-frontend/src/components/Datasource/components/DatasourceEditor/DatasourceEditor.jsx", "status": "modified", "additions": 120, "deletions": 63, "changes": 183, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fsrc%2Fcomponents%2FDatasource%2Fcomponents%2FDatasourceEditor%2FDatasourceEditor.jsx", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fsrc%2Fcomponents%2FDatasource%2Fcomponents%2FDatasourceEditor%2FDatasourceEditor.jsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fcomponents%2FDatasource%2Fcomponents%2FDatasourceEditor%2FDatasourceEditor.jsx?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -30,6 +30,7 @@ import {\n   getClientErrorObject,\n   getExtensionsRegistry,\n } from '@superset-ui/core';\n+import { GenericDataType } from '@apache-superset/core/api/core';\n import {\n   css,\n   styled,\n@@ -56,8 +57,10 @@ import {\n   Col,\n   Divider,\n   EditableTitle,\n+  Flex,\n   FormLabel,\n   Icons,\n+  InfoTooltip,\n   Loading,\n   Row,\n   Select,\n@@ -157,6 +160,31 @@ const StyledTableTabWrapper = styled.div`\n   }\n `;\n \n+const DefaultColumnSettingsContainer = styled.div`\n+  ${({ theme }) => css`\n+    margin-bottom: ${theme.sizeUnit * 4}px;\n+  `}\n+`;\n+\n+const DefaultColumnSettingsTitle = styled.h4`\n+  ${({ theme }) => css`\n+    margin: 0 0 ${theme.sizeUnit * 2}px 0;\n+    font-size: ${theme.fontSizeLG}px;\n+    font-weight: ${theme.fontWeightMedium};\n+    color: ${theme.colorText};\n+  `}\n+`;\n+\n+const FieldLabelWithTooltip = styled.div`\n+  ${({ theme }) => css`\n+    display: flex;\n+    align-items: center;\n+    gap: ${theme.sizeUnit}px;\n+    font-size: ${theme.fontSizeSM}px;\n+    color: ${theme.colorTextLabel};\n+  `}\n+`;\n+\n const StyledButtonWrapper = styled.span`\n   ${({ theme }) => `\n     margin-top: ${theme.sizeUnit * 3}px;\n@@ -234,18 +262,10 @@ function ColumnCollectionTable({\n               'advanced_data_type',\n               'type',\n               'is_dttm',\n-              'main_dttm_col',\n-              'filterable',\n-              'groupby',\n-            ]\n-          : [\n-              'column_name',\n-              'type',\n-              'is_dttm',\n-              'main_dttm_col',\n               'filterable',\n               'groupby',\n             ]\n+          : ['column_name', 'type', 'is_dttm', 'filterable', 'groupby']\n       }\n       sortColumns={\n         isFeatureEnabled(FeatureFlag.EnableAdvancedDataTypes)\n@@ -254,18 +274,10 @@ function ColumnCollectionTable({\n               'advanced_data_type',\n               'type',\n               'is_dttm',\n-              'main_dttm_col',\n-              'filterable',\n-              'groupby',\n-            ]\n-          : [\n-              'column_name',\n-              'type',\n-              'is_dttm',\n-              'main_dttm_col',\n               'filterable',\n               'groupby',\n             ]\n+          : ['column_name', 'type', 'is_dttm', 'filterable', 'groupby']\n       }\n       allowDeletes\n       allowAddItem={allowAddItem}\n@@ -403,15 +415,13 @@ function ColumnCollectionTable({\n               type: t('Data type'),\n               groupby: t('Is dimension'),\n               is_dttm: t('Is temporal'),\n-              main_dttm_col: t('Default datetime'),\n               filterable: t('Is filterable'),\n             }\n           : {\n               column_name: t('Column'),\n               type: t('Data type'),\n               groupby: t('Is dimension'),\n               is_dttm: t('Is temporal'),\n-              main_dttm_col: t('Default datetime'),\n               filterable: t('Is filterable'),\n             }\n       }\n@@ -445,27 +455,6 @@ function ColumnCollectionTable({\n                     {v}\n                   </StyledLabelWrapper>\n                 ),\n-              main_dttm_col: (value, _onItemChange, _label, record) => {\n-                const checked = datasource.main_dttm_col === record.column_name;\n-                const disabled = !record?.is_dttm;\n-                return (\n-                  <Radio\n-                    aria-label={t(\n-                      'Set %s as default datetime column',\n-                      record.column_name,\n-                    )}\n-                    data-test={`radio-default-dttm-${record.column_name}`}\n-                    checked={checked}\n-                    disabled={disabled}\n-                    onChange={() =>\n-                      onDatasourceChange({\n-                        ...datasource,\n-                        main_dttm_col: record.column_name,\n-                      })\n-                    }\n-                  />\n-                );\n-              },\n               type: d => (d ? <Label>{d}</Label> : null),\n               advanced_data_type: d => (\n                 <Label onChange={onColumnsChange}>{d}</Label>\n@@ -497,27 +486,6 @@ function ColumnCollectionTable({\n                     {v}\n                   </StyledLabelWrapper>\n                 ),\n-              main_dttm_col: (value, _onItemChange, _label, record) => {\n-                const checked = datasource.main_dttm_col === record.column_name;\n-                const disabled = !record?.is_dttm;\n-                return (\n-                  <Radio\n-                    aria-label={t(\n-                      'Set %s as default datetime column',\n-                      record.column_name,\n-                    )}\n-                    data-test={`radio-default-dttm-${record.column_name}`}\n-                    checked={checked}\n-                    disabled={disabled}\n-                    onChange={() =>\n-                      onDatasourceChange({\n-                        ...datasource,\n-                        main_dttm_col: record.column_name,\n-                      })\n-                    }\n-                  />\n-                );\n-              },\n               type: d => (d ? <Label>{d}</Label> : null),\n               is_dttm: checkboxGenerator,\n               filterable: checkboxGenerator,\n@@ -1083,11 +1051,12 @@ class DatasourceEditor extends PureComponent {\n       ),\n     );\n \n-    // validate currency code\n+    // validate currency code (skip 'AUTO' - it's a placeholder for auto-detection)\n     try {\n       this.state.datasource.metrics?.forEach(\n         metric =>\n           metric.currency?.symbol &&\n+          metric.currency.symbol !== 'AUTO' &&\n           new Intl.NumberFormat('en-US', {\n             style: 'currency',\n             currency: metric.currency.symbol,\n@@ -1108,6 +1077,86 @@ class DatasourceEditor extends PureComponent {\n     return metrics.sort(({ id: a }, { id: b }) => b - a);\n   }\n \n+  renderDefaultColumnSettings() {\n+    const { datasource, databaseColumns, calculatedColumns } = this.state;\n+    const { theme } = this.props;\n+    const allColumns = [...databaseColumns, ...calculatedColumns];\n+\n+    // Get datetime-compatible columns for the default datetime dropdown\n+    const datetimeColumns = allColumns\n+      .filter(col => col.is_dttm)\n+      .map(col => ({\n+        value: col.column_name,\n+        label: col.verbose_name || col.column_name,\n+      }));\n+\n+    // Get string-type columns for the currency code dropdown\n+    const stringColumns = allColumns\n+      .filter(col => col.type_generic === GenericDataType.String)\n+      .map(col => ({\n+        value: col.column_name,\n+        label: col.verbose_name || col.column_name,\n+      }));\n+\n+    return (\n+      <DefaultColumnSettingsContainer data-test=\"default-column-settings\">\n+        <DefaultColumnSettingsTitle>\n+          {t('Default Column Settings')}\n+        </DefaultColumnSettingsTitle>\n+        <Flex vertical gap={theme.sizeUnit * 3}>\n+          <Flex vertical gap={theme.sizeUnit}>\n+            <FieldLabelWithTooltip>\n+              <span>{t('Default datetime column')}</span>\n+              <InfoTooltip\n+                tooltip={t(\n+                  'Sets the default temporal column for this dataset. Automatically selected as the time column when building charts that require a time dimension and used in dashboard level time filters.',\n+                )}\n+              />\n+            </FieldLabelWithTooltip>\n+            <Select\n+              ariaLabel={t('Default datetime column')}\n+              options={datetimeColumns}\n+              value={datasource.main_dttm_col}\n+              onChange={value =>\n+                this.onDatasourceChange({\n+                  ...datasource,\n+                  main_dttm_col: value,\n+                })\n+              }\n+              placeholder={t('Select datetime column')}\n+              allowClear\n+              data-test=\"default-datetime-column-select\"\n+            />\n+          </Flex>\n+          <Flex vertical gap={theme.sizeUnit}>\n+            <FieldLabelWithTooltip>\n+              <span>{t('Currency code column')}</span>\n+              <InfoTooltip\n+                tooltip={t(\n+                  \"Select the column containing currency codes such as USD, EUR, GBP, etc. Used when building charts when 'Auto-detect' currency formatting is enabled. If this column is not set or if a chart metric contains multiple currencies, charts will fall back to neutral numeric formatting.\",\n+                )}\n+              />\n+            </FieldLabelWithTooltip>\n+            <Select\n+              ariaLabel={t('Currency code column')}\n+              options={stringColumns}\n+              value={datasource.currency_code_column}\n+              onChange={value =>\n+                this.onDatasourceChange({\n+                  ...datasource,\n+                  currency_code_column: value,\n+                })\n+              }\n+              placeholder={t('Select currency code column')}\n+              allowClear\n+              data-test=\"currency-code-column-select\"\n+            />\n+          </Flex>\n+        </Flex>\n+      </DefaultColumnSettingsContainer>\n+    );\n+  }\n+\n   renderSettingsFieldset() {\n     const { datasource } = this.state;\n     return (\n@@ -1889,6 +1938,10 @@ class DatasourceEditor extends PureComponent {\n               ),\n               children: (\n                 <StyledTableTabWrapper>\n+                  {this.renderDefaultColumnSettings()}\n+                  <DefaultColumnSettingsTitle>\n+                    {t('Column Settings')}\n+                  </DefaultColumnSettingsTitle>\n                   <ColumnButtonWrapper>\n                     <StyledButtonWrapper>\n                       <Button\n@@ -1926,6 +1979,10 @@ class DatasourceEditor extends PureComponent {\n               ),\n               children: (\n                 <StyledTableTabWrapper>\n+                  {this.renderDefaultColumnSettings()}\n+                  <DefaultColumnSettingsTitle>\n+                    {t('Column Settings')}\n+                  </DefaultColumnSettingsTitle>\n                   <ColumnCollectionTable\n                     columns={this.state.calculatedColumns}\n                     onColumnsChange={calculatedColumns =>", "pull_request_number": 36416}
{"sha": "bab512914dd8fc37df5a20cba70201eda37dcae9", "filename": "superset-frontend/src/components/Datasource/components/DatasourceEditor/tests/DatasourceEditor.test.tsx", "status": "modified", "additions": 31, "deletions": 13, "changes": 44, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fsrc%2Fcomponents%2FDatasource%2Fcomponents%2FDatasourceEditor%2Ftests%2FDatasourceEditor.test.tsx", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fsrc%2Fcomponents%2FDatasource%2Fcomponents%2FDatasourceEditor%2Ftests%2FDatasourceEditor.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fcomponents%2FDatasource%2Fcomponents%2FDatasourceEditor%2Ftests%2FDatasourceEditor.test.tsx?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -365,34 +365,52 @@ test('properly updates the metric information', async () => {\n   });\n });\n \n-test('shows the default datetime column', async () => {\n+test('shows the default datetime column in dropdown', async () => {\n   await asyncRender(createProps());\n \n   const columnsButton = screen.getByTestId('collection-tab-Columns');\n   await userEvent.click(columnsButton);\n \n-  const dsDefaultDatetimeRadio = screen.getByTestId('radio-default-dttm-ds');\n-  expect(dsDefaultDatetimeRadio).toBeChecked();\n+  // Find the Default Column Settings section\n+  const defaultColumnSettings = screen.getByTestId('default-column-settings');\n+  expect(defaultColumnSettings).toBeInTheDocument();\n \n-  const genderDefaultDatetimeRadio = screen.getByTestId(\n-    'radio-default-dttm-gender',\n-  );\n-  expect(genderDefaultDatetimeRadio).not.toBeChecked();\n+  // Find the default datetime column dropdown\n+  const defaultDatetimeDropdown = screen.getByRole('combobox', {\n+    name: 'Default datetime column',\n+  });\n+  expect(defaultDatetimeDropdown).toBeInTheDocument();\n+\n+  // Verify the current value is 'ds' (from main_dttm_col in props)\n+  const selectedValue = await screen.findByText('ds', {\n+    selector: '.ant-select-selection-item',\n+  });\n+  expect(selectedValue).toBeInTheDocument();\n });\n \n-test('allows choosing only temporal columns as the default datetime', async () => {\n+test('default datetime dropdown shows only temporal columns', async () => {\n   await asyncRender(createProps());\n \n   const columnsButton = screen.getByTestId('collection-tab-Columns');\n   await userEvent.click(columnsButton);\n \n-  const dsDefaultDatetimeRadio = screen.getByTestId('radio-default-dttm-ds');\n-  expect(dsDefaultDatetimeRadio).toBeEnabled();\n+  // Find the default datetime column dropdown\n+  const defaultDatetimeDropdown = screen.getByRole('combobox', {\n+    name: 'Default datetime column',\n+  });\n+\n+  await userEvent.click(defaultDatetimeDropdown);\n+\n+  // Check that temporal column 'ds' is in the dropdown options\n+  const options = document.querySelectorAll('.ant-select-item-option');\n+  const dsOption = Array.from(options).find(o => o.textContent?.includes('ds'));\n+  expect(dsOption).toBeDefined();\n \n-  const genderDefaultDatetimeRadio = screen.getByTestId(\n-    'radio-default-dttm-gender',\n+  // Check that non-temporal column 'gender' is NOT in the dropdown\n+  const genderOption = Array.from(options).find(o =>\n+    o.textContent?.includes('gender'),\n   );\n-  expect(genderDefaultDatetimeRadio).toBeDisabled();\n+  expect(genderOption).toBeUndefined();\n });\n \n test('aborts pending requests on unmount without errors', async () => {", "pull_request_number": 36416}
{"sha": "1d9692c41d148f107b3039e465dffc386086cc67", "filename": "superset-frontend/src/components/Datasource/components/DatasourceEditor/tests/DatasourceEditorCurrency.test.tsx", "status": "modified", "additions": 67, "deletions": 0, "changes": 67, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fsrc%2Fcomponents%2FDatasource%2Fcomponents%2FDatasourceEditor%2Ftests%2FDatasourceEditorCurrency.test.tsx", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fsrc%2Fcomponents%2FDatasource%2Fcomponents%2FDatasourceEditor%2Ftests%2FDatasourceEditorCurrency.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fcomponents%2FDatasource%2Fcomponents%2FDatasourceEditor%2Ftests%2FDatasourceEditorCurrency.test.tsx?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -23,6 +23,7 @@ import {\n   userEvent,\n   selectOption,\n } from 'spec/helpers/testing-library';\n+import { GenericDataType } from '@apache-superset/core/api/core';\n import type { DatasetObject } from 'src/features/datasets/types';\n import {\n   createProps,\n@@ -136,3 +137,69 @@ test('changes currency symbol from USD to GBP', async () => {\n   );\n   expect(updatedMetric?.currency?.symbolPosition).toBe('prefix');\n }, 60000);\n+\n+test('currency code column dropdown shows only string columns', async () => {\n+  const baseProps = createProps();\n+  const testProps = {\n+    ...baseProps,\n+    datasource: {\n+      ...baseProps.datasource,\n+      columns: [\n+        {\n+          id: 100,\n+          type: 'VARCHAR(255)',\n+          type_generic: GenericDataType.String,\n+          filterable: true,\n+          is_dttm: false,\n+          is_active: true,\n+          expression: '',\n+          groupby: true,\n+          column_name: 'currency_code',\n+        },\n+        {\n+          id: 101,\n+          type: 'DECIMAL',\n+          type_generic: GenericDataType.Numeric,\n+          filterable: false,\n+          is_dttm: false,\n+          is_active: true,\n+          expression: '',\n+          groupby: false,\n+          column_name: 'amount',\n+        },\n+        ...baseProps.datasource.columns,\n+      ],\n+    },\n+    onChange: jest.fn(),\n+  };\n+\n+  fastRender(testProps);\n+  await dismissDatasourceWarning();\n+\n+  // Navigate to columns tab\n+  const columnsTab = await screen.findByTestId('collection-tab-Columns');\n+  await userEvent.click(columnsTab);\n+\n+  // Find the currency code column dropdown\n+  const currencyCodeDropdown = await screen.findByRole('combobox', {\n+    name: 'Currency code column',\n+  });\n+\n+  await userEvent.click(currencyCodeDropdown);\n+\n+  // Verify STRING column is available\n+  await waitFor(() => {\n+    const options = document.querySelectorAll('.ant-select-item-option');\n+    const currencyCodeOption = Array.from(options).find(o =>\n+      o.textContent?.includes('currency_code'),\n+    );\n+    expect(currencyCodeOption).toBeDefined();\n+  });\n+\n+  // Verify NUMERIC column is NOT available\n+  const options = document.querySelectorAll('.ant-select-item-option');\n+  const amountOption = Array.from(options).find(o =>\n+    o.textContent?.includes('amount'),\n+  );\n+  expect(amountOption).toBeUndefined();\n+}, 60000);", "pull_request_number": 36416}
{"sha": "2fac42ba0576d798ac916edf10706da9dfa9b4a4", "filename": "superset-frontend/src/explore/components/controls/ColumnConfigControl/ColumnConfigControl.tsx", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2Fcontrols%2FColumnConfigControl%2FColumnConfigControl.tsx", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2Fcontrols%2FColumnConfigControl%2FColumnConfigControl.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2Fcontrols%2FColumnConfigControl%2FColumnConfigControl.tsx?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -82,6 +82,7 @@ export default function ColumnConfigControl<T extends ColumnConfig>({\n     });\n   }\n   const theme = useTheme();\n+\n   const columnConfigs = useMemo(() => {\n     const configs: Record<string, ColumnConfigInfo> = {};\n     colnames?.forEach((col, idx) => {\n@@ -100,6 +101,7 @@ export default function ColumnConfigControl<T extends ColumnConfig>({\n   const [showAllColumns, setShowAllColumns] = useState(false);\n \n   const getColumnInfo = (col: string) => columnConfigs[col] || {};\n+\n   const setColumnConfig = (col: string, config: T) => {\n     if (onChange) {\n       // Only keep configs for known columns", "pull_request_number": 36416}
{"sha": "088a06d89989cfa61cedab52664bf1d09b4372ce", "filename": "superset-frontend/src/explore/components/controls/ColumnConfigControl/constants.tsx", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2Fcontrols%2FColumnConfigControl%2Fconstants.tsx", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2Fcontrols%2FColumnConfigControl%2Fconstants.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2Fcontrols%2FColumnConfigControl%2Fconstants.tsx?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -168,7 +168,7 @@ const currencyFormat: ControlFormItemSpec<'CurrencyControl'> = {\n   controlType: 'CurrencyControl',\n   label: t('Currency format'),\n   description: t(\n-    'Customize chart metrics or columns with currency symbols as prefixes or suffixes. Choose a symbol from dropdown or type your own.',\n+    \"Format metrics or columns with currency symbols as prefixes or suffixes. Choose a symbol manually or use 'Auto-detect' to apply the correct symbol based on the dataset's currency code column. When multiple currencies are present, formatting falls back to neutral numbers.\",\n   ),\n   debounceDelay: 200,\n };", "pull_request_number": 36416}
{"sha": "39a1a64ee29ebbe0fe739fa8498f4b45e9a66d49", "filename": "superset-frontend/src/explore/components/controls/CurrencyControl/CurrencyControl.test.tsx", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2Fcontrols%2FCurrencyControl%2FCurrencyControl.test.tsx", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2Fcontrols%2FCurrencyControl%2FCurrencyControl.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2Fcontrols%2FCurrencyControl%2FCurrencyControl.test.tsx?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -0,0 +1,38 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import { render } from 'spec/helpers/testing-library';\n+import { CurrencyControl } from './CurrencyControl';\n+\n+test('CurrencyControl renders position and symbol selects', () => {\n+  const { container } = render(\n+    <CurrencyControl onChange={jest.fn()} value={{}} />,\n+    {\n+      useRedux: true,\n+      initialState: {\n+        common: { currencies: ['USD', 'EUR'] },\n+        explore: { datasource: {} },\n+      },\n+    },\n+  );\n+\n+  expect(\n+    container.querySelector('[data-test=\"currency-control-container\"]'),\n+  ).toBeInTheDocument();\n+  expect(container.querySelectorAll('.ant-select')).toHaveLength(2);\n+});", "pull_request_number": 36416}
{"sha": "8ec68904440566722945535d018e1ca600fed065", "filename": "superset-frontend/src/explore/components/controls/CurrencyControl/CurrencyControl.tsx", "status": "modified", "additions": 69, "deletions": 11, "changes": 80, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2Fcontrols%2FCurrencyControl%2FCurrencyControl.tsx", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2Fcontrols%2FCurrencyControl%2FCurrencyControl.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2Fcontrols%2FCurrencyControl%2FCurrencyControl.tsx?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -16,14 +16,15 @@\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n-import { useMemo } from 'react';\n+import { useCallback, useMemo } from 'react';\n import { useSelector } from 'react-redux';\n import { t } from '@apache-superset/core';\n import { Currency, ensureIsArray, getCurrencySymbol } from '@superset-ui/core';\n-import { css, styled } from '@apache-superset/core/ui';\n+import { css, styled, useTheme } from '@apache-superset/core/ui';\n import { CSSObject } from '@emotion/react';\n import { Select, type SelectProps } from '@superset-ui/core/components';\n import { ViewState } from 'src/views/types';\n+import { ExplorePageState } from 'src/explore/types';\n import ControlHeader from '../../ControlHeader';\n \n export interface CurrencyControlProps {\n@@ -67,19 +68,74 @@ export const CurrencyControl = ({\n   currencySelectAdditionalStyles,\n   ...props\n }: CurrencyControlProps) => {\n+  const theme = useTheme();\n   const currencies = useSelector<ViewState, string[]>(\n     state => state.common?.currencies,\n   );\n-  const currenciesOptions = useMemo(\n+  const currencyCodeColumn = useSelector<ExplorePageState, string | undefined>(\n+    state => state?.explore?.datasource?.currency_code_column,\n+  );\n+\n+  const currenciesOptions = useMemo(() => {\n+    const options = ensureIsArray(currencies).map(currencyCode => ({\n+      value: currencyCode,\n+      label: `${getCurrencySymbol({\n+        symbol: currencyCode,\n+      })} (${currencyCode})`,\n+    }));\n+\n+    const autoDetectOption = currencyCodeColumn\n+      ? [\n+          {\n+            value: 'AUTO',\n+            label: t('Auto-detect'),\n+            className: 'currency-auto-detect-option',\n+          },\n+        ]\n+      : [];\n+\n+    return [\n+      ...autoDetectOption,\n+      ...options,\n+      { value: '', label: t('Custom...') },\n+    ];\n+  }, [currencies, currencyCodeColumn]);\n+\n+  const currencySortComparator = useCallback(\n+    (\n+      a: { value?: string | number },\n+      b: { value?: string | number },\n+    ): number => {\n+      if (a.value === 'AUTO') return -1;\n+      if (b.value === 'AUTO') return 1;\n+      if (a.value === '') return 1;\n+      if (b.value === '') return -1;\n+      const labelA = String(a.value ?? '');\n+      const labelB = String(b.value ?? '');\n+      return labelA.localeCompare(labelB);\n+    },\n+    [],\n+  );\n+\n+  const renderCurrencyPopup = useMemo(\n     () =>\n-      ensureIsArray(currencies).map(currencyCode => ({\n-        value: currencyCode,\n-        label: `${getCurrencySymbol({\n-          symbol: currencyCode,\n-        })} (${currencyCode})`,\n-      })),\n-    [currencies],\n+      currencyCodeColumn\n+        ? (menu: React.ReactNode) => (\n+            <div\n+              css={css`\n+                .currency-auto-detect-option {\n+                  border-bottom: 1px solid ${theme.colorBorderSecondary};\n+                  margin-bottom: ${theme.sizeUnit}px;\n+                }\n+              `}\n+            >\n+              {menu}\n+            </div>\n+          )\n+        : undefined,\n+    [currencyCodeColumn, theme],\n   );\n+\n   return (\n     <>\n       <ControlHeader {...props} />\n@@ -92,7 +148,7 @@ export const CurrencyControl = ({\n             ${currencySelectAdditionalStyles};\n           }\n         `}\n-        className=\"currency-control-container\"\n+        data-test=\"currency-control-container\"\n       >\n         <Select\n           ariaLabel={t('Currency prefix or suffix')}\n@@ -117,6 +173,8 @@ export const CurrencyControl = ({\n           value={currency?.symbol}\n           allowClear\n           allowNewOptions\n+          sortComparator={currencySortComparator}\n+          popupRender={renderCurrencyPopup}\n           {...currencySelectOverrideProps}\n         />\n       </CurrencyControlContainer>", "pull_request_number": 36416}
{"sha": "62f48f42b486126331cf06005f229ede96c2b6a9", "filename": "superset-frontend/src/features/datasets/types.ts", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fsrc%2Ffeatures%2Fdatasets%2Ftypes.ts", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset-frontend%2Fsrc%2Ffeatures%2Fdatasets%2Ftypes.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ffeatures%2Fdatasets%2Ftypes.ts?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -65,6 +65,7 @@ export type DatasetObject = {\n   catalog?: string;\n   description: string | null;\n   main_dttm_col: string;\n+  currency_code_column?: string;\n   offset?: number;\n   default_endpoint?: string;\n   cache_timeout?: number;", "pull_request_number": 36416}
{"sha": "fc7af43aef557125e5e4d6566654b21238b2aff1", "filename": "superset/charts/schemas.py", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fcharts%2Fschemas.py", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fcharts%2Fschemas.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Fcharts%2Fschemas.py?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -1533,6 +1533,15 @@ class ChartDataResponseResult(Schema):\n     rejected_filters = fields.List(\n         fields.Dict(), metadata={\"description\": \"A list with rejected filters\"}\n     )\n+    detected_currency = fields.String(\n+        metadata={\n+            \"description\": \"Detected ISO 4217 currency code when AUTO mode is used. \"\n+            \"Returns the currency code if all filtered data contains a single currency \"\n+            \"or null if multiple currencies are present.\"\n+        },\n+        allow_none=True,\n+        load_default=None,\n+    )\n     from_dttm = fields.Integer(\n         metadata={\"description\": \"Start timestamp of time range\"},\n         required=False,", "pull_request_number": 36416}
{"sha": "cf7c569df959eb4ad343592722639e1c316a773f", "filename": "superset/cli/examples.py", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fcli%2Fexamples.py", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fcli%2Fexamples.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Fcli%2Fexamples.py?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -52,6 +52,9 @@ def load_examples_run(\n     logger.info(\"Loading [Birth names]\")\n     examples.load_birth_names(only_metadata, force)\n \n+    logger.info(\"Loading [International Sales]\")\n+    examples.load_international_sales(only_metadata, force)\n+\n     if load_test_data:\n         logger.info(\"Loading [Tabbed dashboard]\")\n         examples.load_tabbed_dashboard(only_metadata)", "pull_request_number": 36416}
{"sha": "5479e12d880a1cb0ed5eaad549175d4d90f09289", "filename": "superset/common/query_actions.py", "status": "modified", "additions": 65, "deletions": 0, "changes": 65, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fcommon%2Fquery_actions.py", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fcommon%2Fquery_actions.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Fcommon%2Fquery_actions.py?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -17,6 +17,7 @@\n from __future__ import annotations\n \n import copy\n+import logging\n from typing import Any, Callable, TYPE_CHECKING\n \n from flask_babel import _\n@@ -32,11 +33,18 @@\n     get_column_name,\n     get_time_filter_status,\n )\n+from superset.utils.currency import (\n+    detect_currency,\n+    detect_currency_from_df,\n+    has_auto_currency_in_column_config,\n+)\n \n if TYPE_CHECKING:\n     from superset.common.query_context import QueryContext\n     from superset.common.query_object import QueryObject\n \n+logger = logging.getLogger(__name__)\n+\n \n def _get_datasource(query_context: QueryContext, query_obj: QueryObject) -> Explorable:\n     return query_obj.datasource or query_context.datasource\n@@ -89,6 +97,59 @@ def _get_query(\n     return result\n \n \n+def _detect_currency(\n+    query_context: QueryContext,\n+    query_obj: QueryObject,\n+    datasource: Explorable,\n+    df: Any = None,\n+) -> str | None:\n+    \"\"\"\n+    Detect currency from filtered data for AUTO mode currency formatting.\n+\n+    First attempts to detect from the provided dataframe if the currency\n+    column is present. Falls back to a separate query only when needed.\n+\n+    Checks both top-level currency_format (used by Pie, Timeseries, etc.)\n+    and column_config (used by Table charts) for AUTO currency settings.\n+\n+    :param query_context: The query context with form_data containing currency_format\n+    :param query_obj: The original query object with filters\n+    :param datasource: The datasource being queried\n+    :param df: Optional dataframe to detect currency from (avoids extra query)\n+    :return: ISO 4217 currency code (e.g., \"USD\") or None\n+    \"\"\"\n+    form_data = query_context.form_data or {}\n+\n+    # Check top-level currency_format (for Pie, Timeseries, etc.)\n+    currency_format = form_data.get(\"currency_format\", {})\n+    top_level_auto = (\n+        isinstance(currency_format, dict) and currency_format.get(\"symbol\") == \"AUTO\"\n+    )\n+\n+    # Check column_config (for Table charts)\n+    column_config_auto = has_auto_currency_in_column_config(form_data)\n+\n+    # Only detect if AUTO is configured somewhere\n+    if not top_level_auto and not column_config_auto:\n+        return None\n+\n+    currency_column = getattr(datasource, \"currency_code_column\", None)\n+    if not currency_column:\n+        return None\n+\n+    if df is not None and currency_column in df.columns:\n+        return detect_currency_from_df(df, currency_column)\n+\n+    return detect_currency(\n+        datasource=datasource,\n+        filters=query_obj.filter,\n+        granularity=query_obj.granularity,\n+        from_dttm=query_obj.from_dttm,\n+        to_dttm=query_obj.to_dttm,\n+        extras=query_obj.extras,\n+    )\n+\n+\n def _get_full(\n     query_context: QueryContext,\n     query_obj: QueryObject,\n@@ -105,6 +166,9 @@ def _get_full(\n         payload[\"coltypes\"] = extract_dataframe_dtypes(df, datasource)\n         payload[\"data\"] = query_context.get_data(df, payload[\"coltypes\"])\n         payload[\"result_format\"] = query_context.result_format\n+        payload[\"detected_currency\"] = _detect_currency(\n+            query_context, query_obj, datasource, df\n+        )\n     del payload[\"df\"]\n \n     applied_time_columns, rejected_time_columns = get_time_filter_status(\n@@ -133,6 +197,7 @@ def _get_full(\n             \"coltypes\": payload.get(\"coltypes\"),\n             \"rowcount\": payload.get(\"rowcount\"),\n             \"sql_rowcount\": payload.get(\"sql_rowcount\"),\n+            \"detected_currency\": payload.get(\"detected_currency\"),\n         }\n     return payload\n ", "pull_request_number": 36416}
{"sha": "a60eac43848887c8b9ebe7d3966dbe4ef7192b3e", "filename": "superset/common/query_context_factory.py", "status": "modified", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fcommon%2Fquery_context_factory.py", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fcommon%2Fquery_context_factory.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Fcommon%2Fquery_context_factory.py?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -120,6 +120,7 @@ def _process_query_object(\n         self._apply_granularity(query_object, form_data, datasource)\n         self._apply_filters(query_object)\n         self._add_tooltip_columns(query_object, form_data)\n+        self._add_currency_column(query_object, form_data, datasource)\n         return query_object\n \n     def _add_tooltip_columns(\n@@ -195,6 +196,39 @@ def _extract_tooltip_columns(self, form_data: dict[str, Any]) -> list[str]:\n                         tooltip_columns.append(column_name)\n         return tooltip_columns\n \n+    def _add_currency_column(\n+        self,\n+        query_object: QueryObject,\n+        form_data: dict[str, Any] | None,\n+        datasource: Explorable,\n+    ) -> None:\n+        \"\"\"\n+        Add currency_code_column to the query for pivot_table_v2 cell-level formatting.\n+\n+        When currency_format.symbol is 'AUTO', injects the datasource's\n+        currency_code_column into query columns for per-cell currency formatting.\n+        \"\"\"\n+        if not form_data or not query_object.columns:\n+            return\n+\n+        if form_data.get(\"viz_type\") != \"pivot_table_v2\":\n+            return\n+\n+        currency_format = form_data.get(\"currency_format\", {})\n+        if not (\n+            isinstance(currency_format, dict)\n+            and currency_format.get(\"symbol\") == \"AUTO\"\n+        ):\n+            return\n+\n+        currency_column = getattr(datasource, \"currency_code_column\", None)\n+        if not currency_column:\n+            return\n+\n+        existing_columns = self._get_existing_column_names(query_object.columns)\n+        if currency_column not in existing_columns:\n+            query_object.columns.append(currency_column)\n+\n     def _apply_granularity(  # noqa: C901\n         self,\n         query_object: QueryObject,", "pull_request_number": 36416}
{"sha": "0e3777ba4bf33be73cafd60c246568f75219288c", "filename": "superset/connectors/sqla/models.py", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fconnectors%2Fsqla%2Fmodels.py", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fconnectors%2Fsqla%2Fmodels.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Fconnectors%2Fsqla%2Fmodels.py?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -1221,6 +1221,7 @@ class SqlaTable(\n \n     table_name = Column(String(250), nullable=False)\n     main_dttm_col = Column(String(250))\n+    currency_code_column = Column(String(250))\n     database_id = Column(Integer, ForeignKey(\"dbs.id\"), nullable=False)\n     fetch_values_predicate = Column(Text)\n     owners = relationship(owner_class, secondary=sqlatable_user, backref=\"tables\")\n@@ -1244,6 +1245,7 @@ class SqlaTable(\n     export_fields = [\n         \"table_name\",\n         \"main_dttm_col\",\n+        \"currency_code_column\",\n         \"description\",\n         \"default_endpoint\",\n         \"database_id\",\n@@ -1331,7 +1333,8 @@ def get_datasource_by_name(\n     @property\n     def link(self) -> Markup:\n         name = escape(self.name)\n-        anchor = f'<a target=\"_blank\" href=\"{self.explore_url}\">{name}</a>'\n+        url = escape(self.explore_url)\n+        anchor = f'<a target=\"_blank\" href=\"{url}\">{name}</a>'\n         return Markup(anchor)\n \n     def get_catalog_perm(self) -> str | None:\n@@ -1448,6 +1451,7 @@ def data(self) -> ExplorableData:\n             data_[\"granularity_sqla\"] = self.granularity_sqla\n             data_[\"time_grain_sqla\"] = self.time_grain_sqla\n             data_[\"main_dttm_col\"] = self.main_dttm_col\n+            data_[\"currency_code_column\"] = self.currency_code_column\n             data_[\"fetch_values_predicate\"] = self.fetch_values_predicate\n             data_[\"template_params\"] = self.template_params\n             data_[\"is_sqllab_view\"] = self.is_sqllab_view", "pull_request_number": 36416}
{"sha": "ae6ad6d6c2f739dafc34982d61dd1ebe25488a5f", "filename": "superset/dashboards/schemas.py", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fdashboards%2Fschemas.py", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fdashboards%2Fschemas.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Fdashboards%2Fschemas.py?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -295,6 +295,7 @@ class DashboardDatasetSchema(Schema):\n     sql = fields.Str()\n     select_star = fields.Str()\n     main_dttm_col = fields.Str()\n+    currency_code_column = fields.Str()\n     health_check_message = fields.Str()\n     fetch_values_predicate = fields.Str()\n     template_params = fields.Str()", "pull_request_number": 36416}
{"sha": "dbb51b9bf35567cab7497860a5907de67189b1a9", "filename": "superset/datasets/api.py", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fdatasets%2Fapi.py", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fdatasets%2Fapi.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Fdatasets%2Fapi.py?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -167,6 +167,7 @@ class DatasetRestApi(BaseSupersetModelRestApi):\n         \"schema\",\n         \"description\",\n         \"main_dttm_col\",\n+        \"currency_code_column\",\n         \"normalize_columns\",\n         \"always_filter_main_dttm\",\n         \"offset\",\n@@ -250,6 +251,7 @@ class DatasetRestApi(BaseSupersetModelRestApi):\n         \"schema\",\n         \"description\",\n         \"main_dttm_col\",\n+        \"currency_code_column\",\n         \"normalize_columns\",\n         \"always_filter_main_dttm\",\n         \"offset\",", "pull_request_number": 36416}
{"sha": "8216c96caeef5ab2e5fbe963143ad727f81372c8", "filename": "superset/datasets/schemas.py", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fdatasets%2Fschemas.py", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fdatasets%2Fschemas.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Fdatasets%2Fschemas.py?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -166,6 +166,7 @@ class DatasetPutSchema(Schema):\n     schema = fields.String(allow_none=True, validate=Length(0, 255))\n     description = fields.String(allow_none=True)\n     main_dttm_col = fields.String(allow_none=True)\n+    currency_code_column = fields.String(allow_none=True, validate=Length(0, 250))\n     normalize_columns = fields.Boolean(allow_none=True, dump_default=False)\n     always_filter_main_dttm = fields.Boolean(load_default=False)\n     offset = fields.Integer(allow_none=True)\n@@ -313,6 +314,7 @@ def fix_extra(self, data: dict[str, Any], **kwargs: Any) -> dict[str, Any]:\n \n     table_name = fields.String(required=True)\n     main_dttm_col = fields.String(allow_none=True)\n+    currency_code_column = fields.String(allow_none=True)\n     description = fields.String(allow_none=True)\n     default_endpoint = fields.String(allow_none=True)\n     offset = fields.Integer()", "pull_request_number": 36416}
{"sha": "b7d9c663f680a4c57a6fdd7fafa65d159dbacda1", "filename": "superset/examples/data_loading.py", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fexamples%2Fdata_loading.py", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fexamples%2Fdata_loading.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Fexamples%2Fdata_loading.py?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -22,6 +22,7 @@\n from .deck import load_deck_dash\n from .energy import load_energy\n from .flights import load_flights\n+from .international_sales import load_international_sales\n from .long_lat import load_long_lat_data\n from .misc_dashboard import load_misc_dashboard\n from .multiformat_time_series import load_multiformat_time_series\n@@ -39,6 +40,7 @@\n     \"load_birth_names\",\n     \"load_country_map_data\",\n     \"load_css_templates\",\n+    \"load_international_sales\",\n     \"load_deck_dash\",\n     \"load_energy\",\n     \"load_flights\",", "pull_request_number": 36416}
{"sha": "3cfd4ed430ea1ecf4f3031f1903d83287a48f818", "filename": "superset/examples/international_sales.py", "status": "added", "additions": 238, "deletions": 0, "changes": 238, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fexamples%2Finternational_sales.py", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fexamples%2Finternational_sales.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Fexamples%2Finternational_sales.py?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -0,0 +1,238 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+\"\"\"International sales dataset demonstrating multi-currency transactions.\"\"\"\n+\n+import logging\n+\n+import pandas as pd\n+from sqlalchemy import Date, inspect, Integer, Numeric, String\n+\n+from superset import db\n+from superset.connectors.sqla.models import SqlaTable\n+from superset.models.core import Database\n+from superset.sql.parse import Table\n+\n+from ..utils.database import get_example_database  # noqa: TID252\n+from .helpers import get_table_connector_registry\n+\n+logger = logging.getLogger(__name__)\n+\n+\n+def get_international_sales_data() -> pd.DataFrame:\n+    \"\"\"Generate the international sales dataset with multiple currencies.\"\"\"\n+    # fmt: off\n+    data = [\n+        # North America - USA (USD)\n+        (1, \"2024-01-15\", \"North America\", \"USA\", \"Electronics\", \"Laptop Pro\",\n+         50, 1299.99, 64999.50, 45000.00, 19999.50, \"USD\", \"$\"),\n+        (2, \"2024-01-15\", \"North America\", \"USA\", \"Electronics\", \"Smartphone X\",\n+         200, 899.99, 179998.00, 120000.00, 59998.00, \"USD\", \"$\"),\n+        (3, \"2024-01-15\", \"North America\", \"USA\", \"Software\", \"Office Suite\",\n+         500, 149.99, 74995.00, 15000.00, 59995.00, \"USD\", \"$\"),\n+        (4, \"2024-02-15\", \"North America\", \"USA\", \"Electronics\", \"Laptop Pro\",\n+         75, 1299.99, 97499.25, 67500.00, 29999.25, \"USD\", \"$\"),\n+        (5, \"2024-02-15\", \"North America\", \"USA\", \"Electronics\", \"Smartphone X\",\n+         250, 899.99, 224997.50, 150000.00, 74997.50, \"USD\", \"$\"),\n+        (6, \"2024-02-15\", \"North America\", \"USA\", \"Software\", \"Office Suite\",\n+         600, 149.99, 89994.00, 18000.00, 71994.00, \"USD\", \"$\"),\n+        (7, \"2024-03-15\", \"North America\", \"USA\", \"Electronics\", \"Laptop Pro\",\n+         100, 1299.99, 129999.00, 90000.00, 39999.00, \"USD\", \"$\"),\n+        (8, \"2024-03-15\", \"North America\", \"USA\", \"Electronics\", \"Smartphone X\",\n+         300, 899.99, 269997.00, 180000.00, 89997.00, \"USD\", \"$\"),\n+        # Case normalization test - lowercase 'usd'\n+        (9, \"2024-03-15\", \"North America\", \"USA\", \"Software\", \"Office Suite\",\n+         700, 149.99, 104993.00, 21000.00, 83993.00, \"usd\", \"$\"),\n+        # North America - Canada (CAD)\n+        (10, \"2024-01-15\", \"North America\", \"Canada\", \"Electronics\", \"Laptop Pro\",\n+         30, 1599.99, 47999.70, 35000.00, 12999.70, \"CAD\", \"CA$\"),\n+        (11, \"2024-01-15\", \"North America\", \"Canada\", \"Electronics\", \"Smartphone X\",\n+         100, 1099.99, 109999.00, 75000.00, 34999.00, \"CAD\", \"CA$\"),\n+        (12, \"2024-02-15\", \"North America\", \"Canada\", \"Electronics\", \"Laptop Pro\",\n+         40, 1599.99, 63999.60, 46000.00, 17999.60, \"CAD\", \"CA$\"),\n+        (13, \"2024-02-15\", \"North America\", \"Canada\", \"Software\", \"Office Suite\",\n+         200, 199.99, 39998.00, 8000.00, 31998.00, \"CAD\", \"CA$\"),\n+        # Case normalization test - mixed case 'Cad'\n+        (14, \"2024-03-15\", \"North America\", \"Canada\", \"Electronics\", \"Laptop Pro\",\n+         50, 1599.99, 79999.50, 57500.00, 22499.50, \"Cad\", \"CA$\"),\n+        # Europe - Germany/France (EUR)\n+        (15, \"2024-01-15\", \"Europe\", \"Germany\", \"Electronics\", \"Laptop Pro\",\n+         40, 1199.99, 47999.60, 32000.00, 15999.60, \"EUR\", \"\u20ac\"),\n+        (16, \"2024-01-15\", \"Europe\", \"Germany\", \"Electronics\", \"Smartphone X\",\n+         150, 849.99, 127498.50, 85000.00, 42498.50, \"EUR\", \"\u20ac\"),\n+        (17, \"2024-01-15\", \"Europe\", \"France\", \"Software\", \"Office Suite\",\n+         300, 139.99, 41997.00, 9000.00, 32997.00, \"EUR\", \"\u20ac\"),\n+        (18, \"2024-02-15\", \"Europe\", \"Germany\", \"Electronics\", \"Laptop Pro\",\n+         55, 1199.99, 65999.45, 44000.00, 21999.45, \"EUR\", \"\u20ac\"),\n+        (19, \"2024-02-15\", \"Europe\", \"France\", \"Electronics\", \"Smartphone X\",\n+         180, 849.99, 152998.20, 102000.00, 50998.20, \"EUR\", \"\u20ac\"),\n+        # Case normalization test - lowercase 'eur'\n+        (20, \"2024-02-15\", \"Europe\", \"Germany\", \"Software\", \"Office Suite\",\n+         350, 139.99, 48996.50, 10500.00, 38496.50, \"eur\", \"\u20ac\"),\n+        # Europe - UK (GBP)\n+        (21, \"2024-01-15\", \"Europe\", \"UK\", \"Electronics\", \"Laptop Pro\",\n+         35, 999.99, 34999.65, 24500.00, 10499.65, \"GBP\", \"\u00a3\"),\n+        (22, \"2024-01-15\", \"Europe\", \"UK\", \"Electronics\", \"Smartphone X\",\n+         120, 749.99, 89998.80, 66000.00, 23998.80, \"GBP\", \"\u00a3\"),\n+        (23, \"2024-02-15\", \"Europe\", \"UK\", \"Electronics\", \"Laptop Pro\",\n+         45, 999.99, 44999.55, 31500.00, 13499.55, \"GBP\", \"\u00a3\"),\n+        (24, \"2024-02-15\", \"Europe\", \"UK\", \"Software\", \"Office Suite\",\n+         250, 119.99, 29997.50, 7500.00, 22497.50, \"GBP\", \"\u00a3\"),\n+        # Case normalization test - mixed case 'Gbp'\n+        (25, \"2024-03-15\", \"Europe\", \"UK\", \"Electronics\", \"Laptop Pro\",\n+         60, 999.99, 59999.40, 42000.00, 17999.40, \"Gbp\", \"\u00a3\"),\n+        # Asia - Japan (JPY)\n+        (26, \"2024-01-15\", \"Asia\", \"Japan\", \"Electronics\", \"Laptop Pro\",\n+         25, 149999.00, 3749975.00, 2625000.00, 1124975.00, \"JPY\", \"\u00a5\"),\n+        (27, \"2024-01-15\", \"Asia\", \"Japan\", \"Electronics\", \"Smartphone X\",\n+         80, 99999.00, 7999920.00, 5600000.00, 2399920.00, \"JPY\", \"\u00a5\"),\n+        (28, \"2024-02-15\", \"Asia\", \"Japan\", \"Electronics\", \"Laptop Pro\",\n+         30, 149999.00, 4499970.00, 3150000.00, 1349970.00, \"JPY\", \"\u00a5\"),\n+        (29, \"2024-03-15\", \"Asia\", \"Japan\", \"Software\", \"Office Suite\",\n+         150, 14999.00, 2249850.00, 450000.00, 1799850.00, \"JPY\", \"\u00a5\"),\n+        # Asia Pacific - Australia (AUD)\n+        (30, \"2024-01-15\", \"Asia Pacific\", \"Australia\", \"Electronics\", \"Laptop Pro\",\n+         20, 1899.99, 37999.80, 26000.00, 11999.80, \"AUD\", \"A$\"),\n+        (31, \"2024-02-15\", \"Asia Pacific\", \"Australia\", \"Electronics\", \"Smartphone X\",\n+         60, 1299.99, 77999.40, 48000.00, 29999.40, \"AUD\", \"A$\"),\n+        (32, \"2024-03-15\", \"Asia Pacific\", \"Australia\", \"Software\", \"Office Suite\",\n+         100, 219.99, 21999.00, 6000.00, 15999.00, \"AUD\", \"A$\"),\n+        # NULL currency tests - Other region\n+        (33, \"2024-01-15\", \"Other\", \"Unknown\", \"Electronics\", \"Generic Device\",\n+         10, 500.00, 5000.00, 3500.00, 1500.00, None, None),\n+        (34, \"2024-02-15\", \"Other\", \"Unknown\", \"Software\", \"Basic App\",\n+         50, 50.00, 2500.00, 1000.00, 1500.00, None, None),\n+        # Empty string currency test\n+        (35, \"2024-03-15\", \"Other\", \"Unknown\", \"Electronics\", \"Unknown Product\",\n+         5, 100.00, 500.00, 350.00, 150.00, \"\", \"\"),\n+        # Additional rows for aggregation tests\n+        (36, \"2024-01-15\", \"North America\", \"USA\", \"Electronics\", \"Tablet Pro\",\n+         80, 599.99, 47999.20, 32000.00, 15999.20, \"USD\", \"$\"),\n+        (37, \"2024-02-15\", \"Europe\", \"Germany\", \"Electronics\", \"Tablet Pro\",\n+         65, 549.99, 35749.35, 22750.00, 12999.35, \"EUR\", \"\u20ac\"),\n+        (38, \"2024-03-15\", \"Asia\", \"Japan\", \"Electronics\", \"Tablet Pro\",\n+         45, 64999.00, 2924955.00, 1575000.00, 1349955.00, \"JPY\", \"\u00a5\"),\n+        # Euro word/symbol normalization tests\n+        (39, \"2024-01-15\", \"Europe\", \"Spain\", \"Software\", \"Cloud Service\",\n+         100, 99.99, 9999.00, 5000.00, 4999.00, \"euro\", \"\u20ac\"),\n+        (40, \"2024-02-15\", \"Europe\", \"Italy\", \"Software\", \"Cloud Service\",\n+         120, 99.99, 11998.80, 6000.00, 5998.80, \"EURO\", \"\u20ac\"),\n+        (41, \"2024-03-15\", \"Europe\", \"Portugal\", \"Software\", \"Cloud Service\",\n+         80, 99.99, 7999.20, 4000.00, 3999.20, \"\u20ac\", \"\u20ac\"),\n+        # Invalid currency code fallback test\n+        (42, \"2024-01-15\", \"Other\", \"Unknown\", \"Electronics\", \"Mystery Device\",\n+         25, 200.00, 5000.00, 3000.00, 2000.00, \"XYZ\", \"?\"),\n+    ]\n+    # fmt: on\n+\n+    columns = [\n+        \"id\",\n+        \"transaction_date\",\n+        \"region\",\n+        \"country\",\n+        \"product_category\",\n+        \"product_name\",\n+        \"quantity\",\n+        \"unit_price\",\n+        \"revenue\",\n+        \"cost\",\n+        \"profit\",\n+        \"currency_code\",\n+        \"currency_symbol\",\n+    ]\n+\n+    return pd.DataFrame(data, columns=columns)\n+\n+\n+def load_data(tbl_name: str, database: Database) -> None:\n+    \"\"\"Load the international sales data into the database.\"\"\"\n+    pdf = get_international_sales_data()\n+    pdf[\"transaction_date\"] = pd.to_datetime(pdf[\"transaction_date\"])\n+\n+    with database.get_sqla_engine() as engine:\n+        schema = inspect(engine).default_schema_name\n+\n+        pdf.to_sql(\n+            tbl_name,\n+            engine,\n+            schema=schema,\n+            if_exists=\"replace\",\n+            chunksize=50,\n+            dtype={\n+                \"id\": Integer,\n+                \"transaction_date\": Date,\n+                \"region\": String(50),\n+                \"country\": String(50),\n+                \"product_category\": String(50),\n+                \"product_name\": String(100),\n+                \"quantity\": Integer,\n+                \"unit_price\": Numeric(12, 2),\n+                \"revenue\": Numeric(14, 2),\n+                \"cost\": Numeric(14, 2),\n+                \"profit\": Numeric(14, 2),\n+                \"currency_code\": String(10),\n+                \"currency_symbol\": String(10),\n+            },\n+            method=\"multi\",\n+            index=False,\n+        )\n+    logger.debug(\"Done loading international sales data!\")\n+\n+\n+def load_international_sales(only_metadata: bool = False, force: bool = False) -> None:\n+    \"\"\"Load international sales dataset for demonstrating dynamic currency formatting.\n+\n+    This dataset contains multi-currency transaction data with:\n+    - Multiple currencies (USD, EUR, GBP, JPY, CAD, AUD)\n+    - Case variations for normalization testing (usd, eur, Gbp, Cad)\n+    - Word variations for normalization testing (euro, EURO)\n+    - Symbol variations for normalization testing (\u20ac)\n+    - NULL and empty string currency values for fallback testing\n+    - Invalid currency code (XYZ) for fallback testing\n+    - Multiple monetary columns (revenue, cost, profit, unit_price)\n+    \"\"\"\n+    database = get_example_database()\n+    tbl_name = \"international_sales\"\n+\n+    with database.get_sqla_engine() as engine:\n+        schema = inspect(engine).default_schema_name\n+        table_exists = database.has_table(Table(tbl_name, schema))\n+\n+    if not only_metadata and (not table_exists or force):\n+        load_data(tbl_name, database)\n+\n+    table = get_table_connector_registry()\n+    obj = db.session.query(table).filter_by(table_name=tbl_name, schema=schema).first()\n+    if not obj:\n+        logger.debug(\"Creating table [%s] reference\", tbl_name)\n+        obj = table(table_name=tbl_name, schema=schema)\n+        db.session.add(obj)\n+\n+    _set_table_metadata(obj, database)\n+\n+\n+def _set_table_metadata(datasource: SqlaTable, database: Database) -> None:\n+    \"\"\"Set metadata for the international sales dataset.\"\"\"\n+    datasource.main_dttm_col = \"transaction_date\"\n+    datasource.database = database\n+    datasource.filter_select_enabled = True\n+    datasource.description = (\n+        \"International sales transactions across multiple currencies \"\n+        \"for demonstrating dynamic currency formatting features.\"\n+    )\n+    # Set the currency code column for dynamic currency detection\n+    datasource.currency_code_column = \"currency_code\"\n+    datasource.fetch_metadata()", "pull_request_number": 36416}
{"sha": "6084f50a1d6246e2e07cb10c291b8accc3196a6a", "filename": "superset/migrations/versions/2025-11-18_14-00_9787190b3d89_add_currency_column_support.py", "status": "added", "additions": 48, "deletions": 0, "changes": 48, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fmigrations%2Fversions%2F2025-11-18_14-00_9787190b3d89_add_currency_column_support.py", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fmigrations%2Fversions%2F2025-11-18_14-00_9787190b3d89_add_currency_column_support.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Fmigrations%2Fversions%2F2025-11-18_14-00_9787190b3d89_add_currency_column_support.py?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -0,0 +1,48 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+\"\"\"add currency column support\n+\n+Revision ID: 9787190b3d89\n+Revises: f5b5f88d8526\n+Create Date: 2025-11-18 14:00:00.000000\n+\n+\"\"\"\n+\n+import sqlalchemy as sa\n+\n+from superset.migrations.shared.utils import add_columns, drop_columns\n+\n+# revision identifiers, used by Alembic.\n+revision = \"9787190b3d89\"\n+down_revision = \"f5b5f88d8526\"\n+\n+\n+def upgrade():\n+    \"\"\"Add currency column support to datasets.\"\"\"\n+    # Add currency code column designation to tables (like main_dttm_col pattern)\n+    add_columns(\n+        \"tables\",\n+        sa.Column(\"currency_code_column\", sa.String(250), nullable=True),\n+    )\n+\n+\n+def downgrade():\n+    \"\"\"Remove currency column support.\"\"\"\n+    drop_columns(\n+        \"tables\",\n+        \"currency_code_column\",\n+    )", "pull_request_number": 36416}
{"sha": "4d409398d1c228638f1b89b203a2ceb386adff0d", "filename": "superset/superset_typing.py", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fsuperset_typing.py", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fsuperset_typing.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Fsuperset_typing.py?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -243,6 +243,7 @@ class ExplorableData(TypedDict, total=False):\n         granularity_sqla: Available time granularities\n         time_grain_sqla: Available time grains\n         main_dttm_col: Main datetime column\n+        currency_code_column: Column containing currency codes for dynamic formatting\n         fetch_values_predicate: Predicate for fetching filter values\n         template_params: Template parameters for Jinja\n         is_sqllab_view: Whether this is a SQL Lab view\n@@ -287,6 +288,7 @@ class ExplorableData(TypedDict, total=False):\n     granularity_sqla: list[tuple[Any, Any]]\n     time_grain_sqla: list[tuple[Any, Any]]\n     main_dttm_col: str | None\n+    currency_code_column: str | None\n     fetch_values_predicate: str | None\n     template_params: str | None\n     is_sqllab_view: bool", "pull_request_number": 36416}
{"sha": "f274bf5db774cd71a8c8f0af670f7a0c1961626d", "filename": "superset/utils/currency.py", "status": "added", "additions": 160, "deletions": 0, "changes": 160, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Futils%2Fcurrency.py", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Futils%2Fcurrency.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Futils%2Fcurrency.py?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -0,0 +1,160 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+\"\"\"Currency detection utilities for dynamic currency formatting.\"\"\"\n+\n+from __future__ import annotations\n+\n+import logging\n+from datetime import datetime\n+from typing import Any, TYPE_CHECKING\n+\n+from superset.common.db_query_status import QueryStatus\n+\n+if TYPE_CHECKING:\n+    from superset.explorables.base import Explorable\n+    from superset.superset_typing import QueryObjectDict\n+    from superset.utils.core import QueryObjectFilterClause\n+\n+logger = logging.getLogger(__name__)\n+\n+\n+def has_auto_currency_in_column_config(form_data: dict[str, Any] | None) -> bool:\n+    \"\"\"\n+    Check if any column in column_config has AUTO currency format.\n+\n+    Used by Table charts which configure currency per-column via column_config,\n+    rather than using top-level currency_format like other chart types.\n+\n+    :param form_data: The form data containing column_config\n+    :return: True if any column has AUTO currency format\n+    \"\"\"\n+    if not form_data:\n+        return False\n+    column_config = form_data.get(\"column_config\", {})\n+    if not isinstance(column_config, dict):\n+        return False\n+    for config in column_config.values():\n+        if not isinstance(config, dict):\n+            continue\n+        currency_format = config.get(\"currencyFormat\", {})\n+        if (\n+            isinstance(currency_format, dict)\n+            and currency_format.get(\"symbol\") == \"AUTO\"\n+        ):\n+            return True\n+    return False\n+\n+\n+def detect_currency_from_df(\n+    df: Any,  # pd.DataFrame, but avoiding import for type checking\n+    currency_column: str,\n+) -> str | None:\n+    \"\"\"\n+    Detect currency from an already-fetched dataframe.\n+\n+    Returns the currency code if all data contains a single currency,\n+    or None if multiple currencies are present or column is missing.\n+\n+    :param df: The pandas DataFrame to analyze\n+    :param currency_column: The name of the currency code column\n+    :return: ISO 4217 currency code (e.g., \"USD\", \"EUR\") or None\n+    \"\"\"\n+    if df is None or df.empty:\n+        return None\n+\n+    if currency_column not in df.columns:\n+        return None\n+\n+    unique_currencies = df[currency_column].dropna().astype(str).str.upper().unique()\n+\n+    if len(unique_currencies) == 1:\n+        return str(unique_currencies[0])\n+\n+    return None\n+\n+\n+def detect_currency(\n+    datasource: Explorable,\n+    filters: list[QueryObjectFilterClause] | None = None,\n+    granularity: str | None = None,\n+    from_dttm: datetime | None = None,\n+    to_dttm: datetime | None = None,\n+    extras: dict[str, Any] | None = None,\n+) -> str | None:\n+    \"\"\"\n+    Detect currency from filtered data for AUTO mode currency formatting.\n+\n+    Executes a lightweight query to get distinct currency values using the\n+    provided filters. Returns the currency code if all filtered data contains\n+    a single currency, or None if multiple currencies are present.\n+\n+    This utility is used by both the modern QueryContext API and the legacy\n+    viz API to provide consistent currency detection behavior.\n+\n+    :param datasource: The datasource to query\n+    :param filters: List of filter dicts with 'col', 'op', 'val' keys\n+    :param granularity: Optional time granularity column\n+    :param from_dttm: Optional start datetime for time filtering\n+    :param to_dttm: Optional end datetime for time filtering\n+    :param extras: Optional extra query parameters (having, where clauses)\n+    :return: ISO 4217 currency code (e.g., \"USD\", \"EUR\") or None\n+    \"\"\"\n+    currency_column = getattr(datasource, \"currency_code_column\", None)\n+    if not currency_column:\n+        return None\n+\n+    datasource_id = getattr(datasource, \"id\", 0)\n+\n+    query_method = getattr(datasource, \"query\", None)\n+    if not callable(query_method):\n+        return None\n+\n+    try:\n+        query_obj: QueryObjectDict = {\n+            \"granularity\": granularity,\n+            \"from_dttm\": from_dttm,\n+            \"to_dttm\": to_dttm,\n+            \"is_timeseries\": False,\n+            \"groupby\": [currency_column],\n+            \"metrics\": [],\n+            \"filter\": filters or [],\n+            \"extras\": extras or {},\n+        }\n+\n+        result = query_method(query_obj)\n+\n+        if result.status != QueryStatus.SUCCESS or result.df.empty:\n+            return None\n+        if currency_column not in result.df.columns:\n+            return None\n+\n+        unique_currencies = (\n+            result.df[currency_column].dropna().astype(str).str.upper().unique()\n+        )\n+\n+        if len(unique_currencies) == 1:\n+            return str(unique_currencies[0])\n+\n+        return None\n+\n+    except Exception:  # pylint: disable=broad-except\n+        logger.warning(\n+            \"Failed to detect currency for datasource %s\",\n+            datasource_id,\n+            exc_info=True,\n+        )\n+        return None", "pull_request_number": 36416}
{"sha": "cbe722cc92c500c81c3928e37c5ce1aab8ba3b75", "filename": "superset/views/core.py", "status": "modified", "additions": 10, "deletions": 11, "changes": 21, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fviews%2Fcore.py", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fviews%2Fcore.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Fviews%2Fcore.py?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -168,17 +168,16 @@ def get_raw_results(self, viz_obj: BaseViz) -> FlaskResponse:\n         payload = viz_obj.get_df_payload()\n         if viz_obj.has_error(payload):\n             return json_error_response(payload=payload, status=400)\n-        return self.json_response(\n-            {\n-                \"data\": payload[\"df\"].to_dict(\"records\")\n-                if payload[\"df\"] is not None\n-                else [],\n-                \"colnames\": payload.get(\"colnames\"),\n-                \"coltypes\": payload.get(\"coltypes\"),\n-                \"rowcount\": payload.get(\"rowcount\"),\n-                \"sql_rowcount\": payload.get(\"sql_rowcount\"),\n-            },\n-        )\n+        response = {\n+            \"data\": payload[\"df\"].to_dict(\"records\")\n+            if payload[\"df\"] is not None\n+            else [],\n+            \"colnames\": payload.get(\"colnames\"),\n+            \"coltypes\": payload.get(\"coltypes\"),\n+            \"rowcount\": payload.get(\"rowcount\"),\n+            \"sql_rowcount\": payload.get(\"sql_rowcount\"),\n+        }\n+        return self.json_response(response)\n \n     def get_samples(self, viz_obj: BaseViz) -> FlaskResponse:\n         return self.json_response(viz_obj.get_samples())", "pull_request_number": 36416}
{"sha": "c6c7cf699b7f761ed740462e6de22c846f701c26", "filename": "superset/viz.py", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fviz.py", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/superset%2Fviz.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Fviz.py?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -514,6 +514,7 @@ def get_payload(self, query_obj: QueryObjectDict | None = None) -> VizPayload:\n         ] + rejected_time_columns\n         if df is not None:\n             payload[\"colnames\"] = list(df.columns)\n+\n         return payload\n \n     @deprecated(deprecated_in=\"3.0\")", "pull_request_number": 36416}
{"sha": "58f947034e713b7e472448dd952c165e877c9ee3", "filename": "tests/integration_tests/datasets/commands_tests.py", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/tests%2Fintegration_tests%2Fdatasets%2Fcommands_tests.py", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/tests%2Fintegration_tests%2Fdatasets%2Fcommands_tests.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/tests%2Fintegration_tests%2Fdatasets%2Fcommands_tests.py?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -98,6 +98,7 @@ def test_export_dataset_command(self, mock_g):\n         assert metadata == {\n             \"cache_timeout\": None,\n             \"catalog\": None,\n+            \"currency_code_column\": None,\n             \"columns\": [\n                 {\n                     \"column_name\": \"source\",\n@@ -229,6 +230,7 @@ def test_export_dataset_command_key_order(self, mock_g):\n         assert list(metadata.keys()) == [\n             \"table_name\",\n             \"main_dttm_col\",\n+            \"currency_code_column\",\n             \"description\",\n             \"default_endpoint\",\n             \"offset\",\n@@ -370,6 +372,7 @@ def test_import_v1_dataset(self, mock_add_permissions, sm_g, utils_g):\n         )\n         assert dataset.table_name == \"imported_dataset\"\n         assert dataset.main_dttm_col is None\n+        assert dataset.currency_code_column == \"currency\"\n         assert dataset.description == \"This is a dataset that was exported\"\n         assert dataset.default_endpoint == \"\"\n         assert dataset.offset == 66", "pull_request_number": 36416}
{"sha": "0cd63526e8c332e1520cb869fd9eb4243862018e", "filename": "tests/integration_tests/fixtures/importexport.py", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/tests%2Fintegration_tests%2Ffixtures%2Fimportexport.py", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/tests%2Fintegration_tests%2Ffixtures%2Fimportexport.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/tests%2Fintegration_tests%2Ffixtures%2Fimportexport.py?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -509,6 +509,7 @@\n dataset_config: dict[str, Any] = {\n     \"table_name\": \"imported_dataset\",\n     \"main_dttm_col\": None,\n+    \"currency_code_column\": \"currency\",\n     \"description\": \"This is a dataset that was exported\",\n     \"default_endpoint\": \"\",\n     \"offset\": 66,", "pull_request_number": 36416}
{"sha": "50ec9619c810549391c425f151b983e8069abfe6", "filename": "tests/unit_tests/common/test_query_actions_currency.py", "status": "added", "additions": 290, "deletions": 0, "changes": 290, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/tests%2Funit_tests%2Fcommon%2Ftest_query_actions_currency.py", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/tests%2Funit_tests%2Fcommon%2Ftest_query_actions_currency.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/tests%2Funit_tests%2Fcommon%2Ftest_query_actions_currency.py?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -0,0 +1,290 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+from unittest.mock import MagicMock, patch\n+\n+import pandas as pd\n+import pytest\n+\n+from superset.common.query_actions import _detect_currency\n+\n+\n+@pytest.fixture\n+def mock_query_context() -> MagicMock:\n+    \"\"\"Create a mock QueryContext with AUTO currency format.\"\"\"\n+    context = MagicMock()\n+    context.form_data = {\"currency_format\": {\"symbol\": \"AUTO\"}}\n+    return context\n+\n+\n+@pytest.fixture\n+def mock_query_obj() -> MagicMock:\n+    \"\"\"Create a mock QueryObject with filter attributes.\"\"\"\n+    obj = MagicMock()\n+    obj.filter = []\n+    obj.granularity = None\n+    obj.from_dttm = None\n+    obj.to_dttm = None\n+    obj.extras = {}\n+    return obj\n+\n+\n+@pytest.fixture\n+def mock_datasource() -> MagicMock:\n+    \"\"\"Create a mock datasource with currency column.\"\"\"\n+    ds = MagicMock()\n+    ds.currency_code_column = \"currency_code\"\n+    return ds\n+\n+\n+def test_detect_currency_returns_none_when_form_data_is_none(\n+    mock_query_obj: MagicMock,\n+    mock_datasource: MagicMock,\n+) -> None:\n+    \"\"\"Returns None when query context has no form_data.\"\"\"\n+    context = MagicMock()\n+    context.form_data = None\n+\n+    result = _detect_currency(context, mock_query_obj, mock_datasource)\n+\n+    assert result is None\n+\n+\n+def test_detect_currency_returns_none_when_currency_format_not_dict(\n+    mock_query_obj: MagicMock,\n+    mock_datasource: MagicMock,\n+) -> None:\n+    \"\"\"Returns None when currency_format is not a dict.\"\"\"\n+    context = MagicMock()\n+    context.form_data = {\"currency_format\": \"invalid\"}\n+\n+    result = _detect_currency(context, mock_query_obj, mock_datasource)\n+\n+    assert result is None\n+\n+\n+def test_detect_currency_returns_none_when_symbol_not_auto(\n+    mock_query_obj: MagicMock,\n+    mock_datasource: MagicMock,\n+) -> None:\n+    \"\"\"Returns None when currency_format.symbol is not AUTO.\"\"\"\n+    context = MagicMock()\n+    context.form_data = {\"currency_format\": {\"symbol\": \"USD\"}}\n+\n+    result = _detect_currency(context, mock_query_obj, mock_datasource)\n+\n+    assert result is None\n+\n+\n+def test_detect_currency_returns_none_when_no_currency_column(\n+    mock_query_context: MagicMock,\n+    mock_query_obj: MagicMock,\n+) -> None:\n+    \"\"\"Returns None when datasource has no currency_code_column.\"\"\"\n+    datasource = MagicMock()\n+    datasource.currency_code_column = None\n+\n+    result = _detect_currency(mock_query_context, mock_query_obj, datasource)\n+\n+    assert result is None\n+\n+\n+@patch(\"superset.common.query_actions.detect_currency_from_df\")\n+def test_detect_currency_uses_dataframe_when_column_present(\n+    mock_detect_from_df: MagicMock,\n+    mock_query_context: MagicMock,\n+    mock_query_obj: MagicMock,\n+    mock_datasource: MagicMock,\n+) -> None:\n+    \"\"\"Uses detect_currency_from_df when df contains currency column.\"\"\"\n+    df = pd.DataFrame({\"currency_code\": [\"USD\", \"USD\"]})\n+    mock_detect_from_df.return_value = \"USD\"\n+\n+    result = _detect_currency(mock_query_context, mock_query_obj, mock_datasource, df)\n+\n+    assert result == \"USD\"\n+    mock_detect_from_df.assert_called_once_with(df, \"currency_code\")\n+\n+\n+@patch(\"superset.common.query_actions.detect_currency\")\n+def test_detect_currency_queries_datasource_when_no_df(\n+    mock_detect: MagicMock,\n+    mock_query_context: MagicMock,\n+    mock_query_obj: MagicMock,\n+    mock_datasource: MagicMock,\n+) -> None:\n+    \"\"\"Queries datasource when df is None.\"\"\"\n+    mock_detect.return_value = \"EUR\"\n+\n+    result = _detect_currency(mock_query_context, mock_query_obj, mock_datasource)\n+\n+    assert result == \"EUR\"\n+    mock_detect.assert_called_once_with(\n+        datasource=mock_datasource,\n+        filters=mock_query_obj.filter,\n+        granularity=mock_query_obj.granularity,\n+        from_dttm=mock_query_obj.from_dttm,\n+        to_dttm=mock_query_obj.to_dttm,\n+        extras=mock_query_obj.extras,\n+    )\n+\n+\n+@patch(\"superset.common.query_actions.detect_currency\")\n+def test_detect_currency_queries_datasource_when_column_not_in_df(\n+    mock_detect: MagicMock,\n+    mock_query_context: MagicMock,\n+    mock_query_obj: MagicMock,\n+    mock_datasource: MagicMock,\n+) -> None:\n+    \"\"\"Falls back to query when df doesn't have currency column.\"\"\"\n+    df = pd.DataFrame({\"other_column\": [\"value\"]})\n+    mock_detect.return_value = \"GBP\"\n+\n+    result = _detect_currency(mock_query_context, mock_query_obj, mock_datasource, df)\n+\n+    assert result == \"GBP\"\n+    mock_detect.assert_called_once()\n+\n+\n+# Tests for column_config AUTO detection (Table charts)\n+\n+\n+@pytest.fixture\n+def mock_query_context_with_column_config() -> MagicMock:\n+    \"\"\"Create a mock QueryContext with column_config AUTO currency (Table charts).\"\"\"\n+    context = MagicMock()\n+    context.form_data = {\n+        \"column_config\": {\n+            \"cost\": {\"currencyFormat\": {\"symbol\": \"AUTO\", \"symbolPosition\": \"prefix\"}}\n+        }\n+    }\n+    return context\n+\n+\n+@patch(\"superset.common.query_actions.detect_currency\")\n+def test_detect_currency_checks_column_config_for_auto(\n+    mock_detect: MagicMock,\n+    mock_query_context_with_column_config: MagicMock,\n+    mock_query_obj: MagicMock,\n+    mock_datasource: MagicMock,\n+) -> None:\n+    \"\"\"Runs detection when column_config has AUTO currency (Table charts).\"\"\"\n+    mock_detect.return_value = \"USD\"\n+\n+    result = _detect_currency(\n+        mock_query_context_with_column_config,\n+        mock_query_obj,\n+        mock_datasource,\n+    )\n+\n+    assert result == \"USD\"\n+    mock_detect.assert_called_once()\n+\n+\n+@patch(\"superset.common.query_actions.detect_currency_from_df\")\n+def test_detect_currency_column_config_uses_dataframe(\n+    mock_detect_from_df: MagicMock,\n+    mock_query_context_with_column_config: MagicMock,\n+    mock_query_obj: MagicMock,\n+    mock_datasource: MagicMock,\n+) -> None:\n+    \"\"\"Uses dataframe detection when column_config has AUTO and df has currency.\"\"\"\n+    df = pd.DataFrame({\"currency_code\": [\"EUR\", \"EUR\"]})\n+    mock_detect_from_df.return_value = \"EUR\"\n+\n+    result = _detect_currency(\n+        mock_query_context_with_column_config,\n+        mock_query_obj,\n+        mock_datasource,\n+        df,\n+    )\n+\n+    assert result == \"EUR\"\n+    mock_detect_from_df.assert_called_once_with(df, \"currency_code\")\n+\n+\n+def test_detect_currency_skips_when_no_auto_in_column_config(\n+    mock_query_obj: MagicMock,\n+    mock_datasource: MagicMock,\n+) -> None:\n+    \"\"\"Returns None when column_config has explicit currency (not AUTO).\"\"\"\n+    context = MagicMock()\n+    context.form_data = {\n+        \"column_config\": {\"cost\": {\"currencyFormat\": {\"symbol\": \"USD\"}}}\n+    }\n+\n+    result = _detect_currency(context, mock_query_obj, mock_datasource)\n+\n+    assert result is None\n+\n+\n+@patch(\"superset.common.query_actions.detect_currency\")\n+def test_detect_currency_works_with_both_top_level_and_column_config(\n+    mock_detect: MagicMock,\n+    mock_query_obj: MagicMock,\n+    mock_datasource: MagicMock,\n+) -> None:\n+    \"\"\"Detects when both top-level and column_config have AUTO.\"\"\"\n+    context = MagicMock()\n+    context.form_data = {\n+        \"currency_format\": {\"symbol\": \"AUTO\"},\n+        \"column_config\": {\"cost\": {\"currencyFormat\": {\"symbol\": \"AUTO\"}}},\n+    }\n+    mock_detect.return_value = \"JPY\"\n+\n+    result = _detect_currency(context, mock_query_obj, mock_datasource)\n+\n+    assert result == \"JPY\"\n+    mock_detect.assert_called_once()\n+\n+\n+@patch(\"superset.common.query_actions.detect_currency\")\n+def test_detect_currency_top_level_auto_triggers_detection(\n+    mock_detect: MagicMock,\n+    mock_query_obj: MagicMock,\n+    mock_datasource: MagicMock,\n+) -> None:\n+    \"\"\"Detects when only top-level currency_format has AUTO.\"\"\"\n+    context = MagicMock()\n+    context.form_data = {\n+        \"currency_format\": {\"symbol\": \"AUTO\"},\n+        \"column_config\": {\n+            \"cost\": {\"currencyFormat\": {\"symbol\": \"USD\"}}  # explicit, not AUTO\n+        },\n+    }\n+    mock_detect.return_value = \"CAD\"\n+\n+    result = _detect_currency(context, mock_query_obj, mock_datasource)\n+\n+    assert result == \"CAD\"\n+    mock_detect.assert_called_once()\n+\n+\n+def test_detect_currency_column_config_no_currency_column_returns_none(\n+    mock_query_context_with_column_config: MagicMock,\n+    mock_query_obj: MagicMock,\n+) -> None:\n+    \"\"\"Returns None when column_config has AUTO but datasource lacks currency column.\"\"\"\n+    datasource = MagicMock()\n+    datasource.currency_code_column = None\n+\n+    result = _detect_currency(\n+        mock_query_context_with_column_config,\n+        mock_query_obj,\n+        datasource,\n+    )\n+\n+    assert result is None", "pull_request_number": 36416}
{"sha": "37a7b47460d48d9902979eb726a69bbd971cbbc9", "filename": "tests/unit_tests/common/test_query_context_factory.py", "status": "modified", "additions": 106, "deletions": 0, "changes": 106, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/tests%2Funit_tests%2Fcommon%2Ftest_query_context_factory.py", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/tests%2Funit_tests%2Fcommon%2Ftest_query_context_factory.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/tests%2Funit_tests%2Fcommon%2Ftest_query_context_factory.py?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -436,3 +436,109 @@ def test_apply_filters_no_temporal_filters(self):\n         self.factory._apply_filters(query_object)\n \n         assert query_object.filter[0][\"val\"] == \"value\"\n+\n+    def test_add_currency_column_no_form_data(self):\n+        \"\"\"Test _add_currency_column when form_data is None.\"\"\"\n+        query_object = Mock(spec=QueryObject)\n+        query_object.columns = [\"col1\"]\n+        datasource = Mock()\n+\n+        self.factory._add_currency_column(query_object, None, datasource)\n+\n+        assert query_object.columns == [\"col1\"]\n+\n+    def test_add_currency_column_no_columns(self):\n+        \"\"\"Test _add_currency_column when query_object has no columns.\"\"\"\n+        query_object = Mock(spec=QueryObject)\n+        query_object.columns = []\n+        form_data = {\n+            \"viz_type\": \"pivot_table_v2\",\n+            \"currency_format\": {\"symbol\": \"AUTO\"},\n+        }\n+        datasource = Mock()\n+        datasource.currency_code_column = \"currency_code\"\n+\n+        self.factory._add_currency_column(query_object, form_data, datasource)\n+\n+        assert query_object.columns == []\n+\n+    def test_add_currency_column_unsupported_viz_type(self):\n+        \"\"\"Test _add_currency_column with unsupported viz type.\"\"\"\n+        query_object = Mock(spec=QueryObject)\n+        query_object.columns = [\"col1\"]\n+        form_data = {\"viz_type\": \"pie\", \"currency_format\": {\"symbol\": \"AUTO\"}}\n+        datasource = Mock()\n+        datasource.currency_code_column = \"currency_code\"\n+\n+        self.factory._add_currency_column(query_object, form_data, datasource)\n+\n+        assert query_object.columns == [\"col1\"]\n+\n+    def test_add_currency_column_symbol_not_auto(self):\n+        \"\"\"Test _add_currency_column when symbol is not AUTO.\"\"\"\n+        query_object = Mock(spec=QueryObject)\n+        query_object.columns = [\"col1\"]\n+        form_data = {\"viz_type\": \"pivot_table_v2\", \"currency_format\": {\"symbol\": \"USD\"}}\n+        datasource = Mock()\n+        datasource.currency_code_column = \"currency_code\"\n+\n+        self.factory._add_currency_column(query_object, form_data, datasource)\n+\n+        assert query_object.columns == [\"col1\"]\n+\n+    def test_add_currency_column_no_currency_column_on_datasource(self):\n+        \"\"\"Test _add_currency_column when datasource has no currency column.\"\"\"\n+        query_object = Mock(spec=QueryObject)\n+        query_object.columns = [\"col1\"]\n+        form_data = {\n+            \"viz_type\": \"pivot_table_v2\",\n+            \"currency_format\": {\"symbol\": \"AUTO\"},\n+        }\n+        datasource = Mock()\n+        datasource.currency_code_column = None\n+\n+        self.factory._add_currency_column(query_object, form_data, datasource)\n+\n+        assert query_object.columns == [\"col1\"]\n+\n+    def test_add_currency_column_already_in_query(self):\n+        \"\"\"Test _add_currency_column when currency column already exists.\"\"\"\n+        query_object = Mock(spec=QueryObject)\n+        query_object.columns = [\"col1\", \"currency_code\"]\n+        form_data = {\n+            \"viz_type\": \"pivot_table_v2\",\n+            \"currency_format\": {\"symbol\": \"AUTO\"},\n+        }\n+        datasource = Mock()\n+        datasource.currency_code_column = \"currency_code\"\n+\n+        self.factory._add_currency_column(query_object, form_data, datasource)\n+\n+        assert query_object.columns == [\"col1\", \"currency_code\"]\n+\n+    def test_add_currency_column_adds_column_for_pivot_table(self):\n+        \"\"\"Test _add_currency_column adds column for pivot_table_v2 viz type\"\"\"\n+        query_object = Mock(spec=QueryObject)\n+        query_object.columns = [\"col1\"]\n+        form_data = {\n+            \"viz_type\": \"pivot_table_v2\",\n+            \"currency_format\": {\"symbol\": \"AUTO\"},\n+        }\n+        datasource = Mock()\n+        datasource.currency_code_column = \"currency_code\"\n+\n+        self.factory._add_currency_column(query_object, form_data, datasource)\n+\n+        assert query_object.columns == [\"col1\", \"currency_code\"]\n+\n+    def test_add_currency_column_skips_table_viz_type(self):\n+        \"\"\"Test _add_currency_column does not add column for table viz type.\"\"\"\n+        query_object = Mock(spec=QueryObject)\n+        query_object.columns = [\"col1\"]\n+        form_data = {\"viz_type\": \"table\", \"currency_format\": {\"symbol\": \"AUTO\"}}\n+        datasource = Mock()\n+        datasource.currency_code_column = \"currency_code\"\n+\n+        self.factory._add_currency_column(query_object, form_data, datasource)\n+\n+        assert query_object.columns == [\"col1\"]", "pull_request_number": 36416}
{"sha": "f3079ca356cb91813d22df49aa6c4a5ff59a6cea", "filename": "tests/unit_tests/connectors/sqla/models_test.py", "status": "modified", "additions": 64, "deletions": 0, "changes": 64, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/tests%2Funit_tests%2Fconnectors%2Fsqla%2Fmodels_test.py", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/tests%2Funit_tests%2Fconnectors%2Fsqla%2Fmodels_test.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/tests%2Funit_tests%2Fconnectors%2Fsqla%2Fmodels_test.py?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -842,3 +842,67 @@ def test_quoted_name_prevents_double_quoting(mocker: MockerFixture) -> None:\n     # Should have each part quoted separately:\n     # GOOD: \"MY_DB\".\"MY_SCHEMA\".\"MY_TABLE\"\n     assert '\"MY_DB\".\"MY_SCHEMA\".\"MY_TABLE\"' in compiled\n+\n+\n+def test_sqla_table_currency_code_column_property() -> None:\n+    \"\"\"\n+    Test currency_code_column property on SqlaTable.\n+    \"\"\"\n+    database = Database(database_name=\"my_db\")\n+    table = SqlaTable(\n+        table_name=\"sales\",\n+        database=database,\n+        currency_code_column=\"currency\",\n+    )\n+    assert table.currency_code_column == \"currency\"\n+\n+\n+def test_sqla_table_data_includes_currency_code_column(mocker: MockerFixture) -> None:\n+    \"\"\"\n+    Test that data property includes currency_code_column.\n+    \"\"\"\n+    database = mocker.MagicMock()\n+    database.get_sqla_engine.return_value.__enter__ = mocker.MagicMock()\n+    database.get_sqla_engine.return_value.__exit__ = mocker.MagicMock()\n+\n+    table = SqlaTable(\n+        table_name=\"sales\",\n+        database=database,\n+        currency_code_column=\"currency_code\",\n+        main_dttm_col=\"ds\",\n+    )\n+    table.columns = []\n+    table.metrics = []\n+\n+    # Mock the columns property to return empty list\n+    mocker.patch.object(SqlaTable, \"columns\", [])\n+    mocker.patch.object(SqlaTable, \"metrics\", [])\n+\n+    data = table.data\n+    assert data[\"currency_code_column\"] == \"currency_code\"\n+    assert data[\"main_dttm_col\"] == \"ds\"\n+\n+\n+def test_sqla_table_link_escapes_url(mocker: MockerFixture) -> None:\n+    \"\"\"\n+    Test that link property properly escapes URL to prevent XSS.\n+    \"\"\"\n+    database = Database(database_name=\"my_db\")\n+    table = SqlaTable(\n+        table_name='test<script>alert(\"xss\")</script>',\n+        database=database,\n+        id=1,\n+    )\n+\n+    # Mock explore_url to return a URL with special characters\n+    mocker.patch.object(\n+        SqlaTable,\n+        \"explore_url\",\n+        new_callable=mocker.PropertyMock,\n+        return_value='/explore/?datasource_type=table&datasource_id=1&name=<script>alert(\"xss\")</script>',\n+    )\n+\n+    link = table.link\n+    # Verify that special characters are escaped in both name and URL\n+    assert \"&lt;script&gt;\" in str(link)\n+    assert \"<script>\" not in str(link)", "pull_request_number": 36416}
{"sha": "d2bb3a66ccf5bcdcfd43c4efb6d7feb72c1dbec3", "filename": "tests/unit_tests/datasets/commands/export_test.py", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/tests%2Funit_tests%2Fdatasets%2Fcommands%2Fexport_test.py", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/tests%2Funit_tests%2Fdatasets%2Fcommands%2Fexport_test.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/tests%2Funit_tests%2Fdatasets%2Fcommands%2Fexport_test.py?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -155,6 +155,7 @@ def test_export(session: Session) -> None:\n             f\"datasets/my_database/my_table_{sqla_table.id}.yaml\",\n             f\"\"\"table_name: my_table\n main_dttm_col: ds\n+currency_code_column: null\n description: This is the description\n default_endpoint: null\n offset: -8", "pull_request_number": 36416}
{"sha": "280a2440c2dfda1375f8158ff89c6c1acb9b4e8f", "filename": "tests/unit_tests/datasets/schema_tests.py", "status": "modified", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/tests%2Funit_tests%2Fdatasets%2Fschema_tests.py", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/tests%2Funit_tests%2Fdatasets%2Fschema_tests.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/tests%2Funit_tests%2Fdatasets%2Fschema_tests.py?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -46,3 +46,32 @@ def test_validate_python_date_format(payload) -> None:\n def test_validate_python_date_format_raises(payload) -> None:\n     with pytest.raises(ValidationError):\n         validate_python_date_format(payload)\n+\n+\n+def test_dataset_put_schema_includes_currency_code_column() -> None:\n+    \"\"\"Test that DatasetPutSchema properly handles currency_code_column field.\"\"\"\n+    from superset.datasets.schemas import DatasetPutSchema\n+\n+    schema = DatasetPutSchema()\n+\n+    # Dataset with currency code column\n+    data = {\n+        \"currency_code_column\": \"currency\",\n+    }\n+    result = schema.load(data)\n+    assert result[\"currency_code_column\"] == \"currency\"\n+\n+\n+def test_dataset_put_schema_currency_code_column_optional() -> None:\n+    \"\"\"Test that currency_code_column is optional in DatasetPutSchema.\"\"\"\n+    from superset.datasets.schemas import DatasetPutSchema\n+\n+    schema = DatasetPutSchema()\n+\n+    # Dataset without currency code column (should not fail)\n+    data: dict[str, str | None] = {}\n+    result = schema.load(data)\n+    assert (\n+        \"currency_code_column\" not in result\n+        or result.get(\"currency_code_column\") is None\n+    )", "pull_request_number": 36416}
{"sha": "763f99220d8bab609307b146b5deb27368c5af68", "filename": "tests/unit_tests/utils/currency_test.py", "status": "added", "additions": 332, "deletions": 0, "changes": 332, "blob_url": "https://github.com/apache/superset/blob/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/tests%2Funit_tests%2Futils%2Fcurrency_test.py", "raw_url": "https://github.com/apache/superset/raw/2a9bafe77b2d2eb110b441c861b4ea1d977f5332/tests%2Funit_tests%2Futils%2Fcurrency_test.py", "contents_url": "https://api.github.com/repos/apache/superset/contents/tests%2Funit_tests%2Futils%2Fcurrency_test.py?ref=2a9bafe77b2d2eb110b441c861b4ea1d977f5332", "patch": "@@ -0,0 +1,332 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+from unittest.mock import MagicMock\n+\n+import pandas as pd\n+import pytest\n+\n+from superset.common.db_query_status import QueryStatus\n+from superset.utils.currency import (\n+    detect_currency,\n+    detect_currency_from_df,\n+    has_auto_currency_in_column_config,\n+)\n+\n+\n+@pytest.fixture\n+def mock_datasource() -> MagicMock:\n+    \"\"\"Create a mock datasource with currency_code_column configured.\"\"\"\n+    datasource = MagicMock()\n+    datasource.currency_code_column = \"currency_code\"\n+    datasource.id = 1\n+    return datasource\n+\n+\n+@pytest.fixture\n+def mock_query_result() -> MagicMock:\n+    \"\"\"Create a mock query result.\"\"\"\n+    result = MagicMock()\n+    result.status = QueryStatus.SUCCESS\n+    return result\n+\n+\n+def test_detect_currency_returns_none_when_no_currency_column() -> None:\n+    \"\"\"Returns None when datasource has no currency_code_column configured.\"\"\"\n+    datasource = MagicMock()\n+    datasource.currency_code_column = None\n+\n+    result = detect_currency(datasource)\n+\n+    assert result is None\n+    datasource.query.assert_not_called()\n+\n+\n+def test_detect_currency_returns_single_currency(\n+    mock_datasource: MagicMock,\n+    mock_query_result: MagicMock,\n+) -> None:\n+    \"\"\"Returns currency code when all filtered data contains single currency.\"\"\"\n+    mock_query_result.df = pd.DataFrame({\"currency_code\": [\"USD\", \"USD\", \"USD\"]})\n+    mock_datasource.query.return_value = mock_query_result\n+\n+    result = detect_currency(mock_datasource)\n+\n+    assert result == \"USD\"\n+\n+\n+def test_detect_currency_returns_none_for_multiple_currencies(\n+    mock_datasource: MagicMock,\n+    mock_query_result: MagicMock,\n+) -> None:\n+    \"\"\"Returns None when filtered data contains multiple currencies.\"\"\"\n+    mock_query_result.df = pd.DataFrame({\"currency_code\": [\"USD\", \"EUR\", \"GBP\"]})\n+    mock_datasource.query.return_value = mock_query_result\n+\n+    result = detect_currency(mock_datasource)\n+\n+    assert result is None\n+\n+\n+def test_detect_currency_returns_none_for_empty_dataframe(\n+    mock_datasource: MagicMock,\n+    mock_query_result: MagicMock,\n+) -> None:\n+    \"\"\"Returns None when query returns empty dataframe.\"\"\"\n+    mock_query_result.df = pd.DataFrame()\n+    mock_datasource.query.return_value = mock_query_result\n+\n+    result = detect_currency(mock_datasource)\n+\n+    assert result is None\n+\n+\n+def test_detect_currency_returns_none_on_query_failure(\n+    mock_datasource: MagicMock,\n+    mock_query_result: MagicMock,\n+) -> None:\n+    \"\"\"Returns None when query fails.\"\"\"\n+    mock_query_result.status = QueryStatus.FAILED\n+    mock_query_result.df = pd.DataFrame()\n+    mock_datasource.query.return_value = mock_query_result\n+\n+    result = detect_currency(mock_datasource)\n+\n+    assert result is None\n+\n+\n+def test_detect_currency_handles_exception_gracefully(\n+    mock_datasource: MagicMock,\n+) -> None:\n+    \"\"\"Returns None and logs warning when exception occurs.\"\"\"\n+    mock_datasource.query.side_effect = Exception(\"Database error\")\n+\n+    result = detect_currency(mock_datasource)\n+\n+    assert result is None\n+\n+\n+def test_detect_currency_normalizes_to_uppercase(\n+    mock_datasource: MagicMock,\n+    mock_query_result: MagicMock,\n+) -> None:\n+    \"\"\"Normalizes currency codes to uppercase.\"\"\"\n+    mock_query_result.df = pd.DataFrame({\"currency_code\": [\"usd\", \"Usd\", \"USD\"]})\n+    mock_datasource.query.return_value = mock_query_result\n+\n+    result = detect_currency(mock_datasource)\n+\n+    assert result == \"USD\"\n+\n+\n+def test_detect_currency_ignores_null_values(\n+    mock_datasource: MagicMock,\n+    mock_query_result: MagicMock,\n+) -> None:\n+    \"\"\"Ignores null currency values when detecting single currency.\"\"\"\n+    mock_query_result.df = pd.DataFrame({\"currency_code\": [\"USD\", None, \"USD\", None]})\n+    mock_datasource.query.return_value = mock_query_result\n+\n+    result = detect_currency(mock_datasource)\n+\n+    assert result == \"USD\"\n+\n+\n+def test_detect_currency_returns_none_when_column_missing_from_result(\n+    mock_datasource: MagicMock,\n+    mock_query_result: MagicMock,\n+) -> None:\n+    \"\"\"Returns None when currency column is missing from query result.\"\"\"\n+    mock_query_result.df = pd.DataFrame({\"other_column\": [\"value\"]})\n+    mock_datasource.query.return_value = mock_query_result\n+\n+    result = detect_currency(mock_datasource)\n+\n+    assert result is None\n+\n+\n+# Tests for detect_currency_from_df\n+\n+\n+def test_detect_currency_from_df_returns_single_currency() -> None:\n+    \"\"\"Returns currency code when all data contains single currency.\"\"\"\n+    df = pd.DataFrame({\"currency_code\": [\"USD\", \"USD\", \"USD\"]})\n+\n+    result = detect_currency_from_df(df, \"currency_code\")\n+\n+    assert result == \"USD\"\n+\n+\n+def test_detect_currency_from_df_returns_none_for_multiple_currencies() -> None:\n+    \"\"\"Returns None when data contains multiple currencies.\"\"\"\n+    df = pd.DataFrame({\"currency_code\": [\"USD\", \"EUR\", \"GBP\"]})\n+\n+    result = detect_currency_from_df(df, \"currency_code\")\n+\n+    assert result is None\n+\n+\n+def test_detect_currency_from_df_returns_none_for_empty_dataframe() -> None:\n+    \"\"\"Returns None when dataframe is empty.\"\"\"\n+    df = pd.DataFrame()\n+\n+    result = detect_currency_from_df(df, \"currency_code\")\n+\n+    assert result is None\n+\n+\n+def test_detect_currency_from_df_returns_none_for_none_dataframe() -> None:\n+    \"\"\"Returns None when dataframe is None.\"\"\"\n+    result = detect_currency_from_df(None, \"currency_code\")\n+\n+    assert result is None\n+\n+\n+def test_detect_currency_from_df_returns_none_when_column_missing() -> None:\n+    \"\"\"Returns None when currency column is missing from dataframe.\"\"\"\n+    df = pd.DataFrame({\"other_column\": [\"value\"]})\n+\n+    result = detect_currency_from_df(df, \"currency_code\")\n+\n+    assert result is None\n+\n+\n+def test_detect_currency_from_df_normalizes_to_uppercase() -> None:\n+    \"\"\"Normalizes currency codes to uppercase.\"\"\"\n+    df = pd.DataFrame({\"currency_code\": [\"usd\", \"Usd\", \"USD\"]})\n+\n+    result = detect_currency_from_df(df, \"currency_code\")\n+\n+    assert result == \"USD\"\n+\n+\n+def test_detect_currency_from_df_ignores_null_values() -> None:\n+    \"\"\"Ignores null currency values when detecting single currency.\"\"\"\n+    df = pd.DataFrame({\"currency_code\": [\"USD\", None, \"USD\", None]})\n+\n+    result = detect_currency_from_df(df, \"currency_code\")\n+\n+    assert result == \"USD\"\n+\n+\n+def test_detect_currency_returns_none_when_query_not_callable() -> None:\n+    \"\"\"Returns None when datasource query attribute is not callable.\"\"\"\n+    datasource = MagicMock()\n+    datasource.currency_code_column = \"currency_code\"\n+    datasource.query = \"not_a_callable\"  # Set to a string instead of a method\n+\n+    result = detect_currency(datasource)\n+\n+    assert result is None\n+\n+\n+# Tests for has_auto_currency_in_column_config\n+\n+\n+def test_has_auto_currency_in_column_config_returns_true_when_auto() -> None:\n+    \"\"\"Returns True when column_config has AUTO currency.\"\"\"\n+    form_data = {\n+        \"column_config\": {\n+            \"cost\": {\"currencyFormat\": {\"symbol\": \"AUTO\", \"symbolPosition\": \"prefix\"}}\n+        }\n+    }\n+\n+    result = has_auto_currency_in_column_config(form_data)\n+\n+    assert result is True\n+\n+\n+def test_has_auto_currency_in_column_config_returns_true_multiple_columns() -> None:\n+    \"\"\"Returns True when any column in column_config has AUTO currency.\"\"\"\n+    form_data = {\n+        \"column_config\": {\n+            \"revenue\": {\"currencyFormat\": {\"symbol\": \"USD\"}},\n+            \"cost\": {\"currencyFormat\": {\"symbol\": \"AUTO\"}},\n+            \"profit\": {\"d3NumberFormat\": \",.0f\"},\n+        }\n+    }\n+\n+    result = has_auto_currency_in_column_config(form_data)\n+\n+    assert result is True\n+\n+\n+def test_has_auto_currency_in_column_config_returns_false_for_explicit() -> None:\n+    \"\"\"Returns False when column_config has explicit currency symbol.\"\"\"\n+    form_data = {\"column_config\": {\"cost\": {\"currencyFormat\": {\"symbol\": \"USD\"}}}}\n+\n+    result = has_auto_currency_in_column_config(form_data)\n+\n+    assert result is False\n+\n+\n+def test_has_auto_currency_in_column_config_returns_false_for_none() -> None:\n+    \"\"\"Returns False when form_data is None.\"\"\"\n+    result = has_auto_currency_in_column_config(None)\n+\n+    assert result is False\n+\n+\n+def test_has_auto_currency_in_column_config_returns_false_for_empty() -> None:\n+    \"\"\"Returns False when form_data is empty.\"\"\"\n+    result = has_auto_currency_in_column_config({})\n+\n+    assert result is False\n+\n+\n+def test_has_auto_currency_in_column_config_returns_false_no_column_config() -> None:\n+    \"\"\"Returns False when column_config is not present.\"\"\"\n+    form_data = {\"other_key\": \"value\"}\n+\n+    result = has_auto_currency_in_column_config(form_data)\n+\n+    assert result is False\n+\n+\n+def test_has_auto_currency_in_column_config_handles_invalid_column_config() -> None:\n+    \"\"\"Returns False when column_config is not a dict.\"\"\"\n+    form_data = {\"column_config\": \"invalid\"}\n+\n+    result = has_auto_currency_in_column_config(form_data)\n+\n+    assert result is False\n+\n+\n+def test_has_auto_currency_in_column_config_handles_invalid_config_entry() -> None:\n+    \"\"\"Returns False when column config entry is not a dict.\"\"\"\n+    form_data = {\"column_config\": {\"cost\": \"invalid\"}}\n+\n+    result = has_auto_currency_in_column_config(form_data)\n+\n+    assert result is False\n+\n+\n+def test_has_auto_currency_in_column_config_handles_invalid_currency_format() -> None:\n+    \"\"\"Returns False when currencyFormat is not a dict.\"\"\"\n+    form_data = {\"column_config\": {\"cost\": {\"currencyFormat\": \"invalid\"}}}\n+\n+    result = has_auto_currency_in_column_config(form_data)\n+\n+    assert result is False\n+\n+\n+def test_has_auto_currency_in_column_config_handles_no_currency_format() -> None:\n+    \"\"\"Returns False when column has no currencyFormat.\"\"\"\n+    form_data = {\"column_config\": {\"cost\": {\"d3NumberFormat\": \",.0f\"}}}\n+\n+    result = has_auto_currency_in_column_config(form_data)\n+\n+    assert result is False", "pull_request_number": 36416}
{"sha": "b211853348495fbb1a50b1943a9543d75c1b5262", "filename": "superset-frontend/src/filters/components/Select/SelectFilterPlugin.test.tsx", "status": "modified", "additions": 456, "deletions": 1, "changes": 457, "blob_url": "https://github.com/apache/superset/blob/0f9e29b3cad9a29d8215440a220295fd88e57a27/superset-frontend%2Fsrc%2Ffilters%2Fcomponents%2FSelect%2FSelectFilterPlugin.test.tsx", "raw_url": "https://github.com/apache/superset/raw/0f9e29b3cad9a29d8215440a220295fd88e57a27/superset-frontend%2Fsrc%2Ffilters%2Fcomponents%2FSelect%2FSelectFilterPlugin.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ffilters%2Fcomponents%2FSelect%2FSelectFilterPlugin.test.tsx?ref=0f9e29b3cad9a29d8215440a220295fd88e57a27", "patch": "@@ -17,7 +17,12 @@\n  * under the License.\n  */\n import { AppSection } from '@superset-ui/core';\n-import { render, screen, userEvent } from 'spec/helpers/testing-library';\n+import {\n+  render,\n+  screen,\n+  userEvent,\n+  waitFor,\n+} from 'spec/helpers/testing-library';\n import { NULL_STRING } from 'src/utils/common';\n import SelectFilterPlugin from './SelectFilterPlugin';\n import transformProps from './transformProps';\n@@ -676,3 +681,453 @@ describe('SelectFilterPlugin', () => {\n     expect(options[2]).toHaveTextContent('beta');\n   });\n });\n+\n+test('Select boolean FALSE value in single-select mode', async () => {\n+  jest.useRealTimers();\n+  const setDataMaskMock = jest.fn();\n+  const testProps = {\n+    ...selectMultipleProps,\n+    formData: {\n+      ...selectMultipleProps.formData,\n+      multiSelect: false,\n+      groupby: ['is_active'],\n+    },\n+    queriesData: [\n+      {\n+        ...selectMultipleProps.queriesData[0],\n+        colnames: ['is_active'],\n+        data: [{ is_active: true }, { is_active: false }],\n+        applied_filters: [{ column: 'is_active' }],\n+      },\n+    ],\n+    filterState: { value: undefined },\n+  };\n+\n+  render(\n+    // @ts-ignore\n+    <SelectFilterPlugin\n+      // @ts-ignore\n+      {...transformProps(testProps)}\n+      setDataMask={setDataMaskMock}\n+      showOverflow={false}\n+    />,\n+    {\n+      useRedux: true,\n+      initialState: {\n+        nativeFilters: {\n+          filters: {\n+            'test-filter': {\n+              name: 'Test Filter',\n+            },\n+          },\n+        },\n+        dataMask: {\n+          'test-filter': {\n+            extraFormData: {},\n+            filterState: {\n+              value: undefined,\n+            },\n+          },\n+        },\n+      },\n+    },\n+  );\n+\n+  const filterSelect = screen.getByRole('combobox');\n+  userEvent.click(filterSelect);\n+\n+  const falseOption = await screen.findByRole('option', { name: /false/i });\n+  userEvent.click(falseOption);\n+\n+  await waitFor(() => {\n+    expect(setDataMaskMock).toHaveBeenCalledWith(\n+      expect.objectContaining({\n+        extraFormData: {\n+          filters: [\n+            {\n+              col: 'is_active',\n+              op: 'IN',\n+              val: [false],\n+            },\n+          ],\n+        },\n+        filterState: expect.objectContaining({\n+          value: [false],\n+        }),\n+      }),\n+    );\n+  });\n+});\n+\n+test('Select boolean TRUE value in single-select mode', async () => {\n+  jest.useRealTimers();\n+  const setDataMaskMock = jest.fn();\n+  const testProps = {\n+    ...selectMultipleProps,\n+    formData: {\n+      ...selectMultipleProps.formData,\n+      multiSelect: false,\n+      groupby: ['is_active'],\n+    },\n+    queriesData: [\n+      {\n+        ...selectMultipleProps.queriesData[0],\n+        colnames: ['is_active'],\n+        data: [{ is_active: true }, { is_active: false }],\n+        applied_filters: [{ column: 'is_active' }],\n+      },\n+    ],\n+    filterState: { value: undefined },\n+  };\n+\n+  render(\n+    // @ts-ignore\n+    <SelectFilterPlugin\n+      // @ts-ignore\n+      {...transformProps(testProps)}\n+      setDataMask={setDataMaskMock}\n+      showOverflow={false}\n+    />,\n+    {\n+      useRedux: true,\n+      initialState: {\n+        nativeFilters: {\n+          filters: {\n+            'test-filter': {\n+              name: 'Test Filter',\n+            },\n+          },\n+        },\n+        dataMask: {\n+          'test-filter': {\n+            extraFormData: {},\n+            filterState: {\n+              value: undefined,\n+            },\n+          },\n+        },\n+      },\n+    },\n+  );\n+\n+  const filterSelect = screen.getByRole('combobox');\n+  userEvent.click(filterSelect);\n+\n+  const trueOption = await screen.findByRole('option', { name: /true/i });\n+  userEvent.click(trueOption);\n+\n+  await waitFor(() => {\n+    expect(setDataMaskMock).toHaveBeenCalledWith(\n+      expect.objectContaining({\n+        extraFormData: {\n+          filters: [\n+            {\n+              col: 'is_active',\n+              op: 'IN',\n+              val: [true],\n+            },\n+          ],\n+        },\n+        filterState: expect.objectContaining({\n+          value: [true],\n+        }),\n+      }),\n+    );\n+  });\n+});\n+\n+test('Select both boolean values in multi-select mode', async () => {\n+  jest.useRealTimers();\n+  const setDataMaskMock = jest.fn();\n+  const testProps = {\n+    ...selectMultipleProps,\n+    formData: {\n+      ...selectMultipleProps.formData,\n+      multiSelect: true,\n+      groupby: ['is_active'],\n+    },\n+    queriesData: [\n+      {\n+        ...selectMultipleProps.queriesData[0],\n+        colnames: ['is_active'],\n+        data: [{ is_active: true }, { is_active: false }],\n+        applied_filters: [{ column: 'is_active' }],\n+      },\n+    ],\n+    filterState: { value: [true] },\n+  };\n+\n+  render(\n+    // @ts-ignore\n+    <SelectFilterPlugin\n+      // @ts-ignore\n+      {...transformProps(testProps)}\n+      setDataMask={setDataMaskMock}\n+      showOverflow={false}\n+    />,\n+    {\n+      useRedux: true,\n+      initialState: {\n+        nativeFilters: {\n+          filters: {\n+            'test-filter': {\n+              name: 'Test Filter',\n+            },\n+          },\n+        },\n+        dataMask: {\n+          'test-filter': {\n+            extraFormData: {},\n+            filterState: {\n+              value: [true],\n+            },\n+          },\n+        },\n+      },\n+    },\n+  );\n+\n+  const filterSelect = screen.getByRole('combobox');\n+  userEvent.click(filterSelect);\n+\n+  const falseOption = await screen.findByRole('option', { name: /false/i });\n+  userEvent.click(falseOption);\n+\n+  await waitFor(() => {\n+    expect(setDataMaskMock).toHaveBeenCalledWith(\n+      expect.objectContaining({\n+        extraFormData: {\n+          filters: [\n+            {\n+              col: 'is_active',\n+              op: 'IN',\n+              val: [true, false],\n+            },\n+          ],\n+        },\n+        filterState: expect.objectContaining({\n+          value: [true, false],\n+        }),\n+      }),\n+    );\n+  });\n+});\n+\n+test('Select boolean filter with null values', async () => {\n+  jest.useRealTimers();\n+  const setDataMaskMock = jest.fn();\n+  const testProps = {\n+    ...selectMultipleProps,\n+    formData: {\n+      ...selectMultipleProps.formData,\n+      multiSelect: true,\n+      groupby: ['is_active'],\n+    },\n+    queriesData: [\n+      {\n+        ...selectMultipleProps.queriesData[0],\n+        colnames: ['is_active'],\n+        data: [{ is_active: true }, { is_active: false }, { is_active: null }],\n+        applied_filters: [{ column: 'is_active' }],\n+      },\n+    ],\n+    filterState: { value: [false] },\n+  };\n+\n+  render(\n+    // @ts-ignore\n+    <SelectFilterPlugin\n+      // @ts-ignore\n+      {...transformProps(testProps)}\n+      setDataMask={setDataMaskMock}\n+      showOverflow={false}\n+    />,\n+    {\n+      useRedux: true,\n+      initialState: {\n+        nativeFilters: {\n+          filters: {\n+            'test-filter': {\n+              name: 'Test Filter',\n+            },\n+          },\n+        },\n+        dataMask: {\n+          'test-filter': {\n+            extraFormData: {},\n+            filterState: {\n+              value: [false],\n+            },\n+          },\n+        },\n+      },\n+    },\n+  );\n+\n+  const filterSelect = screen.getByRole('combobox');\n+  userEvent.click(filterSelect);\n+\n+  const nullOption = await screen.findByRole('option', { name: NULL_STRING });\n+  userEvent.click(nullOption);\n+\n+  await waitFor(() => {\n+    expect(setDataMaskMock).toHaveBeenCalledWith(\n+      expect.objectContaining({\n+        extraFormData: {\n+          filters: [\n+            {\n+              col: 'is_active',\n+              op: 'IN',\n+              val: [false, null],\n+            },\n+          ],\n+        },\n+        filterState: expect.objectContaining({\n+          value: [false, null],\n+        }),\n+      }),\n+    );\n+  });\n+});\n+\n+test('Clear boolean FALSE value', async () => {\n+  jest.useRealTimers();\n+  const setDataMaskMock = jest.fn();\n+  const testProps = {\n+    ...selectMultipleProps,\n+    formData: {\n+      ...selectMultipleProps.formData,\n+      multiSelect: false,\n+      enableEmptyFilter: false,\n+      groupby: ['is_active'],\n+    },\n+    queriesData: [\n+      {\n+        ...selectMultipleProps.queriesData[0],\n+        colnames: ['is_active'],\n+        data: [{ is_active: true }, { is_active: false }],\n+        applied_filters: [{ column: 'is_active' }],\n+      },\n+    ],\n+    filterState: { value: [false] },\n+  };\n+\n+  render(\n+    // @ts-ignore\n+    <SelectFilterPlugin\n+      // @ts-ignore\n+      {...transformProps(testProps)}\n+      setDataMask={setDataMaskMock}\n+      showOverflow={false}\n+    />,\n+    {\n+      useRedux: true,\n+      initialState: {\n+        nativeFilters: {\n+          filters: {\n+            'test-filter': {\n+              name: 'Test Filter',\n+            },\n+          },\n+        },\n+        dataMask: {\n+          'test-filter': {\n+            extraFormData: {},\n+            filterState: {\n+              value: [false],\n+            },\n+          },\n+        },\n+      },\n+    },\n+  );\n+\n+  userEvent.click(\n+    screen.getByRole('img', {\n+      name: /close-circle/i,\n+      hidden: true,\n+    }),\n+  );\n+\n+  await waitFor(() => {\n+    expect(setDataMaskMock).toHaveBeenCalledWith({\n+      extraFormData: {},\n+      filterState: {\n+        label: undefined,\n+        value: null,\n+        excludeFilterValues: true,\n+      },\n+    });\n+  });\n+});\n+\n+test('Clear boolean TRUE value', async () => {\n+  jest.useRealTimers();\n+  const setDataMaskMock = jest.fn();\n+  const testProps = {\n+    ...selectMultipleProps,\n+    formData: {\n+      ...selectMultipleProps.formData,\n+      multiSelect: false,\n+      enableEmptyFilter: false,\n+      groupby: ['is_active'],\n+    },\n+    queriesData: [\n+      {\n+        ...selectMultipleProps.queriesData[0],\n+        colnames: ['is_active'],\n+        data: [{ is_active: true }, { is_active: false }],\n+        applied_filters: [{ column: 'is_active' }],\n+      },\n+    ],\n+    filterState: { value: [true] },\n+  };\n+\n+  render(\n+    // @ts-ignore\n+    <SelectFilterPlugin\n+      // @ts-ignore\n+      {...transformProps(testProps)}\n+      setDataMask={setDataMaskMock}\n+      showOverflow={false}\n+    />,\n+    {\n+      useRedux: true,\n+      initialState: {\n+        nativeFilters: {\n+          filters: {\n+            'test-filter': {\n+              name: 'Test Filter',\n+            },\n+          },\n+        },\n+        dataMask: {\n+          'test-filter': {\n+            extraFormData: {},\n+            filterState: {\n+              value: [true],\n+            },\n+          },\n+        },\n+      },\n+    },\n+  );\n+\n+  userEvent.click(\n+    screen.getByRole('img', {\n+      name: /close-circle/i,\n+      hidden: true,\n+    }),\n+  );\n+\n+  await waitFor(() => {\n+    expect(setDataMaskMock).toHaveBeenCalledWith({\n+      extraFormData: {},\n+      filterState: {\n+        label: undefined,\n+        value: null,\n+        excludeFilterValues: true,\n+      },\n+    });\n+  });\n+});", "pull_request_number": 37017}
{"sha": "d70fd7c90fe649e8ee39d6129b9b38d0a2862fca", "filename": "superset-frontend/src/filters/components/Select/SelectFilterPlugin.tsx", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/0f9e29b3cad9a29d8215440a220295fd88e57a27/superset-frontend%2Fsrc%2Ffilters%2Fcomponents%2FSelect%2FSelectFilterPlugin.tsx", "raw_url": "https://github.com/apache/superset/raw/0f9e29b3cad9a29d8215440a220295fd88e57a27/superset-frontend%2Fsrc%2Ffilters%2Fcomponents%2FSelect%2FSelectFilterPlugin.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Ffilters%2Fcomponents%2FSelect%2FSelectFilterPlugin.tsx?ref=0f9e29b3cad9a29d8215440a220295fd88e57a27", "patch": "@@ -514,7 +514,7 @@ export default function PluginFilterSelect(props: PluginFilterSelectProps) {\n             allowClear\n             allowNewOptions={!searchAllOptions && creatable !== false}\n             allowSelectAll={!searchAllOptions}\n-            value={filterState.value || []}\n+            value={multiSelect ? filterState.value || [] : filterState.value}\n             disabled={isDisabled}\n             getPopupContainer={\n               showOverflow", "pull_request_number": 37017}
{"sha": "7a1996c73624b4b0748b205bdd1112cc3ac78a8a", "filename": "superset-frontend/src/utils/colorScheme.ts", "status": "modified", "additions": 20, "deletions": 1, "changes": 21, "blob_url": "https://github.com/apache/superset/blob/a24910bcdd7dc6d40794ebbfab7ee22276cb40bb/superset-frontend%2Fsrc%2Futils%2FcolorScheme.ts", "raw_url": "https://github.com/apache/superset/raw/a24910bcdd7dc6d40794ebbfab7ee22276cb40bb/superset-frontend%2Fsrc%2Futils%2FcolorScheme.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Futils%2FcolorScheme.ts?ref=a24910bcdd7dc6d40794ebbfab7ee22276cb40bb", "patch": "@@ -103,8 +103,27 @@ export const getFreshLabelsColorMapEntries = (\n   Object.keys(customLabelsColor).forEach(label => {\n     delete allEntries[label];\n   });\n+// Ensure no duplicate colors\n+const usedColors = new Set<string>(Object.values(customLabelsColor));\n+const updatedEntries: Record<string, string> = {};\n+\n+Object.entries(allEntries).forEach(([label, color]) => {\n+  let finalColor = color;\n+\n+  // If this color is already used, pick the next available color\n+  if (usedColors.has(color)) {\n+    const availableColors = Object.values(allEntries);\n+\n+    finalColor = availableColors.find(c => !usedColors.has(c)) ?? color;\n+\n+  }\n+\n+  usedColors.add(finalColor);\n+  updatedEntries[label] = finalColor;\n+});\n+\n+return updatedEntries;\n \n-  return allEntries;\n };\n \n /**", "pull_request_number": 36541}
{"sha": "a1969c99612a9fb90e1ddc6c6b02d0050825321c", "filename": "superset-frontend/src/explore/components/ExploreChartHeader/ExploreChartHeader.test.tsx", "status": "modified", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/apache/superset/blob/ef0734b4cc84cee9b29492765d38f1071adf6359/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2FExploreChartHeader%2FExploreChartHeader.test.tsx", "raw_url": "https://github.com/apache/superset/raw/ef0734b4cc84cee9b29492765d38f1071adf6359/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2FExploreChartHeader%2FExploreChartHeader.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2FExploreChartHeader%2FExploreChartHeader.test.tsx?ref=ef0734b4cc84cee9b29492765d38f1071adf6359", "patch": "@@ -383,6 +383,34 @@ describe('ExploreChartHeader', () => {\n \n     expect(setShowModal).toHaveBeenCalledWith(false);\n   });\n+\n+  test('renders Matrixify tag when matrixify is enabled', async () => {\n+    const props = createProps({\n+      formData: {\n+        ...createProps().chart.latestQueryFormData,\n+        matrixify_enable_vertical_layout: true,\n+        matrixify_mode_rows: 'metrics',\n+        matrixify_rows: [{ label: 'COUNT(*)', expressionType: 'SIMPLE' }],\n+      },\n+    });\n+    render(<ExploreHeader {...props} />, { useRedux: true });\n+\n+    const matrixifyTag = await screen.findByText('Matrixify');\n+    expect(matrixifyTag).toBeInTheDocument();\n+  });\n+\n+  test('does not render Matrixify tag when matrixify is disabled', async () => {\n+    const props = createProps({\n+      formData: {\n+        ...createProps().chart.latestQueryFormData,\n+      },\n+    });\n+    render(<ExploreHeader {...props} />, { useRedux: true });\n+\n+    await waitFor(() => {\n+      expect(screen.queryByText('Matrixify')).not.toBeInTheDocument();\n+    });\n+  });\n });\n \n // eslint-disable-next-line no-restricted-globals -- TODO: Migrate from describe blocks", "pull_request_number": 37247}
{"sha": "857e5032f26b7a09eb463c8c334c19ede0d5ceab", "filename": "superset-frontend/src/explore/components/ExploreChartHeader/index.jsx", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/apache/superset/blob/ef0734b4cc84cee9b29492765d38f1071adf6359/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2FExploreChartHeader%2Findex.jsx", "raw_url": "https://github.com/apache/superset/raw/ef0734b4cc84cee9b29492765d38f1071adf6359/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2FExploreChartHeader%2Findex.jsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fexplore%2Fcomponents%2FExploreChartHeader%2Findex.jsx?ref=ef0734b4cc84cee9b29492765d38f1071adf6359", "patch": "@@ -27,7 +27,7 @@ import {\n   UnsavedChangesModal,\n } from '@superset-ui/core/components';\n import { AlteredSliceTag } from 'src/components';\n-import { SupersetClient } from '@superset-ui/core';\n+import { SupersetClient, isMatrixifyEnabled } from '@superset-ui/core';\n import { logging } from '@apache-superset/core';\n import { css, t } from '@apache-superset/core/ui';\n import { chartPropShape } from 'src/dashboard/util/propShapes';\n@@ -42,6 +42,7 @@ import { deleteActiveReport } from 'src/features/reports/ReportModal/actions';\n import { useUnsavedChangesPrompt } from 'src/hooks/useUnsavedChangesPrompt';\n import { getChartFormDiffs } from 'src/utils/getChartFormDiffs';\n import { StreamingExportModal } from 'src/components/StreamingExportModal';\n+import { Tag } from 'src/components/Tag';\n import { useExploreAdditionalActionsMenu } from '../useExploreAdditionalActionsMenu';\n import { useExploreMetadataBar } from './useExploreMetadataBar';\n \n@@ -272,6 +273,9 @@ export const ExploreChartHeader = ({\n                 currentFormData={currentFormData}\n               />\n             ) : null}\n+            {formData && isMatrixifyEnabled(formData) && (\n+              <Tag name=\"Matrixify\" color=\"purple\" />\n+            )}\n             {metadataBar}\n           </div>\n         }", "pull_request_number": 37247}
{"sha": "107a7e2d022415d9086fcefc9d5d92eb5890fc0e", "filename": "superset-frontend/src/pages/ChartList/ChartList.test.tsx", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/apache/superset/blob/ef0734b4cc84cee9b29492765d38f1071adf6359/superset-frontend%2Fsrc%2Fpages%2FChartList%2FChartList.test.tsx", "raw_url": "https://github.com/apache/superset/raw/ef0734b4cc84cee9b29492765d38f1071adf6359/superset-frontend%2Fsrc%2Fpages%2FChartList%2FChartList.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fpages%2FChartList%2FChartList.test.tsx?ref=ef0734b4cc84cee9b29492765d38f1071adf6359", "patch": "@@ -17,7 +17,12 @@\n  * under the License.\n  */\n import fetchMock from 'fetch-mock';\n-import { screen, waitFor, fireEvent } from 'spec/helpers/testing-library';\n+import {\n+  screen,\n+  waitFor,\n+  fireEvent,\n+  within,\n+} from 'spec/helpers/testing-library';\n import { isFeatureEnabled } from '@superset-ui/core';\n import {\n   API_ENDPOINTS,\n@@ -245,6 +250,34 @@ describe('ChartList', () => {\n     );\n   });\n \n+  test('displays Matrixify tag for charts with matrixify enabled', async () => {\n+    renderChartList(mockUser);\n+\n+    // Wait for the chart list to load\n+    await waitFor(() => {\n+      expect(screen.getByText('Test Chart 0')).toBeInTheDocument();\n+    });\n+\n+    // Find the row containing Test Chart 0 (which has matrixify enabled)\n+    const chart0Row = screen.getByText('Test Chart 0').closest('tr');\n+    expect(chart0Row).toBeInTheDocument();\n+\n+    // Check that the Matrixify tag is present in this row\n+    const matrixifyTag = within(chart0Row as HTMLElement).getByText(\n+      'Matrixify',\n+    );\n+    expect(matrixifyTag).toBeInTheDocument();\n+\n+    // Find the row containing Test Chart 1 (which doesn't have matrixify)\n+    const chart1Row = screen.getByText('Test Chart 1').closest('tr');\n+    expect(chart1Row).toBeInTheDocument();\n+\n+    // Check that the Matrixify tag is NOT present in this row\n+    expect(\n+      within(chart1Row as HTMLElement).queryByText('Matrixify'),\n+    ).not.toBeInTheDocument();\n+  });\n+\n   test('handles API errors gracefully', async () => {\n     // Mock API failure\n     fetchMock.get(", "pull_request_number": 37247}
{"sha": "a6578935466d87185ffb5280c81ec24ec53fd509", "filename": "superset-frontend/src/pages/ChartList/ChartList.testHelpers.tsx", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/apache/superset/blob/ef0734b4cc84cee9b29492765d38f1071adf6359/superset-frontend%2Fsrc%2Fpages%2FChartList%2FChartList.testHelpers.tsx", "raw_url": "https://github.com/apache/superset/raw/ef0734b4cc84cee9b29492765d38f1071adf6359/superset-frontend%2Fsrc%2Fpages%2FChartList%2FChartList.testHelpers.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fpages%2FChartList%2FChartList.testHelpers.tsx?ref=ef0734b4cc84cee9b29492765d38f1071adf6359", "patch": "@@ -60,6 +60,14 @@ export const mockCharts = [\n     thumbnail_url: '/api/v1/chart/0/thumbnail/',\n     certified_by: null,\n     certification_details: null,\n+\n+    // Add form_data with matrixify enabled\n+    form_data: {\n+      viz_type: 'table',\n+      matrixify_enable_vertical_layout: true,\n+      matrixify_mode_rows: 'metrics',\n+      matrixify_rows: [{ label: 'COUNT(*)', expressionType: 'SIMPLE' }],\n+    },\n   },\n   {\n     id: 1,\n@@ -102,6 +110,11 @@ export const mockCharts = [\n     thumbnail_url: '/api/v1/chart/1/thumbnail/',\n     certified_by: 'Data Team',\n     certification_details: 'Approved for production use',\n+\n+    // Add form_data without matrixify\n+    form_data: {\n+      viz_type: 'bar',\n+    },\n   },\n   {\n     id: 2,", "pull_request_number": 37247}
{"sha": "f0ff7fb5475a823fb7b37fd96eed39dad1829c88", "filename": "superset-frontend/src/pages/ChartList/index.tsx", "status": "modified", "additions": 19, "deletions": 4, "changes": 23, "blob_url": "https://github.com/apache/superset/blob/ef0734b4cc84cee9b29492765d38f1071adf6359/superset-frontend%2Fsrc%2Fpages%2FChartList%2Findex.tsx", "raw_url": "https://github.com/apache/superset/raw/ef0734b4cc84cee9b29492765d38f1071adf6359/superset-frontend%2Fsrc%2Fpages%2FChartList%2Findex.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fpages%2FChartList%2Findex.tsx?ref=ef0734b4cc84cee9b29492765d38f1071adf6359", "patch": "@@ -16,15 +16,16 @@\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n-import { t } from '@apache-superset/core';\n+import { t, SupersetTheme } from '@apache-superset/core';\n import {\n   isFeatureEnabled,\n   FeatureFlag,\n   getChartMetadataRegistry,\n   JsonResponse,\n   SupersetClient,\n+  isMatrixifyEnabled,\n } from '@superset-ui/core';\n-import { styled } from '@apache-superset/core/ui';\n+import { css, styled } from '@apache-superset/core/ui';\n import { useState, useMemo, useCallback } from 'react';\n import rison from 'rison';\n import { uniqBy } from 'lodash';\n@@ -78,6 +79,7 @@ import { UserWithPermissionsAndRoles } from 'src/types/bootstrapTypes';\n import { findPermission } from 'src/utils/findPermission';\n import { QueryObjectColumns } from 'src/views/CRUD/types';\n import { WIDER_DROPDOWN_WIDTH } from 'src/components/ListView/utils';\n+import { Tag } from 'src/components/Tag';\n \n const FlexRowContainer = styled.div`\n   align-items: center;\n@@ -375,9 +377,22 @@ function ChartList(props: ChartListProps) {\n       {\n         Cell: ({\n           row: {\n-            original: { viz_type: vizType },\n+            original: { viz_type: vizType, form_data: formData },\n           },\n-        }: any) => registry.get(vizType)?.name || vizType,\n+        }: any) => (\n+          <>\n+            {registry.get(vizType)?.name || vizType}\n+            {formData && isMatrixifyEnabled(formData) && (\n+              <span\n+                css={(theme: SupersetTheme) => css`\n+                  margin-left: ${theme.marginXS}px;\n+                `}\n+              >\n+                <Tag name=\"Matrixify\" color=\"purple\" />\n+              </span>\n+            )}\n+          </>\n+        ),\n         Header: t('Type'),\n         accessor: 'viz_type',\n         id: 'viz_type',", "pull_request_number": 37247}
{"sha": "9212936686b6cac6c116a71741deaa10f3b7fa55", "filename": "superset-frontend/plugins/plugin-chart-ag-grid-table/src/buildQuery.ts", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/apache/superset/blob/4d064097148cff9139e7ca654a3cdfcebf04f63a/superset-frontend%2Fplugins%2Fplugin-chart-ag-grid-table%2Fsrc%2FbuildQuery.ts", "raw_url": "https://github.com/apache/superset/raw/4d064097148cff9139e7ca654a3cdfcebf04f63a/superset-frontend%2Fplugins%2Fplugin-chart-ag-grid-table%2Fsrc%2FbuildQuery.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-ag-grid-table%2Fsrc%2FbuildQuery.ts?ref=4d064097148cff9139e7ca654a3cdfcebf04f63a", "patch": "@@ -120,6 +120,12 @@ const buildQuery: BuildQuery<TableChartFormData> = (\n       }\n     }\n \n+    // Dashboard filter override - allows dashboard-level time shifts to OVERRIDE\n+    // chart-level time shift settings (from PRs #33947 and #34014)\n+    if (extra_form_data?.time_compare) {\n+      timeOffsets = [extra_form_data.time_compare];\n+    }\n+\n     let temporalColumnAdded = false;\n     let temporalColumn = null;\n ", "pull_request_number": 37072}
{"sha": "4ab4d8139ba06e596c0c2fe21ccf6101cbbad6f1", "filename": "superset-frontend/plugins/plugin-chart-ag-grid-table/src/controlPanel.tsx", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/apache/superset/blob/4d064097148cff9139e7ca654a3cdfcebf04f63a/superset-frontend%2Fplugins%2Fplugin-chart-ag-grid-table%2Fsrc%2FcontrolPanel.tsx", "raw_url": "https://github.com/apache/superset/raw/4d064097148cff9139e7ca654a3cdfcebf04f63a/superset-frontend%2Fplugins%2Fplugin-chart-ag-grid-table%2Fsrc%2FcontrolPanel.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-ag-grid-table%2Fsrc%2FcontrolPanel.tsx?ref=4d064097148cff9139e7ca654a3cdfcebf04f63a", "patch": "@@ -43,9 +43,7 @@ import {\n import { t } from '@apache-superset/core';\n import {\n   ensureIsArray,\n-  FeatureFlag,\n   isAdhocColumn,\n-  isFeatureEnabled,\n   isPhysicalColumn,\n   validateInteger,\n   QueryFormColumn,\n@@ -752,9 +750,7 @@ const config: ControlPanelConfig = {\n         showCalculationType: false,\n         showFullChoices: false,\n       }),\n-      visibility: ({ controls }) =>\n-        isAggMode({ controls }) &&\n-        isFeatureEnabled(FeatureFlag.TableV2TimeComparisonEnabled),\n+      visibility: isAggMode,\n     },\n   ],\n   formDataOverrides: formData => ({", "pull_request_number": 37072}
{"sha": "73cee040fa9660fa0208e4faa19a2772a6dc6bbb", "filename": "superset-frontend/plugins/plugin-chart-ag-grid-table/src/transformProps.ts", "status": "modified", "additions": 12, "deletions": 6, "changes": 18, "blob_url": "https://github.com/apache/superset/blob/4d064097148cff9139e7ca654a3cdfcebf04f63a/superset-frontend%2Fplugins%2Fplugin-chart-ag-grid-table%2Fsrc%2FtransformProps.ts", "raw_url": "https://github.com/apache/superset/raw/4d064097148cff9139e7ca654a3cdfcebf04f63a/superset-frontend%2Fplugins%2Fplugin-chart-ag-grid-table%2Fsrc%2FtransformProps.ts", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-ag-grid-table%2Fsrc%2FtransformProps.ts?ref=4d064097148cff9139e7ca654a3cdfcebf04f63a", "patch": "@@ -25,20 +25,18 @@ import {\n   DataRecord,\n   ensureIsArray,\n   extractTimegrain,\n-  FeatureFlag,\n   getMetricLabel,\n   getNumberFormatter,\n   getTimeFormatter,\n   getTimeFormatterForGranularity,\n-  isFeatureEnabled,\n   NumberFormats,\n   QueryMode,\n   SMART_DATE_ID,\n   TimeFormats,\n   TimeFormatter,\n } from '@superset-ui/core';\n import { GenericDataType } from '@apache-superset/core/api/core';\n-import { isEmpty, isEqual } from 'lodash';\n+import { isEmpty, isEqual, merge } from 'lodash';\n import {\n   ConditionalFormattingConfig,\n   getColorFormatters,\n@@ -465,7 +463,7 @@ const transformProps = (\n   const {\n     height,\n     width,\n-    rawFormData: formData,\n+    rawFormData: originalFormData,\n     queriesData = [],\n     ownState: serverPaginationData,\n     filterState,\n@@ -474,6 +472,15 @@ const transformProps = (\n     theme,\n   } = chartProps;\n \n+  // Merge extra_form_data (dashboard filter overrides) into formData\n+  // This ensures dashboard-level settings (like time_compare) override chart-level settings\n+  // From PRs #33947 and #34014\n+  const formData = merge(\n+    {},\n+    originalFormData,\n+    originalFormData.extra_form_data,\n+  );\n+\n   const {\n     include_search: includeSearch = false,\n     page_length: pageLength,\n@@ -499,8 +506,7 @@ const transformProps = (\n   const isUsingTimeComparison =\n     !isEmpty(time_compare) &&\n     queryMode === QueryMode.Aggregate &&\n-    comparison_type === ComparisonType.Values &&\n-    isFeatureEnabled(FeatureFlag.TableV2TimeComparisonEnabled);\n+    comparison_type === ComparisonType.Values;\n \n   const nonCustomNorInheritShifts = ensureIsArray(formData.time_compare).filter(\n     (shift: string) => shift !== 'custom' && shift !== 'inherit',", "pull_request_number": 37072}
{"sha": "e767aa510946959adafad42be9769ea2a1526ed2", "filename": "superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigModal.test.tsx", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/apache/superset/blob/4d064097148cff9139e7ca654a3cdfcebf04f63a/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FnativeFilters%2FFiltersConfigModal%2FFiltersConfigModal.test.tsx", "raw_url": "https://github.com/apache/superset/raw/4d064097148cff9139e7ca654a3cdfcebf04f63a/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FnativeFilters%2FFiltersConfigModal%2FFiltersConfigModal.test.tsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FnativeFilters%2FFiltersConfigModal%2FFiltersConfigModal.test.tsx?ref=4d064097148cff9139e7ca654a3cdfcebf04f63a", "patch": "@@ -497,7 +497,7 @@ test('deletes a filter including dependencies', async () => {\n       }),\n     ),\n   );\n-});\n+}, 30000);\n \n test('switches the order between two filters', async () => {\n   const nativeFilterState = [", "pull_request_number": 37072}
{"sha": "23e0a4bf81d18cdcf06992299720c8184f043b81", "filename": "superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx", "status": "modified", "additions": 18, "deletions": 2, "changes": 20, "blob_url": "https://github.com/apache/superset/blob/3974eea1e6bf0da2c773bf33a48b725174331caf/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2Freact-pivottable%2FTableRenderers.jsx", "raw_url": "https://github.com/apache/superset/raw/3974eea1e6bf0da2c773bf33a48b725174331caf/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2Freact-pivottable%2FTableRenderers.jsx", "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fplugins%2Fplugin-chart-pivot-table%2Fsrc%2Freact-pivottable%2FTableRenderers.jsx?ref=3974eea1e6bf0da2c773bf33a48b725174331caf", "patch": "@@ -491,7 +491,15 @@ export class TableRenderer extends Component {\n               true,\n             )}\n           >\n-            {t('Subtotal')}\n+            {allowRenderHtml\n+              ? safeHtmlSpan(\n+                  t('Aggregate (%(aggregatorName)s)', {\n+                    aggregatorName: t(this.props.aggregatorName),\n+                  }),\n+                )\n+              : t('Aggregate (%(aggregatorName)s)', {\n+                  aggregatorName: t(this.props.aggregatorName),\n+                })}\n           </th>,\n         );\n       }\n@@ -704,7 +712,15 @@ export class TableRenderer extends Component {\n             true,\n           )}\n         >\n-          {t('Subtotal')}\n+          {allowRenderHtml\n+            ? safeHtmlSpan(\n+                t('Aggregate (%(aggregatorName)s)', {\n+                  aggregatorName: t(this.props.aggregatorName),\n+                }),\n+              )\n+            : t('Aggregate (%(aggregatorName)s)', {\n+                aggregatorName: t(this.props.aggregatorName),\n+              })}\n         </th>\n       ) : null;\n ", "pull_request_number": 36606}
